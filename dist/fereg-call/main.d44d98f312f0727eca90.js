(self.webpackChunkfereg_call=self.webpackChunkfereg_call||[]).push([[179],{8255:e=>{function t(e){return Promise.resolve().then(()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}t.keys=()=>[],t.resolve=t,t.id=8255,e.exports=t},7368:(e,t,n)=>{"use strict";n.d(t,{deG:()=>nn,tb:()=>Cc,AFp:()=>Tc,ip1:()=>Ec,CZH:()=>Sc,hGG:()=>Eu,z2F:()=>lu,sBO:()=>Ia,Sil:()=>Vc,_Vd:()=>Js,EJc:()=>Nc,SBq:()=>ea,qLn:()=>br,vpe:()=>tc,gxx:()=>uo,tBr:()=>wn,XFs:()=>k,OlP:()=>tn,zs3:()=>Ro,ZZ4:()=>ya,aQg:()=>Sa,soG:()=>Oc,YKP:()=>Ma,v3s:()=>du,h0i:()=>xa,PXZ:()=>ou,R0b:()=>jc,FiY:()=>Rn,Lbi:()=>Ic,g9A:()=>Rc,n_E:()=>rc,Qsj:()=>ra,FYo:()=>na,JOm:()=>Ir,Tiy:()=>oa,q3G:()=>fr,tp0:()=>In,EAV:()=>mu,Rgc:()=>ka,dDg:()=>Yc,DyG:()=>rn,q4F:()=>aa,GfV:()=>sa,s_b:()=>Va,ifc:()=>U,eFA:()=>su,G48:()=>ru,Gpc:()=>m,f3M:()=>Sn,X6Q:()=>nu,_c5:()=>vu,VLi:()=>Xc,c2e:()=>Ac,zSh:()=>ho,wAp:()=>Ms,vHH:()=>v,EiD:()=>dr,mCW:()=>Qn,qzn:()=>Vn,JVY:()=>Bn,pB0:()=>Hn,eBb:()=>Gn,L6k:()=>jn,LAX:()=>qn,cg1:()=>Ps,Tjo:()=>_u,kL8:()=>Ls,yhl:()=>Fn,dqk:()=>G,sIi:()=>Lo,CqO:()=>$o,QGY:()=>Jo,F4k:()=>Xo,RDi:()=>Ie,AaK:()=>d,z3N:()=>Un,qOj:()=>Co,TTD:()=>Ee,_Bn:()=>Ks,xp6:()=>pi,uIk:()=>Uo,Gre:()=>As,ekj:()=>ps,Suo:()=>mc,Xpm:()=>Z,lG2:()=>se,Yz7:()=>T,cJS:()=>b,oAB:()=>re,Yjl:()=>ae,Y36:()=>jo,_UZ:()=>zo,BQk:()=>Yo,ynx:()=>Ko,qZA:()=>Wo,TgZ:()=>Ho,EpF:()=>Qo,n5z:()=>Jt,Ikx:()=>Os,LFG:()=>En,$8M:()=>$t,NdJ:()=>Zo,CRH:()=>gc,oxw:()=>ns,Hsn:()=>os,F$t:()=>is,Q6J:()=>Go,DdM:()=>Za,iGM:()=>pc,MAs:()=>Bo,CHM:()=>He,oJD:()=>mr,LSH:()=>gr,kYT:()=>ie,Udp:()=>ds,YNc:()=>Fo,_uU:()=>ws,Oqu:()=>Rs,hij:()=>Is,AsE:()=>Cs,Gf:()=>fc});var r=n(5959),i=n(7570),o=n(8318),s=n(1906),a=n(2875),c=n(1564);function u(){return new r.xQ}function l(e){for(let t in e)if(e[t]===l)return t;throw Error("Could not find renamed property on target object.")}function h(e,t){for(const n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function d(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(d).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function p(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const f=l({__forward_ref__:l});function m(e){return e.__forward_ref__=m,e.toString=function(){return d(this())},e}function g(e){return _(e)?e():e}function _(e){return"function"==typeof e&&e.hasOwnProperty(f)&&e.__forward_ref__===m}class v extends Error{constructor(e,t){super(function(e,t){return`${e?`NG0${e}: `:""}${t}`}(e,t)),this.code=e}}function y(e){return"string"==typeof e?e:null==e?"":String(e)}function E(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():y(e)}function S(e,t){const n=t?` in ${t}`:"";throw new v("201",`No provider for ${E(e)} found${n}`)}function T(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function b(e){return{providers:e.providers||[],imports:e.imports||[]}}function w(e){return R(e,C)||R(e,O)}function R(e,t){return e.hasOwnProperty(t)?e[t]:null}function I(e){return e&&(e.hasOwnProperty(A)||e.hasOwnProperty(N))?e[A]:null}const C=l({"\u0275prov":l}),A=l({"\u0275inj":l}),O=l({ngInjectableDef:l}),N=l({ngInjectorDef:l});var k=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});let D;function P(e){const t=D;return D=e,t}function L(e,t,n){const r=w(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&k.Optional?null:void 0!==t?t:void S(d(e),"Injector")}function x(e){return{toString:e}.toString()}var M=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}({}),U=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}({});const V="undefined"!=typeof globalThis&&globalThis,F="undefined"!=typeof window&&window,B="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,j="undefined"!=typeof global&&global,G=V||j||F||B,q={},H=[],W=l({"\u0275cmp":l}),z=l({"\u0275dir":l}),K=l({"\u0275pipe":l}),Y=l({"\u0275mod":l}),Q=l({"\u0275loc":l}),J=l({"\u0275fac":l}),X=l({__NG_ELEMENT_ID__:l});let $=0;function Z(e){return x(()=>{const t={},n={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===M.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||H,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||U.Emulated,id:"c",styles:e.styles||H,_:null,setInput:null,schemas:e.schemas||null,tView:null},r=e.directives,i=e.features,o=e.pipes;return n.id+=$++,n.inputs=oe(e.inputs,t),n.outputs=oe(e.outputs),i&&i.forEach(e=>e(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(ee):null,n.pipeDefs=o?()=>("function"==typeof o?o():o).map(te):null,n})}function ee(e){return ce(e)||function(e){return e[z]||null}(e)}function te(e){return function(e){return e[K]||null}(e)}const ne={};function re(e){return x(()=>{const t={type:e.type,bootstrap:e.bootstrap||H,declarations:e.declarations||H,imports:e.imports||H,exports:e.exports||H,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&(ne[e.id]=e.type),t})}function ie(e,t){return x(()=>{const n=ue(e,!0);n.declarations=t.declarations||H,n.imports=t.imports||H,n.exports=t.exports||H})}function oe(e,t){if(null==e)return q;const n={};for(const r in e)if(e.hasOwnProperty(r)){let i=e[r],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),n[i]=r,t&&(t[i]=o)}return n}const se=Z;function ae(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,onDestroy:e.type.prototype.ngOnDestroy||null}}function ce(e){return e[W]||null}function ue(e,t){const n=e[Y]||null;if(!n&&!0===t)throw new Error(`Type ${d(e)} does not have '\u0275mod' property.`);return n}const le=20,he=10;function de(e){return Array.isArray(e)&&"object"==typeof e[1]}function pe(e){return Array.isArray(e)&&!0===e[1]}function fe(e){return 0!=(8&e.flags)}function me(e){return 2==(2&e.flags)}function ge(e){return 1==(1&e.flags)}function _e(e){return null!==e.template}function ve(e,t){return e.hasOwnProperty(J)?e[J]:null}class ye{constructor(e,t,n){this.previousValue=e,this.currentValue=t,this.firstChange=n}isFirstChange(){return this.firstChange}}function Ee(){return Se}function Se(e){return e.type.prototype.ngOnChanges&&(e.setInput=be),Te}function Te(){const e=we(this),t=null==e?void 0:e.current;if(t){const n=e.previous;if(n===q)e.previous=t;else for(let e in t)n[e]=t[e];e.current=null,this.ngOnChanges(t)}}function be(e,t,n,r){const i=we(e)||function(e,t){return e.__ngSimpleChanges__=t}(e,{previous:q,current:null}),o=i.current||(i.current={}),s=i.previous,a=this.declaredInputs[n],c=s[a];o[a]=new ye(c&&c.currentValue,t,s===q),e[r]=t}function we(e){return e.__ngSimpleChanges__||null}let Re;function Ie(e){Re=e}function Ce(){return void 0!==Re?Re:"undefined"!=typeof document?document:void 0}function Ae(e){return!!e.listen}Ee.ngInherit=!0;const Oe={createRenderer:(e,t)=>Ce()};function Ne(e){for(;Array.isArray(e);)e=e[0];return e}function ke(e,t){return Ne(t[e])}function De(e,t){return Ne(t[e.index])}function Pe(e,t){return e.data[t]}function Le(e,t){const n=t[e];return de(n)?n:n[0]}function xe(e){return 4==(4&e[2])}function Me(e){return 128==(128&e[2])}function Ue(e,t){return null==t?null:e[t]}function Ve(e){e[18]=0}function Fe(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const Be={lFrame:ct(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function je(){return Be.bindingsEnabled}function Ge(){return Be.lFrame.lView}function qe(){return Be.lFrame.tView}function He(e){return Be.lFrame.contextLView=e,e[8]}function We(){let e=ze();for(;null!==e&&64===e.type;)e=e.parent;return e}function ze(){return Be.lFrame.currentTNode}function Ke(e,t){const n=Be.lFrame;n.currentTNode=e,n.isParent=t}function Ye(){return Be.lFrame.isParent}function Qe(){Be.lFrame.isParent=!1}function Je(){return Be.isInCheckNoChangesMode}function Xe(e){Be.isInCheckNoChangesMode=e}function $e(){return Be.lFrame.bindingIndex++}function Ze(e){const t=Be.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}function et(e,t){const n=Be.lFrame;n.bindingIndex=n.bindingRootIndex=e,tt(t)}function tt(e){Be.lFrame.currentDirectiveIndex=e}function nt(){return Be.lFrame.currentQueryIndex}function rt(e){Be.lFrame.currentQueryIndex=e}function it(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function ot(e,t,n){if(n&k.SkipSelf){let r=t,i=e;for(;r=r.parent,!(null!==r||n&k.Host||(r=it(i),null===r)||(i=i[15],10&r.type)););if(null===r)return!1;t=r,e=i}const r=Be.lFrame=at();return r.currentTNode=t,r.lView=e,!0}function st(e){const t=at(),n=e[1];Be.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function at(){const e=Be.lFrame,t=null===e?null:e.child;return null===t?ct(e):t}function ct(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function ut(){const e=Be.lFrame;return Be.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const lt=ut;function ht(){const e=ut();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function dt(){return Be.lFrame.selectedIndex}function pt(e){Be.lFrame.selectedIndex=e}function ft(){const e=Be.lFrame;return Pe(e.tView,e.selectedIndex)}function mt(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const t=e.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:o,ngAfterViewChecked:s,ngOnDestroy:a}=t;r&&(e.contentHooks||(e.contentHooks=[])).push(-n,r),i&&((e.contentHooks||(e.contentHooks=[])).push(n,i),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i)),o&&(e.viewHooks||(e.viewHooks=[])).push(-n,o),s&&((e.viewHooks||(e.viewHooks=[])).push(n,s),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,s)),null!=a&&(e.destroyHooks||(e.destroyHooks=[])).push(n,a)}}function gt(e,t,n){yt(e,t,3,n)}function _t(e,t,n,r){(3&e[2])===n&&yt(e,t,n,r)}function vt(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function yt(e,t,n,r){const i=null!=r?r:-1,o=t.length-1;let s=0;for(let a=void 0!==r?65535&e[18]:0;a<o;a++)if("number"==typeof t[a+1]){if(s=t[a],null!=r&&s>=r)break}else t[a]<0&&(e[18]+=65536),(s<i||-1==i)&&(Et(e,n,t,a),e[18]=(4294901760&e[18])+a+2),a++}function Et(e,t,n,r){const i=n[r]<0,o=n[r+1],s=e[i?-n[r]:n[r]];if(i){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{o.call(s)}finally{}}}else try{o.call(s)}finally{}}const St=-1;class Tt{constructor(e,t,n){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=n}}function bt(e,t,n){const r=Ae(e);let i=0;for(;i<n.length;){const o=n[i];if("number"==typeof o){if(0!==o)break;i++;const s=n[i++],a=n[i++],c=n[i++];r?e.setAttribute(t,a,c,s):t.setAttributeNS(s,a,c)}else{const s=o,a=n[++i];Rt(s)?r&&e.setProperty(t,s,a):r?e.setAttribute(t,s,a):t.setAttribute(s,a),i++}}return i}function wt(e){return 3===e||4===e||6===e}function Rt(e){return 64===e.charCodeAt(0)}function It(e,t){if(null===t||0===t.length);else if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||Ct(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function Ct(e,t,n,r,i){let o=0,s=e.length;if(-1===t)s=-1;else for(;o<e.length;){const n=e[o++];if("number"==typeof n){if(n===t){s=-1;break}if(n>t){s=o-1;break}}}for(;o<e.length;){const t=e[o];if("number"==typeof t)break;if(t===n){if(null===r)return void(null!==i&&(e[o+1]=i));if(r===e[o+1])return void(e[o+2]=i)}o++,null!==r&&o++,null!==i&&o++}-1!==s&&(e.splice(s,0,t),o=s+1),e.splice(o++,0,n),null!==r&&e.splice(o++,0,r),null!==i&&e.splice(o++,0,i)}function At(e){return e!==St}function Ot(e){return 32767&e}function Nt(e,t){let n=e>>16,r=t;for(;n>0;)r=r[15],n--;return r}let kt=!0;function Dt(e){const t=kt;return kt=e,t}let Pt=0;function Lt(e,t){const n=Mt(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,xt(r.data,e),xt(t,null),xt(r.blueprint,null));const i=Ut(e,t),o=e.injectorIndex;if(At(i)){const e=Ot(i),n=Nt(i,t),r=n[1].data;for(let i=0;i<8;i++)t[o+i]=n[e+i]|r[e+i]}return t[o+8]=i,o}function xt(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Mt(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Ut(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){const e=i[1],t=e.type;if(r=2===t?e.declTNode:1===t?i[6]:null,null===r)return St;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return St}function Vt(e,t,n){!function(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(X)&&(r=n[X]),null==r&&(r=n[X]=Pt++);const i=255&r;t.data[e+(i>>5)]|=1<<i}(e,t,n)}function Ft(e,t,n){if(n&k.Optional)return e;S(t,"NodeInjector")}function Bt(e,t,n,r){if(n&k.Optional&&void 0===r&&(r=null),0==(n&(k.Self|k.Host))){const i=e[9],o=P(void 0);try{return i?i.get(t,r,n&k.Optional):L(t,r,n&k.Optional)}finally{P(o)}}return Ft(r,t,n)}function jt(e,t,n,r=k.Default,i){if(null!==e){const o=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(X)?e[X]:void 0;return"number"==typeof t?t>=0?255&t:qt:t}(n);if("function"==typeof o){if(!ot(t,e,r))return r&k.Host?Ft(i,n,r):Bt(t,n,r,i);try{const e=o(r);if(null!=e||r&k.Optional)return e;S(n)}finally{lt()}}else if("number"==typeof o){let i=null,s=Mt(e,t),a=St,c=r&k.Host?t[16][6]:null;for((-1===s||r&k.SkipSelf)&&(a=-1===s?Ut(e,t):t[s+8],a!==St&&Yt(r,!1)?(i=t[1],s=Ot(a),t=Nt(a,t)):s=-1);-1!==s;){const e=t[1];if(Kt(o,s,e.data)){const e=Ht(s,t,n,i,r,c);if(e!==Gt)return e}a=t[s+8],a!==St&&Yt(r,t[1].data[s+8]===c)&&Kt(o,s,t)?(i=e,s=Ot(a),t=Nt(a,t)):s=-1}}}return Bt(t,n,r,i)}const Gt={};function qt(){return new Qt(We(),Ge())}function Ht(e,t,n,r,i,o){const s=t[1],a=s.data[e+8],c=Wt(a,s,n,null==r?me(a)&&kt:r!=s&&0!=(3&a.type),i&k.Host&&o===a);return null!==c?zt(t,s,c,a):Gt}function Wt(e,t,n,r,i){const o=e.providerIndexes,s=t.data,a=1048575&o,c=e.directiveStart,u=o>>20,l=i?a+u:e.directiveEnd;for(let h=r?a:a+u;h<l;h++){const e=s[h];if(h<c&&n===e||h>=c&&e.type===n)return h}if(i){const e=s[c];if(e&&_e(e)&&e.type===n)return c}return null}function zt(e,t,n,r){let i=e[n];const o=t.data;if(i instanceof Tt){const s=i;s.resolving&&function(e,t){throw new v("200",`Circular dependency in DI detected for ${e}`)}(E(o[n]));const a=Dt(s.canSeeViewProviders);s.resolving=!0;const c=s.injectImpl?P(s.injectImpl):null;ot(e,r,k.Default);try{i=e[n]=s.factory(void 0,o,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:o}=t.type.prototype;if(r){const r=Se(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,i),o&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,o),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,o))}(n,o[n],t)}finally{null!==c&&P(c),Dt(a),s.resolving=!1,lt()}}return i}function Kt(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function Yt(e,t){return!(e&k.Self||e&k.Host&&t)}class Qt{constructor(e,t){this._tNode=e,this._lView=t}get(e,t){return jt(this._tNode,this._lView,e,void 0,t)}}function Jt(e){return x(()=>{const t=e.prototype.constructor,n=t[J]||Xt(t),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const e=i[J]||Xt(i);if(e&&e!==n)return e;i=Object.getPrototypeOf(i)}return e=>new e})}function Xt(e){return _(e)?()=>{const t=Xt(g(e));return t&&t()}:ve(e)}function $t(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const e=n.length;let r=0;for(;r<e;){const i=n[r];if(wt(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<e&&"string"==typeof n[r];)r++;else{if(i===t)return n[r+1];r+=2}}}return null}(We(),e)}const Zt="__parameters__";function en(e,t,n){return x(()=>{const r=function(e){return function(...t){if(e){const n=e(...t);for(const e in n)this[e]=n[e]}}}(t);function i(...e){if(this instanceof i)return r.apply(this,e),this;const t=new i(...e);return n.annotation=t,n;function n(e,n,r){const i=e.hasOwnProperty(Zt)?e[Zt]:Object.defineProperty(e,Zt,{value:[]})[Zt];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(t),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}class tn{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=T({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const nn=new tn("AnalyzeForEntryComponents"),rn=Function;function on(e,t){void 0===t&&(t=e);for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)?(t===e&&(t=e.slice(0,n)),on(r,t)):t!==e&&t.push(r)}return t}function sn(e,t){e.forEach(e=>Array.isArray(e)?sn(e,t):t(e))}function an(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function cn(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function un(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}function ln(e,t,n){let r=dn(e,t);return r>=0?e[1|r]=n:(r=~r,function(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function hn(e,t){const n=dn(e,t);if(n>=0)return e[1|n]}function dn(e,t){return function(e,t,n){let r=0,i=e.length>>1;for(;i!==r;){const n=r+(i-r>>1),o=e[n<<1];if(t===o)return n<<1;o>t?i=n:r=n+1}return~(i<<1)}(e,t)}const pn={},fn=/\n/gm,mn="__source",gn=l({provide:String,useValue:l});let _n;function vn(e){const t=_n;return _n=e,t}function yn(e,t=k.Default){if(void 0===_n)throw new Error("inject() must be called from an injection context");return null===_n?L(e,void 0,t):_n.get(e,t&k.Optional?null:void 0,t)}function En(e,t=k.Default){return(D||yn)(g(e),t)}const Sn=En;function Tn(e){const t=[];for(let n=0;n<e.length;n++){const r=g(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let e,n=k.Default;for(let t=0;t<r.length;t++){const i=r[t],o=i.__NG_DI_FLAG__;"number"==typeof o?-1===o?e=i.token:n|=o:e=i}t.push(En(e,n))}else t.push(En(r))}return t}function bn(e,t){return e.__NG_DI_FLAG__=t,e.prototype.__NG_DI_FLAG__=t,e}const wn=bn(en("Inject",e=>({token:e})),-1),Rn=bn(en("Optional"),8),In=bn(en("SkipSelf"),4);let Cn,An;function On(e){var t;return(null===(t=function(){if(void 0===Cn&&(Cn=null,G.trustedTypes))try{Cn=G.trustedTypes.createPolicy("angular",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch(t){}return Cn}())||void 0===t?void 0:t.createHTML(e))||e}function Nn(e){var t;return(null===(t=function(){if(void 0===An&&(An=null,G.trustedTypes))try{An=G.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch(t){}return An}())||void 0===t?void 0:t.createHTML(e))||e}class kn{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Dn extends kn{getTypeName(){return"HTML"}}class Pn extends kn{getTypeName(){return"Style"}}class Ln extends kn{getTypeName(){return"Script"}}class xn extends kn{getTypeName(){return"URL"}}class Mn extends kn{getTypeName(){return"ResourceURL"}}function Un(e){return e instanceof kn?e.changingThisBreaksApplicationSecurity:e}function Vn(e,t){const n=Fn(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===t}function Fn(e){return e instanceof kn&&e.getTypeName()||null}function Bn(e){return new Dn(e)}function jn(e){return new Pn(e)}function Gn(e){return new Ln(e)}function qn(e){return new xn(e)}function Hn(e){return new Mn(e)}class Wn{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(On(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch(t){return null}}}class zn{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const e=this.inertDocument.createElement("html");this.inertDocument.appendChild(e);const t=this.inertDocument.createElement("body");e.appendChild(t)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=On(e),t;const n=this.inertDocument.createElement("body");return n.innerHTML=On(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}stripCustomNsAttrs(e){const t=e.attributes;for(let r=t.length-1;0<r;r--){const n=t.item(r).name;"xmlns:ns1"!==n&&0!==n.indexOf("ns1:")||e.removeAttribute(n)}let n=e.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const Kn=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Yn=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Qn(e){return(e=String(e)).match(Kn)||e.match(Yn)?e:"unsafe:"+e}function Jn(e){const t={};for(const n of e.split(","))t[n]=!0;return t}function Xn(...e){const t={};for(const n of e)for(const e in n)n.hasOwnProperty(e)&&(t[e]=!0);return t}const $n=Jn("area,br,col,hr,img,wbr"),Zn=Jn("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),er=Jn("rp,rt"),tr=Xn(er,Zn),nr=Xn($n,Xn(Zn,Jn("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Xn(er,Jn("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),tr),rr=Jn("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),ir=Jn("srcset"),or=Xn(rr,ir,Jn("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Jn("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),sr=Jn("script,style,template");class ar{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,n=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?n=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,n&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let e=this.checkClobberedElement(t,t.nextSibling);if(e){t=e;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!nr.hasOwnProperty(t))return this.sanitizedSomething=!0,!sr.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const n=e.attributes;for(let i=0;i<n.length;i++){const e=n.item(i),t=e.name,o=t.toLowerCase();if(!or.hasOwnProperty(o)){this.sanitizedSomething=!0;continue}let s=e.value;rr[o]&&(s=Qn(s)),ir[o]&&(r=s,s=(r=String(r)).split(",").map(e=>Qn(e.trim())).join(", ")),this.buf.push(" ",t,'="',lr(s),'"')}var r;return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();nr.hasOwnProperty(t)&&!$n.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(lr(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const cr=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,ur=/([^\#-~ |!])/g;function lr(e){return e.replace(/&/g,"&amp;").replace(cr,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(ur,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let hr;function dr(e,t){let n=null;try{hr=hr||function(e){const t=new zn(e);return function(){try{return!!(new window.DOMParser).parseFromString(On(""),"text/html")}catch(e){return!1}}()?new Wn(t):t}(e);let r=t?String(t):"";n=hr.getInertBodyElement(r);let i=5,o=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=o,o=n.innerHTML,n=hr.getInertBodyElement(r)}while(r!==o);return On((new ar).sanitizeChildren(pr(n)||n))}finally{if(n){const e=pr(n)||n;for(;e.firstChild;)e.removeChild(e.firstChild)}}}function pr(e){return"content"in e&&function(e){return e.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===e.nodeName}(e)?e.content:null}var fr=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}({});function mr(e){const t=_r();return t?Nn(t.sanitize(fr.HTML,e)||""):Vn(e,"HTML")?Nn(Un(e)):dr(Ce(),y(e))}function gr(e){const t=_r();return t?t.sanitize(fr.URL,e)||"":Vn(e,"URL")?Un(e):Qn(y(e))}function _r(){const e=Ge();return e&&e[12]}function vr(e,t){e.__ngContext__=t}function yr(e){const t=function(e){return e.__ngContext__||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Er(e){return e.ngDebugContext}function Sr(e){return e.ngOriginalError}function Tr(e,...t){e.error(...t)}class br{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e.ngErrorLogger||Tr}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(e){return e?Er(e)?Er(e):this._findContext(Sr(e)):null}_findOriginalError(e){let t=Sr(e);for(;t&&Sr(t);)t=Sr(t);return t}}const wr=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(G))();function Rr(e){return e instanceof Function?e():e}var Ir=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}({});function Cr(e,t){return(void 0)(e,t)}function Ar(e){const t=e[3];return pe(t)?t[3]:t}function Or(e){return kr(e[13])}function Nr(e){return kr(e[4])}function kr(e){for(;null!==e&&!pe(e);)e=e[4];return e}function Dr(e,t,n,r,i){if(null!=r){let o,s=!1;pe(r)?o=r:de(r)&&(s=!0,r=r[0]);const a=Ne(r);0===e&&null!==n?null==i?Br(t,n,a):Fr(t,n,a,i||null,!0):1===e&&null!==n?Fr(t,n,a,i||null,!0):2===e?function(e,t,n){const r=Gr(e,t);r&&function(e,t,n,r){Ae(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,a,s):3===e&&t.destroyNode(a),null!=o&&function(e,t,n,r,i){const o=n[7];o!==Ne(n)&&Dr(t,e,r,o,i);for(let s=he;s<n.length;s++){const i=n[s];Jr(i[1],i,e,t,r,o)}}(t,e,o,n,i)}}function Pr(e,t,n){return Ae(e)?e.createElement(t,n):null===n?e.createElement(t):e.createElementNS(n,t)}function Lr(e,t){const n=e[9],r=n.indexOf(t),i=t[3];1024&t[2]&&(t[2]&=-1025,Fe(i,-1)),n.splice(r,1)}function xr(e,t){if(e.length<=he)return;const n=he+t,r=e[n];if(r){const o=r[17];null!==o&&o!==e&&Lr(o,r),t>0&&(e[n-1][4]=r[4]);const s=cn(e,he+t);Jr(r[1],i=r,i[11],2,null,null),i[0]=null,i[6]=null;const a=s[19];null!==a&&a.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}var i;return r}function Mr(e,t){if(!(256&t[2])){const n=t[11];Ae(n)&&n.destroyNode&&Jr(e,t,n,3,null,null),function(e){let t=e[13];if(!t)return Ur(e[1],e);for(;t;){let n=null;if(de(t))n=t[13];else{const e=t[10];e&&(n=e)}if(!n){for(;t&&!t[4]&&t!==e;)de(t)&&Ur(t[1],t),t=t[3];null===t&&(t=e),de(t)&&Ur(t[1],t),n=t&&t[4]}t=n}}(t)}}function Ur(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const e=t[n[r]];if(!(e instanceof Tt)){const t=n[r+1];if(Array.isArray(t))for(let n=0;n<t.length;n+=2){const r=e[t[n]],i=t[n+1];try{i.call(r)}finally{}}else try{t.call(e)}finally{}}}}(e,t),function(e,t){const n=e.cleanup,r=t[7];let i=-1;if(null!==n)for(let o=0;o<n.length-1;o+=2)if("string"==typeof n[o]){const e=n[o+1],s="function"==typeof e?e(t):Ne(t[e]),a=r[i=n[o+2]],c=n[o+3];"boolean"==typeof c?s.removeEventListener(n[o],a,c):c>=0?r[i=c]():r[i=-c].unsubscribe(),o+=2}else{const e=r[i=n[o+1]];n[o].call(e)}if(null!==r){for(let e=i+1;e<r.length;e++)(0,r[e])();t[7]=null}}(e,t),1===t[1].type&&Ae(t[11])&&t[11].destroy();const n=t[17];if(null!==n&&pe(t[3])){n!==t[3]&&Lr(n,t);const r=t[19];null!==r&&r.detachView(e)}}}function Vr(e,t,n){return function(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];if(2&r.flags){const t=e.data[r.directiveStart].encapsulation;if(t===U.None||t===U.Emulated)return null}return De(r,n)}(e,t.parent,n)}function Fr(e,t,n,r,i){Ae(e)?e.insertBefore(t,n,r,i):t.insertBefore(n,r,i)}function Br(e,t,n){Ae(e)?e.appendChild(t,n):t.appendChild(n)}function jr(e,t,n,r,i){null!==r?Fr(e,t,n,r,i):Br(e,t,n)}function Gr(e,t){return Ae(e)?e.parentNode(t):t.parentNode}function qr(e,t,n){return Hr(e,t,n)}let Hr=function(e,t,n){return 40&e.type?De(e,n):null};function Wr(e,t,n,r){const i=Vr(e,r,t),o=t[11],s=qr(r.parent||t[6],r,t);if(null!=i)if(Array.isArray(n))for(let a=0;a<n.length;a++)jr(o,i,n[a],s,!1);else jr(o,i,n,s,!1)}function zr(e,t){if(null!==t){const n=t.type;if(3&n)return De(t,e);if(4&n)return Yr(-1,e[t.index]);if(8&n){const n=t.child;if(null!==n)return zr(e,n);{const n=e[t.index];return pe(n)?Yr(-1,n):Ne(n)}}if(32&n)return Cr(t,e)()||Ne(e[t.index]);{const n=Kr(e,t);return null!==n?Array.isArray(n)?n[0]:zr(Ar(e[16]),n):zr(e,t.next)}}return null}function Kr(e,t){return null!==t?e[16][6].projection[t.projection]:null}function Yr(e,t){const n=he+e+1;if(n<t.length){const e=t[n],r=e[1].firstChild;if(null!==r)return zr(e,r)}return t[7]}function Qr(e,t,n,r,i,o,s){for(;null!=n;){const a=r[n.index],c=n.type;if(s&&0===t&&(a&&vr(Ne(a),r),n.flags|=4),64!=(64&n.flags))if(8&c)Qr(e,t,n.child,r,i,o,!1),Dr(t,e,i,a,o);else if(32&c){const s=Cr(n,r);let c;for(;c=s();)Dr(t,e,i,c,o);Dr(t,e,i,a,o)}else 16&c?Xr(e,t,r,n,i,o):Dr(t,e,i,a,o);n=s?n.projectionNext:n.next}}function Jr(e,t,n,r,i,o){Qr(n,r,e.firstChild,t,i,o,!1)}function Xr(e,t,n,r,i,o){const s=n[16],a=s[6].projection[r.projection];if(Array.isArray(a))for(let c=0;c<a.length;c++)Dr(t,e,i,a[c],o);else Qr(e,t,a,s[3],i,o,!0)}function $r(e,t,n){Ae(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Zr(e,t,n){Ae(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}function ei(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const n=t.length;if(i+n===r||e.charCodeAt(i+n)<=32)return i}n=i+1}}const ti="ng-template";function ni(e,t,n){let r=0;for(;r<e.length;){let i=e[r++];if(n&&"class"===i){if(i=e[r],-1!==ei(i.toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function ri(e){return 4===e.type&&e.value!==ti}function ii(e,t,n){return t===(4!==e.type||n?e.value:ti)}function oi(e,t,n){let r=4;const i=e.attrs||[],o=function(e){for(let t=0;t<e.length;t++)if(wt(e[t]))return t;return e.length}(i);let s=!1;for(let a=0;a<t.length;a++){const c=t[a];if("number"!=typeof c){if(!s)if(4&r){if(r=2|1&r,""!==c&&!ii(e,c,n)||""===c&&1===t.length){if(si(r))return!1;s=!0}}else{const u=8&r?c:t[++a];if(8&r&&null!==e.attrs){if(!ni(e.attrs,u,n)){if(si(r))return!1;s=!0}continue}const l=ai(8&r?"class":c,i,ri(e),n);if(-1===l){if(si(r))return!1;s=!0;continue}if(""!==u){let e;e=l>o?"":i[l+1].toLowerCase();const t=8&r?e:null;if(t&&-1!==ei(t,u,0)||2&r&&u!==e){if(si(r))return!1;s=!0}}}}else{if(!s&&!si(r)&&!si(c))return!1;if(s&&si(c))continue;s=!1,r=c|1&r}}return si(r)||s}function si(e){return 0==(1&e)}function ai(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let n=!1;for(;i<t.length;){const r=t[i];if(r===e)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let e=t[++i];for(;"string"==typeof e;)e=t[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function ci(e,t,n=!1){for(let r=0;r<t.length;r++)if(oi(e,t[r],n))return!0;return!1}function ui(e,t){e:for(let n=0;n<t.length;n++){const r=t[n];if(e.length===r.length){for(let t=0;t<e.length;t++)if(e[t]!==r[t])continue e;return!0}}return!1}function li(e,t){return e?":not("+t.trim()+")":t}function hi(e){let t=e[0],n=1,r=2,i="",o=!1;for(;n<e.length;){let s=e[n];if("string"==typeof s)if(2&r){const t=e[++n];i+="["+s+(t.length>0?'="'+t+'"':"")+"]"}else 8&r?i+="."+s:4&r&&(i+=" "+s);else""===i||si(s)||(t+=li(o,i),i=""),r=s,o=o||!si(r);n++}return""!==i&&(t+=li(o,i)),t}const di={};function pi(e){fi(qe(),Ge(),dt()+e,Je())}function fi(e,t,n,r){if(!r)if(3==(3&t[2])){const r=e.preOrderCheckHooks;null!==r&&gt(t,r,n)}else{const r=e.preOrderHooks;null!==r&&_t(t,r,0,n)}pt(n)}function mi(e,t){return e<<17|t<<2}function gi(e){return e>>17&32767}function _i(e){return 2|e}function vi(e){return(131068&e)>>2}function yi(e,t){return-131069&e|t<<2}function Ei(e){return 1|e}function Si(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],o=n[r+1];if(-1!==o){const n=e.data[o];rt(i),n.contentQueries(2,t[o],o)}}}function Ti(e,t,n,r,i,o,s,a,c,u){const l=t.blueprint.slice();return l[0]=i,l[2]=140|r,Ve(l),l[3]=l[15]=e,l[8]=n,l[10]=s||e&&e[10],l[11]=a||e&&e[11],l[12]=c||e&&e[12]||null,l[9]=u||e&&e[9]||null,l[6]=o,l[16]=2==t.type?e[16]:l,l}function bi(e,t,n,r,i){let o=e.data[t];if(null===o)o=function(e,t,n,r,i){const o=ze(),s=Ye(),a=e.data[t]=function(e,t,n,r,i,o){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=a),null!==o&&(s?null==o.child&&null!==a.parent&&(o.child=a):null===o.next&&(o.next=a)),a}(e,t,n,r,i),Be.lFrame.inI18n&&(o.flags|=64);else if(64&o.type){o.type=n,o.value=r,o.attrs=i;const e=function(){const e=Be.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();o.injectorIndex=null===e?-1:e.injectorIndex}return Ke(o,!0),o}function wi(e,t,n,r){if(0===n)return-1;const i=t.length;for(let o=0;o<n;o++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function Ri(e,t,n){st(t);try{const r=e.viewQuery;null!==r&&to(1,r,n);const i=e.template;null!==i&&Ai(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&Si(e,t),e.staticViewQueries&&to(2,e.viewQuery,n);const o=e.components;null!==o&&function(e,t){for(let n=0;n<t.length;n++)Ji(e,t[n])}(t,o)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0),r}finally{t[2]&=-5,ht()}}function Ii(e,t,n,r){const i=t[2];if(256==(256&i))return;st(t);const o=Je();try{Ve(t),Be.lFrame.bindingIndex=e.bindingStartIndex,null!==n&&Ai(e,t,n,2,r);const s=3==(3&i);if(!o)if(s){const n=e.preOrderCheckHooks;null!==n&&gt(t,n,null)}else{const n=e.preOrderHooks;null!==n&&_t(t,n,0,null),vt(t,0)}if(function(e){for(let t=Or(e);null!==t;t=Nr(t)){if(!t[2])continue;const e=t[9];for(let t=0;t<e.length;t++){const n=e[t],r=n[3];0==(1024&n[2])&&Fe(r,1),n[2]|=1024}}}(t),function(e){for(let t=Or(e);null!==t;t=Nr(t))for(let e=he;e<t.length;e++){const n=t[e],r=n[1];Me(n)&&Ii(r,n,r.template,n[8])}}(t),null!==e.contentQueries&&Si(e,t),!o)if(s){const n=e.contentCheckHooks;null!==n&&gt(t,n)}else{const n=e.contentHooks;null!==n&&_t(t,n,1),vt(t,1)}!function(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let e=0;e<n.length;e++){const r=n[e];if(r<0)pt(~r);else{const i=r,o=n[++e],s=n[++e];et(o,i),s(2,t[i])}}}finally{pt(-1)}}(e,t);const a=e.components;null!==a&&function(e,t){for(let n=0;n<t.length;n++)Yi(e,t[n])}(t,a);const c=e.viewQuery;if(null!==c&&to(2,c,r),!o)if(s){const n=e.viewCheckHooks;null!==n&&gt(t,n)}else{const n=e.viewHooks;null!==n&&_t(t,n,2),vt(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),o||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Fe(t[3],-1))}finally{ht()}}function Ci(e,t,n,r){const i=t[10],o=!Je(),s=xe(t);try{o&&!s&&i.begin&&i.begin(),s&&Ri(e,t,r),Ii(e,t,n,r)}finally{o&&!s&&i.end&&i.end()}}function Ai(e,t,n,r,i){const o=dt(),s=2&r;try{pt(-1),s&&t.length>le&&fi(e,t,le,Je()),n(r,i)}finally{pt(o)}}function Oi(e,t,n){if(fe(t)){const r=t.directiveEnd;for(let i=t.directiveStart;i<r;i++){const t=e.data[i];t.contentQueries&&t.contentQueries(1,n[i],i)}}}function Ni(e,t,n){je()&&(function(e,t,n,r){const i=n.directiveStart,o=n.directiveEnd;e.firstCreatePass||Lt(n,t),vr(r,t);const s=n.initialInputs;for(let a=i;a<o;a++){const r=e.data[a],o=_e(r);o&&Hi(t,n,r);const c=zt(t,e,a,n);vr(c,t),null!==s&&Wi(0,a-i,c,r,0,s),o&&(Le(n.index,t)[8]=c)}}(e,t,n,De(n,t)),128==(128&n.flags)&&function(e,t,n){const r=n.directiveStart,i=n.directiveEnd,o=n.index,s=Be.lFrame.currentDirectiveIndex;try{pt(o);for(let n=r;n<i;n++){const r=e.data[n],i=t[n];tt(n),null===r.hostBindings&&0===r.hostVars&&null===r.hostAttrs||Fi(r,i)}}finally{pt(-1),tt(s)}}(e,t,n))}function ki(e,t,n=De){const r=t.localNames;if(null!==r){let i=t.index+1;for(let o=0;o<r.length;o+=2){const s=r[o+1],a=-1===s?n(t,e):e[s];e[i++]=a}}}function Di(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Pi(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Pi(e,t,n,r,i,o,s,a,c,u){const l=le+r,h=l+i,d=function(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:di);return n}(l,h),p="function"==typeof u?u():u;return d[1]={type:e,blueprint:d,template:n,queries:null,viewQuery:a,declTNode:t,data:d.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:c,consts:p,incompleteFirstPass:!1}}function Li(e,t,n,r){const i=ro(t);null===n?i.push(r):(i.push(n),e.firstCreatePass&&io(e).push(r,i.length-1))}function xi(e,t,n){for(let r in e)if(e.hasOwnProperty(r)){const i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function Mi(e,t,n,r,i,o,s,a){const c=De(t,n);let u,l=t.inputs;var h;!a&&null!=l&&(u=l[r])?(so(e,n,u,r,i),me(t)&&function(e,t){const n=Le(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3&t.type&&(r="class"===(h=r)?"className":"for"===h?"htmlFor":"formaction"===h?"formAction":"innerHtml"===h?"innerHTML":"readonly"===h?"readOnly":"tabindex"===h?"tabIndex":h,i=null!=s?s(i,t.value||"",r):i,Ae(o)?o.setProperty(c,r,i):Rt(r)||(c.setProperty?c.setProperty(r,i):c[r]=i))}function Ui(e,t,n,r){let i=!1;if(je()){const o=function(e,t,n){const r=e.directiveRegistry;let i=null;if(r)for(let o=0;o<r.length;o++){const s=r[o];ci(n,s.selectors,!1)&&(i||(i=[]),Vt(Lt(n,t),e,s.type),_e(s)?(Bi(e,n),i.unshift(s)):i.push(s))}return i}(e,t,n),s=null===r?null:{"":-1};if(null!==o){i=!0,Gi(n,e.data.length,o.length);for(let e=0;e<o.length;e++){const t=o[e];t.providersResolver&&t.providersResolver(t)}let r=!1,a=!1,c=wi(e,t,o.length,null);for(let i=0;i<o.length;i++){const u=o[i];n.mergedAttrs=It(n.mergedAttrs,u.hostAttrs),qi(e,n,t,c,u),ji(c,u,s),null!==u.contentQueries&&(n.flags|=8),null===u.hostBindings&&null===u.hostAttrs&&0===u.hostVars||(n.flags|=128);const l=u.type.prototype;!r&&(l.ngOnChanges||l.ngOnInit||l.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),r=!0),a||!l.ngOnChanges&&!l.ngDoCheck||((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),a=!0),c++}!function(e,t){const n=t.directiveEnd,r=e.data,i=t.attrs,o=[];let s=null,a=null;for(let c=t.directiveStart;c<n;c++){const e=r[c],n=e.inputs,u=null===i||ri(t)?null:zi(n,i);o.push(u),s=xi(n,c,s),a=xi(e.outputs,c,a)}null!==s&&(s.hasOwnProperty("class")&&(t.flags|=16),s.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=o,t.inputs=s,t.outputs=a}(e,n)}s&&function(e,t,n){if(t){const r=e.localNames=[];for(let e=0;e<t.length;e+=2){const i=n[t[e+1]];if(null==i)throw new v("301",`Export of name '${t[e+1]}' not found!`);r.push(t[e],i)}}}(n,r,s)}return n.mergedAttrs=It(n.mergedAttrs,n.attrs),i}function Vi(e,t,n,r,i,o){const s=o.hostBindings;if(s){let n=e.hostBindingOpCodes;null===n&&(n=e.hostBindingOpCodes=[]);const o=~t.index;(function(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(n)!=o&&n.push(o),n.push(r,i,s)}}function Fi(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Bi(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function ji(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;_e(t)&&(n[""]=e)}}function Gi(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function qi(e,t,n,r,i){e.data[r]=i;const o=i.factory||(i.factory=ve(i.type)),s=new Tt(o,_e(i),null);e.blueprint[r]=s,n[r]=s,Vi(e,t,0,r,wi(e,n,i.hostVars,di),i)}function Hi(e,t,n){const r=De(t,e),i=Di(n),o=e[10],s=Xi(e,Ti(e,i,null,n.onPush?64:16,r,t,o,o.createRenderer(r,n),null,null));e[t.index]=s}function Wi(e,t,n,r,i,o){const s=o[t];if(null!==s){const e=r.setInput;for(let t=0;t<s.length;){const i=s[t++],o=s[t++],a=s[t++];null!==e?r.setInput(n,a,i,o):n[o]=a}}}function zi(e,t){let n=null,r=0;for(;r<t.length;){const i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function Ki(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function Yi(e,t){const n=Le(t,e);if(Me(n)){const e=n[1];80&n[2]?Ii(e,n,e.template,n[8]):n[5]>0&&Qi(n)}}function Qi(e){for(let n=Or(e);null!==n;n=Nr(n))for(let e=he;e<n.length;e++){const t=n[e];if(1024&t[2]){const e=t[1];Ii(e,t,e.template,t[8])}else t[5]>0&&Qi(t)}const t=e[1].components;if(null!==t)for(let n=0;n<t.length;n++){const r=Le(t[n],e);Me(r)&&r[5]>0&&Qi(r)}}function Ji(e,t){const n=Le(t,e),r=n[1];!function(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n),Ri(r,n,n[8])}function Xi(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function $i(e){for(;e;){e[2]|=64;const t=Ar(e);if(0!=(512&e[2])&&!t)return e;e=t}return null}function Zi(e,t,n){const r=t[10];r.begin&&r.begin();try{Ii(e,t,e.template,n)}catch(i){throw oo(t,i),i}finally{r.end&&r.end()}}function eo(e){!function(e){for(let t=0;t<e.components.length;t++){const n=e.components[t],r=yr(n),i=r[1];Ci(i,r,i.template,n)}}(e[8])}function to(e,t,n){rt(0),t(e,n)}const no=(()=>Promise.resolve(null))();function ro(e){return e[7]||(e[7]=[])}function io(e){return e.cleanup||(e.cleanup=[])}function oo(e,t){const n=e[9],r=n?n.get(br,null):null;r&&r.handleError(t)}function so(e,t,n,r,i){for(let o=0;o<n.length;){const s=n[o++],a=n[o++],c=t[s],u=e.data[s];null!==u.setInput?u.setInput(c,i,r,a):c[a]=i}}function ao(e,t,n){const r=ke(t,e);!function(e,t,n){Ae(e)?e.setValue(t,n):t.textContent=n}(e[11],r,n)}function co(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,o=0;if(null!==t)for(let s=0;s<t.length;s++){const e=t[s];"number"==typeof e?o=e:1==o?i=p(i,e):2==o&&(r=p(r,e+": "+t[++s]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}const uo=new tn("INJECTOR",-1);class lo{get(e,t=pn){if(t===pn){const t=new Error(`NullInjectorError: No provider for ${d(e)}!`);throw t.name="NullInjectorError",t}return t}}const ho=new tn("Set Injector scope."),po={},fo={};let mo;function go(){return void 0===mo&&(mo=new lo),mo}function _o(e,t=null,n=null,r){return new vo(e,n,t||go(),r)}class vo{constructor(e,t,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];t&&sn(t,n=>this.processProvider(n,e,t)),sn([e],e=>this.processInjectorType(e,[],i)),this.records.set(uo,So(void 0,this));const o=this.records.get(ho);this.scope=null!=o?o.value:null,this.source=r||("object"==typeof e?null:d(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=pn,n=k.Default){this.assertNotDestroyed();const r=vn(this);try{if(!(n&k.SkipSelf)){let t=this.records.get(e);if(void 0===t){const n=("function"==typeof(i=e)||"object"==typeof i&&i instanceof tn)&&w(e);t=n&&this.injectableDefInScope(n)?So(yo(e),po):null,this.records.set(e,t)}if(null!=t)return this.hydrate(e,t)}return(n&k.Self?go():this.parent).get(e,t=n&k.Optional&&t===pn?null:t)}catch(o){if("NullInjectorError"===o.name){if((o.ngTempTokenPath=o.ngTempTokenPath||[]).unshift(d(e)),r)throw o;return function(e,t,n,r){const i=e.ngTempTokenPath;throw t[mn]&&i.unshift(t[mn]),e.message=function(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;let i=d(t);if(Array.isArray(t))i=t.map(d).join(" -> ");else if("object"==typeof t){let e=[];for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];e.push(n+":"+("string"==typeof r?JSON.stringify(r):d(r)))}i=`{${e.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(fn,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e.ngTempTokenPath=null,e}(o,e,"R3InjectorError",this.source)}throw o}finally{vn(r)}var i}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((t,n)=>e.push(d(n))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(e,t,n){if(!(e=g(e)))return!1;let r=I(e);const i=null==r&&e.ngModule||void 0,o=void 0===i?e:i,s=-1!==n.indexOf(o);if(void 0!==i&&(r=I(i)),null==r)return!1;if(null!=r.imports&&!s){let e;n.push(o);try{sn(r.imports,r=>{this.processInjectorType(r,t,n)&&(void 0===e&&(e=[]),e.push(r))})}finally{}if(void 0!==e)for(let t=0;t<e.length;t++){const{ngModule:n,providers:r}=e[t];sn(r,e=>this.processProvider(e,n,r||H))}}this.injectorDefTypes.add(o);const a=ve(o)||(()=>new o);this.records.set(o,So(a,po));const c=r.providers;if(null!=c&&!s){const t=e;sn(c,e=>this.processProvider(e,t,c))}return void 0!==i&&void 0!==e.providers}processProvider(e,t,n){let r=bo(e=g(e))?e:g(e&&e.provide);const i=function(e,t,n){return To(e)?So(void 0,e.useValue):So(Eo(e),po)}(e);if(bo(e)||!0!==e.multi)this.records.get(r);else{let t=this.records.get(r);t||(t=So(void 0,po,!0),t.factory=()=>Tn(t.multi),this.records.set(r,t)),r=e,t.multi.push(e)}this.records.set(r,i)}hydrate(e,t){var n;return t.value===po&&(t.value=fo,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=g(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function yo(e){const t=w(e),n=null!==t?t.factory:ve(e);if(null!==n)return n;if(e instanceof tn)throw new Error(`Token ${d(e)} is missing a \u0275prov definition.`);if(e instanceof Function)return function(e){const t=e.length;if(t>0){const n=un(t,"?");throw new Error(`Can't resolve all parameters for ${d(e)}: (${n.join(", ")}).`)}const n=function(e){const t=e&&(e[C]||e[O]);if(t){const n=function(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Error("unreachable")}function Eo(e,t,n){let r;if(bo(e)){const t=g(e);return ve(t)||yo(t)}if(To(e))r=()=>g(e.useValue);else if((i=e)&&i.useFactory)r=()=>e.useFactory(...Tn(e.deps||[]));else if(function(e){return!(!e||!e.useExisting)}(e))r=()=>En(g(e.useExisting));else{const t=g(e&&(e.useClass||e.provide));if(!function(e){return!!e.deps}(e))return ve(t)||yo(t);r=()=>new t(...Tn(e.deps))}var i;return r}function So(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function To(e){return null!==e&&"object"==typeof e&&gn in e}function bo(e){return"function"==typeof e}const wo=function(e,t,n){return function(e,t=null,n=null,r){const i=_o(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)};let Ro=(()=>{class e{static create(e,t){return Array.isArray(e)?wo(e,t,""):wo(e.providers,e.parent,e.name||"")}}return e.THROW_IF_NOT_FOUND=pn,e.NULL=new lo,e.\u0275prov=T({token:e,providedIn:"any",factory:()=>En(uo)}),e.__NG_ELEMENT_ID__=-1,e})();function Io(e,t){mt(yr(e)[1],We())}function Co(e){let t=Object.getPrototypeOf(e.type.prototype).constructor,n=!0;const r=[e];for(;t;){let i;if(_e(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);const t=e;t.inputs=Ao(e.inputs),t.declaredInputs=Ao(e.declaredInputs),t.outputs=Ao(e.outputs);const n=i.hostBindings;n&&ko(e,n);const o=i.viewQuery,s=i.contentQueries;if(o&&Oo(e,o),s&&No(e,s),h(e.inputs,i.inputs),h(e.declaredInputs,i.declaredInputs),h(e.outputs,i.outputs),_e(i)&&i.data.animation){const t=e.data;t.animation=(t.animation||[]).concat(i.data.animation)}}const t=i.features;if(t)for(let r=0;r<t.length;r++){const i=t[r];i&&i.ngInherit&&i(e),i===Co&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){let t=0,n=null;for(let r=e.length-1;r>=0;r--){const i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=It(i.hostAttrs,n=It(n,i.hostAttrs))}}(r)}function Ao(e){return e===q?{}:e===H?[]:e}function Oo(e,t){const n=e.viewQuery;e.viewQuery=n?(e,r)=>{t(e,r),n(e,r)}:t}function No(e,t){const n=e.contentQueries;e.contentQueries=n?(e,r,i)=>{t(e,r,i),n(e,r,i)}:t}function ko(e,t){const n=e.hostBindings;e.hostBindings=n?(e,r)=>{t(e,r),n(e,r)}:t}let Do=null;function Po(){if(!Do){const e=G.Symbol;if(e&&e.iterator)Do=e.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const n=e[t];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Do=n)}}}return Do}function Lo(e){return!!xo(e)&&(Array.isArray(e)||!(e instanceof Map)&&Po()in e)}function xo(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Mo(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Uo(e,t,n,r){const i=Ge();return Mo(i,$e(),t)&&(qe(),function(e,t,n,r,i,o){const s=De(e,t);!function(e,t,n,r,i,o,s){if(null==o)Ae(e)?e.removeAttribute(t,i,n):t.removeAttribute(i);else{const a=null==s?y(o):s(o,r||"",i);Ae(e)?e.setAttribute(t,i,a,n):n?t.setAttributeNS(n,i,a):t.setAttribute(i,a)}}(t[11],s,o,e.value,n,r,i)}(ft(),i,e,t,n,r)),Uo}function Vo(e,t,n,r){return Mo(e,$e(),n)?t+y(n)+r:di}function Fo(e,t,n,r,i,o,s,a){const c=Ge(),u=qe(),l=e+le,h=u.firstCreatePass?function(e,t,n,r,i,o,s,a,c){const u=t.consts,l=bi(t,e,4,s||null,Ue(u,a));Ui(t,n,l,Ue(u,c)),mt(t,l);const h=l.tViews=Pi(2,l,r,i,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,u);return null!==t.queries&&(t.queries.template(t,l),h.queries=t.queries.embeddedTView(l)),l}(l,u,c,t,n,r,i,o,s):u.data[l];Ke(h,!1);const d=c[11].createComment("");Wr(u,c,d,h),vr(d,c),Xi(c,c[l]=Ki(d,c,d,h)),ge(h)&&Ni(u,c,h),null!=s&&ki(c,h,a)}function Bo(e){return function(e,t){return e[t]}(Be.lFrame.contextLView,le+e)}function jo(e,t=k.Default){const n=Ge();return null===n?En(e,t):jt(We(),n,g(e),t)}function Go(e,t,n){const r=Ge();return Mo(r,$e(),t)&&Mi(qe(),ft(),r,e,t,r[11],n,!1),Go}function qo(e,t,n,r,i){const o=i?"class":"style";so(e,n,t.inputs[o],o,r)}function Ho(e,t,n,r){const i=Ge(),o=qe(),s=le+e,a=i[11],c=i[s]=Pr(a,t,Be.lFrame.currentNamespace),u=o.firstCreatePass?function(e,t,n,r,i,o,s){const a=t.consts,c=bi(t,e,2,i,Ue(a,o));return Ui(t,n,c,Ue(a,s)),null!==c.attrs&&co(c,c.attrs,!1),null!==c.mergedAttrs&&co(c,c.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,c),c}(s,o,i,0,t,n,r):o.data[s];Ke(u,!0);const l=u.mergedAttrs;null!==l&&bt(a,c,l);const h=u.classes;null!==h&&Zr(a,c,h);const d=u.styles;null!==d&&$r(a,c,d),64!=(64&u.flags)&&Wr(o,i,c,u),0===Be.lFrame.elementDepthCount&&vr(c,i),Be.lFrame.elementDepthCount++,ge(u)&&(Ni(o,i,u),Oi(o,u,i)),null!==r&&ki(i,u)}function Wo(){let e=We();Ye()?Qe():(e=e.parent,Ke(e,!1));const t=e;Be.lFrame.elementDepthCount--;const n=qe();n.firstCreatePass&&(mt(n,e),fe(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&qo(n,t,Ge(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&qo(n,t,Ge(),t.stylesWithoutHost,!1)}function zo(e,t,n,r){Ho(e,t,n,r),Wo()}function Ko(e,t,n){const r=Ge(),i=qe(),o=e+le,s=i.firstCreatePass?function(e,t,n,r,i){const o=t.consts,s=Ue(o,r),a=bi(t,e,8,"ng-container",s);return null!==s&&co(a,s,!0),Ui(t,n,a,Ue(o,i)),null!==t.queries&&t.queries.elementStart(t,a),a}(o,i,r,t,n):i.data[o];Ke(s,!0);const a=r[o]=r[11].createComment("");Wr(i,r,a,s),vr(a,r),ge(s)&&(Ni(i,r,s),Oi(i,s,r)),null!=n&&ki(r,s)}function Yo(){let e=We();const t=qe();Ye()?Qe():(e=e.parent,Ke(e,!1)),t.firstCreatePass&&(mt(t,e),fe(e)&&t.queries.elementEnd(e))}function Qo(){return Ge()}function Jo(e){return!!e&&"function"==typeof e.then}function Xo(e){return!!e&&"function"==typeof e.subscribe}const $o=Xo;function Zo(e,t,n,r){const i=Ge(),o=qe(),s=We();return function(e,t,n,r,i,o,s,a){const c=ge(r),u=e.firstCreatePass&&io(e),l=ro(t);let h=!0;if(3&r.type||a){const d=De(r,t),p=a?a(d):d,f=l.length,m=a?e=>a(Ne(e[r.index])):r.index;if(Ae(n)){let s=null;if(!a&&c&&(s=function(e,t,n,r){const i=e.cleanup;if(null!=i)for(let o=0;o<i.length-1;o+=2){const e=i[o];if(e===n&&i[o+1]===r){const e=t[7],n=i[o+2];return e.length>n?e[n]:null}"string"==typeof e&&(o+=2)}return null}(e,t,i,r.index)),null!==s)(s.__ngLastListenerFn__||s).__ngNextListenerFn__=o,s.__ngLastListenerFn__=o,h=!1;else{o=ts(r,t,0,o,!1);const e=n.listen(p,i,o);l.push(o,e),u&&u.push(i,m,f,f+1)}}else o=ts(r,t,0,o,!0),p.addEventListener(i,o,s),l.push(o),u&&u.push(i,m,f,s)}else o=ts(r,t,0,o,!1);const d=r.outputs;let p;if(h&&null!==d&&(p=d[i])){const e=p.length;if(e)for(let n=0;n<e;n+=2){const e=t[p[n]][p[n+1]].subscribe(o),s=l.length;l.push(o,e),u&&u.push(i,r.index,s,-(s+1))}}}(o,i,i[11],s,e,t,!!n,r),Zo}function es(e,t,n,r){try{return!1!==n(r)}catch(i){return oo(e,i),!1}}function ts(e,t,n,r,i){return function n(o){if(o===Function)return r;const s=2&e.flags?Le(e.index,t):t;0==(32&t[2])&&$i(s);let a=es(t,0,r,o),c=n.__ngNextListenerFn__;for(;c;)a=es(t,0,c,o)&&a,c=c.__ngNextListenerFn__;return i&&!1===a&&(o.preventDefault(),o.returnValue=!1),a}}function ns(e=1){return function(e){return(Be.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Be.lFrame.contextLView))[8]}(e)}function rs(e,t){let n=null;const r=function(e){const t=e.attrs;if(null!=t){const e=t.indexOf(5);if(0==(1&e))return t[e+1]}return null}(e);for(let i=0;i<t.length;i++){const o=t[i];if("*"!==o){if(null===r?ci(e,o,!0):ui(r,o))return i}else n=i}return n}function is(e){const t=Ge()[16][6];if(!t.projection){const n=t.projection=un(e?e.length:1,null),r=n.slice();let i=t.child;for(;null!==i;){const t=e?rs(i,e):0;null!==t&&(r[t]?r[t].projectionNext=i:n[t]=i,r[t]=i),i=i.next}}}function os(e,t=0,n){const r=Ge(),i=qe(),o=bi(i,le+e,16,null,n||null);null===o.projection&&(o.projection=t),Qe(),64!=(64&o.flags)&&function(e,t,n){Xr(t[11],0,t,n,Vr(e,n,t),qr(n.parent||t[6],n,t))}(i,r,o)}function ss(e,t,n,r,i){const o=e[n+1],s=null===t;let a=r?gi(o):vi(o),c=!1;for(;0!==a&&(!1===c||s);){const n=e[a+1];as(e[a],t)&&(c=!0,e[a+1]=r?Ei(n):_i(n)),a=r?gi(n):vi(n)}c&&(e[n+1]=r?_i(o):Ei(o))}function as(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&dn(e,t)>=0}const cs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function us(e){return e.substring(cs.key,cs.keyEnd)}function ls(e,t){const n=cs.textEnd;return n===t?-1:(t=cs.keyEnd=function(e,t,n){for(;t<n&&e.charCodeAt(t)>32;)t++;return t}(e,cs.key=t,n),hs(e,t,n))}function hs(e,t,n){for(;t<n&&e.charCodeAt(t)<=32;)t++;return t}function ds(e,t,n){return ms(e,t,n,!1),ds}function ps(e,t){return ms(e,t,null,!0),ps}function fs(e,t){for(let n=function(e){return function(e){cs.key=0,cs.keyEnd=0,cs.value=0,cs.valueEnd=0,cs.textEnd=e.length}(e),ls(e,hs(e,0,cs.textEnd))}(t);n>=0;n=ls(t,n))ln(e,us(t),!0)}function ms(e,t,n,r){const i=Ge(),o=qe(),s=Ze(2);o.firstUpdatePass&&_s(o,e,s,r),t!==di&&Mo(i,s,t)&&Es(o,o.data[dt()],i,i[11],e,i[s+1]=function(e,t){return null==e||("string"==typeof t?e+=t:"object"==typeof e&&(e=d(Un(e)))),e}(t,n),r,s)}function gs(e,t){return t>=e.expandoStartIndex}function _s(e,t,n,r){const i=e.data;if(null===i[n+1]){const o=i[dt()],s=gs(e,n);bs(o,r)&&null===t&&!s&&(t=!1),t=function(e,t,n,r){const i=function(e){const t=Be.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let o=r?t.residualClasses:t.residualStyles;if(null===i)0===(r?t.classBindings:t.styleBindings)&&(n=ys(n=vs(null,e,t,n,r),t.attrs,r),o=null);else{const s=t.directiveStylingLast;if(-1===s||e[s]!==i)if(n=vs(i,e,t,n,r),null===o){let n=function(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==vi(r))return e[gi(r)]}(e,t,r);void 0!==n&&Array.isArray(n)&&(n=vs(null,e,t,n[1],r),n=ys(n,t.attrs,r),function(e,t,n,r){e[gi(n?t.classBindings:t.styleBindings)]=r}(e,t,r,n))}else o=function(e,t,n){let r;const i=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<i;o++)r=ys(r,e[o].hostAttrs,n);return ys(r,t.attrs,n)}(e,t,r)}return void 0!==o&&(r?t.residualClasses=o:t.residualStyles=o),n}(i,o,t,r),function(e,t,n,r,i,o){let s=o?t.classBindings:t.styleBindings,a=gi(s),c=vi(s);e[r]=n;let u,l=!1;if(Array.isArray(n)){const e=n;u=e[1],(null===u||dn(e,u)>0)&&(l=!0)}else u=n;if(i)if(0!==c){const t=gi(e[a+1]);e[r+1]=mi(t,a),0!==t&&(e[t+1]=yi(e[t+1],r)),e[a+1]=131071&e[a+1]|r<<17}else e[r+1]=mi(a,0),0!==a&&(e[a+1]=yi(e[a+1],r)),a=r;else e[r+1]=mi(c,0),0===a?a=r:e[c+1]=yi(e[c+1],r),c=r;l&&(e[r+1]=_i(e[r+1])),ss(e,u,r,!0),ss(e,u,r,!1),function(e,t,n,r,i){const o=i?e.residualClasses:e.residualStyles;null!=o&&"string"==typeof t&&dn(o,t)>=0&&(n[r+1]=Ei(n[r+1]))}(t,u,e,r,o),s=mi(a,c),o?t.classBindings=s:t.styleBindings=s}(i,o,t,n,s,r)}}function vs(e,t,n,r,i){let o=null;const s=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<s&&(o=t[a],r=ys(r,o.hostAttrs,i),o!==e);)a++;return null!==e&&(n.directiveStylingLast=a),r}function ys(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let o=0;o<t.length;o++){const s=t[o];"number"==typeof s?i=s:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),ln(e,s,!!n||t[++o]))}return void 0===e?null:e}function Es(e,t,n,r,i,o,s,a){if(!(3&t.type))return;const c=e.data,u=c[a+1];Ts(1==(1&u)?Ss(c,t,n,i,vi(u),s):void 0)||(Ts(o)||2==(2&u)&&(o=Ss(c,null,n,i,a,s)),function(e,t,n,r,i){const o=Ae(e);if(t)i?o?e.addClass(n,r):n.classList.add(r):o?e.removeClass(n,r):n.classList.remove(r);else{let t=-1===r.indexOf("-")?void 0:Ir.DashCase;if(null==i)o?e.removeStyle(n,r,t):n.style.removeProperty(r);else{const s="string"==typeof i&&i.endsWith("!important");s&&(i=i.slice(0,-10),t|=Ir.Important),o?e.setStyle(n,r,i,t):n.style.setProperty(r,i,s?"important":"")}}}(r,s,ke(dt(),n),i,o))}function Ss(e,t,n,r,i,o){const s=null===t;let a;for(;i>0;){const t=e[i],o=Array.isArray(t),c=o?t[1]:t,u=null===c;let l=n[i+1];l===di&&(l=u?H:void 0);let h=u?hn(l,r):c===r?l:void 0;if(o&&!Ts(h)&&(h=hn(t,r)),Ts(h)&&(a=h,s))return a;const d=e[i+1];i=s?gi(d):vi(d)}if(null!==t){let e=o?t.residualClasses:t.residualStyles;null!=e&&(a=hn(e,r))}return a}function Ts(e){return void 0!==e}function bs(e,t){return 0!=(e.flags&(t?16:32))}function ws(e,t=""){const n=Ge(),r=qe(),i=e+le,o=r.firstCreatePass?bi(r,i,1,t,null):r.data[i],s=n[i]=function(e,t){return Ae(e)?e.createText(t):e.createTextNode(t)}(n[11],t);Wr(r,n,s,o),Ke(o,!1)}function Rs(e){return Is("",e,""),Rs}function Is(e,t,n){const r=Ge(),i=Vo(r,e,t,n);return i!==di&&ao(r,dt(),i),Is}function Cs(e,t,n,r,i){const o=Ge(),s=function(e,t,n,r,i,o){const s=function(e,t,n,r){const i=Mo(e,t,n);return Mo(e,t+1,r)||i}(e,Be.lFrame.bindingIndex,n,i);return Ze(2),s?t+y(n)+r+y(i)+o:di}(o,e,t,n,r,i);return s!==di&&ao(o,dt(),s),Cs}function As(e,t,n){!function(e,t,n,r){const i=qe(),o=Ze(2);i.firstUpdatePass&&_s(i,null,o,r);const s=Ge();if(n!==di&&Mo(s,o,n)){const a=i.data[dt()];if(bs(a,r)&&!gs(i,o)){let e=a.classesWithoutHost;null!==e&&(n=p(e,n||"")),qo(i,a,s,n,r)}else!function(e,t,n,r,i,o,s,a){i===di&&(i=H);let c=0,u=0,l=0<i.length?i[0]:null,h=0<o.length?o[0]:null;for(;null!==l||null!==h;){const s=c<i.length?i[c+1]:void 0,d=u<o.length?o[u+1]:void 0;let p,f=null;l===h?(c+=2,u+=2,s!==d&&(f=h,p=d)):null===h||null!==l&&l<h?(c+=2,f=l):(u+=2,f=h,p=d),null!==f&&Es(e,t,n,r,f,p,true,a),l=c<i.length?i[c]:null,h=u<o.length?o[u]:null}}(i,a,s,s[11],s[o+1],s[o+1]=function(e,t,n){if(null==n||""===n)return H;const r=[],i=Un(n);if(Array.isArray(i))for(let o=0;o<i.length;o++)e(r,i[o],!0);else if("object"==typeof i)for(const o in i)i.hasOwnProperty(o)&&e(r,o,i[o]);else"string"==typeof i&&t(r,i);return r}(e,t,n),0,o)}}(ln,fs,Vo(Ge(),e,t,n),!0)}function Os(e,t,n){const r=Ge();return Mo(r,$e(),t)&&Mi(qe(),ft(),r,e,t,r[11],n,!0),Os}const Ns=void 0;var ks=["en",[["a","p"],["AM","PM"],Ns],[["AM","PM"],Ns,Ns],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Ns,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Ns,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Ns,"{1} 'at' {0}",Ns],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){let t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}];let Ds={};function Ps(e){const t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e);let n=xs(t);if(n)return n;const r=t.split("-")[0];if(n=xs(r),n)return n;if("en"===r)return ks;throw new Error(`Missing locale data for the locale "${e}".`)}function Ls(e){return Ps(e)[Ms.PluralCase]}function xs(e){return e in Ds||(Ds[e]=G.ng&&G.ng.common&&G.ng.common.locales&&G.ng.common.locales[e]),Ds[e]}var Ms=function(e){return e[e.LocaleId=0]="LocaleId",e[e.DayPeriodsFormat=1]="DayPeriodsFormat",e[e.DayPeriodsStandalone=2]="DayPeriodsStandalone",e[e.DaysFormat=3]="DaysFormat",e[e.DaysStandalone=4]="DaysStandalone",e[e.MonthsFormat=5]="MonthsFormat",e[e.MonthsStandalone=6]="MonthsStandalone",e[e.Eras=7]="Eras",e[e.FirstDayOfWeek=8]="FirstDayOfWeek",e[e.WeekendRange=9]="WeekendRange",e[e.DateFormat=10]="DateFormat",e[e.TimeFormat=11]="TimeFormat",e[e.DateTimeFormat=12]="DateTimeFormat",e[e.NumberSymbols=13]="NumberSymbols",e[e.NumberFormats=14]="NumberFormats",e[e.CurrencyCode=15]="CurrencyCode",e[e.CurrencySymbol=16]="CurrencySymbol",e[e.CurrencyName=17]="CurrencyName",e[e.Currencies=18]="Currencies",e[e.Directionality=19]="Directionality",e[e.PluralCase=20]="PluralCase",e[e.ExtraData=21]="ExtraData",e}({});const Us="en-US";let Vs=Us;function Fs(e){var t,n;n="Expected localeId to be defined",null==(t=e)&&function(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e} [Expected=> null != ${t} <=Actual]`)}(n,t),"string"==typeof e&&(Vs=e.toLowerCase().replace(/_/g,"-"))}function Bs(e,t,n,r,i){if(e=g(e),Array.isArray(e))for(let o=0;o<e.length;o++)Bs(e[o],t,n,r,i);else{const o=qe(),s=Ge();let a=bo(e)?e:g(e.provide),c=Eo(e);const u=We(),l=1048575&u.providerIndexes,h=u.directiveStart,d=u.providerIndexes>>20;if(bo(e)||!e.multi){const r=new Tt(c,i,jo),p=qs(a,t,i?l:l+d,h);-1===p?(Vt(Lt(u,s),o,a),js(o,e,t.length),t.push(a),u.directiveStart++,u.directiveEnd++,i&&(u.providerIndexes+=1048576),n.push(r),s.push(r)):(n[p]=r,s[p]=r)}else{const p=qs(a,t,l+d,h),f=qs(a,t,l,l+d),m=p>=0&&n[p],g=f>=0&&n[f];if(i&&!g||!i&&!m){Vt(Lt(u,s),o,a);const l=function(e,t,n,r,i){const o=new Tt(e,n,jo);return o.multi=[],o.index=t,o.componentProviders=0,Gs(o,i,r&&!n),o}(i?Ws:Hs,n.length,i,r,c);!i&&g&&(n[f].providerFactory=l),js(o,e,t.length,0),t.push(a),u.directiveStart++,u.directiveEnd++,i&&(u.providerIndexes+=1048576),n.push(l),s.push(l)}else js(o,e,p>-1?p:f,Gs(n[i?f:p],c,!i&&r));!i&&r&&g&&n[f].componentProviders++}}}function js(e,t,n,r){const i=bo(t);if(i||t.useClass){const o=(t.useClass||t).prototype.ngOnDestroy;if(o){const s=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){const e=s.indexOf(n);-1===e?s.push(n,[r,o]):s[e+1].push(r,o)}else s.push(n,o)}}}function Gs(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function qs(e,t,n,r){for(let i=n;i<r;i++)if(t[i]===e)return i;return-1}function Hs(e,t,n,r){return zs(this.multi,[])}function Ws(e,t,n,r){const i=this.multi;let o;if(this.providerFactory){const e=this.providerFactory.componentProviders,t=zt(n,n[1],this.providerFactory.index,r);o=t.slice(0,e),zs(i,o);for(let n=e;n<t.length;n++)o.push(t[n])}else o=[],zs(i,o);return o}function zs(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function Ks(e,t=[]){return n=>{n.providersResolver=(n,r)=>function(e,t,n){const r=qe();if(r.firstCreatePass){const i=_e(e);Bs(n,r.data,r.blueprint,i,!0),Bs(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}class Ys{}class Qs{resolveComponentFactory(e){throw function(e){const t=Error(`No component factory found for ${d(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(e)}}let Js=(()=>{class e{}return e.NULL=new Qs,e})();function Xs(...e){}function $s(e,t){return new ea(De(e,t))}const Zs=function(){return $s(We(),Ge())};let ea=(()=>{class e{constructor(e){this.nativeElement=e}}return e.__NG_ELEMENT_ID__=Zs,e})();function ta(e){return e instanceof ea?e.nativeElement:e}class na{}let ra=(()=>{class e{}return e.__NG_ELEMENT_ID__=()=>ia(),e})();const ia=function(){const e=Ge(),t=Le(We().index,e);return function(e){return e[11]}(de(t)?t:e)};let oa=(()=>{class e{}return e.\u0275prov=T({token:e,providedIn:"root",factory:()=>null}),e})();class sa{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const aa=new sa("12.0.5");class ca{constructor(){}supports(e){return Lo(e)}create(e){return new la(e)}}const ua=(e,t)=>t;class la{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||ua}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,n=this._removalsHead,r=0,i=null;for(;t||n;){const o=!n||t&&t.currentIndex<fa(n,r,i)?t:n,s=fa(o,r,i),a=o.currentIndex;if(o===n)r--,n=n._nextRemoved;else if(t=t._next,null==o.previousIndex)r++;else{i||(i=[]);const e=s-r,t=a-r;if(e!=t){for(let n=0;n<e;n++){const r=n<i.length?i[n]:i[n]=0,o=r+n;t<=o&&o<e&&(i[n]=r+1)}i[o.previousIndex]=t-e}}s!==a&&e(o,s,a)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Lo(e))throw new Error(`Error trying to diff '${d(e)}'. Only arrays and iterables are allowed`);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t,n,r,i=this._itHead,o=!1;if(Array.isArray(e)){this.length=e.length;for(let t=0;t<this.length;t++)n=e[t],r=this._trackByFn(t,n),null!==i&&Object.is(i.trackById,r)?(o&&(i=this._verifyReinsertion(i,n,r,t)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,t),o=!0),i=i._next}else t=0,function(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[Po()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(e,e=>{r=this._trackByFn(t,e),null!==i&&Object.is(i.trackById,r)?(o&&(i=this._verifyReinsertion(i,e,r,t)),Object.is(i.item,e)||this._addIdentityChange(i,e)):(i=this._mismatch(i,e,r,t),o=!0),i=i._next,t++}),this.length=t;return this._truncate(i),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,n,r){let i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):e=this._addAfter(new ha(t,n),i,r),e}_verifyReinsertion(e,t,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}_moveAfter(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}_addAfter(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,n){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new pa),this._linkedRecords.put(e),e.currentIndex=n,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new pa),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class ha{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class da{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Object.is(n.trackById,e))return n;return null}remove(e){const t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}class pa{constructor(){this.map=new Map}put(e){const t=e.trackById;let n=this.map.get(t);n||(n=new da,this.map.set(t,n)),n.add(e)}get(e,t){const n=this.map.get(e);return n?n.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function fa(e,t,n){const r=e.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+t+i}class ma{constructor(){}supports(e){return e instanceof Map||xo(e)}create(){return new ga}}class ga{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let t;for(t=this._mapHead;null!==t;t=t._next)e(t)}forEachPreviousItem(e){let t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}forEachChangedItem(e){let t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}diff(e){if(e){if(!(e instanceof Map||xo(e)))throw new Error(`Error trying to diff '${d(e)}'. Only maps and objects are allowed`)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let t=this._mapHead;if(this._appendAfter=null,this._forEach(e,(e,n)=>{if(t&&t.key===n)this._maybeAddToChanges(t,e),this._appendAfter=t,t=t._next;else{const r=this._getOrCreateRecordForKey(n,e);t=this._insertBeforeOrAppend(t,r)}}),t){t._prev&&(t._prev._next=null),this._removalsHead=t;for(let e=t;null!==e;e=e._nextRemoved)e===this._mapHead&&(this._mapHead=null),this._records.delete(e.key),e._nextRemoved=e._next,e.previousValue=e.currentValue,e.currentValue=null,e._prev=null,e._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,t){if(e){const n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}_getOrCreateRecordForKey(e,t){if(this._records.has(e)){const n=this._records.get(e);this._maybeAddToChanges(n,t);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new _a(e);return this._records.set(e,n),n.currentValue=t,this._addToAdditions(n),n}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,t){Object.is(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach(n=>t(e[n],n))}}class _a{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function va(){return new ya([new ca])}let ya=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(null!=n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||va()),deps:[[e,new In,new Rn]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(null!=t)return t;throw new Error(`Cannot find a differ supporting object '${e}' of type '${n=e,n.name||typeof n}'`);var n}}return e.\u0275prov=T({token:e,providedIn:"root",factory:va}),e})();function Ea(){return new Sa([new ma])}let Sa=(()=>{class e{constructor(e){this.factories=e}static create(t,n){if(n){const e=n.factories.slice();t=t.concat(e)}return new e(t)}static extend(t){return{provide:e,useFactory:n=>e.create(t,n||Ea()),deps:[[e,new In,new Rn]]}}find(e){const t=this.factories.find(t=>t.supports(e));if(t)return t;throw new Error(`Cannot find a differ supporting object '${e}'`)}}return e.\u0275prov=T({token:e,providedIn:"root",factory:Ea}),e})();function Ta(e,t,n,r,i=!1){for(;null!==n;){const o=t[n.index];if(null!==o&&r.push(Ne(o)),pe(o))for(let e=he;e<o.length;e++){const t=o[e],n=t[1].firstChild;null!==n&&Ta(t[1],t,n,r)}const s=n.type;if(8&s)Ta(e,t,n.child,r);else if(32&s){const e=Cr(n,t);let i;for(;i=e();)r.push(i)}else if(16&s){const e=Kr(t,n);if(Array.isArray(e))r.push(...e);else{const n=Ar(t[16]);Ta(n[1],n,e,r,!0)}}n=i?n.projectionNext:n.next}return r}class ba{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Ta(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(pe(e)){const t=e[8],n=t?t.indexOf(this):-1;n>-1&&(xr(e,n),cn(t,n))}this._attachedToViewContainer=!1}Mr(this._lView[1],this._lView)}onDestroy(e){Li(this._lView[1],this._lView,null,e)}markForCheck(){$i(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Zi(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(e,t,n){Xe(!0);try{Zi(e,t,n)}finally{Xe(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var e;this._appRef=null,Jr(this._lView[1],e=this._lView,e[11],2,null,null)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}}class wa extends ba{constructor(e){super(e),this._view=e}detectChanges(){eo(this._view)}checkNoChanges(){!function(e){Xe(!0);try{eo(e)}finally{Xe(!1)}}(this._view)}get context(){return null}}const Ra=function(e){return function(e,t,n){if(me(e)&&!n){const n=Le(e.index,t);return new ba(n,n)}return 47&e.type?new ba(t[16],t):null}(We(),Ge(),16==(16&e))};let Ia=(()=>{class e{}return e.__NG_ELEMENT_ID__=Ra,e})();const Ca=[new ma],Aa=new ya([new ca]),Oa=new Sa(Ca),Na=function(){return La(We(),Ge())};let ka=(()=>{class e{}return e.__NG_ELEMENT_ID__=Na,e})();const Da=ka,Pa=class extends Da{constructor(e,t,n){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=n}createEmbeddedView(e){const t=this._declarationTContainer.tViews,n=Ti(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),Ri(t,n,e),new ba(n)}};function La(e,t){return 4&e.type?new Pa(t,e,$s(e,t)):null}class xa{}class Ma{}const Ua=function(){return qa(We(),Ge())};let Va=(()=>{class e{}return e.__NG_ELEMENT_ID__=Ua,e})();const Fa=Va,Ba=class extends Fa{constructor(e,t,n){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=n}get element(){return $s(this._hostTNode,this._hostLView)}get injector(){return new Qt(this._hostTNode,this._hostLView)}get parentInjector(){const e=Ut(this._hostTNode,this._hostLView);if(At(e)){const t=Nt(e,this._hostLView),n=Ot(e);return new Qt(t[1].data[n+8],t)}return new Qt(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=ja(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-he}createEmbeddedView(e,t,n){const r=e.createEmbeddedView(t||{});return this.insert(r,n),r}createComponent(e,t,n,r,i){const o=n||this.parentInjector;if(!i&&null==e.ngModule&&o){const e=o.get(xa,null);e&&(i=e)}const s=e.create(o,r,void 0,i);return this.insert(s.hostView,t),s}insert(e,t){const n=e._lView,r=n[1];if(pe(n[3])){const t=this.indexOf(e);if(-1!==t)this.detach(t);else{const t=n[3],r=new Ba(t,t[6],t[3]);r.detach(r.indexOf(e))}}const i=this._adjustIndex(t),o=this._lContainer;!function(e,t,n,r){const i=he+r,o=n.length;r>0&&(n[i-1][4]=t),r<o-he?(t[4]=n[i],an(n,he+r,t)):(n.push(t),t[4]=null),t[3]=n;const s=t[17];null!==s&&n!==s&&function(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(s,t);const a=t[19];null!==a&&a.insertView(e),t[2]|=128}(r,n,o,i);const s=Yr(i,o),a=n[11],c=Gr(a,o[7]);return null!==c&&function(e,t,n,r,i,o){r[0]=i,r[6]=t,Jr(e,r,n,1,i,o)}(r,o[6],a,n,c,s),e.attachToViewContainerRef(),an(Ga(o),i,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=ja(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),n=xr(this._lContainer,t);n&&(cn(Ga(this._lContainer),t),Mr(n[1],n))}detach(e){const t=this._adjustIndex(e,-1),n=xr(this._lContainer,t);return n&&null!=cn(Ga(this._lContainer),t)?new ba(n):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function ja(e){return e[8]}function Ga(e){return e[8]||(e[8]=[])}function qa(e,t){let n;const r=t[e.index];if(pe(r))n=r;else{let i;if(8&e.type)i=Ne(r);else{const n=t[11];i=n.createComment("");const r=De(e,t);Fr(n,Gr(n,r),i,function(e,t){return Ae(e)?e.nextSibling(t):t.nextSibling}(n,r),!1)}t[e.index]=n=Ki(r,t,i,e),Xi(t,n)}return new Ba(n,e,t)}const Ha={};class Wa extends Js{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=ce(e);return new Ya(t,this.ngModule)}}function za(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}const Ka=new tn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>wr});class Ya extends Ys{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=e.selectors.map(hi).join(","),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return za(this.componentDef.inputs)}get outputs(){return za(this.componentDef.outputs)}create(e,t,n,r){const i=(r=r||this.ngModule)?function(e,t){return{get:(n,r,i)=>{const o=e.get(n,Ha,i);return o!==Ha||r===Ha?o:t.get(n,r,i)}}}(e,r.injector):e,o=i.get(na,Oe),s=i.get(oa,null),a=o.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",u=n?function(e,t,n){if(Ae(e))return e.selectRootElement(t,n===U.ShadowDom);let r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(a,n,this.componentDef.encapsulation):Pr(o.createRenderer(null,this.componentDef),c,function(e){const t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(c)),l=this.componentDef.onPush?576:528,h={components:[],scheduler:wr,clean:no,playerHandler:null,flags:0},d=Pi(0,null,null,1,0,null,null,null,null,null),p=Ti(null,d,h,l,null,null,o,a,s,i);let f,m;st(p);try{const e=function(e,t,n,r,i,o){const s=n[1];n[20]=e;const a=bi(s,20,2,"#host",null),c=a.mergedAttrs=t.hostAttrs;null!==c&&(co(a,c,!0),null!==e&&(bt(i,e,c),null!==a.classes&&Zr(i,e,a.classes),null!==a.styles&&$r(i,e,a.styles)));const u=r.createRenderer(e,t),l=Ti(n,Di(t),null,t.onPush?64:16,n[20],a,r,u,null,null);return s.firstCreatePass&&(Vt(Lt(a,n),s,t.type),Bi(s,a),Gi(a,n.length,1)),Xi(n,l),n[20]=l}(u,this.componentDef,p,o,a);if(u)if(n)bt(a,u,["ng-version",aa.full]);else{const{attrs:e,classes:t}=function(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let o=e[r];if("string"==typeof o)2===i?""!==o&&t.push(o,e[++r]):8===i&&n.push(o);else{if(!si(i))break;i=o}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]);e&&bt(a,u,e),t&&t.length>0&&Zr(a,u,t.join(" "))}if(m=Pe(d,le),void 0!==t){const e=m.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=t[n];e.push(null!=r?Array.from(r):null)}}f=function(e,t,n,r,i){const o=n[1],s=function(e,t,n){const r=We();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),qi(e,r,t,wi(e,t,1,null),n));const i=zt(t,e,r.directiveStart,r);vr(i,t);const o=De(r,t);return o&&vr(o,t),i}(o,n,t);if(r.components.push(s),e[8]=s,i&&i.forEach(e=>e(s,t)),t.contentQueries){const e=We();t.contentQueries(1,s,e.directiveStart)}const a=We();return!o.firstCreatePass||null===t.hostBindings&&null===t.hostAttrs||(pt(a.index),Vi(n[1],a,0,a.directiveStart,a.directiveEnd,t),Fi(t,s)),s}(e,this.componentDef,p,h,[Io]),Ri(d,p,null)}finally{ht()}return new Qa(this.componentType,f,$s(m,p),p,m)}}class Qa extends class{}{constructor(e,t,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.instance=t,this.hostView=this.changeDetectorRef=new wa(r),this.componentType=e}get injector(){return new Qt(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}const Ja=new Map;class Xa extends xa{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Wa(this);const n=ue(e),r=e[Q]||null;r&&Fs(r),this._bootstrapComponents=Rr(n.bootstrap),this._r3Injector=_o(e,t,[{provide:xa,useValue:this},{provide:Js,useValue:this.componentFactoryResolver}],d(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=Ro.THROW_IF_NOT_FOUND,n=k.Default){return e===Ro||e===xa||e===uo?this:this._r3Injector.get(e,t,n)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class $a extends Ma{constructor(e){super(),this.moduleType=e,null!==ue(e)&&function(e){const t=new Set;!function e(n){const r=ue(n,!0),i=r.id;null!==i&&(function(e,t,n){if(t&&t!==n)throw new Error(`Duplicate module registered for ${e} - ${d(t)} vs ${d(t.name)}`)}(i,Ja.get(i),n),Ja.set(i,n));const o=Rr(r.imports);for(const s of o)t.has(s)||(t.add(s),e(s))}(e)}(e)}create(e){return new Xa(this.moduleType,e)}}function Za(e,t,n){const r=function(){const e=Be.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}()+e,i=Ge();return i[r]===di?function(e,t,n){return e[t]=n}(i,r,n?t.call(n):t()):function(e,t){return e[t]}(i,r)}function ec(e){return t=>{setTimeout(e,void 0,t)}}const tc=class extends r.xQ{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,n){var r,o,s;let a=e,c=t||(()=>null),u=n;if(e&&"object"==typeof e){const t=e;a=null===(r=t.next)||void 0===r?void 0:r.bind(t),c=null===(o=t.error)||void 0===o?void 0:o.bind(t),u=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}this.__isAsync&&(c=ec(c),a&&(a=ec(a)),u&&(u=ec(u)));const l=super.subscribe({next:a,error:c,complete:u});return e instanceof i.w&&e.add(l),l}};function nc(){return this._results[Po()]()}class rc{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Po(),n=rc.prototype;n[t]||(n[t]=nc)}get changes(){return this._changes||(this._changes=new tc)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const n=this;n.dirty=!1;const r=on(e);(this._changesDetected=!function(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],o=t[r];if(n&&(i=n(i),o=n(o)),o!==i)return!1}return!0}(n._results,r,t))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){!this._changes||!this._changesDetected&&this._emitDistinctChangesOnly||this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}class ic{constructor(e){this.queryList=e,this.matches=null}clone(){return new ic(this.queryList)}setDirty(){this.queryList.setDirty()}}class oc{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const n=null!==e.contentQueries?e.contentQueries[0]:t.length,r=[];for(let e=0;e<n;e++){const n=t.getByIndex(e);r.push(this.queries[n.indexInDeclarationView].clone())}return new oc(r)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==yc(e,t).matches&&this.queries[t].setDirty()}}class sc{constructor(e,t,n=null){this.predicate=e,this.flags=t,this.read=n}}class ac{constructor(e=[]){this.queries=e}elementStart(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let n=0;n<this.length;n++){const r=null!==t?t.length:0,i=this.getByIndex(n).embeddedTView(e,r);i&&(i.indexInDeclarationView=n,null!==t?t.push(i):t=[i])}return null!==t?new ac(t):null}template(e,t){for(let n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class cc{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new cc(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let n=e.parent;for(;null!==n&&8&n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(e,t,uc(t,i)),this.matchTNodeWithReadOption(e,t,Wt(t,e,i,!1,!1))}else n===ka?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,Wt(t,e,n,!1,!1))}matchTNodeWithReadOption(e,t,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===ea||r===Va||r===ka&&4&t.type)this.addMatch(t.index,-2);else{const n=Wt(t,e,r,!1,!1);null!==n&&this.addMatch(t.index,n)}else this.addMatch(t.index,n)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function uc(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function lc(e,t,n,r){return-1===n?function(e,t){return 11&e.type?$s(e,t):4&e.type?La(e,t):null}(t,e):-2===n?function(e,t,n){return n===ea?$s(t,e):n===ka?La(t,e):n===Va?qa(t,e):void 0}(e,t,r):zt(e,e[1],n,t)}function hc(e,t,n,r){const i=t[19].queries[r];if(null===i.matches){const r=e.data,o=n.matches,s=[];for(let e=0;e<o.length;e+=2){const i=o[e];s.push(i<0?null:lc(t,r[i],o[e+1],n.metadata.read))}i.matches=s}return i.matches}function dc(e,t,n,r){const i=e.queries.getByIndex(n),o=i.matches;if(null!==o){const s=hc(e,t,i,n);for(let e=0;e<o.length;e+=2){const n=o[e];if(n>0)r.push(s[e/2]);else{const i=o[e+1],s=t[-n];for(let e=he;e<s.length;e++){const t=s[e];t[17]===t[3]&&dc(t[1],t,i,r)}if(null!==s[9]){const e=s[9];for(let t=0;t<e.length;t++){const n=e[t];dc(n[1],n,i,r)}}}}}return r}function pc(e){const t=Ge(),n=qe(),r=nt();rt(r+1);const i=yc(n,r);if(e.dirty&&xe(t)===(2==(2&i.metadata.flags))){if(null===i.matches)e.reset([]);else{const o=i.crossesNgTemplate?dc(n,t,r,[]):hc(n,t,i,r);e.reset(o,ta),e.notifyOnChanges()}return!0}return!1}function fc(e,t,n){const r=qe();r.firstCreatePass&&(vc(r,new sc(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),_c(r,Ge(),t)}function mc(e,t,n,r){const i=qe();if(i.firstCreatePass){const o=We();vc(i,new sc(t,n,r),o.index),function(e,t){const n=e.contentQueries||(e.contentQueries=[]);t!==(n.length?n[n.length-1]:-1)&&n.push(e.queries.length-1,t)}(i,e),2==(2&n)&&(i.staticContentQueries=!0)}_c(i,Ge(),n)}function gc(){return e=Ge(),t=nt(),e[19].queries[t].queryList;var e,t}function _c(e,t,n){const r=new rc(4==(4&n));Li(e,t,r,r.destroy),null===t[19]&&(t[19]=new oc),t[19].queries.push(new ic(r))}function vc(e,t,n){null===e.queries&&(e.queries=new ac),e.queries.track(new cc(t,n))}function yc(e,t){return e.queries.getByIndex(t)}const Ec=new tn("Application Initializer");let Sc=(()=>{class e{constructor(e){this.appInits=e,this.resolve=Xs,this.reject=Xs,this.initialized=!1,this.done=!1,this.donePromise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}runInitializers(){if(this.initialized)return;const e=[],t=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const t=this.appInits[n]();if(Jo(t))e.push(t);else if($o(t)){const n=new Promise((e,n)=>{t.subscribe({complete:e,error:n})});e.push(n)}}Promise.all(e).then(()=>{t()}).catch(e=>{this.reject(e)}),0===e.length&&t(),this.initialized=!0}}return e.\u0275fac=function(t){return new(t||e)(En(Ec,8))},e.\u0275prov=T({token:e,factory:e.\u0275fac}),e})();const Tc=new tn("AppId"),bc={provide:Tc,useFactory:function(){return`${wc()}${wc()}${wc()}`},deps:[]};function wc(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Rc=new tn("Platform Initializer"),Ic=new tn("Platform ID"),Cc=new tn("appBootstrapListener");let Ac=(()=>{class e{log(e){console.log(e)}warn(e){console.warn(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac}),e})();const Oc=new tn("LocaleId"),Nc=new tn("DefaultCurrencyCode");class kc{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}const Dc=function(e){return new $a(e)},Pc=Dc,Lc=function(e){return Promise.resolve(Dc(e))},xc=function(e){const t=Dc(e),n=Rr(ue(e).declarations).reduce((e,t)=>{const n=ce(t);return n&&e.push(new Ya(n)),e},[]);return new kc(t,n)},Mc=xc,Uc=function(e){return Promise.resolve(xc(e))};let Vc=(()=>{class e{constructor(){this.compileModuleSync=Pc,this.compileModuleAsync=Lc,this.compileModuleAndAllComponentsSync=Mc,this.compileModuleAndAllComponentsAsync=Uc}clearCache(){}clearCacheFor(e){}getModuleId(e){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac}),e})();const Fc=(()=>Promise.resolve(0))();function Bc(e){"undefined"==typeof Zone?Fc.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class jc{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tc(!1),this.onMicrotaskEmpty=new tc(!1),this.onStable=new tc(!1),this.onError=new tc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&t,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function(){let e=G.requestAnimationFrame,t=G.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function(e){const t=()=>{!function(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(G,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,Hc(e),e.isCheckStableRunning=!0,qc(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),Hc(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,o,s,a)=>{try{return Wc(e),n.invokeTask(i,o,s,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||e.shouldCoalesceRunChangeDetection)&&t(),zc(e)}},onInvoke:(n,r,i,o,s,a,c)=>{try{return Wc(e),n.invoke(i,o,s,a,c)}finally{e.shouldCoalesceRunChangeDetection&&t(),zc(e)}},onHasTask:(t,n,r,i)=>{t.hasTask(r,i),n===r&&("microTask"==i.change?(e._hasPendingMicrotasks=i.microTask,Hc(e),qc(e)):"macroTask"==i.change&&(e.hasPendingMacrotasks=i.macroTask))},onHandleError:(t,n,r,i)=>(t.handleError(r,i),e.runOutsideAngular(()=>e.onError.emit(i)),!1)})}(r)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!jc.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(jc.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,n){return this._inner.run(e,t,n)}runTask(e,t,n,r){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+r,e,Gc,Xs,Xs);try{return i.runTask(o,t,n)}finally{i.cancelTask(o)}}runGuarded(e,t,n){return this._inner.runGuarded(e,t,n)}runOutsideAngular(e){return this._outer.run(e)}}const Gc={};function qc(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function Hc(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function Wc(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function zc(e){e._nesting--,qc(e)}class Kc{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tc,this.onMicrotaskEmpty=new tc,this.onStable=new tc,this.onError=new tc}run(e,t,n){return e.apply(t,n)}runGuarded(e,t,n){return e.apply(t,n)}runOutsideAngular(e){return e()}runTask(e,t,n,r){return e.apply(t,n)}}let Yc=(()=>{class e{constructor(e){this._ngZone=e,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),e.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{jc.assertNotInAngularZone(),Bc(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Bc(()=>{for(;0!==this._callbacks.length;){let e=this._callbacks.pop();clearTimeout(e.timeoutId),e.doneCb(this._didWork)}this._didWork=!1});else{let e=this.getPendingTasks();this._callbacks=this._callbacks.filter(t=>!t.updateCb||!t.updateCb(e)||(clearTimeout(t.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(e=>({source:e.source,creationLocation:e.creationLocation,data:e.data})):[]}addCallback(e,t,n){let r=-1;t&&t>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(e=>e.timeoutId!==r),e(this._didWork,this.getPendingTasks())},t)),this._callbacks.push({doneCb:e,timeoutId:r,updateCb:n})}whenStable(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(e,t,n){return[]}}return e.\u0275fac=function(t){return new(t||e)(En(jc))},e.\u0275prov=T({token:e,factory:e.\u0275fac}),e})(),Qc=(()=>{class e{constructor(){this._applications=new Map,Zc.addToWindow(this)}registerApplication(e,t){this._applications.set(e,t)}unregisterApplication(e){this._applications.delete(e)}unregisterAllApplications(){this._applications.clear()}getTestability(e){return this._applications.get(e)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(e,t=!0){return Zc.findTestabilityInTree(this,e,t)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=T({token:e,factory:e.\u0275fac}),e})();class Jc{addToWindow(e){}findTestabilityInTree(e,t,n){return null}}function Xc(e){Zc=e}let $c,Zc=new Jc,eu=!0,tu=!1;function nu(){return tu=!0,eu}function ru(){if(tu)throw new Error("Cannot enable prod mode after platform setup.");eu=!1}const iu=new tn("AllowMultipleToken");class ou{constructor(e,t){this.name=e,this.token=t}}function su(e,t,n=[]){const r=`Platform: ${t}`,i=new tn(r);return(t=[])=>{let o=au();if(!o||o.injector.get(iu,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{const e=n.concat(t).concat({provide:i,useValue:!0},{provide:ho,useValue:"platform"});!function(e){if($c&&!$c.destroyed&&!$c.injector.get(iu,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");$c=e.get(cu);const t=e.get(Rc,null);t&&t.forEach(e=>e())}(Ro.create({providers:e,name:r}))}return function(e){const t=au();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function au(){return $c&&!$c.destroyed?$c:null}let cu=(()=>{class e{constructor(e){this._injector=e,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(e,t){const n=function(e,t){let n;return n="noop"===e?new Kc:("zone.js"===e?void 0:e)||new jc({enableLongStackTrace:nu(),shouldCoalesceEventChangeDetection:!!(null==t?void 0:t.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==t?void 0:t.ngZoneRunCoalescing)}),n}(t?t.ngZone:void 0,{ngZoneEventCoalescing:t&&t.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:t&&t.ngZoneRunCoalescing||!1}),r=[{provide:jc,useValue:n}];return n.run(()=>{const t=Ro.create({providers:r,parent:this.injector,name:e.moduleType.name}),i=e.create(t),o=i.injector.get(br,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const e=n.onError.subscribe({next:e=>{o.handleError(e)}});i.onDestroy(()=>{hu(this._modules,i),e.unsubscribe()})}),function(e,t,n){try{const r=n();return Jo(r)?r.catch(n=>{throw t.runOutsideAngular(()=>e.handleError(n)),n}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(o,n,()=>{const e=i.injector.get(Sc);return e.runInitializers(),e.donePromise.then(()=>(Fs(i.injector.get(Oc,Us)||Us),this._moduleDoBootstrap(i),i))})})}bootstrapModule(e,t=[]){const n=uu({},t);return function(e,t,n){const r=new $a(n);return Promise.resolve(r)}(0,0,e).then(e=>this.bootstrapModuleFactory(e,n))}_moduleDoBootstrap(e){const t=e.injector.get(lu);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach(e=>t.bootstrap(e));else{if(!e.instance.ngDoBootstrap)throw new Error(`The module ${d(e.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);e.instance.ngDoBootstrap(t)}this._modules.push(e)}onDestroy(e){this._destroyListeners.push(e)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(e=>e.destroy()),this._destroyListeners.forEach(e=>e()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(t){return new(t||e)(En(Ro))},e.\u0275prov=T({token:e,factory:e.\u0275fac}),e})();function uu(e,t){return Array.isArray(t)?t.reduce(uu,e):Object.assign(Object.assign({},e),t)}let lu=(()=>{class e{constructor(e,t,n,r,i){this._zone=e,this._injector=t,this._exceptionHandler=n,this._componentFactoryResolver=r,this._initStatus=i,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const l=new o.y(e=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{e.next(this._stable),e.complete()})}),h=new o.y(e=>{let t;this._zone.runOutsideAngular(()=>{t=this._zone.onStable.subscribe(()=>{jc.assertNotInAngularZone(),Bc(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,e.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{jc.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{e.next(!1)}))});return()=>{t.unsubscribe(),n.unsubscribe()}});this.isStable=(0,s.T)(l,h.pipe(e=>{return(0,c.x)()((t=u,function(e){let n;n="function"==typeof t?t:function(){return t};const r=Object.create(e,a.N);return r.source=e,r.subjectFactory=n,r})(e));var t}))}bootstrap(e,t){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=e instanceof Ys?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);const r=n.isBoundToModule?void 0:this._injector.get(xa),i=n.create(Ro.NULL,[],t||n.selector,r),o=i.location.nativeElement,s=i.injector.get(Yc,null),a=s&&i.injector.get(Qc);return s&&a&&a.registerApplication(o,s),i.onDestroy(()=>{this.detachView(i.hostView),hu(this.components,i),a&&a.unregisterApplication(o)}),this._loadComponent(i),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let e of this._views)e.detectChanges()}catch(e){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(e))}finally{this._runningTick=!1}}attachView(e){const t=e;this._views.push(t),t.attachToAppRef(this)}detachView(e){const t=e;hu(this._views,t),t.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Cc,[]).concat(this._bootstrapListeners).forEach(t=>t(e))}ngOnDestroy(){this._views.slice().forEach(e=>e.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return e.\u0275fac=function(t){return new(t||e)(En(jc),En(Ro),En(br),En(Js),En(Sc))},e.\u0275prov=T({token:e,factory:e.\u0275fac}),e})();function hu(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class du{}class pu{}const fu={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let mu=(()=>{class e{constructor(e,t){this._compiler=e,this._config=t||fu}load(e){return this.loadAndCompile(e)}loadAndCompile(e){let[t,r]=e.split("#");return void 0===r&&(r="default"),n(8255)(t).then(e=>e[r]).then(e=>gu(e,t,r)).then(e=>this._compiler.compileModuleAsync(e))}loadFactory(e){let[t,r]=e.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n(8255)(this._config.factoryPathPrefix+t+this._config.factoryPathSuffix).then(e=>e[r+i]).then(e=>gu(e,t,r))}}return e.\u0275fac=function(t){return new(t||e)(En(Vc),En(pu,8))},e.\u0275prov=T({token:e,factory:e.\u0275fac}),e})();function gu(e,t,n){if(!e)throw new Error(`Cannot find '${n}' in '${t}'`);return e}const _u=function(e){return null},vu=su(null,"core",[{provide:Ic,useValue:"unknown"},{provide:cu,deps:[Ro]},{provide:Qc,deps:[]},{provide:Ac,deps:[]}]),yu=[{provide:lu,useClass:lu,deps:[jc,Ro,br,Js,Sc]},{provide:Ka,deps:[jc],useFactory:function(e){let t=[];return e.onStable.subscribe(()=>{for(;t.length;)t.pop()()}),function(e){t.push(e)}}},{provide:Sc,useClass:Sc,deps:[[new Rn,Ec]]},{provide:Vc,useClass:Vc,deps:[]},bc,{provide:ya,useFactory:function(){return Aa},deps:[]},{provide:Sa,useFactory:function(){return Oa},deps:[]},{provide:Oc,useFactory:function(e){return Fs(e=e||"undefined"!=typeof $localize&&$localize.locale||Us),e},deps:[[new wn(Oc),new Rn,new In]]},{provide:Nc,useValue:"USD"}];let Eu=(()=>{class e{constructor(e){}}return e.\u0275fac=function(t){return new(t||e)(En(lu))},e.\u0275mod=re({type:e}),e.\u0275inj=b({providers:yu}),e})()},2346:(e,t,n)=>{"use strict";n.d(t,{hO:()=>I,xv:()=>y,Dh:()=>v,HU:()=>p,GT:()=>_,sI:()=>w,on:()=>S,ss:()=>f,pX:()=>g,yq:()=>T});var r=n(8489),i=n(8569),o=n(6599),s=n(3482),a=n(9971),c=n(7368),u=n(1858);function l(){}e=n.hmd(e);class h{constructor(e,t=r.N){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){const r=this.zone;return this.delegate.schedule(function(t){r.runGuarded(()=>{e.apply(this,[t])})},t,n)}}class d{constructor(e){this.zone=e,this.task=null}call(e,t){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",l,{},l,l)),t.pipe((0,o.b)({next:n,complete:n,error:n})).subscribe(e).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}class p{constructor(e){this.ngZone=e,this.outsideAngular=e.runOutsideAngular(()=>new h(Zone.current)),this.insideAngular=e.run(()=>new h(Zone.current,i.z))}}function f(e){return function(t){return(t=t.lift(new d(e.ngZone))).pipe((0,s.R)(e.outsideAngular),(0,a.QV)(e.insideAngular))}}const m=["ngOnDestroy"],g=(e,t,n,r={})=>new Proxy(e,{get:(i,o)=>n.runOutsideAngular(()=>{var i;if(e[o])return(null===(i=null==r?void 0:r.spy)||void 0===i?void 0:i.get)&&r.spy.get(o,e[o]),e[o];if(m.indexOf(o)>-1)return()=>{};const s=t.toPromise().then(e=>{const t=e&&e[o];return"function"==typeof t?t.bind(e):t&&t.then?t.then(e=>n.run(()=>e)):n.run(()=>t)});return new Proxy(()=>{},{get:(e,t)=>s[t],apply:(e,t,n)=>s.then(e=>{var t;const i=e&&e(...n);return(null===(t=null==r?void 0:r.spy)||void 0===t?void 0:t.apply)&&r.spy.apply(o,n,i),i})})})}),_=(e,t)=>{t.forEach(t=>{Object.getOwnPropertyNames(t.prototype||t).forEach(n=>{Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype||t,n))})})},v=new c.OlP("angularfire2.app.options"),y=new c.OlP("angularfire2.app.nameOrConfig"),E=new c.GfV("6.1.5");function S(t,n,r){const i="object"==typeof r&&r||{};i.name=i.name||"string"==typeof r&&r||"[DEFAULT]";const o=u.Z.apps.filter(e=>e&&e.name===i.name)[0]||n.runOutsideAngular(()=>u.Z.initializeApp(t,i));try{JSON.stringify(t)!==JSON.stringify(o.options)&&b("error",`${o.name} Firebase App already initialized with different options${e.hot?", you may need to reload as Firebase is not HMR aware.":"."}`)}catch(s){}return o}const T=()=>{b("warn","You may need to import 'firebase/auth' manually in your component rather than rely on AngularFireAuth's dynamic import, when using the emulator suite https://github.com/angular/angularfire/issues/2656")},b=(e,...t)=>{(0,c.X6Q)()&&"undefined"!=typeof console&&console[e](...t)};function w(t,n,r,i,o){const[s,...a]=globalThis.\u0275AngularfireInstanceCache.get(t)||[];if(s){try{o.some((e,t)=>{const n=a[t];return e&&"object"==typeof e?JSON.stringify(e)!==JSON.stringify(n):e!==n})&&b("error",`${n} was already initialized on the ${r.name} Firebase App instance with different settings.${e.hot?" You may need to reload as Firebase is not HMR aware.":""}`)}catch(c){}return s}{const e=i();return globalThis.\u0275AngularfireInstanceCache.set(t,[e,...o]),e}}globalThis.\u0275AngularfireInstanceCache||(globalThis.\u0275AngularfireInstanceCache=new Map);const R={provide:class{},useFactory:S,deps:[v,c.R0b,[new c.FiY,y]]};let I=(()=>{class e{constructor(e){u.Z.registerVersion("angularfire",E.full,e.toString()),u.Z.registerVersion("angular",c.q4F.full)}static initializeApp(t,n){return{ngModule:e,providers:[{provide:v,useValue:t},{provide:y,useValue:n}]}}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(c.Lbi))},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({providers:[R]}),e})()},1062:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var r,i,o=n(4762),s=n(250),a=n(5119),c=n(308),u=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r["invalid-log-argument"]="First argument to `onLog` must be null or a function.",r),l=new s.LL("app","Firebase",u),h="@firebase/app",d="[DEFAULT]",p=((i={})[h]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/app-check"]="fire-app-check",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),f=new c.Yd("@firebase/app"),m=function(){function e(e,t,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=(0,s.p$)(e),this.container=new a.H0(t.name),this._addComponent(new a.wA("app",function(){return r},"PUBLIC")),this.firebase_.INTERNAL.components.forEach(function(e){return r._addComponent(e)})}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise(function(t){e.checkDestroyed_(),t()}).then(function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map(function(e){return e.delete()}))}).then(function(){e.isDeleted_=!0})},e.prototype._getService=function(e,t){var n;void 0===t&&(t=d),this.checkDestroyed_();var r=this.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})},e.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=d),this.container.getProvider(e).clearInstance(t)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){f.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw l.create("app-deleted",{appName:this.name_})},e}();m.prototype.name&&m.prototype.options||m.prototype.delete||console.log("dc");var g=function e(){var t=function(e){var t={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"==typeof i&&null!==i||(i={name:i});var o=i;void 0===o.name&&(o.name=d);var a=o.name;if("string"!=typeof a||!a)throw l.create("bad-app-name",{appName:String(a)});if((0,s.r3)(t,a))throw l.create("duplicate-app",{appName:a});var c=new e(n,o,r);return t[a]=c,c},app:i,registerVersion:function(e,t,n){var r,i=null!==(r=p[e])&&void 0!==r?r:e;n&&(i+="-"+n);var s=i.match(/\s|\//),c=t.match(/\s|\//);if(s||c){var u=['Unable to register library "'+i+'" with version "'+t+'":'];return s&&u.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&c&&u.push("and"),c&&u.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void f.warn(u.join(" "))}o(new a.wA(i+"-version",function(){return{library:i,version:t}},"VERSION"))},setLogLevel:c.Ub,onLog:function(e,t){if(null!==e&&"function"!=typeof e)throw l.create("invalid-log-argument");(0,c.Am)(e,t)},apps:null,SDK_VERSION:"8.6.8",INTERNAL:{registerComponent:o,removeApp:function(e){delete t[e]},components:n,useAsService:function(e,t){return"serverAuth"===t?null:t}}};function i(e){if(!(0,s.r3)(t,e=e||d))throw l.create("no-app",{appName:e});return t[e]}function o(o){var a=o.name;if(n.has(a))return f.debug("There were multiple attempts to register component "+a+"."),"PUBLIC"===o.type?r[a]:null;if(n.set(a,o),"PUBLIC"===o.type){var c=function(e){if(void 0===e&&(e=i()),"function"!=typeof e[a])throw l.create("invalid-app-argument",{appName:a});return e[a]()};void 0!==o.serviceProps&&(0,s.ZB)(c,o.serviceProps),r[a]=c,e.prototype[a]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._getService.bind(this,a).apply(this,o.multipleInstances?e:[])}}for(var u=0,h=Object.keys(t);u<h.length;u++)t[h[u]]._addComponent(o);return"PUBLIC"===o.type?r[a]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(t).map(function(e){return t[e]})}}),i.App=e,r}(m);return t.INTERNAL=(0,o.pi)((0,o.pi)({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,s.ZB)(t,e)},createSubscribe:s.ne,ErrorFactory:s.LL,deepExtend:s.ZB}),t}(),_=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){var t=e.getImmediate();return t.library+"/"+t.version}return null}).filter(function(e){return e}).join(" ")},e}();if((0,s.jU)()&&void 0!==self.firebase){f.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var v=self.firebase.SDK_VERSION;v&&v.indexOf("LITE")>=0&&f.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var y=g.initializeApp;g.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,s.UG)()&&f.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),y.apply(void 0,e)};var E=g;!function(e,t){e.INTERNAL.registerComponent(new a.wA("platform-logger",function(e){return new _(e)},"PRIVATE")),e.registerVersion(h,"0.6.27",void 0),e.registerVersion("fire-js","")}(E);const S=E},5119:(e,t,n)=>{"use strict";n.d(t,{wA:()=>o,H0:()=>c});var r=n(4762),i=n(250),o=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},e}(),s="[DEFAULT]",a=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.onInitCallbacks=new Map}return e.prototype.get=function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new i.BH;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(o){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t,n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(h){}try{for(var i=(0,r.XA)(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var a=(0,r.CR)(o.value,2),c=a[1],u=this.normalizeInstanceIdentifier(a[0]);try{var l=this.getOrInitializeService({instanceIdentifier:u});c.resolve(l)}catch(h){}}}catch(d){t={error:d}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}},e.prototype.clearInstance=function(e){void 0===e&&(e=s),this.instancesDeferred.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return(0,r.mG)(this,void 0,void 0,function(){var e;return(0,r.Jh)(this,function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all((0,r.ev)((0,r.ev)([],(0,r.CR)(e.filter(function(e){return"INTERNAL"in e}).map(function(e){return e.INTERNAL.delete()}))),(0,r.CR)(e.filter(function(e){return"_delete"in e}).map(function(e){return e._delete()}))))];case 1:return t.sent(),[2]}})})},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.isInitialized=function(e){return void 0===e&&(e=s),this.instances.has(e)},e.prototype.initialize=function(e){var t,n;void 0===e&&(e={});var i=e.options,o=void 0===i?{}:i,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(this.name+"("+s+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var a=this.getOrInitializeService({instanceIdentifier:s,options:o});try{for(var c=(0,r.XA)(this.instancesDeferred.entries()),u=c.next();!u.done;u=c.next()){var l=(0,r.CR)(u.value,2),h=l[1];s===this.normalizeInstanceIdentifier(l[0])&&h.resolve(a)}}catch(d){t={error:d}}finally{try{u&&!u.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return this.invokeOnInitCallbacks(a,s),a},e.prototype.onInit=function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var o=this.instances.get(r);return o&&e(o,r),function(){i.delete(e)}},e.prototype.invokeOnInitCallbacks=function(e,t){var n,i,o=this.onInitCallbacks.get(t);if(o)try{for(var s=(0,r.XA)(o),a=s.next();!a.done;a=s.next()){var c=a.value;try{c(e,t)}catch(u){}}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},e.prototype.getOrInitializeService=function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===s?void 0:t),options:i}),this.instances.set(n,o),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(a){}return o||null},e.prototype.normalizeInstanceIdentifier=function(e){return void 0===e&&(e=s),this.component?this.component.multipleInstances?e:s:e},e.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},e}(),c=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new a(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}()},308:(e,t,n)=>{"use strict";function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var i;n.d(t,{in:()=>s,Yd:()=>h,Ub:()=>d,Am:()=>p});var o=[],s=function(e){return e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT",e}({}),a={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},c=s.INFO,u=((i={})[s.DEBUG]="log",i[s.VERBOSE]="log",i[s.INFO]="info",i[s.WARN]="warn",i[s.ERROR]="error",i),l=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(t<e.logLevel)){var o=(new Date).toISOString(),s=u[t];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[s].apply(console,r(["["+o+"]  "+e.name+":"],n))}},h=function(){function e(e){this.name=e,this._logLevel=c,this._logHandler=l,this._userLogHandler=null,o.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in s))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?a[e]:e},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.DEBUG],e)),this._logHandler.apply(this,r([this,s.DEBUG],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.VERBOSE],e)),this._logHandler.apply(this,r([this,s.VERBOSE],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.INFO],e)),this._logHandler.apply(this,r([this,s.INFO],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.WARN],e)),this._logHandler.apply(this,r([this,s.WARN],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.ERROR],e)),this._logHandler.apply(this,r([this,s.ERROR],e))},e}();function d(e){o.forEach(function(t){t.setLogLevel(e)})}function p(e,t){for(var n=function(n){var r=null;t&&t.level&&(r=a[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var a=i.map(function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}}).filter(function(e){return e}).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:s[n].toLowerCase(),message:a,args:i,type:t.name})}},r=0,i=o;r<i.length;r++)n(i[r])}},250:(e,t,n)=>{"use strict";n.d(t,{BH:()=>a,LL:()=>y,ZR:()=>v,r3:()=>T,Sg:()=>c,ne:()=>b,p$:()=>o,ZB:()=>s,m9:()=>I,z$:()=>u,jU:()=>d,ru:()=>p,d:()=>m,w1:()=>g,uI:()=>l,UG:()=>h,b$:()=>f,Mn:()=>_});var r=n(4762),i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,a=s?e[i+1]:0,c=i+2<e.length,u=c?e[i+2]:0,l=(15&a)<<2|u>>6,h=63&u;c||(h=64,s||(l=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[l],n[h])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=e[n++]))<<12|(63&(a=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{o=e[n++];var a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,c=++i<e.length?n[e.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==c)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==c&&r.push(a<<6&192|c))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};function o(e){return s(void 0,e)}function s(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=s(e[n],t[n]));return e}var a=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch(function(){}),1===e.length?e(n):e(n,r))}},e}();function c(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",o=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=(0,r.pi)({iss:"https://securetoken.google.com/"+n,aud:n,iat:o,exp:o+3600,auth_time:o,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[i.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),i.encodeString(JSON.stringify(a),!1),""].join(".")}function u(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function l(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(u())}function h(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function d(){return"object"==typeof self&&self.self===self}function p(){var e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function f(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function m(){return u().indexOf("Electron/")>=0}function g(){var e=u();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function _(){return u().indexOf("MSAppHost/")>=0}var v=function(e){function t(n,r,i){var o=e.call(this,r)||this;return o.code=n,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,y.prototype.create),o}return(0,r.ZT)(t,e),t}(Error),y=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=t[0]||{},i=this.service+"/"+e,o=this.errors[e],s=o?E(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",c=new v(i,a,r);return c},e}();function E(e,t){return e.replace(S,function(e,n){var r=t[n];return null!=r?String(r):"<"+n+"?>"})}var S=/\{\$([^}]+)}/g;function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function b(e,t){var n=new w(e,t);return n.subscribe.bind(n)}var w=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(function(){e(n)}).catch(function(e){n.error(e)})}return e.prototype.next=function(e){this.forEachObserver(function(t){t.next(e)})},e.prototype.error=function(e){this.forEachObserver(function(t){t.error(e)}),this.close(e)},e.prototype.complete=function(){this.forEachObserver(function(e){e.complete()}),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=R),void 0===r.error&&(r.error=R),void 0===r.complete&&(r.complete=R);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}}),this.observers.push(r),o},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!=typeof console&&console.error&&console.error(r)}})},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(function(){t.observers=void 0,t.onNoObservers=void 0}))},e}();function R(){}function I(e){return e&&e._delegate?e._delegate:e}},2544:function(e,t,n){"use strict";var r=n(1052).default;e.exports=function(){function e(e,t,n){return e(n={path:t,exports:{},require:function(e,t){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}},n.exports),n.exports}function t(e,t,n){return(e=e.match(t))&&e.length>=n&&gs(e[n],10)}function n(e,t,n){if(e.RTCPeerConnection){var r=(e=e.RTCPeerConnection.prototype).addEventListener;e.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);let o=e=>{(e=n(e))&&i(e)};return this._eventMap=this._eventMap||{},this._eventMap[i]=o,r.apply(this,[e,o])};var i=e.removeEventListener;e.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return i.apply(this,arguments);let r=this._eventMap[n];return delete this._eventMap[n],i.apply(this,[e,r])},cs(e,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function i(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(_s=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function o(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(vs=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function s(){"object"!=typeof window||_s||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}function a(e,t){vs&&console.warn(e+" is deprecated, please use "+t+" instead.")}function c(e){let{navigator:n}=e,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(n.mozGetUserMedia)r.browser="firefox",r.version=t(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=t(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=t(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=t(n.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r}function u(e){var t;return"[object Object]"===Object.prototype.toString.call(e)?ss(t=ts(e)).call(t,function(t,n){var r="[object Object]"===Object.prototype.toString.call(e[n]);let i=r?u(e[n]):e[n];return r=r&&!ts(i).length,void 0===i||r?t:Zo(t,{[n]:i})},{}):e}function l(e,t,n){let r=n?"outbound-rtp":"inbound-rtp",i=new Do;if(null===t)return i;let o=[];return Qo(e).call(e,e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),Qo(o).call(o,t=>{Qo(e).call(e,n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){var i;n&&!r.has(n.id)&&(r.set(n.id,n),Qo(i=ts(n)).call(i,i=>{if(qo(i).call(i,"Id"))e(t,t.get(n[i]),r);else if(qo(i).call(i,"Ids")){var o;Qo(o=n[i]).call(o,n=>{e(t,t.get(n),r)})}}))}(e,n,i)})}),i}function h(e){let t=e&&e.navigator;if(t.mediaDevices){var n=c(e),r=function(e){var t;if("object"!=typeof e||e.mandatory||e.optional)return e;const n={};var r;return Qo(t=ts(e)).call(t,t=>{if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"==typeof e[t]?e[t]:{ideal:e[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var i,o=function(e,t){return e?e+t.charAt(0).toUpperCase()+wc(t).call(t,1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){n.optional=n.optional||[];let e={};"number"==typeof r.ideal?(e[o("min",t)]=r.ideal,n.optional.push(e),e={},e[o("max",t)]=r.ideal,n.optional.push(e)):(e[o("",t)]=r.ideal,n.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(n.mandatory=n.mandatory||{},n.mandatory[o("",t)]=r.exact):Qo(i=["min","max"]).call(i,e=>{void 0!==r[e]&&(n.mandatory=n.mandatory||{},n.mandatory[o(e,t)]=r[e])})}}),e.advanced&&(n.optional=Us(r=n.optional||[]).call(r,e.advanced)),n},i=function(e,i){if(61<=n.version)return i(e);if((e=JSON.parse(wr(e)))&&"object"==typeof e.audio){var o=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};o((e=JSON.parse(wr(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let s=e.video.facingMode;if(s=s&&("object"==typeof s?s:{ideal:s}),o=66>n.version,!(!s||"user"!==s.exact&&"environment"!==s.exact&&"user"!==s.ideal&&"environment"!==s.ideal||t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!o)){let n;if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?n=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(n=["front"]),n)return t.mediaDevices.enumerateDevices().then(t=>{t=Bs(t).call(t,e=>"videoinput"===e.kind);let o=Ac(t).call(t,e=>jc(n).call(n,t=>{var n;return Vc(n=e.label.toLowerCase()).call(n,t)}));return!o&&t.length&&Vc(n).call(n,"back")&&(o=t[t.length-1]),o&&(e.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),Gc("chrome: "+wr(e)),i(e)})}e.video=r(e.video)}return Gc("chrome: "+wr(e)),i(e)},o=function(e){return 64<=n.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(e=function(e,n,r){i(e,e=>{t.webkitGetUserMedia(e,n,e=>{r&&r(o(e))})})},t.getUserMedia=Pc(e).call(e,t),t.mediaDevices.getUserMedia){var s;let e=Pc(s=t.mediaDevices.getUserMedia).call(s,t.mediaDevices);t.mediaDevices.getUserMedia=function(t){return i(t,t=>e(t).then(e=>{var n;if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw Qo(n=e.getTracks()).call(n,e=>{e.stop()}),new DOMException("","NotFoundError");return e},e=>ic.reject(o(e))))}}}}function d(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function p(e){if("object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)n(e,"track",e=>(e.transceiver||cs(e,"transceiver",{value:{receiver:e.receiver}}),e));else{cs(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{var n;t.stream.addEventListener("addtrack",n=>{let r;var i;r=e.RTCPeerConnection.prototype.getReceivers?Ac(i=this.getReceivers()).call(i,e=>e.track&&e.track.id===n.track.id):{track:n.track},(i=new Event("track")).track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}),Qo(n=t.stream.getTracks()).call(n,n=>{let r;var i;r=e.RTCPeerConnection.prototype.getReceivers?Ac(i=this.getReceivers()).call(i,e=>e.track&&e.track.id===n.id):{track:n},(i=new Event("track")).track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}}function f(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===t.kind?e.createDTMFSender(t):null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){var e;return this._senders=this._senders||[],wc(e=this._senders).call(e)};let n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};let r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t;r.apply(this,arguments);let n=vc(t=this._senders).call(t,e);var i;-1!==n&&dc(i=this._senders).call(i,n,1)}}let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r;this._senders=this._senders||[],n.apply(this,[e]),Qo(r=e.getTracks()).call(r,e=>{this._senders.push(t(this,e))})};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t;this._senders=this._senders||[],r.apply(this,[e]),Qo(t=e.getTracks()).call(t,e=>{var t;let n=Ac(t=this._senders).call(t,t=>t.track===e);var r,i;n&&dc(r=this._senders).call(r,vc(i=this._senders).call(i,n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return Qo(e).call(e,e=>e._pc=this),e},cs(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}}function m(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,r]=arguments;if(0<arguments.length&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);let i=function(e){const t={};return e=e.result(),Qo(e).call(e,e=>{var n;const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};Qo(n=e.names()).call(n,t=>{r[t]=e.stat(t)}),t[r.id]=r}),t},o=function(e){var t;return new Do(ac(t=ts(e)).call(t,t=>[t,e[t]]))};return 2<=arguments.length?t.apply(this,[function(e){n(o(i(e)))},e]):new ic((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])}).then(n,r)}}}function g(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return Qo(e).call(e,e=>e._pc=this),e});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>l(t,e.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return Qo(e).call(e,e=>e._pc=this),e}),n(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){let e=this;return this._pc.getStats().then(t=>l(t,e.track,!1))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var n,r;let e,t,i,o=arguments[0];return Qo(n=this.getSenders()).call(n,t=>{t.track===o&&(e?i=!0:e=t)}),Qo(r=this.getReceivers()).call(r,e=>(e.track===o&&(t?i=!0:t=e),e.track===o)),i||e&&t?ic.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():t?t.getStats():ic.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}}}function _(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},ac(e=ts(this._shimmedLocalStreams)).call(e,e=>this._shimmedLocalStreams[e][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var r;if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===vc(r=this._shimmedLocalStreams[n.id]).call(r,i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t,r,i;this._shimmedLocalStreams=this._shimmedLocalStreams||{},Qo(t=e.getTracks()).call(t,e=>{var t;if(Ac(t=this.getSenders()).call(t,t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")});let o=this.getSenders();n.apply(this,arguments),t=Bs(r=this.getSenders()).call(r,e=>-1===vc(o).call(o,e)),this._shimmedLocalStreams[e.id]=Us(i=[e]).call(i,t)};let r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Qo(t=ts(this._shimmedLocalStreams)).call(t,t=>{var n;let r=vc(n=this._shimmedLocalStreams[t]).call(n,e);var i;-1!==r&&dc(i=this._shimmedLocalStreams[t]).call(i,r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]}),i.apply(this,arguments)}}function v(e){function t(e,t){var n;let r=t.sdp;return Qo(n=ts(e._reverseStreams||[])).call(n,t=>{t=e._reverseStreams[t],r=r.replace(new RegExp(e._streams[t.id].id,"g"),t.id)}),new RTCSessionDescription({type:t.type,sdp:r})}function n(e,t){var n;let r=t.sdp;return Qo(n=ts(e._reverseStreams||[])).call(n,t=>{t=e._reverseStreams[t],r=r.replace(new RegExp(t.id,"g"),e._streams[t.id].id)}),new RTCSessionDescription({type:t.type,sdp:r})}var r;if(e.RTCPeerConnection){var i=c(e);if(e.RTCPeerConnection.prototype.addTrack&&65<=i.version)return _(e);var o=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let e=o.apply(this);return this._reverseStreams=this._reverseStreams||{},ac(e).call(e,e=>this._reverseStreams[e.id])};var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},Qo(n=t.getTracks()).call(n,e=>{var t;if(Ac(t=this.getSenders()).call(t,t=>t.track===e))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[t.id]||(n=new e.MediaStream(t.getTracks()),this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n),s.apply(this,[t])};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},a.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r,i,o;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let s=wc([]).call(arguments,1);if(1!==s.length||!Ac(r=s[0].getTracks()).call(r,e=>e===t))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(Ac(i=this.getSenders()).call(i,e=>e.track===t))throw new DOMException("Track already exists.","InvalidAccessError");return this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},(r=this._streams[n.id])?(r.addTrack(t),ic.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))})):(r=new e.MediaStream([t]),this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)),Ac(o=this.getSenders()).call(o,e=>e.track===t)},Qo(r=["createOffer","createAnswer"]).call(r,function(n){let r=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]={[n](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[n=>{n=t(this,n),e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then(e=>t(this,e))}}[n]});var u=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=n(this,arguments[0]),u.apply(this,arguments)):u.apply(this,arguments)};var l=bs(e.RTCPeerConnection.prototype,"localDescription");cs(e.RTCPeerConnection.prototype,"localDescription",{get(){let e=l.get.apply(this);return""===e.type?e:t(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let n;this._streams=this._streams||{},Qo(t=ts(this._streams)).call(t,t=>{var r;Ac(r=this._streams[t].getTracks()).call(r,t=>e.track===t)&&(n=this._streams[t])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}}function y(e){let t=c(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var n;53>t.version&&Qo(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}[t]});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?78>t.version&&arguments[0]&&""===arguments[0].candidate?ic.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ic.resolve())}}}function E(e){n(e,"negotiationneeded",e=>{if("stable"===e.target.signalingState)return e})}function S(e,t,n,r,i){return t=nu.writeRtpDescription(e.kind,t),t+=nu.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=nu.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),t+="a=mid:"+e.mid+"\r\n",t+=e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender&&(e.rtpSender._initialTrackId=n=e.rtpSender._initialTrackId||e.rtpSender.track.id,t=t+"a="+(r="msid:"+(r?r.id:"-")+" "+n+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+nu.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+nu.localCName+"\r\n"),t}function T(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){return e=r(e.parameters.apt,n),t=r(t.parameters.apt,i),e&&t&&e.name.toLowerCase()===t.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(r.name.toLowerCase()===s.name.toLowerCase()&&r.clockRate===s.clockRate&&("rtx"!==r.name.toLowerCase()||!r.parameters||!s.parameters.apt||i(r,s,e.codecs,t.codecs))){(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(r.numChannels,s.numChannels),n.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function b(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function w(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function R(e,t){return(t=Error(t)).name=e,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],t}function I(e){var t;let n=Pc(t=(e=e&&e.navigator).mediaDevices.getUserMedia).call(t,e.mediaDevices);e.mediaDevices.getUserMedia=function(e){return n(e).catch(e=>ic.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString(){return this.name}}}(e)))}}function C(e){var t;"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=Pc(t=e.navigator.getDisplayMedia).call(t,e.navigator)))}function A(e){let t=c(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),15025>t.version)){let t=bs(e.MediaStreamTrack.prototype,"enabled");cs(e.MediaStreamTrack.prototype,"enabled",{set(e){t.set.call(this,e);let n=new Event("enabled");n.enabled=e,this.dispatchEvent(n)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||cs(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);let n=ru(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=function(e,t){let n=!1;return e=JSON.parse(wr(e)),Bs(e).call(e,e=>{if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&a("RTCIceServer.url","RTCIceServer.urls");let r="string"==typeof t;return r&&(t=[t]),t=Bs(t).call(t,e=>0!==vc(e).call(e,"stun:")&&((e=Qc(e).call(e,"turn")&&!Qc(e).call(e,"turn:[")&&Vc(e).call(e,"transport=udp"))&&!n?(n=!0,!0):e&&!n)),delete e.url,e.urls=r?t[0]:t,!!t.length}})}(e.iceServers),s("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype}function O(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}function N(e){let t=c(e),n=e&&e.navigator;if(e=e&&e.MediaStreamTrack,n.getUserMedia=function(e,t,r){a("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(55<t.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var r;let t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},i=Pc(r=n.mediaDevices.getUserMedia).call(r,n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(wr(e)),t(e.audio,"autoGainControl","mozAutoGainControl"),t(e.audio,"noiseSuppression","mozNoiseSuppression")),i(e)},e&&e.prototype.getSettings){let n=e.prototype.getSettings;e.prototype.getSettings=function(){let e=n.apply(this,arguments);return t(e,"mozAutoGainControl","autoGainControl"),t(e,"mozNoiseSuppression","noiseSuppression"),e}}if(e&&e.prototype.applyConstraints){let n=e.prototype.applyConstraints;e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(wr(e)),t(e,"autoGainControl","mozAutoGainControl"),t(e,"noiseSuppression","mozNoiseSuppression")),n.apply(this,[e])}}}}function k(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&cs(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function D(e){let t=c(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){var n;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),53>t.version&&Qo(n=["setLocalDescription","setRemoteDescription","addIceCandidate"]).call(n,function(t){let n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}[t]});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?68>t.version&&arguments[0]&&""===arguments[0].candidate?ic.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),ic.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[e,n,r]=arguments;return o.apply(this,[e||null]).then(e=>{if(53>t.version&&!n)try{Qo(e).call(e,e=>{e.type=i[e.type]||e.type})}catch(r){if("TypeError"!==r.name)throw r;Qo(e).call(e,(t,n)=>{e.set(n,Zo({},t,{type:i[t.type]||t.type}))})}return e}).then(n,r)}}}function P(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let e=t.apply(this,[]);return Qo(e).call(e,e=>e._pc=this),e});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):ic.resolve(new Do)}}}function L(e){if("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let e=t.apply(this,[]);return Qo(e).call(e,e=>e._pc=this),e}),n(e,"track",e=>(e.receiver._pc=e.srcElement,e)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function x(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t;a("removeStream","removeTrack"),Qo(t=this.getSenders()).call(t,t=>{var n;t.track&&Vc(n=e.getTracks()).call(n,t.track)&&this.removeTrack(t)})})}function M(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function U(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n,r,i;this._localStreams||(this._localStreams=[]),Vc(n=this._localStreams).call(n,e)||this._localStreams.push(e),Qo(r=e.getAudioTracks()).call(r,n=>t.call(this,n,e)),Qo(i=e.getVideoTracks()).call(i,n=>t.call(this,n,e))},e.RTCPeerConnection.prototype.addTrack=function(e,n){var r;return n&&(this._localStreams?Vc(r=this._localStreams).call(r,n)||this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t,n,r;this._localStreams||(this._localStreams=[]);let i=vc(t=this._localStreams).call(t,e);if(-1!==i){dc(n=this._localStreams).call(n,i,1);var o=e.getTracks();Qo(r=this.getSenders()).call(r,e=>{Vc(o).call(o,e.track)&&this.removeTrack(e)})}})}}function V(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){cs(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{var t;Qo(t=e.streams).call(t,e=>{var t;this._remoteStreams||(this._remoteStreams=[]),Vc(t=this._remoteStreams).call(t,e)||(this._remoteStreams.push(e),(t=new Event("addstream")).stream=e,this.dispatchEvent(t))})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){var n;Qo(n=t.streams).call(n,t=>{var n;e._remoteStreams||(e._remoteStreams=[]),0<=vc(n=e._remoteStreams).call(n,t)||(e._remoteStreams.push(t),(n=new Event("addstream")).stream=t,e.dispatchEvent(n))})}),t.apply(e,arguments)}}}function F(e){if("object"==typeof e&&e.RTCPeerConnection){var t=(e=e.RTCPeerConnection.prototype).createOffer,n=e.createAnswer,r=e.setLocalDescription,i=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(e,n){let r=t.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return n?(r.then(e,n),ic.resolve()):r},e.createAnswer=function(e,t){let r=n.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return t?(r.then(e,t),ic.resolve()):r};var s=function(e,t,n){return e=r.apply(this,[e]),n?(e.then(t,n),ic.resolve()):e};e.setLocalDescription=s,e.setRemoteDescription=s=function(e,t,n){return e=i.apply(this,[e]),n?(e.then(t,n),ic.resolve()):e},e.addIceCandidate=s=function(e,t,n){return e=o.apply(this,[e]),n?(e.then(t,n),ic.resolve()):e}}}function B(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n;let r=Pc(n=(e=t.mediaDevices).getUserMedia).call(n,e);t.mediaDevices.getUserMedia=e=>r(j(e))}var r;!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=Pc(r=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}).call(r,t))}function j(e){return e&&void 0!==e.video?Zo({},e,{video:u(e.video)}):e}function G(e){let t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){let t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(a("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(wr(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&cs(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function q(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&cs(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function H(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){var n,r;void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);let t=Ac(n=this.getTransceivers()).call(n,e=>"audio"===e.receiver.track.kind);!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),n=Ac(r=this.getTransceivers()).call(r,e=>"video"===e.receiver.track.kind),!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}}function W(e){if(e.RTCIceCandidate&&(!e.RTCIceCandidate||!("foundation"in e.RTCIceCandidate.prototype))){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){var n;if("object"==typeof e&&e.candidate&&0===vc(n=e.candidate).call(n,"a=")&&((e=JSON.parse(wr(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){n=new t(e),e=nu.parseCandidate(e.candidate);let r=Zo(n,e);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,n(e,"icecandidate",t=>(t.candidate&&cs(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t))}}function z(e){if(e.RTCPeerConnection){var t=c(e);"sctp"in e.RTCPeerConnection.prototype||cs(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});var n=function(e){return!(!e||!e.sdp)&&((e=nu.splitSections(e.sdp)).shift(),jc(e).call(e,e=>{var t;return(e=nu.parseMLine(e))&&"application"===e.kind&&-1!==vc(t=e.protocol).call(t,"SCTP")}))},r=function(e){return null===(e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/))||2>e.length||(e=gs(e[1],10))!=e?-1:e},i=function(e){let n=65536;return"firefox"===t.browser&&(n=57>t.version?-1===e?16384:2147483637:60>t.version?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;return"firefox"===t.browser&&57===t.version&&(r=65535),0<(e=nu.matchPrefix(e.sdp,"a=max-message-size:")).length?r=gs(e[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&76<=t.version){var{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&cs(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var a=r(arguments[0]);let t;e=i(a),a=o(arguments[0],a),t=0===e&&0===a?Number.POSITIVE_INFINITY:0===e||0===a?Math.max(e,a):Math.min(e,a),cs(e={},"maxMessageSize",{get:()=>t}),this._sctp=e}return s.apply(this,arguments)}}}function K(e){function t(e,t){let n=e.send;e.send=function(){var r=arguments[0];if(r=r.length||r.size||r.byteLength,"open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let e=r.apply(this,arguments);return t(e,this),e},n(e,"datachannel",e=>(t(e.channel,e.target),e))}}function Y(e){var t;if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var n=e.RTCPeerConnection.prototype;cs(n,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),cs(n,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),Qo(t=["setLocalDescription","setRemoteDescription"]).call(t,e=>{let t=n[e];n[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{let t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;let n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})}}function Q(e){if(e.RTCPeerConnection){var t=c(e);if(!("chrome"===t.browser&&71<=t.version)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t,r;return e&&e.sdp&&-1!==vc(t=e.sdp).call(t,"\na=extmap-allow-mixed")&&(e.sdp=Bs(r=e.sdp.split("\n")).call(r,e=>"a=extmap-allow-mixed"!==tu(e).call(e)).join("\n")),n.apply(this,arguments)}}}}function J(e){return"string"==typeof e?Zo({},du[e]):e}function X(e){return"string"==typeof e?Zo({},pu[e]):e}function $(e){return"string"==typeof e?Zo({},fu[e]):e}function Z(e){return"string"==typeof e?Zo({},mu[e]):e}function ee(e,t){var n;Vc(n=ts(gu)).call(n,e)&&(gu[e]=t)}function te(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function ne(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function re(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function ie(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}function oe(e){return"[object Array]"===Nu.call(e)}function se(e){return null!==e&&"object"==typeof e}function ae(e){return"[object Function]"===Nu.call(e)}function ce(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),oe(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.call(null,e[n],n,e)}function ue(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function le(){this.handlers=[]}function he(e,t){!ku.isUndefined(e)&&ku.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}function de(e){this.defaults=e,this.interceptors={request:new Lu,response:new Lu}}function pe(e){this.message=e}function fe(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var n=this;e(function(e){n.reason||(n.reason=new Ku(e),t(n.reason))})}function me(e){e=new zu(e);var t=Ou(zu.prototype.request,e);return ku.extend(t,zu.prototype,e),ku.extend(t,e),t}function ge(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function _e(e,t){if("boolean"!=typeof e)throw new Zu(Cu.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function ve(e,t,n){var r;if(!Vc(n).call(n,e))throw new Zu(Cu.INVALID_PARAMS,Us(r="".concat(t," can only be set as ")).call(r,wr(n)))}function ye(e,t,n=1,r=1e4,i=!0){var o,s;if(e<n||e>r||i&&("number"!=typeof e||0!=e%1))throw new Zu(Cu.INVALID_PARAMS,Us(o=Us(s="invalid ".concat(t,": the value range is [")).call(s,n,", ")).call(o,r,"]. integer only"))}function Ee(e,t,n=1,r=255,i=!0){if(null==e)throw new Zu(Cu.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));var o,s,a;if(!we(e,n,r,i))throw new Zu(Cu.INVALID_PARAMS,Us(o=Us(s=Us(a="Invalid ".concat(t||"string param",": Length of the string: [")).call(a,n,",")).call(s,r,"].")).call(o,i?" ASCII characters only.":""))}function Se(e,t){if(!Au(e))throw new Zu(Cu.INVALID_PARAMS,"".concat(t," should be an array"))}function Te(e){if("string"!=typeof e||!/^[a-zA-Z0-9 !#\$%&\(\)\+\-:;<=\.>\?@\[\]\^_\{\}\|~,]{1,64}$/.test(e))throw $u.error("Invalid Channel Name ".concat(e)),new Zu(Cu.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function be(e){var t;if(!("number"==typeof e&&Math.floor(e)===e&&0<=e&&4294967295>=e||we(e,1,255)))throw $u.error(Us(t="Invalid UID ".concat(e," ")).call(t,typeof e)),new Zu(Cu.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")}function we(e,t=1,n=255,r=!0){if(t="string"==typeof e&&e.length<=n&&e.length>=t){if(!(r=!r))e:if("string"!=typeof e)r=!1;else{for(r=0;r<e.length;r+=1)if(0>(t=e.charCodeAt(r))||255<t){r=!1;break e}r=!0}t=r}return t}function Re(e){return Ee(e.reportId,"params.reportId",0,100,!1),Ee(e.category,"params.category",0,100,!1),Ee(e.event,"params.event",0,100,!1),Ee(e.label,"params.label",0,100,!1),ye(e.value,"params.value",-9007199254740991,9007199254740991,!1),!0}function Ie(e){return ye(e.timeout,"config.timeout",0,1e5),ye(e.timeoutFactor,"config.timeoutFactor",0,100,!1),ye(e.maxRetryCount,"config.maxRetryConfig",0,1/0),ye(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Ce(e){if(!Au(e)||1>e.length)return!1;try{Qo(e).call(e,e=>{if(!e.urls)throw Error()})}catch(t){return!1}return!0}function Ae(e){return Ee(e.turnServerURL,"turnServerURL"),Ee(e.username,"username"),Ee(e.password,"password"),e.udpport&&ye(e.udpport,"udpport",1,99999,!0),e.forceturn&&_e(e.forceturn,"forceturn"),e.security&&_e(e.security,"security"),e.tcpport&&ye(e.tcpport,"tcpport",1,99999,!0),!0}function Oe(e){return void 0!==e.level&&ve(e.level,"level",[1,2]),!0}function Ne(e,t){Ee(e.url,"".concat(t,".url"),1,1e3,!1),null==e.x||ye(e.x,"".concat(t,".x"),0,1e4),null==e.y||ye(e.y,"".concat(t,".y"),0,1e4),null==e.width||ye(e.width,"".concat(t,".width"),0,1e4),null==e.height||ye(e.height,"".concat(t,".height"),0,1e4),null==e.zOrder||ye(e.zOrder,"".concat(t,".zOrder"),0,255),null==e.alpha||ye(e.alpha,"".concat(t,".alpha"),0,1,!1)}function ke(e){if(!e.channelName)throw new Zu(Cu.INVALID_PARAMS,"invalid channelName in info");if(!e.uid||"number"!=typeof e.uid)throw new Zu(Cu.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&Ee(e.token,"info.token",1,2047),be(e.uid),Te(e.channelName),!0}function De(e){return ve(e,"mediaSource",["screen","window","application"]),!0}function Pe(e){var t,n,r,i;let o=(e=e||navigator.userAgent).match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===o[1]){var s=e.match(/(OPR(?=\/))\/?(\d+)/i);null!==s&&(o=s)}"Safari"===o[1]&&null!==(s=e.match(/version\/(\d+)/i))&&(o[2]=s[1]),-1!==vc(t=e.toLowerCase()).call(t,"qqbrowser")&&null!==(t=e.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(o=t),-1!==vc(n=e.toLowerCase()).call(n,"micromessenger")&&null!==(n=e.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(o=n),-1!==vc(r=e.toLowerCase()).call(r,"edge")&&null!==(r=e.match(/(edge(?=\/))\/?(\d+)/i))&&(o=r),-1!==vc(i=e.toLowerCase()).call(i,"trident")&&null!==(i=/\brv[ :]+(\d+)/g.exec(e)||[])&&(o=["","IE",i[1]]),i=null,r=[{s:Jc.WIN_10,r:/(Windows 10.0|Windows NT 10.0)/},{s:Jc.WIN_81,r:/(Windows 8.1|Windows NT 6.3)/},{s:Jc.WIN_8,r:/(Windows 8|Windows NT 6.2)/},{s:Jc.WIN_7,r:/(Windows 7|Windows NT 6.1)/},{s:Jc.WIN_VISTA,r:/Windows NT 6.0/},{s:Jc.WIN_SERVER_2003,r:/Windows NT 5.2/},{s:Jc.WIN_XP,r:/(Windows NT 5.1|Windows XP)/},{s:Jc.WIN_2000,r:/(Windows NT 5.0|Windows 2000)/},{s:Jc.ANDROID,r:/Android/},{s:Jc.OPEN_BSD,r:/OpenBSD/},{s:Jc.SUN_OS,r:/SunOS/},{s:Jc.LINUX,r:/(Linux|X11)/},{s:Jc.IOS,r:/(iPhone|iPad|iPod)/},{s:Jc.MAC_OS_X,r:/Mac OS X/},{s:Jc.MAC_OS,r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:Jc.QNX,r:/QNX/},{s:Jc.UNIX,r:/UNIX/},{s:Jc.BEOS,r:/BeOS/},{s:Jc.OS_2,r:/OS\/2/},{s:Jc.SEARCH_BOT,r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(let a in r)if((n=r[a]).r.test(e)){i=n.s;break}return{name:o[1],version:o[2],os:i}}function Le(){return Pe().name===Xc.CHROME}function xe(){return Pe().name===Xc.FIREFOX}function Me(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&35>=window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]}function Ue(){let e=Pe();return e.name!==Xc.EDGE&&e.name!==Xc.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ve(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=Ve(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=Ve(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function Be(e){if(!e.address||!e.tcp)throw new Zu(Cu.UNEXPECTED_RESPONSE,"Invalid address format ".concat(e));return e.address.match(/^[\.:\d]+$/)?"".concat(e.address.replace(/[^\d]/g,"-"),".edge.agora.io"):($u.info("Cannot recognized as IP address ".concat(e.address,". Used As Host instead")),Us(t="".concat(e.address,":")).call(t,e.tcp));var t}function je(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function Ge(e,t){let n=e.videoSend[0];return n?(t=t&&t.videoSend[0]?t.videoSend[0].inputFrame:void 0,e={id:Je(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()},n.inputFrame&&(t&&n.inputFrame.height===t.height||(e.A_fhi=n.inputFrame.height?n.inputFrame.height.toString():"0"),t&&n.inputFrame.width===t.width||(e.A_fwi=n.inputFrame.width?n.inputFrame.width.toString():"0"),t&&n.inputFrame.frameRate===t.frameRate||(e.A_fri=n.inputFrame.frameRate?n.inputFrame.frameRate.toString():"0")),e):null}function qe(e){return 0<=e&&.17>e?1:.17<=e&&.36>e?2:.36<=e&&.59>e?3:.59<=e&&1>=e?4:1<e?5:0}function He(e,t){let n={};return e.height&&e.width&&(t=t._videoHeight||t.getMediaStreamTrack(!0).getSettings().height,n.scaleResolutionDownBy=t?t/je(e.height):4),n.maxFramerate=e.framerate?je(e.framerate):void 0,n.maxBitrate=e.bitrate?1e3*e.bitrate:void 0,n}function We(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=We(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=We(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function Ke(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function Ye(e){return new ic(t=>{window.setTimeout(t,e)})}function Qe(e){let t=new Zu(Cu.TIMEOUT,"timeout");return new ic((n,r)=>{window.setTimeout(()=>r(t),e)})}function Je(e=7,t){var n,r;let i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?Us(n="".concat(t)).call(n,i):Us(r="".concat(t)).call(r,i)+Je(e-i.length,"")}function Xe(e){return new ic((t,n)=>{let r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: absolute; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r),r.addEventListener("playing",()=>{!r.videoWidth&&xe()||(document.body.removeChild(r),t([r.videoWidth,r.videoHeight]))}),r.srcObject=new MediaStream([e])})}function $e(e){return ic.all(ac(e).call(e,e=>e.then(e=>{throw e},e=>e))).then(e=>{throw e},e=>e)}function Ze(e,t,...n){return 0===e.getListeners(t).length?ic.reject(new Zu(Cu.UNEXPECTED_ERROR,"can not emit promise")):new ic((r,i)=>{e.emit(t,...n,r,i)})}function et(e,t,...n){return 0===e.getListeners(t).length?ic.resolve():Ze(e,t,...n)}function tt(e,t,...n){return 0===e.getListeners(t).length?null:nt(e,t,...n)}function nt(e,t,...n){let r=null,i=null;if(e.emit(t,...n,e=>{r=e},e=>{i=e}),null!==i)throw i;if(null===r)throw new Zu(Cu.UNEXPECTED_ERROR,"handler is not sync");return r}function rt(e,t){-1!==(t=vc(e).call(e,t))&&dc(e).call(e,t,1)}function it(e){let t=[];return Qo(e).call(e,e=>{-1===vc(t).call(t,e)&&t.push(e)}),t}function ot(e){ic.resolve().then(e)}function st(e,t){Jh[t]||(Jh[t]=!0,e())}function at(e){e=window.atob(e);let t=new Uint8Array(new ArrayBuffer(e.length));for(let n=0;n<e.length;n+=1)t[n]=e.charCodeAt(n);return t}function ct(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}function ut(e,t){return lt.apply(this,arguments)}function lt(){return(lt=r(function*(e,t){let n=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t;return e={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}},t.frameRate&&"number"!=typeof t.frameRate?(e.video.mandatory.maxFrameRate=t.frameRate.max,e.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(e.video.mandatory.maxFrameRate=t.frameRate),yield navigator.mediaDevices.getUserMedia(e)})).apply(this,arguments)}function ht(e){return dt.apply(this,arguments)}function dt(){return(dt=r(function*(e){let t=yield(n=yield pt(e.mediaSource),new ic((e,t)=>{const r=document.createElement("div");r.innerText="share screen",r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");const s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const a=document.createElement("div");a.setAttribute("style","text-align: right; padding: 16px 0;");const c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=()=>{document.body.removeChild(u);const e=Error("NotAllowedError");e.name="NotAllowedError",t(e)},a.appendChild(c),i.appendChild(o),i.appendChild(s),i.appendChild(a);const u=document.createElement("div");u.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),u.appendChild(r),u.appendChild(i),document.body.appendChild(u),ac(n).call(n,t=>{if(t.id){const n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=t.thumbnail;const{width:i}=r.getSize();1920<i&&(r=r.resize({width:1920})),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t.name.replace(/[\u00A0-\u9999<>&]/g,function(e){return"&#"+e.charCodeAt(0)+";"})+"</span>",n.onclick=()=>{document.body.removeChild(u),e(t.id)},s.appendChild(n)}})}));var n;return yield ut(t,e)})).apply(this,arguments)}function pt(e){return ft.apply(this,arguments)}function ft(){return(ft=r(function*(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);let n=mt();if(!n)throw new Zu(Cu.ELECTRON_IS_NULL);e=null;try{e=n.desktopCapturer.getSources({types:t})}catch(r){e=null}e&&e.then||(e=new ic((e,r)=>{n.desktopCapturer.getSources({types:t},(t,n)=>{t?r(t):e(n)})}));try{return yield e}catch(r){throw new Zu(Cu.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,r.toString())}})).apply(this,arguments)}function mt(){if(ed)return ed;try{return ed=window.require("electron"),ed}catch($c){return null}}function gt(e,t){return _t.apply(this,arguments)}function _t(){return(_t=r(function*(e,t){let n=0,r=null;for(;2>n;)try{r=yield vt(e,t,0<n);break}catch(s){var i,o;if(s instanceof Zu)throw $u.error(Us(o="[".concat(t,"] ")).call(o,s.toString())),s;let e=Et(s.name||s.code||s,s.message);if(e.code!==Cu.MEDIA_OPTION_INVALID)throw $u.error(Us(i="[".concat(t,"] ")).call(i,e.toString())),e;$u.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,yield Ye(500)}if(!r)throw new Zu(Cu.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r})).apply(this,arguments)}function vt(e,t,n){return yt.apply(this,arguments)}function yt(){return(yt=r(function*(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Zu(Cu.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));var r,i,o=Ql;if(n=new MediaStream,e.audioSource&&n.addTrack(e.audioSource),e.videoSource&&n.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return $u.debug("Using Video Source/ Audio Source"),n;if(e.screen)if(mt())St(n,e.screen.sourceId?yield ut(e.screen.sourceId,e.screen):yield ht(e.screen));else if(Le()&&e.screen.extensionId&&e.screen.mandatory){if(!o.getStreamFromExtension)throw new Zu(Cu.NOT_SUPPORTED,"This browser does not support screen sharing");$u.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));var s=yield(r=e.screen.extensionId,i=t,new ic((e,t)=>{try{chrome.runtime.sendMessage(r,{getStream:!0},n=>{if(!n||!n.streamId)return $u.error("[".concat(i,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new Zu(Cu.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)})}catch(o){var n;$u.error(Us(n="[".concat(i,"] AgoraRTC screensharing plugin is not accessible(")).call(n,r,")"),o.toString()),t(new Zu(Cu.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=s,St(n,yield navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(o.getDisplayMedia)e.screen.mediaSource&&De(e.screen.mediaSource),s={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},$u.debug("[".concat(t,"] getDisplayMedia:"),wr({video:s,audio:!!e.screenAudio})),St(n,yield navigator.mediaDevices.getDisplayMedia({video:s,audio:!!e.screenAudio}));else{if(!xe())throw $u.error("[".concat(t,"] This browser does not support screenSharing")),new Zu(Cu.NOT_SUPPORTED,"This browser does not support screen sharing");e.screen.mediaSource&&De(e.screen.mediaSource),o={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}},$u.debug(Us(s="[".concat(t,"] getUserMedia: ")).call(s,wr(o))),St(n,yield navigator.mediaDevices.getUserMedia(o))}if(!e.video&&!e.audio)return n;let a;e={video:e.video,audio:e.audio},$u.debug("[".concat(t,"] GetUserMedia"),wr(e)),s=null,(t=Pe()).name!==Xc.SAFARI&&t.os!==Jc.IOS||(s=yield rd.lock());try{a=yield navigator.mediaDevices.getUserMedia(e)}catch(c){throw s&&s(),c}return e.audio&&(id=!0),e.video&&(od=!0),St(n,a),s&&s(),n})).apply(this,arguments)}function Et(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":var n;return new Zu(Cu.MEDIA_OPTION_INVALID,Us(n="".concat(e,": ")).call(n,t));case"NotFoundError":case"DevicesNotFoundError":var r;return new Zu(Cu.DEVICE_NOT_FOUND,Us(r="".concat(e,": ")).call(r,t));case"NotSupportedError":var i;return new Zu(Cu.NOT_SUPPORTED,Us(i="".concat(e,": ")).call(i,t));case"NotReadableError":var o;return new Zu(Cu.NOT_READABLE,Us(o="".concat(e,": ")).call(o,t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":var s;return new Zu(Cu.PERMISSION_DENIED,Us(s="".concat(e,": ")).call(s,t));case"ConstraintNotSatisfiedError":var a;return new Zu(Cu.CONSTRAINT_NOT_SATISFIED,Us(a="".concat(e,": ")).call(a,t));default:var c;return $u.error("getUserMedia unexpected error",e),new Zu(Cu.UNEXPECTED_ERROR,Us(c="".concat(e,": ")).call(c,t))}}function St(e,t){let n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0];(t=t.getAudioTracks()[0])&&(r&&e.removeTrack(r),e.addTrack(t)),i&&(n&&e.removeTrack(n),e.addTrack(i))}function Tt(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function bt(e,t,n){return new ic((r,i)=>{t.timeout=t.timeout||gu.HTTP_CONNECT_TIMEOUT,t.responseType=t.responseType||"json",t.data&&!n?(t.data=wr(t.data),hd+=Ke(t.data)):n&&(hd+=t.data.size),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Qu.request(t).then(e=>{"string"==typeof e.data?dd+=Ke(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?dd+=e.data.byteLength:dd+=Ke(wr(e.data)),r(e.data)}).catch(e=>{Qu.isCancel(e)?i(new Zu(Cu.OPERATION_ABORTED,"cancel token canceled")):i("ECONNABORTED"===e.code?new Zu(Cu.NETWORK_TIMEOUT,e.message):e.response?new Zu(Cu.NETWORK_RESPONSE_ERROR,e.response.status):new Zu(Cu.NETWORK_ERROR,e.message))})})}function wt(e,t){return Rt.apply(this,arguments)}function Rt(){return(Rt=r(function*(e,t){let n=new Blob([t.data],{type:"buffer"});return yield bt(e,function(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=Tt(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=Tt(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}({},t,{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)})).apply(this,arguments)}function It(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function Ct(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=It(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=It(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function At(e={report:pd}){return function(t,n,r){let i=t[n];if("function"==typeof i){let o="AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name;r.value=function(...t){var r;let s=e.report.reportApiInvoke(this._sessionId||null,{name:Us(r="".concat(o,".")).call(r,n),options:t,tag:al.TRACER});try{let e=i.apply(this,t);return s.onSuccess(),e}catch(a){throw s.onError(a),a}}}return r}}function Ot(e){var t=fd[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};if(!(t=t[e%1e4])){if(Math.floor(e/1e4)===ll.ACCESS_POINT){if("1"===(e%=1e4).toString()[0])return{desc:e.toString(),retry:!1};if("2"===e.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return t}function Nt(e){return md[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function kt(e,t,n,i){let o=Zo({},gd,i),s=o.timeout,a=function(){var e=r(function*(){yield Ye(s),s*=o.timeoutFactor,s=Math.min(o.maxRetryTimeout,s)});return function(){return e.apply(this,arguments)}}(),c=!1;return(i=new ic(function(){var i=r(function*(r,i){t=t||(()=>!1),n=n||(()=>!0);for(let u=0;u<o.maxRetryCount;u+=1){if(c)return i(new Zu(Cu.OPERATION_ABORTED));try{const n=yield e();if(!t(n,u)||u+1===o.maxRetryCount)return r(n);yield a()}catch(s){if(!n(s,u)||u+1===o.maxRetryCount)return i(s);yield a()}}});return function(e,t){return i.apply(this,arguments)}}())).cancel=()=>c=!0,i}function Dt(){if(!bd&&(Td?($u.info("create audio context"),bd=new Td,bd.onstatechange=()=>{wd.emit("state-change")},function(e){function t(t){"running"===e.state?n(!1):"closed"!==e.state&&(n(!0),t?e.resume().then(r,r):n(!1))}function n(e){if(s!==e){s=e;for(let t=0,n=o;t<n.length;t+=1){let r=n[t];e?window.addEventListener(r,i,{capture:!0,passive:!0}):window.removeEventListener(r,i,{capture:!0,passive:!0})}}}function r(){t(!1)}function i(){t(!0)}let o="click contextmenu auxclick dblclick mousedown mouseup touchend keydown keyup".split(" "),s=!1;e.onstatechange=function(){t(!0)},t(!1)}(bd)):$u.error("your browser is not support web audio"),!bd))throw new Zu(Cu.NOT_SUPPORTED,"can not create audio context");return bd}function Pt(e){if(!function(){if(null!==Rd)return Rd;var e=Dt();let t=e.createBufferSource(),n=e.createGain();e=e.createGain(),t.connect(n),t.connect(e),t.disconnect(n),e=!1;try{t.disconnect(n)}catch(r){e=!0}return t.disconnect(),Rd=e,e}()){$u.debug("polyfill audio node");var t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>{var o;return e._inputNodes||(e._inputNodes=[]),Vc(o=e._inputNodes).call(o,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e},e.disconnect=(r,i,o)=>{n.call(e),r?rt(e._inputNodes,r):e._inputNodes=[];for(let n of e._inputNodes)t.call(e,n)}}}function Lt(e,t){let n=1/t,r=Dt(),i=r.createGain();i.gain.value=0,i.connect(r.destination);let o=!1,s=()=>{if(o)return void(i=null);const t=r.createOscillator();t.onended=s,t.connect(i),t.start(0),t.stop(r.currentTime+n),e(r.currentTime)};return s(),()=>{o=!0}}function xt(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=xt(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=xt(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function Ut(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function Vt(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=Ut(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=Ut(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function Ft(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function Bt(e,t,n,i,o){xd+=1;let s,a,c={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(qh()/1e3),seq:xd,requestId:xd,version:cu,cname:n.cname},u={service_name:t,json_body:wr(c)},l=e[0];return kt(r(function*(){s=qh();var e=yield bt(l,{data:u,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(a=qh()-s,0!==e.code){var n=new Zu(Cu.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:a});throw $u.error(n.toString()),n}if(200!==(e=JSON.parse(e.json_body)).code)throw e=new Zu(Cu.UNEXPECTED_RESPONSE,Us(n="live streaming app center error, code: ".concat(e.code,", reason: ")).call(n,e.reason),{code:e.code,responseTime:a}),$u.error(e.toString()),e;if(!e.servers||0===e.servers.length)throw n=new Zu(Cu.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:e.code,responseTime:a}),$u.error(n.toString()),n;return n=function(e,t){var n;return{addressList:ac(n=e.servers).call(n,e=>{var n,r;return Us(n=Us(r="wss://".concat(e.address.replace(/\./g,"-"),".edge.agora.io:")).call(r,e.wss,"?serviceName=")).call(n,encodeURIComponent(t))}),workerToken:e.workerToken,vid:e.vid}}(e,t),gu.LIVE_STREAMING_ADDRESS&&(n.addressList=gu.LIVE_STREAMING_ADDRESS instanceof Array?gu.LIVE_STREAMING_ADDRESS:[gu.LIVE_STREAMING_ADDRESS]),function(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=Ft(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=Ft(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}({},n,{responseTime:a})}),(r,i)=>(pd.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:wr(r.addressList),firstSuccess:0===i,responseTime:a,serverIp:e[i%e.length]}),!1),(r,i)=>(pd.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:a,serverIp:e[i%e.length]}),!!(r.code!==Cu.OPERATION_ABORTED&&r.code!==Cu.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(l=e[(i+1)%e.length],!0)),o)}function jt({url:e,areaCode:t},n,i,o){let s=qh(),a={opid:133,flag:4096,ts:qh(),key:n.token,cname:n.cname,sid:n.sid,detail:{6:n.stringUid,11:t},uid:n.uid||0};return n.multiIP&&n.multiIP.gateway_ip&&(a.detail[5]=wr({vocs_ip:[n.multiIP.uni_lbs_ip],vos_ip:[n.multiIP.gateway_ip]})),kt(r(function*(){let t=yield bt(e+"".concat(-1===vc(e).call(e,"?")?"?":"&","action=wrtc_gateway"),{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}});if(t.addresses&&0===t.addresses.length&&0===t.code)throw new Zu(Cu.VOID_GATEWAY_ADDRESS,"",{retry:!0,csIp:t.detail&&t.detail[502]});if(gu.GATEWAY_ADDRESS&&0<gu.GATEWAY_ADDRESS.length){var n;console.log(gu.GATEWAY_ADDRESS);let e=ac(n=gu.GATEWAY_ADDRESS).call(n,(e,n)=>({ip:e.ip,port:e.port,ticket:t.addresses[0]&&t.addresses[0].ticket}));t.addresses=e}return function(e,t){var n;let r=[".agora.io",".sd-rtn.com"],i=r[1]&&-1!==vc(t).call(t,r[1])?1:0;return e.addresses=e.addresses||[],{gatewayAddrs:ac(n=e.addresses).call(n,e=>{var t,n,o;return e.ip.match(/^[\.:\d]+$/)?Us(t=Us(n="".concat(e.ip.replace(/[^\d]/g,"-"),".edge")).call(n,r[i++%r.length],":")).call(t,e.port):($u.info("Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),Us(o="".concat(e.ip,":")).call(o,e.port))}),uid:e.uid,cid:e.cid,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}(t,e)}),t=>{if(0===t.res.code)return pd.joinChooseServer(n.sid,{lts:s,succ:!0,csAddr:e,serverList:t.gatewayAddrs,ec:null,cid:t.res.cid.toString(),uid:t.res.uid.toString(),csIp:t.csIp}),!1;let r=Ot(t.res.code);throw new Zu(Cu.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{retry:r.retry,csIp:t.csIp})},t=>{return t.code!==Cu.OPERATION_ABORTED&&(t.code===Cu.CAN_NOT_GET_GATEWAY_SERVER||t.code===Cu.VOID_GATEWAY_ADDRESS?(pd.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:e,serverList:null,ec:t.message,csIp:t.data&&t.data.csIp}),$u.warning(Us(r=Us(i=Us(o="[".concat(n.clientId,"] Choose server ")).call(o,e," failed, message: ")).call(i,t.message,", retry: ")).call(r,t.data.retry)),t.data.retry):(pd.joinChooseServer(n.sid,{lts:s,succ:!1,csAddr:e,serverList:null,ec:t.code,csIp:t.data&&t.data.csIp}),$u.warning("[".concat(n.clientId,"] Choose server network error, retry"),t),!0));var r,i,o},o)}function Gt(e,t,n){return qt.apply(this,arguments)}function qt(){return(qt=r(function*(e,t,n){return{gatewayInfo:yield(i=r(function*(e,t,n){var i,o;const s=ac(i=wc(o=gu.WEBCS_DOMAIN).call(o,0,gu.AJAX_REQUEST_CONCURRENT)).call(i,t=>{var n;return{url:e.proxyServer?Us(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1"):"https://".concat(t,"/api/v1"),areaCode:Ud()}});let a=null;return a=yield $e([r(function*(){return yield Zh({fragementLength:gu.FRAGEMENT_LENGTH,referenceList:s,asyncMapHandler:r=>($u.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),jt(r,e,t,n)),allFailedhandler:e=>{throw e[0]}})})(),r(function*(){var r;if(yield Ye(1e3),null!==a)return a;const i=ac(r=gu.WEBCS_DOMAIN_BACKUP_LIST).call(r,t=>{var n;return{url:e.proxyServer?Us(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1"):"https://".concat(t,"/api/v1"),areaCode:Ud()}});return yield Zh({fragementLength:gu.FRAGEMENT_LENGTH,referenceList:i,asyncMapHandler:r=>($u.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),jt(r,e,t,n)),allFailedhandler:e=>{throw e[0]}})})()]),a}),function(e,t,n){return i.apply(this,arguments)})(e,t,n)};var i})).apply(this,arguments)}function Ht(){return(Ht=r(function*(e,t,n){var i,o,s,a;if("disabled"!==e.cloudProxyServer){var c=yield(a=r(function*(e,t,n){var i,o=qh(),s=ac(i=gu.PROXY_CS).call(i,t=>{var n;return e.proxyServer?Us(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1"):"https://".concat(t,"/api/v1")});if("proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer||"proxy5"===e.cloudProxyServer){o=ac(s).call(s,e=>({url:e,areaCode:Ud()}));var a=null;if(a=yield Zh({fragementLength:gu.FRAGEMENT_LENGTH,referenceList:o,asyncMapHandler:i=>function({url:e,areaCode:t},n,i,o){const s=qh(),a={opid:133,flag:"proxy5"===n.cloudProxyServer?4194304:1048576,ts:+new Date,key:n.token,cname:n.cname,sid:n.sid,detail:{6:n.stringUid,11:t},uid:n.uid||0};return kt(r(function*(){return yield bt(e,{data:a,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":69}})}),t=>{var r;if(0===t.code)return pd.joinWebProxyAP(n.sid,{lts:s,sucess:1,apServerAddr:e,turnServerAddrList:ac(r=t.addresses).call(r,e=>e.ip).join(","),errorCode:null,eventType:n.cloudProxyServer}),!1;throw t=Ot(t.code),new Zu(Cu.CAN_NOT_GET_GATEWAY_SERVER,t.desc,{retry:t.retry})},t=>{return t.code!==Cu.OPERATION_ABORTED&&(t.code===Cu.CAN_NOT_GET_GATEWAY_SERVER||t.code===Cu.VOID_GATEWAY_ADDRESS?(pd.joinWebProxyAP(a.sid,{lts:s,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:t.code,eventType:n.cloudProxyServer}),$u.warning(Us(r=Us(i=Us(o="[".concat(n.clientId,"] proxy ap server ")).call(o,e," failed, message: ")).call(i,t.message,", retry: ")).call(r,t.data.retry)),t.data.retry):(pd.joinWebProxyAP(a.sid,{lts:s,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:t.code,eventType:n.cloudProxyServer}),!0));var r,i,o},o)}(i,e,t,n),allFailedhandler:()=>{throw $u.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new Zu(Cu.CAN_NOT_GET_PROXY_SERVER)}}),!(o=a.addresses)||0===o.length)throw $u.error("[".concat(e.clientId,"] can not get proxy server, empty proxy server list")),new Zu(Cu.CAN_NOT_GET_PROXY_SERVER,"empty proxy server list");return{addresses:ac(o).call(o,e=>e.ip),serverResponse:{tcpport:o[0].port||443,udpport:o[0].port||hu.udpport,username:hu.username,password:hu.password}}}if(i=null,i=yield Zh({fragementLength:gu.FRAGEMENT_LENGTH,referenceList:s,asyncMapHandler:i=>function(e,t,n,i){const o=qh(),s={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,uid:t.uid,cname:t.cname,ts:Math.floor(qh()/1e3),version:cu,seq:0,requestId:1};return kt(r(function*(){return{res:yield bt(e,{data:{service_name:"webrtc_proxy",json_body:wr(s)},cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}}),url:e}}),e=>{if(!e.res.json_body)throw $u.debug("[".concat(t.clientId,"] Get proxy server failed: no json_body")),new Zu(Cu.UNEXPECTED_RESPONSE,wr(e.res));const n=JSON.parse(e.res.json_body);var r,i;if(200!==n.code)throw $u.debug(Us(r=Us(i="[".concat(t.clientId,"] Get proxy server failed: response code [")).call(i,n.code,"], reason [")).call(r,n.reason,"]")),new Zu(Cu.UNEXPECTED_RESPONSE,wr(e.res));return $u.debug("[".concat(t.clientId,"] App return server length"),n.servers.length),!1},t=>t.code!==Cu.OPERATION_ABORTED&&(pd.requestProxyAppCenter(s.sid,{lts:o,succ:!1,APAddr:e,workerManagerList:null,ec:t.code,response:t.message}),!0),i)}(i,e,t,n),allFailedhandler:()=>{throw $u.error("[".concat(e.clientId,"] can not get proxy server after trying several times")),new Zu(Cu.CAN_NOT_GET_PROXY_SERVER)}}),s=JSON.parse(i.res.json_body),s=ac(a=s.servers).call(a,Be),"443only"===e.cloudProxyServer)return{addresses:s,serverResponse:{tcpport:443,udpport:hu.udpport,username:hu.username,password:hu.password}};pd.requestProxyAppCenter(e.sid,{lts:o,succ:!0,APAddr:i.url,workerManagerList:wr(s),ec:null,response:wr(i.res)}),o=qh(),a=ac(s).call(s,i=>function(e,t,n,i){const o=qh();let s=e;Qc(e).call(e,"http")||(s="https://".concat(e,":4000/v2/machine"));const a={command:"request",gatewayType:"http",appId:t.appId,cname:t.cname,uid:(t.uid||"").toString(),sdkVersion:"2.3.1",sid:t.sid,seq:1,ts:qh(),requestId:3,clientRequest:{appId:t.appId,cname:t.cname,uid:(t.uid||"").toString(),sid:t.sid}};return kt(r(function*(){return{res:yield bt(s,{data:a,cancelToken:n}),url:e}}),e=>{if(!e.res.serverResponse)throw new Zu(Cu.UNEXPECTED_RESPONSE,"requeet worker manager server failed: serverResponse is undefined");return!1},t=>t.code!==Cu.OPERATION_ABORTED&&(pd.requestProxyWorkerManager(a.sid,{lts:o,succ:!1,workerManagerAddr:e,ec:t.code,response:t.message}),!0),i)}(i,e,t,n)),i=null;try{i=yield $e(a)}catch(c){throw $u.error("[".concat(e.clientId,"] can not get worker manager after trying several times")),new Zu(Cu.CAN_NOT_GET_PROXY_SERVER)}return Qo(a).call(a,e=>e.cancel()),pd.requestProxyWorkerManager(e.sid,{lts:o,succ:!0,workerManagerAddr:i.url,ec:null,response:wr(i.res)}),{addresses:[i.url],serverResponse:i.res.serverResponse}}),function(e,t,n){return a.apply(this,arguments)})(e,t,n);"443only"===e.cloudProxyServer?e.proxyServer=gu.PROXY_SERVER_TYPE2:"proxy3"!==e.cloudProxyServer&&"proxy4"!==e.cloudProxyServer&&"proxy5"!==e.cloudProxyServer||(e.proxyServer=gu.PROXY_SERVER_TYPE3),pd.setProxyServer(e.proxyServer),$u.setProxyServer(e.proxyServer),"normal"===e.cloudProxyServer&&(e.proxyServer=c.addresses[0],pd.setProxyServer(e.proxyServer),$u.setProxyServer(e.proxyServer)),e.turnServer={mode:"manual",servers:ac(i=c.addresses).call(i,t=>({turnServerURL:t,tcpport:"proxy3"===e.cloudProxyServer?void 0:c.serverResponse.tcpport?c.serverResponse.tcpport:hu.tcpport,udpport:"proxy4"===e.cloudProxyServer?void 0:c.serverResponse.udpport?c.serverResponse.udpport:hu.udpport,username:c.serverResponse.username||hu.username,password:c.serverResponse.password||hu.password,forceturn:"proxy4"!==e.cloudProxyServer&&"proxy5"!==e.cloudProxyServer,security:"proxy5"===e.cloudProxyServer}))},$u.debug(Us(o=Us(s="[".concat(e.clientId,"] set proxy server: ")).call(s,e.proxyServer,", mode: ")).call(o,e.cloudProxyServer))}})).apply(this,arguments)}function Wt(e,t,n,r){return zt.apply(this,arguments)}function zt(){return(zt=r(function*(e,t,n,i){var o;let s=wc(o=gu.ACCOUNT_REGISTER).call(o,0,gu.AJAX_REQUEST_CONCURRENT);return o=[],o=t.proxyServer?ac(s).call(s,e=>{var n;return Us(n="https://".concat(t.proxyServer,"/ap/?url=")).call(n,e+"/api/v1")}):ac(s).call(s,e=>"https://".concat(e,"/api/v1")),(yield(a=r(function*(e,t,n,r,i){let o=qh(),s={sid:n.sid,opid:10,appid:n.appId,string_uid:t},a=e[0];if(0!==(n=yield kt(()=>bt(a+"".concat(-1===vc(a).call(a,"?")?"?":"&","action=stringuid"),{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(n,r)=>{if(0===n.code){var i;if(0>=n.uid||n.uid>=Math.pow(2,32))throw $u.error(Us(i="Invalid Uint Uid ".concat(t," => ")).call(i,n.uid),n),pd.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:Cu.INVALID_UINT_UID_FROM_STRING_UID,extend:s}),new Zu(Cu.INVALID_UINT_UID_FROM_STRING_UID);return pd.reqUserAccount(s.sid,{lts:o,success:!0,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:null,extend:s}),!1}return(i=Ot(n.code)).retry&&(a=e[(r+1)%e.length]),pd.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:i.desc,extend:s}),i.retry},(t,n)=>t.code!==Cu.OPERATION_ABORTED&&(pd.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:null,errorCode:t.code,extend:s}),a=e[(n+1)%e.length],!0),i)).code)throw n=Ot(n.code),new Zu(Cu.UNEXPECTED_RESPONSE,n.desc);return n}),function(e,t,n,r,i){return a.apply(this,arguments)})(o,e,t,n,i)).uid;var a})).apply(this,arguments)}function Kt(){return(Kt=r(function*(e,t,n){var r,i,o=ac(r=wc(i=gu.CDS_AP).call(i,0,gu.AJAX_REQUEST_CONCURRENT)).call(r,t=>{var n;return e.proxyServer?Us(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1"):"https://".concat(t,"/api/v1?action=config")});r=ac(o).call(o,r=>function(e,t,n,r){const i=Pe(),o={flag:64,cipher_method:0,features:{device:i.name,system:i.os,vendor:t.appId,version:cu,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return kt(()=>bt(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,e=>e.code!==Cu.OPERATION_ABORTED,r)}(r,e,t,n)),o=i=null;let s={};try{i=yield $e(r)}catch(a){if(a.code===Cu.OPERATION_ABORTED)throw a;o=a}if(Qo(r).call(r,e=>e.cancel()),pd.reportApiInvoke(e.sid,{name:sl.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:i}}).onSuccess(),i&&i.test_tags)try{s=function(e){if(!e.test_tags)return{};let t=e.test_tags;e=ts(t);let n={};return Qo(e).call(e,e=>{var r;let i=tu(r=wc(e).call(e,4)).call(r);e=JSON.parse(t[e])[1],n[i]=e}),n}(i)}catch(a){}return s})).apply(this,arguments)}function Yt(e,t,n,r){return Qt.apply(this,arguments)}function Qt(){return(Qt=r(function*(e,t,n,r){var i,o;let s=ac(i=wc(o=gu.UAP_AP).call(o,0,gu.AJAX_REQUEST_CONCURRENT)).call(i,e=>{var n;return t.proxyServer?Us(n="https://".concat(t.proxyServer,"/ap/?url=")).call(n,e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")});return yield Bt(s,e,t,n,r)})).apply(this,arguments)}function Jt(){return(Jt=r(function*(e,t,n){var i,o;let s=ac(i=wc(o=gu.UAP_AP).call(o,0,gu.AJAX_REQUEST_CONCURRENT)).call(i,t=>{var n;return e.proxyServer?Us(n="https://".concat(e.proxyServer,"/ap/?url=")).call(n,t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")});i=ac(s).call(s,i=>function(e,t,n,i){t={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:qh(),version:cu,cname:t.cname,uid:t.uid.toString(),requestId:Md,seq:Md},Md+=1;const o={service_name:"tele_channel",json_body:wr(t)};return kt(r(function*(){var t=yield bt(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){var r=new Zu(Cu.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw $u.error(r.toString()),r}if(200!==(t=JSON.parse(t.json_body)).code){var i=new Zu(Cu.UNEXPECTED_RESPONSE,Us(r="cross channel app center error, code: ".concat(t.code,", reason: ")).call(r,t.reason));throw $u.error(i.toString()),i}if(!t.servers||0===t.servers.length)throw r=new Zu(Cu.UNEXPECTED_RESPONSE,"cross channel app center empty server"),$u.error(r.toString()),r;return{vid:t.vid,workerToken:t.workerToken,addressList:ac(i=t.servers).call(i,e=>{var t;return Us(t="wss://".concat(e.address.replace(/\./g,"-"),".edge.agora.io:")).call(t,e.wss)})}}),void 0,e=>!!(e.code!==Cu.OPERATION_ABORTED&&e.code!==Cu.UNEXPECTED_RESPONSE||e.data&&e.data.retry),i)}(i,e,t,n));try{let e=yield $e(i);return Qo(i).call(i,e=>e.cancel()),e}catch(a){throw a[0]}})).apply(this,arguments)}function Xt(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function $t(e){if(Array.isArray(e))return e.map(function(e){return e});if(!Zt(e))return e;var t,n={};for(t in e)n[t]=Zt(e[t])||Array.isArray(e[t])?$t(e[t]):e[t];return n}function Zt(e){return!("object"!=typeof e||Array.isArray(e)||!e)}function en(e,t){function n(){this.constructor=e}Hd(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function tn(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})}function nn(e,t){function n(n){return function(s){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(!((o=0<(o=a.trys).length&&o[o.length-1])||6!==n[0]&&2!==n[0])){a=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3]))a.label=n[1];else if(6===n[0]&&a.label<o[1])a.label=o[1],o=n;else{if(!(o&&a.label<o[2])){o[2]&&a.ops.pop(),a.trys.pop();continue}a.label=o[2],a.ops.push(n)}}n=t.call(e,a)}catch(s){n=[6,s],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}var r,i,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s}function rn(e,t,n){return(n=e.createShader(n))?(e.shaderSource(n,t),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(t=e.getShaderInfoLog(n),e.deleteShader(n),new Zu(Cu.WEBGL_INTERNAL_ERROR,"error compiling shader:"+t).throw())):new Zu(Cu.WEBGL_INTERNAL_ERROR,"can not create shader").throw()}function on(e){var t=new Uint8Array([99,114,121,112,116,105,105]),n=t.length;let r=e.length,i=new Uint8Array(r),o=new Uint8Array(256);for(var s=0;256>s;s++)o[s]=s;s=0;for(var a=0;256>a;a++)s=(s+o[a]+t[a%n])%256,[o[a],o[s]]=[o[s],o[a]];for(s=n=0,a=0;a<0+r;a++)s=(s+o[n=(n+1)%256])%256,[o[n],o[s]]=[o[s],o[n]],t=o[(o[n]+o[s])%256],0<=a&&(i[a-0]=e[a-0]^t);return e=String.fromCharCode.apply(null,Gh(i)),Function("var winSize = 5; return `"+e+"`")()}function sn(e){let t={};return e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId}),e.encoderConfig?(e=J(e.encoderConfig),t.width=e.width,t.height=e.height,!Me()&&e.frameRate&&(t.frameRate=e.frameRate),Pe().name===Xc.EDGE&&"object"==typeof t.frameRate&&(t.frameRate.max=60),xe()&&(t.frameRate={ideal:30,max:30}),t):t}function an(e){let t={};if(Me()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC,Le()&&(t.googAutoGainControl=e.AGC,t.googAutoGainControl2=e.AGC)),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,Le()&&(t.googNoiseSuppression=e.ANS))),e.encoderConfig){let n=Z(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Le()&&2===t.channelCount&&(t.googAutoGainControl=!1,t.googAutoGainControl2=!1,t.echoCancellation=!1,t.googNoiseSuppression=!1),t}function cn(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=cn(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=cn(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function ln(e){let t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1X/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ opus/i)&&t.audio.push("OPUS"),t}function hn(e,t){var n=e.match(/a=rtpmap:(\d+) opus/);if(!n||!n[0]||!n[1])return e;var r,i=n[1];return(n=e.match("a=fmtp:".concat(i,".*\r\n")))&&n[0]?(i="a=fmtp:".concat(i," minptime=10;useinbandfec=1;"),t.bitrate&&(i+="maxaveragebitrate=".concat(Math.floor(1e3*t.bitrate),";")),t.sampleRate&&(i+=Us(r="maxplaybackrate=".concat(t.sampleRate,";sprop-maxcapturerate=")).call(r,t.sampleRate,";")),t.stereo&&(i+="stereo=1;sprop-stereo-1;"),e.replace(n[0],i+="\r\n")):e}function dn(e){return e.replace("minptime=10","minptime=10;stereo=1; sprop-stereo=1")}function pn(e,t,n){var r=!1;switch(t){case"h264":case"vp8":return e;case"vp9":case"av1":r=!0}if(r){var i;let y,E,S=Pc(i=RegExp.prototype.test).call(i,/^([a-z])=(.*)/),T=e.split("m="),b=null,w=null,R=null,I=[];var o;i=[],t=[];let C=r=null;var s;let A=[],O=[];for(var a=0;a<T.length;++a)if(b=T[a].match(/a=msid-semantic:/),b){b=T[a];break}for(a=0;a<T.length;++a)if(w=T[a].match(/audio /),w){y=a,w="m="+T[a];break}for(a=0;a<T.length;++a)if(R=T[a].match(/video /),R){E=a,R="m="+T[a];break}if(b&&(I=Bs(o=b.split(/(\r\n|\r|\n)/)).call(o,S)),0<I.length&&(t=Us(t).call(t,I)),w&&(i=Bs(s=w.split(/(\r\n|\r|\n)/)).call(s,S)),!R)return e;var c;for(o=Bs(c=R.split(/(\r\n|\r|\n)/)).call(c,S),c=0;c<o.length;++c)if(null===r&&null!==(r=o[c].match(/cname:/))){r="cname:"+o[c].split("cname:")[1];break}for(s=0;s<o.length;++s)if(null===C&&(C=o[s].match(/a=msid:/),null!==C&&(C="msid:"+o[s].split(":")[1])),o[s].match(/a=ssrc-group:FID/)){c=o[s].split(" "),A.push(Number(c[1])),c[2]&&O.push(Number(c[2])),o.length=s;break}for(c=1;c<n.numSpatialLayers;++c)A.push(A[0]+c),0<O.length&&O.push(O[0]+c);for(c="a=ssrc-group:SIM ",s=0;s<A.length;++s)c=Us(c).call(c,String(A[s])),s<A.length-1&&(c=Us(c).call(c," "));for(o.push(c),c=0;c<n.numSpatialLayers;++c){var u,l;s=Us(u=Us(l=Us("a=ssrc-group:FID ").call("a=ssrc-group:FID ",String(A[c]))).call(l," ")).call(u,String(O[c])),o.push(s)}for(u=0;u<n.numSpatialLayers;++u){var h,d,p,f;if(null===r||null===C)return e;l=Us(h=Us(d="a=ssrc:".concat(String(A[u]))).call(d," ")).call(h,r),c=Us(p=Us(f="a=ssrc:".concat(String(A[u]))).call(f," ")).call(p,C),o.push(l),o.push(c)}for(h=0;h<n.numSpatialLayers;++h){var m,g,_,v;if(null===r||null===C)return e;d=Us(m=Us(g="a=ssrc:".concat(String(O[h]))).call(g," ")).call(m,r),p=Us(_=Us(v="a=ssrc:".concat(String(O[h]))).call(v," ")).call(_,C),o.push(d),o.push(p)}y&&E&&y>E?(t=Us(t).call(t,o),t=Us(t).call(t,i)):(t=Us(t).call(t,i),t=Us(t).call(t,o)),e=t.join("\r\n")+"\r\n"}return e}function fn(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=je(t.width),r.height=je(t.height),t=je(t.framerate||15),document.body.append(n),document.body.append(r);let i=e._mediaStreamTrack;n.srcObject=new MediaStream([i]),n.play();let o=r.getContext("2d");if(!o)throw new Zu(Cu.UNEXPECTED_ERROR,"can not get canvas context");let s=r.captureStream(Ql.supportRequestFrame?0:t).getVideoTracks()[0],a=Lt(()=>{if(n.paused&&n.play(),2<n.videoHeight&&2<n.videoWidth){const e=n.videoHeight/n.videoWidth*r.width;var t,a,c;2<=Math.abs(e-r.height)&&($u.debug("adjust low stream resolution",Us(t=Us(a=Us(c="".concat(r.width,"x")).call(c,r.height," -> ")).call(a,r.width,"x")).call(t,e)),r.height=e)}o.drawImage(n,0,0,r.width,r.height),s.requestFrame&&s.requestFrame(),i!==e._mediaStreamTrack&&(i=e._mediaStreamTrack,n.srcObject=new MediaStream([i]))},t),c=s.stop;return s.stop=()=>{c.call(s),a(),n.remove(),r.width=0,r.remove(),n=r=null,$u.debug("clean low stream renderer")},s}function mn(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function gn(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=mn(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=mn(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function _n(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function vn(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=_n(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=_n(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function yn(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function En(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=yn(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=yn(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function Sn(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function Tn(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=Sn(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=Sn(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function bn(e){if(!(e instanceof Gp))return new Zu(Cu.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo();return e=e.getDestChannelMediaInfo(),t?0===e.size?new Zu(Cu.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new Zu(Cu.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}function wn(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function Rn(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=wn(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=wn(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function In(){return(In=r(function*(e,t){var n=null;if("string"==typeof e){let t=Xp.get(e);if(t)return $u.debug("use cached audio resource: ",e),t;try{n=(yield kt(()=>Qu.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(r){throw new Zu(Cu.FETCH_AUDIO_FILE_FAILED,r.toString())}}else n=yield new ic((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new Zu(Cu.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new Zu(Cu.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)});return n=yield function(e){const t=Dt();return new ic((n,r)=>{t.decodeAudioData(e,e=>{n(e)},e=>{r(new Zu(Cu.DECODE_AUDIO_FILE_FAILED,e.toString()))})})}(n),"string"==typeof e&&t&&Xp.set(e,n),n})).apply(this,arguments)}function Cn(e,t){var n=ts(e);if(xh){var r=xh(e);t&&(r=Bs(r).call(r,function(t){return bs(e,t).enumerable})),n.push.apply(n,r)}return n}function An(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=Cn(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=Cn(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}function On(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=An({},r,{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?$u.debug("[".concat(e,"] set content hint to"),n.optimizationMode):$u.debug("[".concat(e,"] set content hint failed")))):$u.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Nn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},kn=function(e){return e&&e.Math==Math&&e},Dn=kn("object"==typeof globalThis&&globalThis)||kn("object"==typeof window&&window)||kn("object"==typeof self&&self)||kn("object"==typeof Nn&&Nn)||Function("return this")(),Pn=function(e){try{return!!e()}catch(t){return!0}},Ln=!Pn(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),xn={}.propertyIsEnumerable,Mn=Object.getOwnPropertyDescriptor,Un=Mn&&!xn.call({1:2},1)?function(e){return!!(e=Mn(this,e))&&e.enumerable}:xn,Vn=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Fn={}.toString,Bn=function(e){return Fn.call(e).slice(8,-1)},jn="".split,Gn=Pn(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return"String"==Bn(e)?jn.call(e,""):Object(e)}:Object,qn=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},Hn=function(e){return Gn(qn(e))},Wn=function(e){return"object"==typeof e?null!==e:"function"==typeof e},zn=function(e,t){if(!Wn(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!Wn(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!Wn(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!Wn(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Kn={}.hasOwnProperty,Yn=function(e,t){return Kn.call(e,t)},Qn=Dn.document,Jn=Wn(Qn)&&Wn(Qn.createElement),Xn=!Ln&&!Pn(function(){return 7!=Object.defineProperty(Jn?Qn.createElement("div"):{},"a",{get:function(){return 7}}).a}),$n=Object.getOwnPropertyDescriptor,Zn=Ln?$n:function(e,t){if(e=Hn(e),t=zn(t,!0),Xn)try{return $n(e,t)}catch(Pu){}if(Yn(e,t))return Vn(!Un.call(e,t),e[t])},er=/#|\.prototype\./,tr=function(e,t){return(e=rr[nr(e)])==or||e!=ir&&("function"==typeof t?Pn(t):!!t)},nr=tr.normalize=function(e){return String(e).replace(er,".").toLowerCase()},rr=tr.data={},ir=tr.NATIVE="N",or=tr.POLYFILL="P",sr={},ar=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},cr=function(e,t,n){if(ar(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},ur=function(e){if(!Wn(e))throw TypeError(String(e)+" is not an object");return e},lr=Object.defineProperty,hr={f:Ln?lr:function(e,t,n){if(ur(e),t=zn(t,!0),ur(n),Xn)try{return lr(e,t,n)}catch(r){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},dr=Ln?function(e,t,n){return hr.f(e,t,Vn(1,n))}:function(e,t,n){return e[t]=n,e},pr=Zn,fr=function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t},mr=function(e,t){var n,r,i,o,s,a=e.target,c=e.global,u=e.stat,l=e.proto,h=c?Dn:u?Dn[a]:(Dn[a]||{}).prototype,d=c?sr:sr[a]||(sr[a]={}),p=d.prototype;for(r in t){var f=!tr(c?r:a+(u?".":"#")+r,e.forced)&&h&&Yn(h,r),m=d[r];f&&(i=e.noTargetGet?(s=pr(h,r))&&s.value:h[r]);var g=f&&i?i:t[r];f&&typeof m==typeof g||(o=e.bind&&f?cr(g,Dn):e.wrap&&f?fr(g):l&&"function"==typeof g?cr(Function.call,g):g,(e.sham||g&&g.sham||m&&m.sham)&&dr(o,"sham",!0),d[r]=o,l&&(Yn(sr,n=a+"Prototype")||dr(sr,n,{}),sr[n][r]=g,e.real&&p&&!p[r]&&dr(p,r,g)))}},gr=function(e){return"function"==typeof e?e:void 0},_r=function(e,t){return 2>arguments.length?gr(sr[e])||gr(Dn[e]):sr[e]&&sr[e][t]||Dn[e]&&Dn[e][t]},vr=_r("JSON","stringify"),yr=/[\uD800-\uDFFF]/g,Er=/^[\uD800-\uDBFF]$/,Sr=/^[\uDC00-\uDFFF]$/,Tr=function(e,t,n){var r=n.charAt(t-1);return t=n.charAt(t+1),Er.test(e)&&!Sr.test(t)||Sr.test(e)&&!Er.test(r)?"\\u"+e.charCodeAt(0).toString(16):e},br=Pn(function(){return'"\\udf06\\ud834"'!==vr("\udf06\ud834")||'"\\udead"'!==vr("\udead")});vr&&mr({target:"JSON",stat:!0,forced:br},{stringify:function(e,t,n){var r=vr.apply(null,arguments);return"string"==typeof r?r.replace(yr,Tr):r}}),sr.JSON||(sr.JSON={stringify:JSON.stringify});var wr=function(e,t,n){return sr.JSON.stringify.apply(null,arguments)},Rr={},Ir=0,Cr=Math.random(),Ar=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++Ir+Cr).toString(36)},Or=!Pn(function(){return Object.isExtensible(Object.preventExtensions({}))}),Nr=e(function(e){var t=hr.f,n=Ar("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},s=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!Wn(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Yn(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!Yn(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return Or&&s.REQUIRED&&i(e)&&!Yn(e,n)&&o(e),e}};Rr[n]=!0}),kr=Dn["__core-js_shared__"]||function(e,t){try{dr(Dn,e,t)}catch(Pu){Dn[e]=t}return t}("__core-js_shared__",{}),Dr=e(function(e){(e.exports=function(e,t){return kr[e]||(kr[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.4.3",mode:"pure",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})}),Pr=!!Object.getOwnPropertySymbols&&!Pn(function(){return!String(Symbol())}),Lr=Pr&&!Symbol.sham&&"symbol"==typeof Symbol(),xr=Dr("wks"),Mr=Dn.Symbol,Ur=Lr?Mr:Ar,Vr=function(e){return Yn(xr,e)||(xr[e]=Pr&&Yn(Mr,e)?Mr[e]:Ur("Symbol."+e)),xr[e]},Fr={},Br=Vr("iterator"),jr=Array.prototype,Gr=function(e){return void 0!==e&&(Fr.Array===e||jr[Br]===e)},qr=Math.ceil,Hr=Math.floor,Wr=function(e){return isNaN(e=+e)?0:(0<e?Hr:qr)(e)},zr=Math.min,Kr=function(e){return 0<e?zr(Wr(e),9007199254740991):0},Yr={};Yr[Vr("toStringTag")]="z";var Qr="[object z]"===String(Yr),Jr=Vr("toStringTag"),Xr="Arguments"==Bn(function(){return arguments}()),$r=Qr?Bn:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[Jr];break e}catch(o){}r=void 0}r="string"==typeof(n=r)?n:Xr?Bn(e):"Object"==(t=Bn(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},Zr=Vr("iterator"),ei=function(e){if(null!=e)return e[Zr]||e["@@iterator"]||Fr[$r(e)]},ti=function(e,t,n,r){try{return r?t(ur(n)[0],n[1]):t(n)}catch(i){throw void 0!==(t=e.return)&&ur(t.call(e)),i}},ni=e(function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,n,r,i,o){var s,a;if(n=cr(n,r,i?2:1),!o){if("function"!=typeof(o=ei(e)))throw TypeError("Target is not iterable");if(Gr(o)){for(o=0,r=Kr(e.length);r>o;o++)if((s=i?n(ur(a=e[o])[0],a[1]):n(e[o]))&&s instanceof t)return s;return new t(!1)}e=o.call(e)}for(o=e.next;!(a=o.call(e)).done;)if("object"==typeof(s=ti(e,n,a.value,i))&&s&&s instanceof t)return s;return new t(!1)}).stop=function(e){return new t(!0,e)}}),ri=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},ii=Qr?{}.toString:function(){return"[object "+$r(this)+"]"},oi=hr.f,si=Vr("toStringTag"),ai=function(e,t,n,r){e&&(Yn(e=n?e:e.prototype,si)||oi(e,si,{configurable:!0,value:t}),r&&!Qr&&dr(e,"toString",ii))},ci=function(e){return Object(qn(e))},ui=Array.isArray||function(e){return"Array"==Bn(e)},li=Vr("species"),hi=function(e,t){var n;return ui(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!ui(n.prototype)?Wn(n)&&null===(n=n[li])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},di=[].push,pi=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,s=5==e||o;return function(a,c,u,l){var h,d,p=ci(a),f=Gn(p);c=cr(c,u,3),u=Kr(f.length);var m=0;for(l=l||hi,a=t?l(a,u):n?l(a,0):void 0;u>m;m++)if((s||m in f)&&(d=c(h=f[m],m,p),e))if(t)a[m]=d;else if(d)switch(e){case 3:return!0;case 5:return h;case 6:return m;case 2:di.call(a,h)}else if(i)return!1;return o?-1:r||i?i:a}},fi=pi(0),mi=pi(1),gi=pi(2),_i=pi(3);pi(4);var vi=pi(5),yi=pi(6),Ei=Dr("native-function-to-string",Function.toString),Si=Dn.WeakMap,Ti="function"==typeof Si&&/native code/.test(Ei.call(Si)),bi=Dr("keys"),wi=function(e){return bi[e]||(bi[e]=Ar(e))};if(Ti)var Ri=new(0,Dn.WeakMap),Ii=Ri.get,Ci=Ri.has,Ai=Ri.set,Oi=function(e,t){return Ai.call(Ri,e,t),t},Ni=function(e){return Ii.call(Ri,e)||{}},ki=function(e){return Ci.call(Ri,e)};else{var Di=wi("state");Rr[Di]=!0,Oi=function(e,t){return dr(e,Di,t),t},Ni=function(e){return Yn(e,Di)?e[Di]:{}},ki=function(e){return Yn(e,Di)}}var Pi={set:Oi,get:Ni,has:ki,enforce:function(e){return ki(e)?Ni(e):Oi(e,{})},getterFor:function(e){return function(t){var n;if(!Wn(t)||(n=Ni(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Li=hr.f,xi=Pi.set,Mi=Pi.getterFor,Ui=Math.max,Vi=Math.min,Fi=function(e,t){return 0>(e=Wr(e))?Ui(e+t,0):Vi(e,t)},Bi=function(e){return function(t,n,r){var i;t=Hn(t);var o=Kr(t.length);if(r=Fi(r,o),e&&n!=n){for(;o>r;)if((i=t[r++])!=i)return!0}else for(;o>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},ji=Bi(!0),Gi=Bi(!1),qi=function(e,t){var n;e=Hn(e);var r=0,i=[];for(n in e)!Yn(Rr,n)&&Yn(e,n)&&i.push(n);for(;t.length>r;)Yn(e,n=t[r++])&&(~Gi(i,n)||i.push(n));return i},Hi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),Wi=Object.keys||function(e){return qi(e,Hi)},zi=Ln?Object.defineProperties:function(e,t){ur(e);for(var n,r=Wi(t),i=r.length,o=0;i>o;)hr.f(e,n=r[o++],t[n]);return e},Ki=_r("document","documentElement"),Yi=wi("IE_PROTO"),Qi=function(){},Ji=function(){var e=Jn?Qn.createElement("iframe"):{},t=Hi.length;for(e.style.display="none",Ki.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),Ji=e.F;t--;)delete Ji.prototype[Hi[t]];return Ji()},Xi=Object.create||function(e,t){var n;return null!==e?(Qi.prototype=ur(e),n=new Qi,Qi.prototype=null,n[Yi]=e):n=Ji(),void 0===t?n:zi(n,t)};Rr[Yi]=!0;var $i,Zi,eo,to=function(e,t,n,r){r&&r.enumerable?e[t]=n:dr(e,t,n)},no=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:to(e,r,t[r],n);return e},ro=!Pn(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),io=wi("IE_PROTO"),oo=Object.prototype,so=ro?Object.getPrototypeOf:function(e){return e=ci(e),Yn(e,io)?e[io]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?oo:null},ao=(Vr("iterator"),!1);[].keys&&("next"in(eo=[].keys())?(Zi=so(so(eo)))!==Object.prototype&&($i=Zi):ao=!0),null==$i&&($i={});var co=$i,uo=ao,lo=function(){return this},ho=(Object.setPrototypeOf||"__proto__"in{}&&function(){try{Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set.call({},[])}catch(e){}}(),co),po=Vr("iterator"),fo=function(){return this},mo=function(e,t,n,r,i,o,s){var a,c,u;!function(e,t,n){t+=" Iterator",e.prototype=Xi(co,{next:Vn(1,n)}),ai(e,t,!1,!0),Fr[t]=lo}(n,t,r),r=function(e){if(e===i&&f)return f;if(!uo&&e in d)return d[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var l=t+" Iterator",h=!1,d=e.prototype,p=d[po]||d["@@iterator"]||i&&d[i],f=!uo&&p||r(i),m="Array"==t&&d.entries||p;if(m&&(a=so(m.call(new e)),ho!==Object.prototype&&a.next&&(ai(a,l,!0,!0),Fr[l]=fo)),"values"==i&&p&&"values"!==p.name&&(h=!0,f=function(){return p.call(this)}),s&&d[po]!==f&&dr(d,po,f),Fr[t]=f,i)if(c={values:r("values"),keys:o?f:r("keys"),entries:r("entries")},s)for(u in c)!uo&&!h&&u in d||to(d,u,c[u]);else mr({target:t,proto:!0,forced:uo||h},c);return c},go=Vr("species"),_o=function(e){e=_r(e),Ln&&e&&!e[go]&&(0,hr.f)(e,go,{configurable:!0,get:function(){return this}})},vo=hr.f,yo=Nr.fastKey,Eo=Pi.set,So=Pi.getterFor,To=(function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",s=Dn[e],a=s&&s.prototype,c={};if(Ln&&"function"==typeof s&&(i||a.forEach&&!Pn(function(){(new s).entries().next()}))){var u=t(function(t,n){xi(ri(t,u,e),{type:e,collection:new s}),null!=n&&ni(n,t[o],t,r)}),l=Mi(e);fi("add clear delete forEach get has set keys values entries".split(" "),function(e){var t="add"==e||"set"==e;!(e in a)||i&&"clear"==e||dr(u.prototype,e,function(n,r){var o=l(this).collection;return t||!i||Wn(n)?(n=o[e](0===n?0:n,r),t?this:n):"get"==e&&void 0})}),i||Li(u.prototype,"size",{configurable:!0,get:function(){return l(this).collection.size}})}else u=n.getConstructor(t,e,r,o),Nr.REQUIRED=!0;ai(u,e,!1,!0),c[e]=u,mr({global:!0,forced:!0},c),i||n.setStrong(u,e,r)}("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},{getConstructor:function(e,t,n,r){var i=e(function(e,o){ri(e,i,t),Eo(e,{type:t,index:Xi(null),first:void 0,last:void 0,size:0}),Ln||(e.size=0),null!=o&&ni(o,e[r],e,n)}),o=So(t),s=function(e,t,n){var r,i,s=o(e),c=a(e,t);return c?c.value=n:(s.last=c={index:i=yo(t,!0),key:t,value:n,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=c),r&&(r.next=c),Ln?s.size++:e.size++,"F"!==i&&(s.index[i]=c)),e},a=function(e,t){e=o(e);var n=yo(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return no(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,Ln?e.size=0:this.size=0},delete:function(e){var t=o(this);if(e=a(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),Ln?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=o(this),r=cr(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),no(i.prototype,n?{get:function(e){return(e=a(this,e))&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Ln&&vo(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=So(t),o=So(r);mo(e,t,function(e,t){Eo(this,{type:r,target:e,state:i(e),kind:t,last:void 0})},function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),_o(t)}}),function(e){return function(t,n){var r,i;t=String(qn(t)),n=Wr(n);var o=t.length;return 0>n||n>=o?e?"":void 0:55296>(r=t.charCodeAt(n))||56319<r||n+1===o||56320>(i=t.charCodeAt(n+1))||57343<i?e?t.charAt(n):r:e?t.slice(n,n+2):i-56320+(r-55296<<10)+65536}}),bo=(To(!1),To(!0)),wo=Pi.set,Ro=Pi.getterFor("String Iterator");mo(String,"String",function(e){wo(this,{type:"String Iterator",string:String(e),index:0})},function(){var e,t=Ro(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=bo(n,r),t.index+=e.length,{value:e,done:!1})});var Io=Pi.set,Co=Pi.getterFor("Array Iterator");mo(Array,"Array",function(e,t){Io(this,{type:"Array Iterator",target:Hn(e),index:0,kind:t})},function(){var e=Co(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),Fr.Arguments=Fr.Array;var Ao,Oo=Vr("toStringTag");for(Ao in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var No=Dn[Ao],ko=No&&No.prototype;ko&&!ko[Oo]&&dr(ko,Oo,Ao),Fr[Ao]=Fr.Array}var Do=sr.Map,Po=Vr("match"),Lo=function(e){var t;if(Wn(e)&&(void 0!==(t=e[Po])?t:"RegExp"==Bn(e)))throw TypeError("The method doesn't accept regular expressions");return e},xo=Vr("match"),Mo=function(e){var t=/./;try{"/./"[e](t)}catch(Pu){try{return t[xo]=!1,"/./"[e](t)}catch(n){}}return!1},Uo="".endsWith,Vo=Math.min,Fo=Mo("endsWith");mr({target:"String",proto:!0,forced:!Fo},{endsWith:function(e){var t=String(qn(this));Lo(e);var n=1<arguments.length?arguments[1]:void 0,r=Kr(t.length);return n=void 0===n?r:Vo(Kr(n),r),r=String(e),Uo?Uo.call(t,r,n):t.slice(n-r.length,n)===r}});var Bo=function(e){return sr[e+"Prototype"]},jo=Bo("String").endsWith,Go=String.prototype,qo=function(e){var t=e.endsWith;return"string"==typeof e||e===Go||e instanceof String&&t===Go.endsWith?jo:t},Ho=function(e,t){var n=[][e];return!n||!Pn(function(){n.call(null,t||function(){throw 1},1)})},Wo=Ho("forEach")?function(e){return fi(this,e,1<arguments.length?arguments[1]:void 0)}:[].forEach;mr({target:"Array",proto:!0,forced:[].forEach!=Wo},{forEach:Wo});var zo=Bo("Array").forEach,Ko=Array.prototype,Yo={DOMTokenList:!0,NodeList:!0},Qo=function(e){var t=e.forEach;return e===Ko||e instanceof Array&&t===Ko.forEach||Yo.hasOwnProperty($r(e))?zo:t},Jo={f:Object.getOwnPropertySymbols},Xo=Object.assign,$o=!Xo||Pn(function(){var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(e){t[e]=e}),7!=Xo({},e)[n]||"abcdefghijklmnopqrst"!=Wi(Xo({},t)).join("")})?function(e,t){for(var n=ci(e),r=arguments.length,i=1,o=Jo.f,s=Un;r>i;)for(var a,c=Gn(arguments[i++]),u=o?Wi(c).concat(o(c)):Wi(c),l=u.length,h=0;l>h;)a=u[h++],Ln&&!s.call(c,a)||(n[a]=c[a]);return n}:Xo;mr({target:"Object",stat:!0,forced:Object.assign!==$o},{assign:$o});var Zo=sr.Object.assign,es=Pn(function(){Wi(1)});mr({target:"Object",stat:!0,forced:es},{keys:function(e){return Wi(ci(e))}});var ts=sr.Object.keys,ns=function(e){return function(t,n,r,i){ar(n),t=ci(t);var o=Gn(t),s=Kr(t.length),a=e?s-1:0,c=e?-1:1;if(2>r)for(;;){if(a in o){i=o[a],a+=c;break}if(a+=c,e?0>a:s<=a)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=a:s>a;a+=c)a in o&&(i=n(i,o[a],a,t));return i}},rs=[ns(!1),ns(!0)][0];mr({target:"Array",proto:!0,forced:Ho("reduce")},{reduce:function(e){return rs(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var is=Bo("Array").reduce,os=Array.prototype,ss=function(e){var t=e.reduce;return e===os||e instanceof Array&&t===os.reduce?is:t};mr({target:"Object",stat:!0,forced:!Ln,sham:!Ln},{defineProperty:hr.f});var as=e(function(e){var t=sr.Object;e=e.exports=function(e,n,r){return t.defineProperty(e,n,r)},t.defineProperty.sham&&(e.sham=!0)}),cs=as,us=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ls=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hs=function(e){return function(t){return t=String(qn(t)),1&e&&(t=t.replace(us,"")),2&e&&(t=t.replace(ls,"")),t}};hs(1),hs(2);var ds=hs(3),ps=Dn.parseInt,fs=/^[+-]?0[Xx]/,ms=8!==ps("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff08")||22!==ps("\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff0x16")?function(e,t){return e=ds(String(e)),ps(e,t>>>0||(fs.test(e)?16:10))}:ps;mr({global:!0,forced:parseInt!=ms},{parseInt:ms});var gs=sr.parseInt;let _s=!0,vs=!0;var ys=Zn,Es=Pn(function(){ys(1)});mr({target:"Object",stat:!0,forced:!Ln||Es,sham:!Ln},{getOwnPropertyDescriptor:function(e,t){return ys(Hn(e),t)}});var Ss,Ts,bs=e(function(e){var t=sr.Object;e=e.exports=function(e,n){return t.getOwnPropertyDescriptor(e,n)},t.getOwnPropertyDescriptor.sham&&(e.sham=!0)}),ws=function(e,t,n){(t=zn(t))in e?hr.f(e,t,Vn(0,n)):e[t]=n},Rs=_r("navigator","userAgent")||"",Is=Dn.process,Cs=Is&&Is.versions,As=Cs&&Cs.v8;As?Ts=(Ss=As.split("."))[0]+Ss[1]:Rs&&(!(Ss=Rs.match(/Edge\/(\d+)/))||74<=Ss[1])&&(Ss=Rs.match(/Chrome\/(\d+)/))&&(Ts=Ss[1]);var Os=Ts&&+Ts,Ns=Vr("species"),ks=function(e){return 51<=Os||!Pn(function(){var t=[];return(t.constructor={})[Ns]=function(){return{foo:1}},1!==t[e](Boolean).foo})},Ds=Vr("isConcatSpreadable"),Ps=51<=Os||!Pn(function(){var e=[];return e[Ds]=!1,e.concat()[0]!==e}),Ls=ks("concat");mr({target:"Array",proto:!0,forced:!Ps||!Ls},{concat:function(e){var t,n,r=ci(this),i=hi(r,0),o=0,s=-1;for(t=arguments.length;s<t;s++){var a=n=-1===s?r:arguments[s];if(Wn(a)){var c=a[Ds];a=void 0!==c?!!c:ui(a)}else a=!1;if(a){if(9007199254740991<o+(c=Kr(n.length)))throw TypeError("Maximum allowed index exceeded");for(a=0;a<c;a++,o++)a in n&&ws(i,o,n[a])}else{if(9007199254740991<=o)throw TypeError("Maximum allowed index exceeded");ws(i,o++,n)}}return i.length=o,i}});var xs=Bo("Array").concat,Ms=Array.prototype,Us=function(e){var t=e.concat;return e===Ms||e instanceof Array&&t===Ms.concat?xs:t};mr({target:"Array",proto:!0,forced:!ks("filter")},{filter:function(e){return gi(this,e,1<arguments.length?arguments[1]:void 0)}});var Vs=Bo("Array").filter,Fs=Array.prototype,Bs=function(e){var t=e.filter;return e===Fs||e instanceof Array&&t===Fs.filter?Vs:t},js=Dn.Promise,Gs=Vr("iterator"),qs=!1;try{var Hs=0,Ws={next:function(){return{done:!!Hs++}},return:function(){qs=!0}};Ws[Gs]=function(){return this},Array.from(Ws,function(){throw 2})}catch($c){}var zs,Ks,Ys,Qs=function(e,t){if(!t&&!qs)return!1;var n=!1;try{(t={})[Gs]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(r){}return n},Js=Vr("species"),Xs=function(e,t){var n;return void 0===(e=ur(e).constructor)||null==(n=ur(e)[Js])?t:ar(n)},$s=/(iphone|ipod|ipad).*applewebkit/i.test(Rs),Zs=Dn.location,ea=Dn.setImmediate,ta=Dn.clearImmediate,na=Dn.process,ra=Dn.MessageChannel,ia=Dn.Dispatch,oa=0,sa={},aa=function(e){if(sa.hasOwnProperty(e)){var t=sa[e];delete sa[e],t()}},ca=function(e){return function(){aa(e)}},ua=function(e){aa(e.data)},la=function(e){Dn.postMessage(e+"",Zs.protocol+"//"+Zs.host)};ea&&ta||(ea=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return sa[++oa]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},zs(oa),oa},ta=function(e){delete sa[e]},"process"==Bn(na)?zs=function(e){na.nextTick(ca(e))}:ia&&ia.now?zs=function(e){ia.now(ca(e))}:ra&&!$s?(Ys=(Ks=new ra).port2,Ks.port1.onmessage=ua,zs=cr(Ys.postMessage,Ys,1)):!Dn.addEventListener||"function"!=typeof postMessage||Dn.importScripts||Pn(la)?zs="onreadystatechange"in(Jn?Qn.createElement("script"):{})?function(e){Ki.appendChild(Jn?Qn.createElement("script"):{}).onreadystatechange=function(){Ki.removeChild(this),aa(e)}}:function(e){setTimeout(ca(e),0)}:(zs=la,Dn.addEventListener("message",ua,!1)));var ha,da,pa,fa,ma,ga,_a,va,ya=ea,Ea=Zn,Sa=Dn.MutationObserver||Dn.WebKitMutationObserver,Ta=Dn.process,ba=Dn.Promise,wa="process"==Bn(Ta),Ra=Ea(Dn,"queueMicrotask"),Ia=Ra&&Ra.value;Ia||(ha=function(){var e;for(wa&&(e=Ta.domain)&&e.exit();da;){var t=da.fn;da=da.next;try{t()}catch(Pu){throw da?fa():pa=void 0,Pu}}pa=void 0,e&&e.enter()},wa?fa=function(){Ta.nextTick(ha)}:Sa&&!$s?(ma=!0,ga=document.createTextNode(""),new Sa(ha).observe(ga,{characterData:!0}),fa=function(){ga.data=ma=!ma}):ba&&ba.resolve?(_a=ba.resolve(void 0),va=_a.then,fa=function(){va.call(_a,ha)}):fa=function(){ya.call(Dn,ha)});var Ca,Aa,Oa=Ia||function(e){e={fn:e,next:void 0},pa&&(pa.next=e),da||(da=e,fa()),pa=e},Na=function(e){var t,n;this.promise=new e(function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r}),this.resolve=ar(t),this.reject=ar(n)},ka={f:function(e){return new Na(e)}},Da=function(e,t){return ur(e),Wn(t)&&t.constructor===e?t:((0,(e=ka.f(e)).resolve)(t),e.promise)},Pa=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},La=Vr("species"),xa=Pi.get,Ma=Pi.set,Ua=Pi.getterFor("Promise"),Va=js,Fa=Dn.TypeError,Ba=Dn.document,ja=Dn.process,Ga=Dr("inspectSource"),qa=(_r("fetch"),ka.f),Ha=qa,Wa="process"==Bn(ja),za=!!(Ba&&Ba.createEvent&&Dn.dispatchEvent),Ka=tr("Promise",function(){if(Ga(Va)===String(Va)&&(66===Os||!Wa&&"function"!=typeof PromiseRejectionEvent)||!Va.prototype.finally)return!0;if(51<=Os&&/native code/.test(Va))return!1;var e=Va.resolve(1),t=function(e){e(function(){},function(){})};return(e.constructor={})[La]=t,!(e.then(function(){})instanceof t)}),Ya=Ka||!Qs(function(e){Va.all(e).catch(function(){})}),Qa=function(e){var t;return!(!Wn(e)||"function"!=typeof(t=e.then))&&t},Ja=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;Oa(function(){for(var i=t.value,o=1==t.state,s=0;r.length>s;){var a,c,u,l=r[s++],h=o?l.ok:l.fail,d=l.resolve,p=l.reject,f=l.domain;try{h?(o||(2===t.rejection&&Za(e,t),t.rejection=1),!0===h?a=i:(f&&f.enter(),a=h(i),f&&(f.exit(),u=!0)),a===l.promise?p(Fa("Promise-chain cycle")):(c=Qa(a))?c.call(a,d,p):d(a)):p(i)}catch(m){f&&!u&&f.exit(),p(m)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&$a(e,t)})}},Xa=function(e,t,n){var r,i;za?((r=Ba.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Dn.dispatchEvent(r)):r={promise:t,reason:n},(i=Dn["on"+e])?i(r):"unhandledrejection"===e&&function(e,t){var n=Dn.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},$a=function(e,t){ya.call(Dn,function(){var n,r=t.value;if(1!==t.rejection&&!t.parent&&(n=Pa(function(){Wa?ja.emit("unhandledRejection",r,e):Xa("unhandledrejection",e,r)}),t.rejection=Wa||1!==t.rejection&&!t.parent?2:1,n.error))throw n.value})},Za=function(e,t){ya.call(Dn,function(){Wa?ja.emit("rejectionHandled",e):Xa("rejectionhandled",e,t.value)})},ec=function(e,t,n,r){return function(i){e(t,n,i,r)}},tc=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,Ja(e,t,!0))},nc=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw Fa("Promise can't be resolved itself");var i=Qa(n);i?Oa(function(){var r={done:!1};try{i.call(n,ec(nc,e,r,t),ec(tc,e,r,t))}catch(o){tc(e,r,o,t)}}):(t.value=n,t.state=1,Ja(e,t,!1))}catch(o){tc(e,{done:!1},o,t)}}};Ka&&(Va=function(e){ri(this,Va,"Promise"),ar(e),Ca.call(this);var t=xa(this);try{e(ec(nc,this,t),ec(tc,this,t))}catch(Pu){tc(this,t,Pu)}},(Ca=function(e){Ma(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=no(Va.prototype,{then:function(e,t){var n=Ua(this),r=qa(Xs(this,Va));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=Wa?ja.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Ja(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),Aa=function(){var e=new Ca,t=xa(e);this.promise=e,this.resolve=ec(nc,e,t),this.reject=ec(tc,e,t)},ka.f=qa=function(e){return e===Va||e===rc?new Aa(e):Ha(e)}),mr({global:!0,wrap:!0,forced:Ka},{Promise:Va}),ai(Va,"Promise",!1,!0),_o("Promise");var rc=_r("Promise");mr({target:"Promise",stat:!0,forced:Ka},{reject:function(e){var t=qa(this);return t.reject.call(void 0,e),t.promise}}),mr({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Da(this===rc?Va:this,e)}}),mr({target:"Promise",stat:!0,forced:Ya},{all:function(e){var t=this,n=qa(t),r=n.resolve,i=n.reject,o=Pa(function(){var n=ar(t.resolve),o=[],s=0,a=1;ni(e,function(e){var c=s++,u=!1;o.push(void 0),a++,n.call(t,e).then(function(e){u||(u=!0,o[c]=e,--a||r(o))},i)}),--a||r(o)});return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=qa(t),r=n.reject,i=Pa(function(){var i=ar(t.resolve);ni(e,function(e){i.call(t,e).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}}),mr({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=ka.f(t),r=n.resolve,i=n.reject,o=Pa(function(){var n=ar(t.resolve),i=[],o=0,s=1;ni(e,function(e){var a=o++,c=!1;i.push(void 0),s++,n.call(t,e).then(function(e){c||(c=!0,i[a]={status:"fulfilled",value:e},--s||r(i))},function(e){c||(c=!0,i[a]={status:"rejected",reason:e},--s||r(i))})}),--s||r(i)});return o.error&&i(o.value),n.promise}}),mr({target:"Promise",proto:!0,real:!0},{finally:function(e){var t=Xs(this,_r("Promise")),n="function"==typeof e;return this.then(n?function(n){return Da(t,e()).then(function(){return n})}:e,n?function(n){return Da(t,e()).then(function(){throw n})}:e)}});var ic=sr.Promise;mr({target:"Array",proto:!0,forced:!ks("map")},{map:function(e){return mi(this,e,1<arguments.length?arguments[1]:void 0)}});var oc=Bo("Array").map,sc=Array.prototype,ac=function(e){var t=e.map;return e===sc||e instanceof Array&&t===sc.map?oc:t},cc=Math.max,uc=Math.min;mr({target:"Array",proto:!0,forced:!ks("splice")},{splice:function(e,t){var n,r,i,o,s=ci(this),a=Kr(s.length),c=Fi(e,a),u=arguments.length;if(0===u?n=r=0:1===u?(n=0,r=a-c):(n=u-2,r=uc(cc(Wr(t),0),a-c)),9007199254740991<a+n-r)throw TypeError("Maximum allowed length exceeded");for(u=hi(s,r),i=0;i<r;i++)(o=c+i)in s&&ws(u,i,s[o]);if(u.length=r,n<r){for(i=c;i<a-r;i++){var l=i+n;(o=i+r)in s?s[l]=s[o]:delete s[l]}for(i=a;i>a-r+n;i--)delete s[i-1]}else if(n>r)for(i=a-r;i>c;i--)l=i+n-1,(o=i+r-1)in s?s[l]=s[o]:delete s[l];for(i=0;i<n;i++)s[i+c]=arguments[i+2];return s.length=a-r+n,u}});var lc=Bo("Array").splice,hc=Array.prototype,dc=function(e){var t=e.splice;return e===hc||e instanceof Array&&t===hc.splice?lc:t},pc=[].indexOf,fc=!!pc&&0>1/[1].indexOf(1,-0),mc=Ho("indexOf");mr({target:"Array",proto:!0,forced:fc||mc},{indexOf:function(e){return fc?pc.apply(this,arguments)||0:Gi(this,e,1<arguments.length?arguments[1]:void 0)}});var gc=Bo("Array").indexOf,_c=Array.prototype,vc=function(e){var t=e.indexOf;return e===_c||e instanceof Array&&t===_c.indexOf?gc:t},yc=Vr("species"),Ec=[].slice,Sc=Math.max;mr({target:"Array",proto:!0,forced:!ks("slice")},{slice:function(e,t){var n,r=Hn(this),i=Kr(r.length);if(e=Fi(e,i),t=Fi(void 0===t?i:t,i),ui(r)&&("function"!=typeof(n=r.constructor)||n!==Array&&!ui(n.prototype)?Wn(n)&&null===(n=n[yc])&&(n=void 0):n=void 0,n===Array||void 0===n))return Ec.call(r,e,t);for(n=new(void 0===n?Array:n)(Sc(t-e,0)),i=0;e<t;e++,i++)e in r&&ws(n,i,r[e]);return n.length=i,n}});var Tc=Bo("Array").slice,bc=Array.prototype,wc=function(e){var t=e.slice;return e===bc||e instanceof Array&&t===bc.slice?Tc:t},Rc=!0;"find"in[]&&Array(1).find(function(){Rc=!1}),mr({target:"Array",proto:!0,forced:Rc},{find:function(e){return vi(this,e,1<arguments.length?arguments[1]:void 0)}});var Ic=Bo("Array").find,Cc=Array.prototype,Ac=function(e){var t=e.find;return e===Cc||e instanceof Array&&t===Cc.find?Ic:t},Oc=[].slice,Nc={};mr({target:"Function",proto:!0},{bind:Function.bind||function(e){var t=ar(this),n=Oc.call(arguments,1),r=function(){var i=n.concat(Oc.call(arguments));if(this instanceof r){var o=i.length;if(!(o in Nc)){for(var s=[],a=0;a<o;a++)s[a]="a["+a+"]";Nc[o]=Function("C,a","return new C("+s.join(",")+")")}i=Nc[o](t,i)}else i=t.apply(e,i);return i};return Wn(t.prototype)&&(r.prototype=t.prototype),r}});var kc=Bo("Function").bind,Dc=Function.prototype,Pc=function(e){var t=e.bind;return e===Dc||e instanceof Function&&t===Dc.bind?kc:t};mr({target:"Array",proto:!0},{includes:function(e){return ji(this,e,1<arguments.length?arguments[1]:void 0)}});var Lc=Bo("Array").includes;mr({target:"String",proto:!0,forced:!Mo("includes")},{includes:function(e){return!!~String(qn(this)).indexOf(Lo(e),1<arguments.length?arguments[1]:void 0)}});var xc=Bo("String").includes,Mc=Array.prototype,Uc=String.prototype,Vc=function(e){var t=e.includes;return e===Mc||e instanceof Array&&t===Mc.includes?Lc:"string"==typeof e||e===Uc||e instanceof String&&t===Uc.includes?xc:t};mr({target:"Array",proto:!0,forced:Ho("some")},{some:function(e){return _i(this,e,1<arguments.length?arguments[1]:void 0)}});var Fc=Bo("Array").some,Bc=Array.prototype,jc=function(e){var t=e.some;return e===Bc||e instanceof Array&&t===Bc.some?Fc:t};let Gc=s;var qc=Object.freeze({__proto__:null,shimMediaStream:d,shimOnTrack:p,shimGetSendersWithDtmf:f,shimGetStats:m,shimSenderReceiverGetStats:g,shimAddTrackRemoveTrackWithNative:_,shimAddTrackRemoveTrack:v,shimPeerConnection:y,fixNegotiationNeeded:E,shimGetUserMedia:h,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(t=>{let r=n.video&&n.video.width,i=n.video&&n.video.height;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:n.video&&n.video.frameRate||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}),Hc="".startsWith,Wc=Math.min,zc=Mo("startsWith");mr({target:"String",proto:!0,forced:!zc},{startsWith:function(e){var t=String(qn(this));Lo(e);var n=Kr(Wc(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return Hc?Hc.call(t,r,n):t.slice(n,n+r.length)===r}});var Kc=Bo("String").startsWith,Yc=String.prototype,Qc=function(e){var t=e.startsWith;return"string"==typeof e||e===Yc||e instanceof String&&t===Yc.startsWith?Kc:t};mr({target:"String",proto:!0,forced:Pn(function(){return"trim"!=="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff".trim.name})},{trim:function(){return ds(this)}});var Jc,Xc,$c,Zc=Bo("String").trim,eu=String.prototype,tu=function(e){var t=e.trim;return"string"==typeof e||e===eu||e instanceof String&&t===eu.trim?Zc:t},nu=e(function(e){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){var t;return ac(t=tu(e).call(e).split("\n")).call(t,function(e){return tu(e).call(e)})},t.splitSections=function(e){return e=e.split("\nm="),ac(e).call(e,function(e,t){var n;return tu(n=0<t?"m="+e:e).call(n)+"\r\n"})},t.getDescription=function(e){return(e=t.splitSections(e))&&e[0]},t.getMediaSections=function(e){return(e=t.splitSections(e)).shift(),e},t.matchPrefix=function(e,n){var r;return Bs(r=t.splitLines(e)).call(r,function(e){return 0===vc(e).call(e,n)})},t.parseCandidate=function(e){var t;e={foundation:(t=0===vc(e).call(e,"a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:gs(t[1],10),protocol:t[2].toLowerCase(),priority:gs(t[3],10),ip:t[4],address:t[4],port:gs(t[5],10),type:t[7]};for(var n=8;n<t.length;n+=2)switch(t[n]){case"raddr":e.relatedAddress=t[n+1];break;case"rport":e.relatedPort=gs(t[n+1],10);break;case"tcptype":e.tcpType=t[n+1];break;case"ufrag":e.ufrag=t[n+1],e.usernameFragment=t[n+1];break;default:e[t[n]]=t[n+1]}return e},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){e=e.substr(9).split(" ");var t={payloadType:gs(e.shift(),10)};return e=e[0].split("/"),t.name=e[0],t.clockRate=gs(e[1],10),t.channels=3===e.length?gs(e[2],10):1,t.numChannels=t.channels,t},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t;return e=e.substr(9).split(" "),{id:gs(e[0],10),direction:0<vc(t=e[0]).call(t,"/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t={},n=e.substr(vc(e).call(e," ")+1).split(";"),r=0;r<n.length;r++){var i,o;e=tu(i=n[r]).call(i).split("="),t[tu(o=e[0]).call(o)]=e[1]}return t},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&ts(e.parameters).length){var r,i=[];Qo(r=ts(e.parameters)).call(r,function(t){i.push(e.parameters[t]?t+"="+e.parameters[t]:t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){return{type:(e=e.substr(vc(e).call(e," ")+1).split(" ")).shift(),parameter:e.join(" ")}},t.writeRtcpFb=function(e){var t,n="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&Qo(t=e.rtcpFeedback).call(t,function(e){n+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),n},t.parseSsrcMedia=function(e){var t=vc(e).call(e," "),n={ssrc:gs(e.substr(7,t-7),10)},r=vc(e).call(e,":",t);return-1<r?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){return{semantics:(e=e.substr(13).split(" ")).shift(),ssrcs:ac(e).call(e,function(e){return gs(e,10)})}},t.getMid=function(e){if(e=t.matchPrefix(e,"a=mid:")[0])return e.substr(6)},t.parseFingerprint=function(e){return{algorithm:(e=e.substr(14).split(" "))[0].toLowerCase(),value:e[1]}},t.getDtlsParameters=function(e,n){return e=t.matchPrefix(e+n,"a=fingerprint:"),{role:"auto",fingerprints:ac(e).call(e,t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n,r="a=setup:"+t+"\r\n";return Qo(n=e.fingerprints).call(n,function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},t.getIceParameters=function(e,n){return e=t.splitLines(e),e=Us(e).call(e,t.splitLines(n)),{usernameFragment:Bs(e).call(e,function(e){return 0===vc(e).call(e,"a=ice-ufrag:")})[0].substr(12),password:Bs(e).call(e,function(e){return 0===vc(e).call(e,"a=ice-pwd:")})[0].substr(10)}},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var n,r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" "),o=3;o<i.length;o++){var s=i[o],a=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){var c;a=t.parseRtpMap(a);var u=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(a.parameters=u.length?t.parseFmtp(u[0]):{},a.rtcpFeedback=ac(c=t.matchPrefix(e,"a=rtcp-fb:"+s+" ")).call(c,t.parseRtcpFb),r.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(a.name.toUpperCase())}}}return Qo(n=t.matchPrefix(e,"a=extmap:")).call(n,function(e){r.headerExtensions.push(t.parseExtmap(e))}),r},t.writeRtpDescription=function(e,n){var r,i,o,s="";s+="m="+e+" ",s+=0<n.codecs.length?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=ac(r=n.codecs).call(r,function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",s+="c=IN IP4 0.0.0.0\r\n",s+="a=rtcp:9 IN IP4 0.0.0.0\r\n",Qo(i=n.codecs).call(i,function(e){s+=t.writeRtpMap(e),s+=t.writeFmtp(e),s+=t.writeRtcpFb(e)});var a,c=0;return Qo(o=n.codecs).call(o,function(e){e.maxptime>c&&(c=e.maxptime)}),0<c&&(s+="a=maxptime:"+c+"\r\n"),s+="a=rtcp-mux\r\n",n.headerExtensions&&Qo(a=n.headerExtensions).call(a,function(e){s+=t.writeExtmap(e)}),s},t.parseRtpEncodingParameters=function(e){var n,r,i,o,s,a,c,u=[],l=t.parseRtpParameters(e),h=-1!==vc(n=l.fecMechanisms).call(n,"RED"),d=-1!==vc(r=l.fecMechanisms).call(r,"ULPFEC"),p=0<(n=Bs(i=ac(o=t.matchPrefix(e,"a=ssrc:")).call(o,function(e){return t.parseSsrcMedia(e)})).call(i,function(e){return"cname"===e.attribute})).length&&n[0].ssrc;0<(i=ac(s=t.matchPrefix(e,"a=ssrc-group:FID")).call(s,function(e){return e=e.substr(17).split(" "),ac(e).call(e,function(e){return gs(e,10)})})).length&&1<i[0].length&&i[0][0]===p&&(c=i[0][1]),Qo(a=l.codecs).call(a,function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:p,codecPayloadType:gs(e.parameters.apt,10)},p&&c&&(e.rtx={ssrc:c}),u.push(e),h&&((e=JSON.parse(wr(e))).fec={ssrc:p,mechanism:d?"red+ulpfec":"red"},u.push(e)))}),0===u.length&&p&&u.push({ssrc:p});var f,m,g=t.matchPrefix(e,"b=");return g.length&&(g=0===vc(f=g[0]).call(f,"b=TIAS:")?gs(g[0].substr(7),10):0===vc(m=g[0]).call(m,"b=AS:")?950*gs(g[0].substr(5),10)-16e3:void 0,Qo(u).call(u,function(e){e.maxBitrate=g})),u},t.parseRtcpParameters=function(e){var n,r,i={},o=Bs(n=ac(r=t.matchPrefix(e,"a=ssrc:")).call(r,function(e){return t.parseSsrcMedia(e)})).call(n,function(e){return"cname"===e.attribute})[0];return o&&(i.cname=o.value,i.ssrc=o.ssrc),n=t.matchPrefix(e,"a=rtcp-rsize"),i.reducedSize=0<n.length,i.compound=0===n.length,e=t.matchPrefix(e,"a=rtcp-mux"),i.mux=0<e.length,i},t.parseMsid=function(e){var n,r,i,o=t.matchPrefix(e,"a=msid:");return 1===o.length?{stream:(i=o[0].substr(7).split(" "))[0],track:i[1]}:0<(e=Bs(n=ac(r=t.matchPrefix(e,"a=ssrc:")).call(r,function(e){return t.parseSsrcMedia(e)})).call(n,function(e){return"msid"===e.attribute})).length?{stream:(i=e[0].value.split(" "))[0],track:i[1]}:void 0},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){return n=void 0!==n?n:2,"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,n,r,i){return n=t.writeRtpDescription(e.kind,n),n+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),n+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),n+="a=mid:"+e.mid+"\r\n",n+=e.direction?"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?"a=sendrecv\r\n":e.rtpSender?"a=sendonly\r\n":e.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",e.rtpSender&&(n=n+"a="+(r="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,n+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),n+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(n+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),n},t.getDirection=function(e,n){e=t.splitLines(e);for(var r=0;r<e.length;r++)switch(e[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[r].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){return{kind:(e=t.splitLines(e)[0].substr(2).split(" "))[0],port:gs(e[1],10),protocol:e[2],fmt:wc(e).call(e,3).join(" ")}},t.parseOLine=function(e){return{username:(e=t.matchPrefix(e,"o=")[0].substr(2).split(" "))[0],sessionId:e[1],sessionVersion:gs(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;e=t.splitLines(e);for(var n=0;n<e.length;n++)if(2>e[n].length||"="!==e[n].charAt(1))return!1;return!0},e.exports=t}),ru=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function r(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var i=function(n){var r=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){r[e]=i[e].bind(i)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw R("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&14393<=t&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var o=n.iceCandidatePoolSize;0<o;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=nu.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(i.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(i.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},i.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(e,t){var n=0<this.transceivers.length;return e={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0},this.usingBundle&&n?(e.iceTransport=this.transceivers[0].iceTransport,e.dtlsTransport=this.transceivers[0].dtlsTransport):(n=this._createIceAndDtlsTransports(),e.iceTransport=n.iceTransport,e.dtlsTransport=n.dtlsTransport),t||this.transceivers.push(e),e},i.prototype.addTrack=function(t,n){if(this._isClosed)throw R("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw R("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},i.prototype.addStream=function(e){var n=this;if(15025<=t)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},i.prototype.removeTrack=function(t){if(this._isClosed)throw R("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw R("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&-1<this.localStreams.indexOf(r)&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},i.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},i.prototype._createIceGatherer=function(t,n){var r=this;if(n&&0<t)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},i.prototype._gather=function(t,n){var r=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var o=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(r.usingBundle&&0<n)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate;(e=!s||0===Object.keys(s).length)?"new"!==i.state&&"gathering"!==i.state||(i.state="completed"):("new"===i.state&&(i.state="gathering"),s.component=1,s.ufrag=i.getLocalParameters().usernameFragment,s=nu.writeCandidate(s),o.candidate=Object.assign(o.candidate,nu.parseCandidate(s)),o.candidate.candidate=s,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}),(s=nu.getMediaSections(r._localDescription.sdp))[o.candidate.sdpMLineIndex]+=e?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r._localDescription.sdp=nu.getDescription(r._localDescription.sdp)+s.join(""),s=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}),"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),e||r._dispatchEvent("icecandidate",o),s&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){i.onlocalcandidate(e)})},0)}},i.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},i.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer),(t=this.transceivers[e].iceTransport)&&(delete t.onicestatechange,delete this.transceivers[e].iceTransport),(t=this.transceivers[e].dtlsTransport)&&(delete t.ondtlsstatechange,delete t.onerror,delete this.transceivers[e].dtlsTransport)},i.prototype._transceive=function(e,n,r){var i=T(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:nu.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),r&&e.rtpReceiver&&0<i.codecs.length&&("video"===e.kind&&e.recvEncodingParameters&&15019>t&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=e.recvEncodingParameters.length?e.recvEncodingParameters:[{}],i.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(i.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},i.prototype.setLocalDescription=function(e){var t=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(R("TypeError",'Unsupported type "'+e.type+'"'));if(!b("setLocalDescription",e.type,t.signalingState)||t._isClosed)return Promise.reject(R("InvalidStateError","Can not set local "+e.type+" in state "+t.signalingState));if("offer"===e.type){var n=nu.splitSections(e.sdp),r=n.shift();n.forEach(function(e,n){e=nu.parseRtpParameters(e),t.transceivers[n].localCapabilities=e}),t.transceivers.forEach(function(e,n){t._gather(e.mid,n)})}else if("answer"===e.type){n=nu.splitSections(t._remoteDescription.sdp),r=n.shift();var i=0<nu.matchPrefix(r,"a=ice-lite").length;n.forEach(function(e,n){var o=t.transceivers[n],s=o.iceGatherer,a=o.iceTransport,c=o.dtlsTransport,u=o.localCapabilities,l=o.remoteCapabilities;if(!(nu.isRejected(e)&&0===nu.matchPrefix(e,"a=bundle-only").length||o.rejected)){var h=nu.getIceParameters(e,r);e=nu.getDtlsParameters(e,r),i&&(e.role="server"),t.usingBundle&&0!==n||(t._gather(o.mid,n),"new"===a.state&&a.start(s,h,i?"controlling":"controlled"),"new"===c.state&&c.start(e)),n=T(u,l),t._transceive(o,0<n.codecs.length,!1)}})}return t._localDescription={type:e.type,sdp:e.sdp},t._updateSignalingState("offer"===e.type?"have-local-offer":"stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(R("TypeError",'Unsupported type "'+i.type+'"'));if(!b("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(R("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var s={};o.remoteStreams.forEach(function(e){s[e.id]=e});var a=[],c=nu.splitSections(i.sdp),u=c.shift(),l=0<nu.matchPrefix(u,"a=ice-lite").length,h=0<nu.matchPrefix(u,"a=group:BUNDLE ").length;o.usingBundle=h;var d=nu.matchPrefix(u,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!d&&0<=d.substr(14).split(" ").indexOf("trickle"),c.forEach(function(r,c){var d=nu.splitLines(r),p=nu.getKind(r),f=nu.isRejected(r)&&0===nu.matchPrefix(r,"a=bundle-only").length,m=d[0].substr(2).split(" ")[2];d=nu.getDirection(r,u);var g=nu.parseMsid(r),_=nu.getMid(r)||nu.generateIdentifier();if(f||"application"===p&&("DTLS/SCTP"===m||"UDP/DTLS/SCTP"===m))o.transceivers[c]={mid:_,kind:p,protocol:m,rejected:!0};else{var v,y;!f&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(p,!0));var E,S,b=nu.parseRtpParameters(r);f||(E=nu.getIceParameters(r,u),(S=nu.getDtlsParameters(r,u)).role="client"),m=nu.parseRtpEncodingParameters(r);var R=nu.parseRtcpParameters(r),I=0<nu.matchPrefix(r,"a=end-of-candidates",u).length;if(r=nu.matchPrefix(r,"a=candidate:").map(function(e){return nu.parseCandidate(e)}).filter(function(e){return 1===e.component}),("offer"===i.type||"answer"===i.type)&&!f&&h&&0<c&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||f){if("answer"===i.type&&!f){p=(v=o.transceivers[c]).iceGatherer;var C=v.iceTransport,A=v.dtlsTransport,O=v.rtpReceiver;f=v.sendEncodingParameters,_=v.localCapabilities,o.transceivers[c].recvEncodingParameters=m,o.transceivers[c].remoteCapabilities=b,o.transceivers[c].rtcpParameters=R,r.length&&"new"===C.state&&(!l&&!I||h&&0!==c?r.forEach(function(e){w(v.iceTransport,e)}):C.setRemoteCandidates(r)),h&&0!==c||("new"===C.state&&C.start(p,E,"controlling"),"new"===A.state&&A.start(S)),!T(v.localCapabilities,v.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&v.sendEncodingParameters[0].rtx&&delete v.sendEncodingParameters[0].rtx,o._transceive(v,"sendrecv"===d||"recvonly"===d,"sendrecv"===d||"sendonly"===d),!O||"sendrecv"!==d&&"sendonly"!==d?delete v.rtpReceiver:(y=O.track,g?(s[g.stream]||(s[g.stream]=new e.MediaStream),n(y,s[g.stream]),a.push([y,O,s[g.stream]])):(s.default||(s.default=new e.MediaStream),n(y,s.default),a.push([y,O,s.default])))}}else(v=o.transceivers[c]||o._createTransceiver(p)).mid=_,v.iceGatherer||(v.iceGatherer=o._createIceGatherer(c,h)),r.length&&"new"===v.iceTransport.state&&(!I||h&&0!==c?r.forEach(function(e){w(v.iceTransport,e)}):v.iceTransport.setRemoteCandidates(r)),_=e.RTCRtpReceiver.getCapabilities(p),15019>t&&(_.codecs=_.codecs.filter(function(e){return"rtx"!==e.name})),f=v.sendEncodingParameters||[{ssrc:1001*(2*c+2)}],E=!1,"sendrecv"===d||"sendonly"===d?(E=!v.rtpReceiver,O=v.rtpReceiver||new e.RTCRtpReceiver(v.dtlsTransport,p),E&&(y=O.track,g&&"-"===g.stream||(g?(s[g.stream]||(s[g.stream]=new e.MediaStream,Object.defineProperty(s[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(y,"id",{get:function(){return g.track}}),C=s[g.stream]):(s.default||(s.default=new e.MediaStream),C=s.default)),C&&(n(y,C),v.associatedRemoteMediaStreams.push(C)),a.push([y,O,C]))):v.rtpReceiver&&v.rtpReceiver.track&&(v.associatedRemoteMediaStreams.forEach(function(t){var n=t.getTracks().find(function(e){return e.id===v.rtpReceiver.track.id});n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)}),v.associatedRemoteMediaStreams=[]),v.localCapabilities=_,v.remoteCapabilities=b,v.rtpReceiver=O,v.rtcpParameters=R,v.sendEncodingParameters=f,v.recvEncodingParameters=m,o._transceive(o.transceivers[c],!1,E)}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o._remoteDescription={type:i.type,sdp:i.sdp},o._updateSignalingState("offer"===i.type?"have-remote-offer":"stable"),Object.keys(s).forEach(function(t){var n=s[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){o._dispatchEvent("addstream",i)})}a.forEach(function(e){n.id===e[2].id&&r(o,e[0],e[1],[n])})}}),a.forEach(function(e){e[2]||r(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(e){this.signalingState=e,e=new Event("signalingstatechange"),this._dispatchEvent("signalingstatechange",e)},i.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},i.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++}),e="new",0<t.failed?e="failed":0<t.checking?e="checking":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected?e="connected":0<t.completed&&(e="completed"),e!==this.iceConnectionState&&(this.iceConnectionState=e,e=new Event("iceconnectionstatechange"),this._dispatchEvent("iceconnectionstatechange",e))},i.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach(function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":0<t.connected&&(e="connected"),e!==this.connectionState&&(this.connectionState=e,e=new Event("connectionstatechange"),this._dispatchEvent("connectionstatechange",e))},i.prototype.createOffer=function(n){var r=this;if(r._isClosed)return Promise.reject(R("InvalidStateError","Can not call createOffer after close"));var i=r.transceivers.filter(function(e){return"audio"===e.kind}).length,o=r.transceivers.filter(function(e){return"video"===e.kind}).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(i=!0===n.offerToReceiveAudio?1:!1===n.offerToReceiveAudio?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(o=!0===n.offerToReceiveVideo?1:!1===n.offerToReceiveVideo?0:n.offerToReceiveVideo)}for(r.transceivers.forEach(function(e){"audio"===e.kind?0>--i&&(e.wantReceive=!1):"video"===e.kind&&0>--o&&(e.wantReceive=!1)});0<i||0<o;)0<i&&(r._createTransceiver("audio"),i--),0<o&&(r._createTransceiver("video"),o--);var s=nu.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);return r.transceivers.forEach(function(n,i){var o=n.track,s=n.kind,a=n.mid||nu.generateIdentifier();n.mid=a,n.iceGatherer||(n.iceGatherer=r._createIceGatherer(i,r.usingBundle)),a=e.RTCRtpSender.getCapabilities(s),15019>t&&(a.codecs=a.codecs.filter(function(e){return"rtx"!==e.name})),a.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),a.headerExtensions.forEach(function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})}),i=n.sendEncodingParameters||[{ssrc:1001*(2*i+1)}],o&&15019<=t&&"video"===s&&!i[0].rtx&&(i[0].rtx={ssrc:i[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,s)),n.localCapabilities=a,n.sendEncodingParameters=i}),"max-compat"!==r._config.bundlePolicy&&(s+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",r.transceivers.forEach(function(e,t){s+=S(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),s+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,s+="a="+nu.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))}),n=new e.RTCSessionDescription({type:"offer",sdp:s}),Promise.resolve(n)},i.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(R("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(R("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var r=nu.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(r+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var i=nu.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach(function(e,o){if(!(o+1>i)){if(e.rejected)return"application"===e.kind?r+="DTLS/SCTP"===e.protocol?"m=application 0 DTLS/SCTP 5000\r\n":"m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var s;e.stream&&("audio"===e.kind?s=e.stream.getAudioTracks()[0]:"video"===e.kind&&(s=e.stream.getVideoTracks()[0]),s&&15019<=t&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})),!(o=T(e.localCapabilities,e.remoteCapabilities)).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=S(e,o,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var o=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(o)},i.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,i){if(!n._remoteDescription)return i(R("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var s=0;s<n.transceivers.length;s++)if(n.transceivers[s].mid===e.sdpMid){o=s;break}var a=n.transceivers[o];if(!a)return i(R("OperationError","Can not add ICE candidate"));if(a.rejected)return r();if("tcp"===(s=0<Object.keys(e.candidate).length?nu.parseCandidate(e.candidate):{}).protocol&&(0===s.port||9===s.port)||s.component&&1!==s.component)return r();if((0===o||0<o&&a.iceTransport!==n.transceivers[0].iceTransport)&&!w(a.iceTransport,s))return i(R("OperationError","Can not add ICE candidate"));0===(i=e.candidate.trim()).indexOf("a=")&&(i=i.substr(2)),(t=nu.getMediaSections(n._remoteDescription.sdp))[o]+="a="+(s.type?i:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=nu.getDescription(n._remoteDescription.sdp)+t.join("")}else for(o=0;o<n.transceivers.length&&(n.transceivers[o].rejected||(n.transceivers[o].iceTransport.addRemoteCandidate({}),(t=nu.getMediaSections(n._remoteDescription.sdp))[o]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=nu.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));o++);r()})},i.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw R("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){if((t=e[t])&&t.prototype&&t.prototype.getStats){var n=t.prototype.getStats;t.prototype.getStats=function(){return n.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])}),t})}}});var o=["createOffer","createAnswer"];return o.forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=i.prototype[e];i.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),i},iu=Object.freeze({__proto__:null,shimPeerConnection:A,shimReplaceTrack:O,shimGetUserMedia:I,shimGetDisplayMedia:C}),ou=Object.freeze({__proto__:null,shimOnTrack:k,shimPeerConnection:D,shimSenderGetStats:P,shimReceiverGetStats:L,shimRemoveStream:x,shimRTCDataChannel:M,shimGetUserMedia:N,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){return n&&n.video?(!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)):((n=new DOMException("getDisplayMedia without video constraints is undefined")).name="NotFoundError",n.code=8,ic.reject(n))})}}),su=Object.freeze({__proto__:null,shimLocalStreamsAPI:U,shimRemoteStreamsAPI:V,shimCallbacksAPI:F,shimGetUserMedia:B,shimConstraints:j,shimRTCIceServerUrls:G,shimTrackEventTransceiver:q,shimCreateOfferLegacy:H}),au=Object.freeze({__proto__:null,shimRTCIceCandidate:W,shimMaxMessageSize:z,shimSendThrowTypeError:K,shimConnectionState:Y,removeAllowExtmapMixed:Q});!function({window:e}={},n={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){let r=c(e),a={browserDetails:r,commonShim:au,extractVersion:t,disableLog:i,disableWarnings:o};switch(r.browser){case"chrome":if(!qc||!y||!n.shimChrome)return s("Chrome shim is not included in this adapter release."),a;s("adapter.js shimming chrome."),a.browserShim=qc,h(e),d(e),y(e),p(e),v(e),f(e),m(e),g(e),E(e),W(e),Y(e),z(e),K(e),Q(e);break;case"firefox":if(!ou||!D||!n.shimFirefox)return s("Firefox shim is not included in this adapter release."),a;s("adapter.js shimming firefox."),a.browserShim=ou,N(e),D(e),k(e),x(e),P(e),L(e),M(e),W(e),Y(e),z(e),K(e);break;case"edge":if(!iu||!A||!n.shimEdge)return s("MS edge shim is not included in this adapter release."),a;s("adapter.js shimming edge."),a.browserShim=iu,I(e),C(e),A(e),O(e),z(e),K(e);break;case"safari":if(!su||!n.shimSafari)return s("Safari shim is not included in this adapter release."),a;s("adapter.js shimming safari."),a.browserShim=su,G(e),H(e),F(e),U(e),V(e),q(e),B(e),W(e),z(e),K(e),Q(e);break;default:s("Unsupported browser!")}}({window:window}),($c=Jc||(Jc={})).WIN_10="Windows 10",$c.WIN_81="Windows 8.1",$c.WIN_8="Windows 8",$c.WIN_7="Windows 7",$c.WIN_VISTA="Windows Vista",$c.WIN_SERVER_2003="Windows Server 2003",$c.WIN_XP="Windows XP",$c.WIN_2000="Windows 2000",$c.ANDROID="Android",$c.OPEN_BSD="Open BSD",$c.SUN_OS="Sun OS",$c.LINUX="Linux",$c.IOS="iOS",$c.MAC_OS_X="Mac OS X",$c.MAC_OS="Mac OS",$c.QNX="QNX",$c.UNIX="UNIX",$c.BEOS="BeOS",$c.OS_2="OS/2",$c.SEARCH_BOT="Search Bot",function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(Xc||(Xc={}));let cu=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;var t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){var n,r=t[2];return Us(n="".concat(t[1],".")).call(n,r)}return(t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/))&&t[1]&&t[2]?(n=t[2],Us(r="".concat(t[1],".")).call(r,100*(Number(n)+1))):"4.0.0.999"}("4.5.0");try{var uu=!0===JSON.parse("true")}catch($c){uu=!0}let lu=uu,hu={username:"test",password:"111111",turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1},du={"90p":ne(160,90),"90p_1":ne(160,90),"120p":ne(160,120,15,30,65),"120p_1":ne(160,120,15,30,65),"120p_3":ne(120,120,15,30,50),"120p_4":ne(212,120),"180p":ne(320,180,15,30,140),"180p_1":ne(320,180,15,30,140),"180p_3":ne(180,180,15,30,100),"180p_4":ne(240,180,15,30,120),"240p":ne(320,240,15,40,200),"240p_1":ne(320,240,15,40,200),"240p_3":ne(240,240,15,40,140),"240p_4":ne(424,240,15,40,220),"360p":ne(640,360,15,80,400),"360p_1":ne(640,360,15,80,400),"360p_3":ne(360,360,15,80,260),"360p_4":ne(640,360,30,80,600),"360p_6":ne(360,360,30,80,400),"360p_7":ne(480,360,15,80,320),"360p_8":ne(480,360,30,80,490),"360p_9":ne(640,360,15,80,800),"360p_10":ne(640,360,24,80,800),"360p_11":ne(640,360,24,80,1e3),"480p":ne(640,480,15,100,500),"480p_1":ne(640,480,15,100,500),"480p_2":ne(640,480,30,100,1e3),"480p_3":ne(480,480,15,100,400),"480p_4":ne(640,480,30,100,750),"480p_6":ne(480,480,30,100,600),"480p_8":ne(848,480,15,100,610),"480p_9":ne(848,480,30,100,930),"480p_10":ne(640,480,10,100,400),"720p":ne(1280,720,15,120,1130),"720p_1":ne(1280,720,15,120,1130),"720p_2":ne(1280,720,30,120,2e3),"720p_3":ne(1280,720,30,120,1710),"720p_5":ne(960,720,15,120,910),"720p_6":ne(960,720,30,120,1380),"1080p":ne(1920,1080,15,120,2080),"1080p_1":ne(1920,1080,15,120,2080),"1080p_2":ne(1920,1080,30,120,3e3),"1080p_3":ne(1920,1080,30,120,3150),"1080p_5":ne(1920,1080,60,120,4780),"1440p":ne(2560,1440,30,120,4850),"1440p_1":ne(2560,1440,30,120,4850),"1440p_2":ne(2560,1440,60,120,7350),"4k":ne(3840,2160,30,120,8910),"4k_1":ne(3840,2160,30,120,8910),"4k_3":ne(3840,2160,60,120,13500)},pu={"480p":re(640,480,5),"480p_1":re(640,480,5),"480p_2":re(640,480,30),"480p_3":re(640,480,15),"720p":re(1280,720,5),"720p_1":re(1280,720,5),"720p_2":re(1280,720,30),"720p_3":re(1280,720,15),"1080p":re(1920,1080,5),"1080p_1":re(1920,1080,5),"1080p_2":re(1920,1080,30),"1080p_3":re(1920,1080,15)},fu={"1SL1TL":ie(1,1),"3SL3TL":ie(3,3),"2SL3TL":ie(2,3)},mu={speech_low_quality:te(16e3,!1),speech_standard:te(32e3,!1,18),music_standard:te(48e3,!1),standard_stereo:te(48e3,!0,56),high_quality:te(48e3,!1,128),high_quality_stereo:te(48e3,!0,192)},gu={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_TIMEOUT:1e4,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!0,PING_PONG_TIME_OUT:10,DUALSTREAM_OPERATION_CHECK:!0,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:5e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,SHOW_REPORT_INVOKER_LOG:!1,STATS_FILTER:{transportId:!0,googTrackId:!0},JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:"webrtc-cloud-proxy.sd-rtn.com",CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3};lu||(gu.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],gu.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],gu.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],gu.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],gu.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],gu.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],gu.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",gu.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",gu.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",gu.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",gu.AREAS=["NORTH_AMERICA","OVERSEA"]);let _u=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],vu=[];var yu=[],Eu=yu.sort,Su=Pn(function(){yu.sort(void 0)}),Tu=Pn(function(){yu.sort(null)}),bu=Ho("sort");mr({target:"Array",proto:!0,forced:Su||!Tu||bu},{sort:function(e){return void 0===e?Eu.call(ci(this)):Eu.call(ci(this),ar(e))}});var wu=Bo("Array").sort,Ru=Array.prototype,Iu=function(e){var t=e.sort;return e===Ru||e instanceof Array&&t===Ru.sort?wu:t};mr({target:"Array",stat:!0},{isArray:ui});var Cu,Au=sr.Array.isArray;!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR"}(Cu||(Cu={}));var Ou=function(e,t){return function(){for(var n=Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},Nu=Object.prototype.toString,ku={isArray:oe,isArrayBuffer:function(e){return"[object ArrayBuffer]"===Nu.call(e)},isBuffer:function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:se,isUndefined:function(e){return void 0===e},isDate:function(e){return"[object Date]"===Nu.call(e)},isFile:function(e){return"[object File]"===Nu.call(e)},isBlob:function(e){return"[object Blob]"===Nu.call(e)},isFunction:ae,isStream:function(e){return se(e)&&ae(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:ce,merge:function e(){function t(t,r){n[r]="object"==typeof n[r]&&"object"==typeof t?e(n[r],t):t}for(var n={},r=0,i=arguments.length;r<i;r++)ce(arguments[r],t);return n},deepMerge:function e(){function t(t,r){n[r]="object"==typeof n[r]&&"object"==typeof t?e(n[r],t):"object"==typeof t?e({},t):t}for(var n={},r=0,i=arguments.length;r<i;r++)ce(arguments[r],t);return n},extend:function(e,t,n){return ce(t,function(t,r){e[r]=n&&"function"==typeof t?Ou(t,n):t}),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}},Du=function(e,t,n){if(!t)return e;if(n)t=n(t);else if(ku.isURLSearchParams(t))t=t.toString();else{var r=[];ku.forEach(t,function(e,t){null!=e&&(ku.isArray(e)?t+="[]":e=[e],ku.forEach(e,function(e){ku.isDate(e)?e=e.toISOString():ku.isObject(e)&&(e=JSON.stringify(e)),r.push(ue(t)+"="+ue(e))}))}),t=r.join("&")}return t&&(-1!==(n=e.indexOf("#"))&&(e=e.slice(0,n)),e+=(-1===e.indexOf("?")?"?":"&")+t),e};le.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},le.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},le.prototype.forEach=function(e){ku.forEach(this.handlers,function(t){null!==t&&e(t)})};var Pu,Lu=le,xu=function(e,t,n){return ku.forEach(n,function(n){e=n(e,t)}),e},Mu=function(e){return!(!e||!e.__CANCEL__)},Uu=function(e,t){ku.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})},Vu=function(e,t,n,r,i){return function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(Error(e),t,n,r,i)},Fu="age authorization content-length content-type etag expires from host if-modified-since if-unmodified-since last-modified location max-forwards proxy-authorization referer retry-after user-agent".split(" "),Bu=ku.isStandardBrowserEnv()?function(){function e(e){return n&&(r.setAttribute("href",e),e=r.href),r.setAttribute("href",e),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}var t,n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");return t=e(window.location.href),function(n){return(n=ku.isString(n)?e(n):n).protocol===t.protocol&&n.host===t.host}}():function(){return!0},ju=ku.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var s=[];s.push(e+"="+encodeURIComponent(t)),ku.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),ku.isString(r)&&s.push("path="+r),ku.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){return(e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)")))?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Gu={"Content-Type":"application/x-www-form-urlencoded"},qu={adapter:(("undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)||"undefined"!=typeof XMLHttpRequest)&&(Pu=function(e){return new Promise(function(t,n){var r=e.data,i=e.headers;ku.isFormData(r)&&delete i["Content-Type"];var o=new XMLHttpRequest;if(e.auth&&(i.Authorization="Basic "+btoa((e.auth.username||"")+":"+(e.auth.password||""))),o.open(e.method.toUpperCase(),Du(e.url,e.params,e.paramsSerializer),!0),o.timeout=e.timeout,o.onreadystatechange=function(){if(o&&4===o.readyState&&(0!==o.status||o.responseURL&&0===o.responseURL.indexOf("file:"))){var r,i,s,a,c,u="getAllResponseHeaders"in o?(r=o.getAllResponseHeaders(),c={},r?(ku.forEach(r.split("\n"),function(e){a=e.indexOf(":"),i=ku.trim(e.substr(0,a)).toLowerCase(),s=ku.trim(e.substr(a+1)),!i||c[i]&&0<=Fu.indexOf(i)||(c[i]="set-cookie"===i?(c[i]?c[i]:[]).concat([s]):c[i]?c[i]+", "+s:s)}),c):c):null;!function(e,t,n){var r=n.config.validateStatus;!r||r(n.status)?e(n):t(Vu("Request failed with status code "+n.status,n.config,null,n.request,n))}(t,n,{data:e.responseType&&"text"!==e.responseType?o.response:o.responseText,status:o.status,statusText:o.statusText,headers:u,config:e,request:o}),o=null}},o.onabort=function(){o&&(n(Vu("Request aborted",e,"ECONNABORTED",o)),o=null)},o.onerror=function(){n(Vu("Network Error",e,null,o)),o=null},o.ontimeout=function(){n(Vu("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",o)),o=null},ku.isStandardBrowserEnv()){var s=(e.withCredentials||Bu(e.url))&&e.xsrfCookieName?ju.read(e.xsrfCookieName):void 0;s&&(i[e.xsrfHeaderName]=s)}if("setRequestHeader"in o&&ku.forEach(i,function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete i[t]:o.setRequestHeader(t,e)}),e.withCredentials&&(o.withCredentials=!0),e.responseType)try{o.responseType=e.responseType}catch(a){if("json"!==e.responseType)throw a}"function"==typeof e.onDownloadProgress&&o.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&o.upload&&o.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){o&&(o.abort(),n(e),o=null)}),void 0===r&&(r=null),o.send(r)})}),Pu),transformRequest:[function(e,t){return Uu(t,"Accept"),Uu(t,"Content-Type"),ku.isFormData(e)||ku.isArrayBuffer(e)||ku.isBuffer(e)||ku.isStream(e)||ku.isFile(e)||ku.isBlob(e)?e:ku.isArrayBufferView(e)?e.buffer:ku.isURLSearchParams(e)?(he(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):ku.isObject(e)?(he(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(t){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&300>e},headers:{common:{Accept:"application/json, text/plain, */*"}}};ku.forEach(["delete","get","head"],function(e){qu.headers[e]={}}),ku.forEach(["post","put","patch"],function(e){qu.headers[e]=ku.merge(Gu)});var Hu=function(e){var t,n;return e.cancelToken&&e.cancelToken.throwIfRequested(),e.baseURL&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e.url)&&(e.url=(t=e.baseURL,(n=e.url)?t.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):t)),e.headers=e.headers||{},e.data=xu(e.data,e.headers,e.transformRequest),e.headers=ku.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),ku.forEach("delete get head post put patch common".split(" "),function(t){delete e.headers[t]}),(e.adapter||qu.adapter)(e).then(function(t){return e.cancelToken&&e.cancelToken.throwIfRequested(),t.data=xu(t.data,t.headers,e.transformResponse),t},function(t){return Mu(t)||(e.cancelToken&&e.cancelToken.throwIfRequested(),t&&t.response&&(t.response.data=xu(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},Wu=function(e,t){t=t||{};var n={};return ku.forEach(["url","method","params","data"],function(e){void 0!==t[e]&&(n[e]=t[e])}),ku.forEach(["headers","auth","proxy"],function(r){ku.isObject(t[r])?n[r]=ku.deepMerge(e[r],t[r]):void 0!==t[r]?n[r]=t[r]:ku.isObject(e[r])?n[r]=ku.deepMerge(e[r]):void 0!==e[r]&&(n[r]=e[r])}),ku.forEach("baseURL transformRequest transformResponse paramsSerializer timeout withCredentials adapter responseType xsrfCookieName xsrfHeaderName onUploadProgress onDownloadProgress maxContentLength validateStatus maxRedirects httpAgent httpsAgent cancelToken socketPath".split(" "),function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])}),n};de.prototype.request=function(e,t){"string"==typeof e?(e=t||{}).url=e:e=e||{},(e=Wu(this.defaults,e)).method=e.method?e.method.toLowerCase():"get";var n=[Hu,void 0];for(e=Promise.resolve(e),this.interceptors.request.forEach(function(e){n.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){n.push(e.fulfilled,e.rejected)});n.length;)e=e.then(n.shift(),n.shift());return e},de.prototype.getUri=function(e){return e=Wu(this.defaults,e),Du(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},ku.forEach(["delete","get","head","options"],function(e){de.prototype[e]=function(t,n){return this.request(ku.merge(n||{},{method:e,url:t}))}}),ku.forEach(["post","put","patch"],function(e){de.prototype[e]=function(t,n,r){return this.request(ku.merge(r||{},{method:e,url:t,data:n}))}});var zu=de;pe.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},pe.prototype.__CANCEL__=!0;var Ku=pe;fe.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},fe.source=function(){var e;return{token:new fe(function(t){e=t}),cancel:e}};var Yu=me(qu);Yu.Axios=zu,Yu.create=function(e){return me(Wu(Yu.defaults,e))},Yu.Cancel=Ku,Yu.CancelToken=fe,Yu.isCancel=Mu,Yu.all=function(e){return Promise.all(e)},Yu.spread=function(e){return function(t){return e.apply(null,t)}};var Qu=Yu.default=Yu;let Ju={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Xu=e=>{for(const t in Ju)if(Ju[t]===e)return t;return"DEFAULT"},$u=new class{constructor(){this.logLevel=Ju.DEBUG,this.uploadState="collecting",this.uploadLogWaitingList=[],this.uploadLogUploadingList=[],this.currentLogID=this.uploadErrorCount=0}debug(...e){var t;e=Us(t=[Ju.DEBUG]).call(t,e),this.log.apply(this,e)}info(...e){var t;e=Us(t=[Ju.INFO]).call(t,e),this.log.apply(this,e)}warning(...e){var t;e=Us(t=[Ju.WARNING]).call(t,e),this.log.apply(this,e)}error(...e){var t;e=Us(t=[Ju.ERROR]).call(t,e),this.log.apply(this,e)}setLogLevel(e){this.logLevel=e=Math.min(Math.max(0,e),4)}enableLogUpload(){ee("UPLOAD_LOG",!0)}disableLogUpload(){ee("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}log(...e){var t,n,r,i;const o=Math.max(0,Math.min(4,e[0]));if(e[0]=ge()+" Agora-SDK [".concat(Xu(o),"]:"),this.appendLogToWaitingList(o,e),!(o<this.logLevel)){var s=ge()+" %cAgora-SDK [".concat(Xu(o),"]:");switch(o){case Ju.DEBUG:e=Us(t=[s,"color: #64B5F6;"]).call(t,wc(e).call(e,1)),console.log.apply(console,e);break;case Ju.INFO:e=Us(n=[s,"color: #1E88E5; font-weight: bold;"]).call(n,wc(e).call(e,1)),console.log.apply(console,e);break;case Ju.WARNING:e=Us(r=[s,"color: #FB8C00; font-weight: bold;"]).call(r,wc(e).call(e,1)),console.warn.apply(console,e);break;case Ju.ERROR:e=Us(i=[s,"color: #B00020; font-weight: bold;"]).call(i,wc(e).call(e,1)),console.error.apply(console,e)}}}appendLogToWaitingList(e,...t){if(gu.UPLOAD_LOG){var n="";Qo(t).call(t,e=>{"object"==typeof e&&(e=wr(e)),n+="".concat(e," ")}),this.uploadLogWaitingList.push({payload_str:n,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}uploadLogs(){var e=this;return r(function*(){var t,n={sdk_version:cu,process_id:gu.PROCESS_ID,payload:wr(e.uploadLogUploadingList)};if("OK"!==(n=yield Qu.post(e.url||(e.proxyServerURL?Us(t="https://".concat(e.proxyServerURL,"/ls/?h=")).call(t,gu.LOG_UPLOAD_SERVER,"&p=443&d=upload/v1"):"https://".concat(gu.LOG_UPLOAD_SERVER,"/upload/v1")),n,{responseType:"text"})).data)throw Error("unexpected upload log response: "+n.data);e.uploadLogUploadingList=[]})()}uploadLogInterval(){var e;0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=dc(e=this.uploadLogWaitingList).call(e,0,10)),this.uploadLogs().then(()=>{this.uploadErrorCount=0,0<this.uploadLogWaitingList.length&&window.setTimeout(()=>this.uploadLogInterval(),3e3)}).catch(e=>{this.uploadErrorCount+=1,2>this.uploadErrorCount?window.setTimeout(()=>this.uploadLogInterval(),200):window.setTimeout(()=>this.uploadLogInterval(),1e3)}))}};class Zu{constructor(e,t="",n){var r;this.name="AgoraRTCException",this.code=e,this.message=Us(r="AgoraRTCError ".concat(this.code,": ")).call(r,t),this.data=n}toString(){var e;return this.data?Us(e="".concat(this.message," data: ")).call(e,wr(this.data)):this.message}print(){return $u.error(this.toString()),this}throw(){throw this.print(),this}}var el,tl;!function(e){e.FREE="free",e.UPLOADING="uploading"}(el||(el={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied"}(tl||(tl={})),mr({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),mr({target:"Number",stat:!0},{MIN_SAFE_INTEGER:-9007199254740991});let nl={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var rl,il,ol,sl,al,cl,ul,ll,hl,dl,pl,fl,ml,gl,_l,vl,yl,El,Sl,Tl,bl;!function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics"}(rl||(rl={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAT="io.agora.pb.Wrtc.JoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics"}(il||(il={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(ol||(ol={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange"}(sl||(sl={})),(al||(al={})).TRACER="tracer",function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(cl||(cl={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(ul||(ul={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(ll||(ll={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(hl||(hl={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(dl||(dl={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(pl||(pl={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(fl||(fl={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error"}(ml||(ml={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE"}(gl||(gl={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(_l||(_l={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success"}(vl||(vl={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v2",e.REJOIN="rejoin",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.UNSUBSCRIBE="unsubscribe",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer"}(yl||(yl={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats"}(El||(El={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio"}(Sl||(Sl={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(Tl||(Tl={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer"}(bl||(bl={}));let wl={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0},Rl={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0},Il={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,publishDuration:-1},Cl={uplinkNetworkQuality:0,downlinkNetworkQuality:0},Al={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,publishDuration:-1};var Ol,Nl;!function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls"}(Ol||(Ol={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(Nl||(Nl={}));let kl={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Dl={x:0,y:0,width:160,height:160,zOrder:255,alpha:1},Pl={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Ll={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var xl,Ml,Ul,Vl,Fl,Bl,jl,Gl,ql,Hl;!function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(xl||(xl={})),(Ml||(Ml={})).REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Ul||(Ul={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(Vl||(Vl={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(Fl||(Fl={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid"}(Bl||(Bl={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ADD_TRACK="@need_add_track",e.NEED_REMOVE_TRACK="@need_remove_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp"}(jl||(jl={})),function(e){e.SCREEN_TRACK="screen_track",e.LOW_STREAM="low_stream"}(Gl||(Gl={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload"}(ql||(ql={})),(Hl||(Hl={})).FIRST_FRAME_DECODED="first-frame-decoded";let Wl="AFRICA ASIA CHINA EUROPE GLOBAL INDIA JAPAN NORTH_AMERICA OCEANIA OVERSEA SOUTH_AMERICA".split(" ");var zl;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(zl||(zl={}));let Kl={CHINA:{},ASIA:{CODE:zl.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:zl.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:zl.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:zl.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:zl.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:zl.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:zl.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:zl.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:zl.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:zl.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]}};var Yl;lu&&(Kl.CHINA={CODE:zl.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),(Yl||(Yl={})).UPDATE_BITRATE_LIMIT="update_bitrate_limit";let Ql={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1};mr({target:"Object",stat:!0,forced:!Ln,sham:!Ln},{defineProperties:zi});var Jl=e(function(e){var t=sr.Object;e=e.exports=function(e,n){return t.defineProperties(e,n)},t.defineProperties.sham&&(e.sham=!0)}),Xl=Hi.concat("length","prototype"),$l={f:Object.getOwnPropertyNames||function(e){return qi(e,Xl)}},Zl=_r("Reflect","ownKeys")||function(e){var t=$l.f(ur(e)),n=Jo.f;return n?t.concat(n(e)):t};mr({target:"Object",stat:!0,sham:!Ln},{getOwnPropertyDescriptors:function(e){var t,n;e=Hn(e);for(var r=Zn,i=Zl(e),o={},s=0;i.length>s;)void 0!==(n=r(e,t=i[s++]))&&ws(o,t,n);return o}});var eh=sr.Object.getOwnPropertyDescriptors,th=$l.f,nh={}.toString,rh="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ih=function(e){if(rh&&"[object Window]"==nh.call(e))try{var t=th(e)}catch(n){t=rh.slice()}else t=th(Hn(e));return t},oh={f:Vr},sh=hr.f,ah=wi("hidden"),ch=Vr("toPrimitive"),uh=Pi.set,lh=Pi.getterFor("Symbol"),hh=Object.prototype,dh=Dn.Symbol,ph=_r("JSON","stringify"),fh=Zn,mh=hr.f,gh=ih,_h=Un,vh=Dr("symbols"),yh=Dr("op-symbols"),Eh=Dr("string-to-symbol-registry"),Sh=Dr("symbol-to-string-registry"),Th=Dr("wks"),bh=Dn.QObject,wh=!bh||!bh.prototype||!bh.prototype.findChild,Rh=Ln&&Pn(function(){return 7!=Xi(mh({},"a",{get:function(){return mh(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=fh(hh,t);r&&delete hh[t],mh(e,t,n),r&&e!==hh&&mh(hh,t,r)}:mh,Ih=function(e,t){var n=vh[e]=Xi(dh.prototype);return uh(n,{type:"Symbol",tag:e,description:t}),Ln||(n.description=t),n},Ch=Pr&&"symbol"==typeof dh.iterator?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof dh},Ah=function(e,t,n){return e===hh&&Ah(yh,t,n),ur(e),t=zn(t,!0),ur(n),Yn(vh,t)?(n.enumerable?(Yn(e,ah)&&e[ah][t]&&(e[ah][t]=!1),n=Xi(n,{enumerable:Vn(0,!1)})):(Yn(e,ah)||mh(e,ah,Vn(1,{})),e[ah][t]=!0),Rh(e,t,n)):mh(e,t,n)},Oh=function(e,t){ur(e);var n=Hn(t);return t=Wi(n).concat(Ph(n)),fi(t,function(t){Ln&&!Nh.call(n,t)||Ah(e,t,n[t])}),e},Nh=function(e){e=zn(e,!0);var t=_h.call(this,e);return!(this===hh&&Yn(vh,e)&&!Yn(yh,e))&&(!(t||!Yn(this,e)||!Yn(vh,e)||Yn(this,ah)&&this[ah][e])||t)},kh=function(e,t){if(e=Hn(e),t=zn(t,!0),e!==hh||!Yn(vh,t)||Yn(yh,t)){var n=fh(e,t);return!n||!Yn(vh,t)||Yn(e,ah)&&e[ah][t]||(n.enumerable=!0),n}},Dh=function(e){e=gh(Hn(e));var t=[];return fi(e,function(e){Yn(vh,e)||Yn(Rr,e)||t.push(e)}),t},Ph=function(e){var t=e===hh;e=gh(t?yh:Hn(e));var n=[];return fi(e,function(e){!Yn(vh,e)||t&&!Yn(hh,e)||n.push(vh[e])}),n};if(Pr||(to((dh=function(){if(this instanceof dh)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ar(e),n=function(e){this===hh&&n.call(yh,e),Yn(this,ah)&&Yn(this[ah],t)&&(this[ah][t]=!1),Rh(this,t,Vn(1,e))};return Ln&&wh&&Rh(hh,t,{configurable:!0,set:n}),Ih(t,e)}).prototype,"toString",function(){return lh(this).tag}),Un=Nh,hr.f=Ah,Zn=kh,$l.f=ih=Dh,Jo.f=Ph,Ln&&mh(dh.prototype,"description",{configurable:!0,get:function(){return lh(this).description}})),Lr||(oh.f=function(e){return Ih(Vr(e),e)}),mr({global:!0,wrap:!0,forced:!Pr,sham:!Pr},{Symbol:dh}),fi(Wi(Th),function(e){var t=sr.Symbol||(sr.Symbol={});Yn(t,e)||sh(t,e,{value:oh.f(e)})}),mr({target:"Symbol",stat:!0,forced:!Pr},{for:function(e){if(e=String(e),Yn(Eh,e))return Eh[e];var t=dh(e);return Eh[e]=t,Sh[t]=e,t},keyFor:function(e){if(!Ch(e))throw TypeError(e+" is not a symbol");if(Yn(Sh,e))return Sh[e]},useSetter:function(){wh=!0},useSimple:function(){wh=!1}}),mr({target:"Object",stat:!0,forced:!Pr,sham:!Ln},{create:function(e,t){return void 0===t?Xi(e):Oh(Xi(e),t)},defineProperty:Ah,defineProperties:Oh,getOwnPropertyDescriptor:kh}),mr({target:"Object",stat:!0,forced:!Pr},{getOwnPropertyNames:Dh,getOwnPropertySymbols:Ph}),mr({target:"Object",stat:!0,forced:Pn(function(){Jo.f(1)})},{getOwnPropertySymbols:function(e){return Jo.f(ci(e))}}),ph){var Lh=!Pr||Pn(function(){var e=dh();return"[null]"!=ph([e])||"{}"!=ph({a:e})||"{}"!=ph(Object(e))});mr({target:"JSON",stat:!0,forced:Lh},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(Wn(t)||void 0!==e)&&!Ch(e))return ui(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ch(t))return t}),i[1]=t,ph.apply(null,i)}})}dh.prototype[ch]||dr(dh.prototype,ch,dh.prototype.valueOf),ai(dh,"Symbol"),Rr[ah]=!0;var xh=sr.Object.getOwnPropertySymbols,Mh=function(e,t,n){return t in e?as(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},Uh=Bo("Array").values,Vh=Array.prototype,Fh={DOMTokenList:!0,NodeList:!0},Bh=function(e){var t=e.values;return e===Vh||e instanceof Array&&t===Vh.values||Fh.hasOwnProperty($r(e))?Uh:t},jh=!Qs(function(e){Array.from(e)});mr({target:"Array",stat:!0,forced:jh},{from:function(e){var t=ci(e),n="function"==typeof this?this:Array,r=arguments.length,i=1<r?arguments[1]:void 0,o=void 0!==i,s=0,a=ei(t);if(o&&(i=cr(i,2<r?arguments[2]:void 0,2)),null==a||n==Array&&Gr(a))for(n=new n(r=Kr(t.length));r>s;s++)ws(n,s,o?i(t[s],s):t[s]);else for(r=(t=a.call(t)).next,n=new n;!(a=r.call(t)).done;s++)ws(n,s,o?ti(t,i,[a.value,s],!0):a.value);return n.length=s,n}});var Gh=sr.Array.from;mr({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}});var qh=sr.Date.now;class Hh{constructor(){this._events={},this.addListener=this.on}getListeners(e){var t;return this._events[e]?ac(t=this._events[e]).call(t,e=>e.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]),-1===this._indexOfListener(e=this._events[e],t)&&e.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]),-1===this._indexOfListener(e=this._events[e],t)&&e.push({listener:t,once:!0})}off(e,t){if(this._events[e]){var n=this._events[e];-1!==(t=this._indexOfListener(n,t))&&dc(n).call(n,t,1),0===this._events[e].length&&delete this._events[e]}}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e,...t){var n;this._events[e]||(this._events[e]=[]);let r=ac(n=this._events[e]).call(n,e=>e);for(n=0;n<r.length;n+=1){let i=r[n];i.once&&this.off(e,i.listener),i.listener.apply(this,t||[])}}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}class Wh extends Hh{constructor(){super(...arguments),this.resultStorage=new Do}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){e=e.getUserId(),this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",e,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){e=e.getUserId(),this.record("RECV_VIDEO_DECODE_FAILED",e,this.checkVideoDecode(t))}record(e,t,n){this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});let r=this.resultStorage.get(e);var i;r&&(r.result.push(n),5<=r.result.length)&&(n=Vc(i=r.result).call(i,!0),r.isPrevNormal&&!n&&this.emit("exception",zh[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",zh[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[])}checkAudioOutputLevel(e){return!(0<e.receiveBitrate&&0===e.receiveLevel)}checkAudioInputLevel(e){return 0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;return t._encoderConfig&&t._encoderConfig.frameRate&&(n=je(t._encoderConfig.frameRate)),e=e.captureFrameRate,!n||!e||!(10<n&&5>e||10>n&&5<=n&&1>=e)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&5<e.captureFrameRate&&1>=e.sendFrameRate)}checkSendVideoBitrate(e){return 0!==e.sendBitrate}checkSendAudioBitrate(e){return 0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}let zh={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003};class Kh{constructor(e){this.localConnectionsMap=new Do,this.remoteConnectionsMap=new Do,this.trafficStatsPeerList=[],this.updateStats=()=>{var e,t;Qo(e=this.remoteConnectionsMap).call(e,e=>{var t;let n=e.audioStats;var r=e.videoStats,i=e.pcStats;let o=Fe({},Il),s=Fe({},Al),a=Fe({},Cl),c=e.connection.pc.getStats(),u=c.audioRecv[0],l=c.videoRecv[0];i=i?i.videoRecv[0]:void 0;let h=!0===e.connection.pc._statsFilter.videoIsReady,d=this.trafficStats&&Ac(t=this.trafficStats.peer_delay).call(t,t=>t.peer_uid===e.connection.getUserId());u&&("opus"!==u.codec&&"aac"!==u.codec||(o.codecType=u.codec),u.outputLevel?o.receiveLevel=Math.round(32767*u.outputLevel):e.connection.user.audioTrack&&(o.receiveLevel=Math.round(32767*e.connection.user.audioTrack.getVolumeLevel())),o.receiveBytes=u.bytes,o.receivePackets=u.packets,o.receivePacketsLost=u.packetsLost,o.packetLossRate=o.receivePacketsLost/(o.receivePackets+o.receivePacketsLost),o.receiveBitrate=n?8*Math.max(0,o.receiveBytes-n.receiveBytes):0,o.totalDuration=n?n.totalDuration+1:1,o.totalFreezeTime=n?n.totalFreezeTime:0,o.freezeRate=o.totalFreezeTime/o.totalDuration,o.receiveDelay=u.jitterBufferMs,t=e.connection.user.audioTrack,10<o.totalDuration&&Kh.isRemoteAudioFreeze(t)&&(o.totalFreezeTime+=1)),l&&("H264"!==l.codec&&"VP8"!==l.codec&&"VP9"!==l.codec&&"AV1X"!==l.codec||(s.codecType=l.codec),s.receiveBytes=l.bytes,s.receiveBitrate=r?8*Math.max(0,s.receiveBytes-r.receiveBytes):0,s.decodeFrameRate=l.decodeFrameRate,s.renderFrameRate=l.decodeFrameRate,l.outputFrame&&(s.renderFrameRate=l.outputFrame.frameRate),l.receivedFrame?(s.receiveFrameRate=l.receivedFrame.frameRate,s.receiveResolutionHeight=l.receivedFrame.height,s.receiveResolutionWidth=l.receivedFrame.width):e.connection.user.videoTrack&&(s.receiveResolutionHeight=e.connection.user.videoTrack._videoHeight||0,s.receiveResolutionWidth=e.connection.user.videoTrack._videoWidth||0),void 0!==l.framesRateFirefox&&(s.receiveFrameRate=Math.round(l.framesRateFirefox)),s.receivePackets=l.packets,s.receivePacketsLost=l.packetsLost,s.packetLossRate=s.receivePacketsLost/(s.receivePackets+s.receivePacketsLost),s.totalDuration=r?r.totalDuration+1:1,s.totalFreezeTime=r?r.totalFreezeTime:0,s.receiveDelay=l.jitterBufferMs||0,r=e.connection.user.videoTrack,e.connection.subscribeOptions.video&&h&&Kh.isRemoteVideoFreeze(r,l,i)&&(s.totalFreezeTime+=1),s.freezeRate=s.totalFreezeTime/s.totalDuration),d&&(o.end2EndDelay=d.B_ad,s.end2EndDelay=d.B_vd,o.transportDelay=d.B_ed,s.transportDelay=d.B_ed,a.uplinkNetworkQuality=d.B_punq?d.B_punq:0,a.downlinkNetworkQuality=d.B_pdnq?d.B_punq:0),e.audioStats=o,e.videoStats=s,e.pcStats=c,e.networkStats=a,e.connection.user.audioTrack&&this.exceptionMonitor.setRemoteAudioStats(e.connection.user.audioTrack,o),e.connection.user.videoTrack&&this.exceptionMonitor.setRemoteVideoStats(e.connection.user.videoTrack,s)}),Qo(t=this.localConnectionsMap).call(t,e=>{let t=e.audioStats,n=e.videoStats,r=Fe({},wl),i=Fe({},Rl);var o=e.connection.pc.getStats();let s=o.audioSend[0];o=o.videoSend[0];let a=e.connection.getUserId();s&&("opus"!==s.codec&&"aac"!==s.codec||(r.codecType=s.codec),s.inputLevel?r.sendVolumeLevel=Math.round(32767*s.inputLevel):e.connection.audioTrack&&(r.sendVolumeLevel=Math.round(32767*e.connection.audioTrack.getVolumeLevel())),r.sendBytes=s.bytes,r.sendPackets=s.packets,r.sendPacketsLost=s.packetsLost,r.sendBitrate=t?8*Math.max(0,r.sendBytes-t.sendBytes):0),o&&("H264"!==o.codec&&"VP8"!==o.codec&&"VP9"!==o.codec&&"AV1X"!==o.codec||(i.codecType=o.codec),i.sendBytes=o.bytes,i.sendBitrate=n?8*Math.max(0,i.sendBytes-n.sendBytes):0,o.inputFrame?(i.captureFrameRate=o.inputFrame.frameRate,i.captureResolutionHeight=o.inputFrame.height,i.captureResolutionWidth=o.inputFrame.width):e.connection.videoTrack&&(i.captureResolutionWidth=e.connection.videoTrack._videoWidth||0,i.captureResolutionHeight=e.connection.videoTrack._videoHeight||0),o.sentFrame?(i.sendFrameRate=o.sentFrame.frameRate,i.sendResolutionHeight=o.sentFrame.height,i.sendResolutionWidth=o.sentFrame.width):e.connection.videoTrack&&(i.sendResolutionWidth=e.connection.videoTrack._videoWidth||0,i.sendResolutionHeight=e.connection.videoTrack._videoHeight||0),o.avgEncodeMs&&(i.encodeDelay=o.avgEncodeMs),e.connection.videoTrack&&e.connection.videoTrack._encoderConfig&&e.connection.videoTrack._encoderConfig.bitrateMax&&(i.targetSendBitrate=1e3*e.connection.videoTrack._encoderConfig.bitrateMax),i.sendPackets=o.packets,i.sendPacketsLost=o.packetsLost,i.totalDuration=n?n.totalDuration+1:1,i.totalFreezeTime=n?n.totalFreezeTime:0,this.isLocalVideoFreeze(o)&&(i.totalFreezeTime+=1)),e.audioStats=r,e.videoStats=i,e.audioStats&&e.connection.audioTrack&&this.exceptionMonitor.setLocalAudioStats(a,e.connection.audioTrack,e.audioStats),e.videoStats&&e.connection.videoTrack&&this.exceptionMonitor.setLocalVideoStats(a,e.connection.videoTrack,e.videoStats)})},this.clientId=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new Wh,this.exceptionMonitor.on("exception",(e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)})}reset(){this.localConnectionsMap=new Do,this.remoteConnectionsMap=new Do,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(e){return(e=this.localConnectionsMap.get(e))&&e.audioStats?e.audioStats:Fe({},wl)}getLocalVideoTrackStats(e){return(e=this.localConnectionsMap.get(e))&&e.videoStats?e.videoStats:Fe({},Rl)}getRemoteAudioTrackStats(e){var t;let n=this.remoteConnectionsMap.get(e);return n&&n.audioStats?this.trafficStats?((e=Ac(t=this.trafficStats.peer_delay).call(t,e=>e.peer_uid===n.connection.user.uid))&&(n.audioStats.publishDuration=e.B_ppad+(qh()-this.trafficStats.timestamp)),n.audioStats):n.audioStats:Fe({},Il)}getRemoteNetworkQualityStats(e){return(e=this.remoteConnectionsMap.get(e))&&e.networkStats?e.networkStats:Fe({},Cl)}getRemoteVideoTrackStats(e){var t;let n=this.remoteConnectionsMap.get(e);return n&&n.videoStats?this.trafficStats?((e=Ac(t=this.trafficStats.peer_delay).call(t,e=>e.peer_uid===n.connection.user.uid))&&(n.videoStats.publishDuration=e.B_ppvd+(qh()-this.trafficStats.timestamp)),n.videoStats):n.videoStats:Fe({},Al)}getRTCStats(){var e,t;let n=0,r=0,i=0,o=0;return Qo(e=this.localConnectionsMap).call(e,e=>{e.audioStats&&(n+=e.audioStats.sendBytes,r+=e.audioStats.sendBitrate),e.videoStats&&(n+=e.videoStats.sendBytes,r+=e.videoStats.sendBitrate)}),Qo(t=this.remoteConnectionsMap).call(t,e=>{e.audioStats&&(i+=e.audioStats.receiveBytes,o+=e.audioStats.receiveBitrate),e.videoStats&&(i+=e.videoStats.receiveBytes,o+=e.videoStats.receiveBitrate)}),e=1,this.trafficStats&&(e+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:e,SendBitrate:r,SendBytes:n,RecvBytes:i,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}removeConnection(e){this.localConnectionsMap.delete(e),this.remoteConnectionsMap.delete(e)}addLocalConnection(e){let t=e.connectionId;this.localConnectionsMap.has(t)||this.localConnectionsMap.set(t,{connection:e})}addRemoteConnection(e){let t=e.connectionId;this.remoteConnectionsMap.has(t)||this.remoteConnectionsMap.set(t,{connection:e})}updateTrafficStats(e){var t;let n=Bs(t=e.peer_delay).call(t,e=>{var t;return-1===vc(t=this.trafficStatsPeerList).call(t,e.peer_uid)});Qo(n).call(n,e=>{var t,n;let r=Ac(t=Gh(Bh(n=this.remoteConnectionsMap).call(n))).call(t,t=>t.connection._userId===e.peer_uid);void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r?qh()-r.connection.startTime:0),this.trafficStatsPeerList.push(e.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){var t;this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&$u.debug(Us(t="[".concat(this.clientId,"]: Period fir changes to ")).call(t,e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){return!!e&&(e=!n||t.framesDecodeCount>n.framesDecodeCount,!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime||!e)}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&5<e.inputFrame.frameRate&&3>e.sentFrame.frameRate}}var Yh;let Qh=()=>{},Jh={},Xh=new class{constructor(){this.fnMap=new Do}throttleByKey(e,t,n,r,...i){if(this.fnMap.has(t)){var o=this.fnMap.get(t);o.threshold!==n?(o.fn(...o.args),clearTimeout(o.timer),o=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n),this.fnMap.set(t,{fn:e,threshold:n,timer:o,args:i,skipFn:r})):(o.skipFn&&o.skipFn(...o.args),this.fnMap.set(t,ze({},o,{fn:e,args:i,skipFn:r})))}else o=window.setTimeout(()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)},n),this.fnMap.set(t,{fn:e,threshold:n,timer:o,args:i,skipFn:r})}},$h=Pc(Yh=Xh.throttleByKey).call(Yh,Xh),Zh=function(){var e=r(function*({fragementLength:e,referenceList:t,asyncMapHandler:n,allFailedhandler:i}){let o,s=0,a=0;const c=function(){var u=r(function*(){const r=(()=>{var r=s*e;const i=r+e;return r=wc(t).call(t,r,i),ac(r).call(r,n)})();try{o=yield $e(r)}catch(u){if(a+=e,s++,!(a>=t.length))return void(yield c());i(u)}Qo(r).call(r,e=>e.cancel())});return function(){return u.apply(this,arguments)}}();return yield c(),o});return function(t){return e.apply(this,arguments)}}(),ed=null,td=1;class nd{constructor(e){var t;this.lockingPromise=ic.resolve(),this.locks=0,this.name="",this.lockId=td++,e&&(this.name=e),$u.debug(Us(t="[lock-".concat(this.name,"-")).call(t,this.lockId,"] is created."))}get isLocked(){return 0<this.locks}lock(){var e,t;let n;this.locks+=1,$u.debug(Us(e=Us(t="[lock-".concat(this.name,"-")).call(t,this.lockId,"] is locked, current queue ")).call(e,this.locks,"."));let r=new ic(e=>{n=()=>{var t,n;--this.locks,$u.debug(Us(t=Us(n="[lock-".concat(this.name,"-")).call(n,this.lockId,"] is not locked, current queue ")).call(t,this.locks,".")),e()}});return e=this.lockingPromise.then(()=>n),this.lockingPromise=this.lockingPromise.then(()=>r),e}}let rd=new nd("safari"),id=!1,od=!1,sd=new class extends Hh{constructor(){super(),this._state=cl.IDLE,this.lastAccessCameraPermission=this.lastAccessMicrophonePermission=this.isAccessCameraPermission=this.isAccessMicrophonePermission=!1,this.deviceInfoMap=new Do,this.init().then(()=>{var e,t;navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",Pc(t=this.updateDevicesInfo).call(t,this)),window.setInterval(Pc(e=this.updateDevicesInfo).call(e,this),2500)}).catch(e=>$u.error(e.toString()))}get state(){return this._state}set state(e){e!==this._state&&(this.emit(ul.STATE_CHANGE,e),this._state=e)}enumerateDevices(e,t,n=!1){var i=this;return r(function*(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Zu(Cu.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();var r=yield navigator.mediaDevices.enumerateDevices();r=i.checkMediaDeviceInfoIsOk(r);let o=!i.isAccessMicrophonePermission&&e,s=!i.isAccessCameraPermission&&t;r.audio&&(o=!1),r.video&&(s=!1);let a=r=null,c=null;if(!n&&(o||s)){if(rd.isLocked&&($u.debug("[device manager] wait GUM lock"),(yield rd.lock())(),$u.debug("[device manager] GUM unlock")),id&&(o=!1,i.isAccessMicrophonePermission=!0),od&&(s=!1,i.isAccessCameraPermission=!0),$u.debug("[device manager] check media device permissions",e,t,o,s),o&&s){try{c=yield navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(m){if((n=Et(m.name||m.code||m,m.message)).code===Cu.PERMISSION_DENIED)throw n;$u.warning("getUserMedia failed in getDevices",n)}i.isAccessMicrophonePermission=i.isAccessCameraPermission=!0}else if(o){try{r=yield navigator.mediaDevices.getUserMedia({audio:e})}catch(m){if((n=Et(m.name||m.code||m,m.message)).code===Cu.PERMISSION_DENIED)throw n;$u.warning("getUserMedia failed in getDevices",n)}i.isAccessMicrophonePermission=!0}else if(s){try{a=yield navigator.mediaDevices.getUserMedia({video:t})}catch(m){if((n=Et(m.name||m.code||m,m.message)).code===Cu.PERMISSION_DENIED)throw n;$u.warning("getUserMedia failed in getDevices",n)}i.isAccessCameraPermission=!0}$u.debug("[device manager] mic permission",e,"cam permission",t)}try{var u,l,h;const e=yield navigator.mediaDevices.enumerateDevices();return r&&Qo(u=r.getTracks()).call(u,e=>e.stop()),a&&Qo(l=a.getTracks()).call(l,e=>e.stop()),c&&Qo(h=c.getTracks()).call(h,e=>e.stop()),r=null,a=null,c=null,e}catch(m){var d,p,f;return r&&Qo(d=r.getTracks()).call(d,e=>e.stop()),a&&Qo(p=a.getTracks()).call(p,e=>e.stop()),c&&Qo(f=c.getTracks()).call(f,e=>e.stop()),c=a=r=null,new Zu(Cu.ENUMERATE_DEVICES_FAILED,m.toString()).throw()}})()}getRecordingDevices(e=!1){var t=this;return r(function*(){return e=yield t.enumerateDevices(!0,!1,e),Bs(e).call(e,e=>"audioinput"===e.kind)})()}getCamerasDevices(e=!1){var t=this;return r(function*(){return e=yield t.enumerateDevices(!1,!0,e),Bs(e).call(e,e=>"videoinput"===e.kind)})()}getSpeakers(e=!1){var t=this;return r(function*(){return e=yield t.enumerateDevices(!0,!1,e),Bs(e).call(e,e=>"audiooutput"===e.kind)})()}searchDeviceNameById(e){return(e=this.deviceInfoMap.get(e))?e.device.label||e.device.deviceId:null}searchDeviceIdByName(e){var t;let n=null;return Qo(t=this.deviceInfoMap).call(t,t=>{t.device.label===e&&(n=t.device.deviceId)}),n}getDeviceById(e){var t=this;return r(function*(){var n=yield t.enumerateDevices(!0,!0,!0);if(!(n=Ac(n).call(n,t=>t.deviceId===e)))throw new Zu(Cu.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return n})()}init(){var e=this;return r(function*(){e.state=cl.INITING;try{yield e.updateDevicesInfo(),e.state=cl.INITEND}catch(Pu){throw $u.warning("Device Detection functionality cannot start properly.",Pu.toString()),e.state=cl.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new Zu(Cu.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),Pu}})()}updateDevicesInfo(){var e=this;return r(function*(){var t;const n=yield e.enumerateDevices(!0,!0,!0),r=qh(),i=[],o=e.checkMediaDeviceInfoIsOk(n);if(Qo(n).call(n,t=>{if(t.deviceId){var n=e.deviceInfoMap.get(t.deviceId);if("ACTIVE"!==(n?n.state:"INACTIVE")){const n={initAt:r,updateAt:r,device:t,state:"ACTIVE"};e.deviceInfoMap.set(t.deviceId,n),i.push(n)}n&&(n.updateAt=r)}}),Qo(t=e.deviceInfoMap).call(t,(e,t)=>{"ACTIVE"===e.state&&e.updateAt!==r&&(e.state="INACTIVE",i.push(e))}),e.state!==cl.INITEND)return o.audio&&(e.lastAccessMicrophonePermission=!0,e.isAccessMicrophonePermission=!0),void(o.video&&(e.lastAccessCameraPermission=!0,e.isAccessCameraPermission=!0));Qo(i).call(i,t=>{switch(t.device.kind){case"audioinput":e.lastAccessMicrophonePermission&&e.isAccessMicrophonePermission&&e.emit(ul.RECORDING_DEVICE_CHANGED,t);break;case"videoinput":e.lastAccessCameraPermission&&e.isAccessCameraPermission&&e.emit(ul.CAMERA_DEVICE_CHANGED,t);break;case"audiooutput":e.lastAccessMicrophonePermission&&e.isAccessMicrophonePermission&&e.emit(ul.PLAYOUT_DEVICE_CHANGED,t)}}),o.audio&&(e.lastAccessMicrophonePermission=!0,e.isAccessMicrophonePermission=!0),o.video&&(e.lastAccessCameraPermission=!0,e.isAccessCameraPermission=!0)})()}checkMediaDeviceInfoIsOk(e){const t=Bs(e).call(e,e=>"audioinput"===e.kind);e=Bs(e).call(e,e=>"videoinput"===e.kind);const n={audio:!1,video:!1};for(const r of t)if(r.label&&r.deviceId){n.audio=!0;break}for(const r of e)if(r.label&&r.deviceId){n.video=!0;break}return n}};var ad=[].slice,cd=/MSIE .\./.test(Rs),ud=function(e){return function(t,n){var r=2<arguments.length,i=r?ad.call(arguments,2):void 0;return e(r?function(){("function"==typeof t?t:Function(t)).apply(this,i)}:t,n)}};mr({global:!0,bind:!0,forced:cd},{setTimeout:ud(Dn.setTimeout),setInterval:ud(Dn.setInterval)});var ld=sr.setTimeout;let hd=0,dd=0,pd=new class{constructor(){var e,t;this.baseInfoMap=new Do,this.clientList=vu,this.keyEventUploadPendingItems=[],this.normalEventUploadPendingItems=[],this.apiInvokeUploadPendingItems=[],this.apiInvokeCount=0,this.ltsList=[],this.lastSendNormalEventTime=qh(),this.customReportCount=0,this.eventUploadTimer=window.setInterval(Pc(e=this.doSend).call(e,this),gu.EVENT_REPORT_SEND_INTERVAL),this.setSessionIdTimer=window.setInterval(Pc(t=this.appendSessionId).call(t,this),gu.EVENT_REPORT_SEND_INTERVAL)}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=qh(),i=this.apiInvokeCount+=1,o=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options}),s=!!gu.SHOW_REPORT_INVOKER_LOG;s&&$u.info("".concat(t.name," start"),t.options);let a=!1;Ye(t.timeout).then(()=>{a||(this.sendApiInvoke(Ct({},o(),{error:Cu.API_INVOKE_TIMEOUT,success:!1})),$u.debug("".concat(t.name," timeout")))});const c=new Zu(Cu.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(Ct({},o(),{success:!0},t.reportResult&&{result:e})),s&&$u.info("".concat(t.name," onSuccess")),e};return n?$h(r,t.name+"Success",n,()=>a=!0):r()},onError:e=>{const r=()=>{if(a)throw e;a=!0,this.sendApiInvoke(Ct({},o(),{success:!1,error:e.toString()})),s&&$u.info("".concat(t.name," onFailure"),e.toString())};return n?$h(r,t.name+"Error",n,()=>a=!0):r()}}}sessionInit(e,t){if(!this.baseInfoMap.has(e)){var n=qh();(e=this.createBaseInfo(e,n)).cname=t.cname;var r=Zo({},{willUploadConsoleLog:gu.UPLOAD_LOG,maxTouchPoints:navigator.maxTouchPoints,areaVersion:lu?"global":"oversea",areas:gu.AREAS&&gu.AREAS.join(",")},t.extend),i=qh();t=Ct({},e,{eventType:rl.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:"v4.5.0-0-g87245ad6(5/25/2021, 3:25:26 PM)",lts:i,elapse:i-n,extend:wr(r),mode:t.mode,process:gu.PROCESS_ID,success:!0,version:cu}),this.send({type:il.SESSION,data:t},!0)}}joinChooseServer(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{eventType:rl.JOIN_CHOOSE_SERVER,lts:r,eventElapse:r-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:r-e.startTime,success:t.succ,chooseServerAddrList:wr(t.serverList),uid:t.uid?gs(t.uid):null,cid:t.cid?gs(t.cid):null,chooseServerIp:t.csIp||""}),this.send({type:il.JOIN_CHOOSE_SERVER,data:t},!0)}}reqUserAccount(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{eventType:rl.REQ_USER_ACCOUNT,lts:r,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:r-e.startTime,eventElapse:r-t.lts,extend:wr(t.extend)}),this.send({type:il.REQ_USER_ACCOUNT,data:t},!0)}}joinGateway(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info;t.vid&&(n.vid=t.vid),n.uid=t.uid,n.cid=t.cid;var r=qh();n=Ct({},n,{eventType:rl.JOIN_GATEWAY,lts:r,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:r-e.startTime,eventElapse:r-t.lts}),t.succ&&(e.lastJoinSuccessTime=r),this.send({type:il.JOIN_GATEWAT,data:n},!0)}}joinChannelTimeout(e,t){if(e=this.baseInfoMap.get(e)){var n=qh();t=Ct({},e.info,{lts:n,timeout:t,elapse:n-e.startTime}),this.send({type:il.JOIN_CHANNEL_TIMEOUT,data:t},!0)}}publish(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{eventType:rl.PUBLISH,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid}),this.send({type:il.PUBLISH,data:t},!0)}}subscribe(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();e=Ct({},n,{eventType:rl.SUBSCRIBE,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid}),"string"==typeof t.peerid?e.peerSuid=t.peerid:e.peer=t.peerid,this.send({type:il.SUBSCRIBE,data:e},!0)}}firstRemoteFrame(e,t,n,r){if(e=this.baseInfoMap.get(e)){var i=e.info,o=qh();t=Ct({},i,{},r,{elapse:o-e.startTime,eventType:t,lts:o}),this.send({type:n,data:t},!0)}}onGatewayStream(e,t,n,r){(e=this.baseInfoMap.get(e))&&(t=Ct({},e.info,{},r,{eventType:t,lts:qh()}),this.send({type:n,data:t},!0))}streamSwitch(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{eventType:rl.STREAM_SWITCH,lts:r,isDual:t.isdual,elapse:r-e.startTime,success:t.succ}),this.send({type:il.STREAM_SWITCH,data:t},!0)}}requestProxyAppCenter(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{eventType:rl.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ}),this.send({type:il.REQUEST_PROXY_APPCENTER,data:t},!0)}}requestProxyWorkerManager(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{eventType:rl.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-t.lts,elapse:r-e.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ}),this.send({type:il.REQUEST_PROXY_WORKER_MANAGER,data:t},!0)}}setProxyServer(e){(this.proxyServer=e)?$u.debug("reportProxyServerurl: ".concat(e)):$u.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:0<t.audioPublishDuration?1:-1,videotag:0<t.videoPublishDuration?1:-1,lts:r,elapse:r-e.startTime,joinChannelSuccessElapse:r-(e.lastJoinSuccessTime||r)}),this.send({type:il.PEER_PUBLISH_STATUS,data:t},!0)}}workerEvent(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=Ke(wr(e));let o=0;const s=[];let a=0;for(let c=0;c<r.length;c++)a+=127>=r.charCodeAt(c)?1:3,a<=1300-i||(s[s.length]=ze({},e,{[t]:r.substring(o,c)}),o=c,a=127>=r.charCodeAt(c)?1:3);return o!==r.length-1&&(s[s.length]=ze({},e,{[t]:r.substring(o)})),s}(Ct({},n,{},t,{elapse:r-e.startTime,lts:r,productType:"WebRTC"}),"payload"),Qo(t).call(t,e=>this.send({type:il.WORKER_EVENT,data:e},!0))}}apworkerEvent(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{},t,{elapse:r-e.startTime,lts:r}),this.send({type:il.AP_WORKER_EVENT,data:t},!0)}}joinWebProxyAP(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{},t,{elapse:r-e.startTime,lts:r}),this.send({type:il.JOIN_WEB_PROXY_AP,data:t},!0)}}WebSocketQuit(e,t){if(e=this.baseInfoMap.get(e)){var n=e.info,r=qh();t=Ct({},n,{},t,{elapse:r-e.startTime,lts:r}),this.send({type:il.WEBSOCKET_QUIT,data:t},!0)}}sendCustomReportMessage(e,t){var n=this;return r(function*(){if(n.customReportCount+=t.length,n.customReportCount>gu.CUSTOM_REPORT_LIMIT)throw new Zu(Cu.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);n.customReportCounterTimer||(n.customReportCounterTimer=window.setInterval(()=>{n.customReportCount=0},5e3)),t=ac(t).call(t,t=>({type:il.USER_ANALYTICS,data:Ct({sid:e},t)})),t={msgType:"EventMessages",sentTs:Math.round(qh()/1e3),payloads:ac(t).call(t,e=>wr(e))};try{yield n.postDataToStatsCollector(t)}catch(r){throw $u.error("send custom report message failed",r.toString()),new Zu(Cu.CUSTOM_REPORT_SEND_FAILED,r.message)}})()}sendApiInvoke(e){var t=gu.NOT_REPORT_EVENT;if(e.tag&&Vc(t)&&Vc(t).call(t,e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;if(!(t=this.baseInfoMap.get(e.sid)))return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:n,uid:r,cid:i}=t.info;return e.lts=e.lts||qh(),e={invokeId:e.invokeId,sid:e.sid,cname:n,cid:i,uid:r,lts:e.lts,success:e.success,elapse:e.lts-t.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?wr(e.options):void 0,execStates:e.states?wr(e.states):void 0,execResult:e.result?wr(e.result):void 0,errorCode:e.error?wr(e.error):void 0},this.send({type:il.API_INVOKE,data:e},!1),!0}appendSessionId(){var e;Qo(e=this.clientList).call(e,e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const t=this.apiInvokeUploadPendingItems.shift();t&&(t.sid=e._sessionId,this.sendApiInvoke(Zo({},t)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);var n;this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>gu.NORMAL_EVENT_QUEUE_CAPACITY&&dc(n=this.normalEventUploadPendingItems).call(n,0,1),10<=this.normalEventUploadPendingItems.length&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){0<this.keyEventUploadPendingItems.length&&this.sendItems(this.keyEventUploadPendingItems,!0),0<this.normalEventUploadPendingItems.length&&5e3<=qh()-this.lastSendNormalEventTime&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[];for(var r=[];e.length;){const t=e.shift();20>n.length?n.push(t):r.push(t)}e.push(...r);for(const s of[...n]){var i,o;-1!==vc(i=this.ltsList).call(i,s.data.lts)?(s.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(s.data.lts)):(this.ltsList.push(s.data.lts),Iu(o=this.ltsList).call(o,(e,t)=>e-t))}return t||(this.lastSendNormalEventTime=qh()),r={msgType:"EventMessages",sentTs:Math.round(qh()/1e3),payloads:ac(n).call(n,e=>wr(e)),vid:(e=>(e=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid))&&e.info.vid&&+e.info.vid||0)(n[0])},n.length&&this.postDataToStatsCollector(r).catch((e=>n=>{var r,i,o;t?this.keyEventUploadPendingItems=Us(r=this.keyEventUploadPendingItems).call(r,e):(this.normalEventUploadPendingItems=Us(i=this.normalEventUploadPendingItems).call(i,e),this.normalEventUploadPendingItems.length>gu.NORMAL_EVENT_QUEUE_CAPACITY&&(dc(o=this.normalEventUploadPendingItems).call(o,0,this.normalEventUploadPendingItems.length-gu.NORMAL_EVENT_QUEUE_CAPACITY),$u.warning("report: drop normal events")))})(n)),e}postDataToStatsCollector(e,t=!1){var n=this;return r(function*(){var r,i,o;const s=t?"/events/proto-raws":"/events/messages";let a=n.url||(n.proxyServer?Us(r=Us(i="https://".concat(n.proxyServer,"/rs/?h=")).call(i,gu.EVENT_REPORT_DOMAIN,"&p=6443&d=")).call(r,s):Us(o="https://".concat(gu.EVENT_REPORT_DOMAIN,":6443")).call(o,s));for(r=0;2>r;r+=1){var c,u,l;1===r&&(a=n.backupUrl||(n.proxyServer?Us(c=Us(u="https://".concat(n.proxyServer,"/rs/?h=")).call(u,gu.EVENT_REPORT_BACKUP_DOMAIN,"&p=6443&d=")).call(c,s):Us(l="https://".concat(gu.EVENT_REPORT_BACKUP_DOMAIN,":6443")).call(l,s)));try{t?yield wt(a,{timeout:1e4,data:e}):yield bt(a,{timeout:1e4,data:e})}catch(h){if(1===r)throw h;continue}break}})()}createBaseInfo(e,t){const n=Zo({},nl);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}},fd={[ll.ACCESS_POINT]:{[pl.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[pl.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[pl.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[pl.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[pl.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ll.UNILBS]:{[dl.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[dl.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[dl.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[dl.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[dl.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[dl.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[dl.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[dl.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[dl.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[dl.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[dl.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[dl.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ll.STRING_UID_ALLOCATOR]:{[hl.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[hl.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[hl.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}},md={[fl.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[fl.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[fl.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[fl.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[fl.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[fl.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[fl.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[fl.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[fl.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[fl.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[fl.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[fl.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[fl.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[fl.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[fl.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[fl.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[fl.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[fl.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[fl.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[fl.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[fl.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[fl.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[fl.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[fl.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[fl.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[fl.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[fl.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[fl.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[fl.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[fl.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[fl.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[fl.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[fl.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[fl.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[fl.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[fl.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[fl.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[fl.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[fl.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[fl.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[fl.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[fl.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[fl.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[fl.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[fl.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[fl.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[fl.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[fl.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[fl.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[fl.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[fl.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[fl.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[fl.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[fl.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[fl.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[fl.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"}},gd={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};class _d extends Hh{constructor(e,t){super(),this.currentURLIndex=this.connectionID=0,this.reconnectMode="tryNext",this._state="closed",this.reconnectCount=0,this.name=e,this.retryConfig=t}get url(){return this.websocket?this.websocket.url:null}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(Ol.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Ol.CONNECTED):"closed"===this._state?this.emit(Ol.CLOSED):"failed"===this._state&&this.emit(Ol.FAILED))}init(e){return new ic((t,n)=>{this.urls=e;let r=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(r).then(t).catch(n),this.once(Ol.CLOSED,()=>n(new Zu(Cu.WS_DISCONNECT))),this.once(Ol.CONNECTED,()=>t())})}close(e,t){if(this.currentURLIndex=0,this.reconnectCount=0,this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let e=this.websocket;t?ld(()=>e.close(),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed"}reconnect(e,t){this.websocket?(void 0!==e&&(this.reconnectMode=e),$u.debug("[".concat(this.name,"] reconnect is triggered initiative")),e=this.websocket.onclose,this.websocket.onclose=null,this.websocket.close(),e&&Pc(e).call(e,this.websocket)({code:9999,reason:t})):$u.warning("[".concat(this.name,"] can not reconnect, no websocket"))}sendMessage(e){if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Zu(Cu.WS_ABORT,"websocket is not ready");e=wr(e);try{this.websocket.send(e)}catch(t){throw new Zu(Cu.WS_ERR,"send websocket message error"+t.toString())}}createWebSocketConnection(e){var t=this;return r(function*(){let n=t.connectionID+=1;return new ic((i,o)=>{var s,a;t.websocket&&(t.websocket.onclose=null,t.websocket.close()),gu.GATEWAY_WSS_ADDRESS&&Qc(s=t.name).call(s,"gateway")&&(e=gu.GATEWAY_WSS_ADDRESS),$u.debug(Us(a="[".concat(t.name,"] start connect, url: ")).call(a,e));try{t.websocket=new WebSocket(e),t.websocket.binaryType="arraybuffer"}catch(u){var c;return s=new Zu(Cu.WS_ERR,"init websocket failed! Error: ".concat(u.toString())),$u.error(Us(c="[".concat(t.name,"]")).call(c,s)),void o(s)}Ye(5e3).then(()=>{n===t.connectionID&&t.websocket&&t.websocket.readyState!==WebSocket.OPEN&&t.websocket&&t.websocket.close()}),t.websocket.onopen=()=>{$u.debug("[".concat(t.name,"] websocket opened:"),e),t.reconnectMode="retry",t.state="connected",t.reconnectCount=0,i()},t.websocket.onclose=function(){var e=r(function*(e){var n,r,s,a;if($u.debug(Us(n=Us(r=Us(s=Us(a="[".concat(t.name,"] websocket close ")).call(a,t.websocket&&t.websocket.url,", code: ")).call(s,e.code,", reason: ")).call(r,e.reason,", current mode: ")).call(n,t.reconnectMode)),t.reconnectCount<t.retryConfig.maxRetryCount){if("connected"===t.state&&(t.reconnectReason=e.reason,t.state="reconnecting"),n=tt(t,Ol.WILL_RECONNECT,t.reconnectMode)||t.reconnectMode,n=yield t.reconnectWithAction(n),"closed"===t.state)return void $u.debug("[".concat(t.connectionID,"] ws is closed, no need to reconnect"));if(!n)return o(new Zu(Cu.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),void t.close(!0);i()}else o(new Zu(Cu.WS_DISCONNECT,"websocket close: ".concat(e.code))),t.close()});return function(t){return e.apply(this,arguments)}}(),t.websocket.onmessage=e=>{t.emit(Ol.ON_MESSAGE,e)}})})()}reconnectWithAction(e,t){var n=this;return r(function*(){var r,i;if(!t&&n.reconnectCount>=n.retryConfig.maxRetryCount||!n.urls||"closed"===n.state)return!1;if(n.onlineReconnectListener||!navigator||void 0===navigator.onLine||navigator.onLine||(n.onlineReconnectListener=new ic(e=>{let t=()=>{n.onlineReconnectListener=void 0,window.removeEventListener("online",t),e()};window.addEventListener("online",t)})),t=function(e,t){return Math.min(t.maxRetryTimeout,t.timeout*Math.pow(t.timeoutFactor,e))}(n.reconnectCount,n.retryConfig),$u.debug(Us(r=Us(i="[".concat(n.name,"] wait ")).call(i,t,"ms to reconnect websocket, mode: ")).call(r,e)),yield ic.race([Ye(t),n.onlineReconnectListener||new ic(()=>{})]),"closed"===n.state)return!1;n.reconnectCount+=1;try{if("retry"===e)yield n.createWebSocketConnection(n.urls[n.currentURLIndex]);else if("tryNext"===e){var o,s;if(n.currentURLIndex+=1,n.currentURLIndex>=n.urls.length)return yield n.reconnectWithAction("recover");$u.debug(Us(o=Us(s="[".concat(n.name,"] websocket url length: ")).call(s,n.urls.length," current index: ")).call(o,n.currentURLIndex)),yield n.createWebSocketConnection(n.urls[n.currentURLIndex])}else"recover"===e&&($u.debug("[".concat(n.name,"] request new urls")),n.urls=yield Ze(n,Ol.REQUEST_NEW_URLS),n.currentURLIndex=0,yield n.createWebSocketConnection(n.urls[n.currentURLIndex]));return!0}catch(a){return $u.error("[".concat(n.name,"] reconnect failed"),a.toString()),yield n.reconnectWithAction(e)}})()}}class vd{constructor(e){this.input=[],this.size=e}add(e){var t;this.input.push(e),this.input.length>this.size&&dc(t=this.input).call(t,0,1)}mean(){var e;return 0===this.input.length?0:ss(e=this.input).call(e,(e,t)=>e+t)/this.input.length}}class yd extends Hh{constructor(e){super(),this._connectionState=_l.CLOSED,this.openConnectionTime=qh(),this.lastMsgTime=qh(),this.uploadCache=[],this.rttRolling=new vd(5),this.pingpongTimeoutCount=0,this.onWebsocketMessage=e=>{if(e.data instanceof ArrayBuffer)this.emit(vl.ON_BINARY_DATA,e.data);else if(e=JSON.parse(e.data),this.lastMsgTime=qh(),Object.prototype.hasOwnProperty.call(e,"_id")){let t="res-@".concat(e._id);this.emit(t,e._result,e._message)}else if(Object.prototype.hasOwnProperty.call(e,"_type")&&(this.emit(e._type,e._message),e._type===Sl.ON_NOTIFICATION&&this.handleNotification(e._message),e._type===Sl.ON_USER_BANNED))switch(e._message.error_code){case 14:this.close("UID_BANNED");break;case 15:this.close("IP_BANNED");break;case 16:this.close("CHANNEL_BANNED")}},this.clientId=e.clientId,this.spec=e,this.websocket=new _d("gateway-".concat(this.clientId),this.spec.retryConfig),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===_l.CONNECTED&&this.reconnect("retry",gl.OFFLINE)})}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===_l.CONNECTED?this.emit(vl.WS_CONNECTED):e===_l.RECONNECTING?this.emit(vl.WS_RECONNECTING,this._websocketReconnectReason):e===_l.CLOSED&&this.emit(vl.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}request(e,t,n){var i=this;return r(function*(){var r,o,s,a,c;let u=Je(6,"");var l={_id:u,_type:e,_message:t};let h=i.websocket.connectionID;var d=()=>new ic((e,t)=>{if(i.connectionState===_l.CONNECTED)return e();const n=()=>{i.off(vl.WS_CLOSED,r),e()},r=()=>{i.off(vl.WS_CONNECTED,n),t(new Zu(Cu.WS_ABORT))};i.once(vl.WS_CONNECTED,n),i.once(vl.WS_CLOSED,r)});i.connectionState!==_l.CONNECTING&&i.connectionState!==_l.RECONNECTING||e===yl.JOIN||e===yl.REJOIN||(yield d());var p=new ic((n,r)=>{let o=!1;const s=(r,s)=>{o=!0,n({isSuccess:"success"===r,message:s||{}}),i.off(vl.WS_CLOSED,a),i.off(vl.WS_RECONNECTING,a),i.emit(vl.REQUEST_SUCCESS,e,t)};i.once("res-@".concat(u),s);const a=()=>{r(new Zu(Cu.WS_ABORT,"type: ".concat(e))),i.off(vl.WS_CLOSED,a),i.off(vl.WS_RECONNECTING,a),i.off("res-@".concat(u),s)};i.once(vl.WS_CLOSED,a),i.once(vl.WS_RECONNECTING,a),Ye(gu.SIGNAL_REQUEST_TIMEOUT).then(()=>{i.websocket.connectionID!==h||o||($u.warning("ws request timeout, type: ".concat(e)),i.emit(vl.REQUEST_TIMEOUT,e,t))})});i.websocket.sendMessage(l),l=null;try{l=yield p}catch(f){if(i.connectionState===_l.CLOSED||e===yl.LEAVE)throw new Zu(Cu.WS_ABORT);return!i.spec.forceWaitGatewayResponse||n?f.throw():e===yl.JOIN||e===yl.REJOIN?null:(yield d(),yield i.request(e,t))}return l.isSuccess?l.message:(d=Nt(n=Number(l.message.error_code||l.message.code)),p=new Zu(Cu.UNEXPECTED_RESPONSE,Us(r="".concat(d.desc,": ")).call(r,l.message.error_str),{code:n,data:l.message}),"success"===d.action?l.message:($u.warning(Us(o=Us(s=Us(a=Us(c="[".concat(i.websocket.connectionID,"] unexpected response from type ")).call(c,e,", error_code: ")).call(a,n,", message: ")).call(s,d.desc,", action: ")).call(o,d.action)),"failed"===d.action?p.throw():"quit"===d.action?(i.initError=p,i.close(),p.throw()):(n===fl.ERR_JOIN_BY_MULTI_IP?(i.multiIpOption=l.message.option,$u.warning("[".concat(i.clientId,"] detect multi ip, recover")),i.reconnect("recover",gl.MULTI_IP)):i.reconnect(d.action,gl.SERVER_ERROR),e===yl.JOIN||e===yl.REJOIN?null:yield i.request(e,t))))})()}waitMessage(e,t){return new ic(n=>{let r=i=>{t&&!t(i)||(this.off(e,r),n(i))};this.on(e,r)})}upload(e,t){e={_type:e,_message:t};try{this.websocket.sendMessage(e)}catch(r){var n;$u.info("[".concat(this.clientId,"] upload failed, cache message"),r),t=gu.MAX_UPLOAD_CACHE||50,this.uploadCache.push(e),this.uploadCache.length>t&&dc(n=this.uploadCache).call(n,0,1),0<this.uploadCache.length&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{var e;if(this.connectionState===_l.CONNECTED){var t=dc(e=this.uploadCache).call(e,0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(t._type,t._message)}},gu.UPLOAD_CACHE_INTERVAL||2e3))}}send(e,t){this.websocket.sendMessage({_type:e,_message:t})}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,new ic((t,n)=>{this.once(vl.WS_CONNECTED,()=>t(this.joinResponse)),this.once(vl.WS_CLOSED,()=>n(this.initError||new Zu(Cu.WS_ABORT))),this.connectionState=_l.CONNECTING,this.websocket.init(e).catch(n)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.joinResponse=this.reconnectToken=void 0,this._disconnectedReason=e||"LEAVE",this.connectionState=_l.CLOSED,this.websocket.close()}join(){var e=this;return r(function*(){var t;if(!e.joinResponse){var n=nt(e,vl.REQUEST_JOIN_INFO);if(!(n=yield e.request(yl.JOIN,n)))return e.emit(vl.REPORT_JOIN_GATEWAY,Cu.TIMEOUT,e.url||""),!1;e.joinResponse=n,e.reconnectToken=e.joinResponse.rejoin_token}return e.connectionState=_l.CONNECTED,e.pingpongTimer&&window.clearInterval(e.pingpongTimer),e.pingpongTimer=window.setInterval(Pc(t=e.handlePingPong).call(t,e),3e3),!0})()}rejoin(){var e=this;return r(function*(){var t,n;if(!e.reconnectToken)throw new Zu(Cu.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");var r=nt(e,vl.REQUEST_REJOIN_INFO);return r.token=e.reconnectToken,!!(r=yield e.request(yl.REJOIN,r))&&(e.connectionState=_l.CONNECTED,e.pingpongTimer&&window.clearInterval(e.pingpongTimer),e.pingpongTimer=window.setInterval(Pc(t=e.handlePingPong).call(t,e),3e3),r.peers&&Qo(n=r.peers).call(n,t=>{e.emit(Sl.ON_USER_ONLINE,{uid:t.uid}),e.emit(t.audio_mute?Sl.MUTE_AUDIO:Sl.UNMUTE_AUDIO,{uid:t.uid}),e.emit(t.video_mute?Sl.MUTE_VIDEO:Sl.UNMUTE_VIDEO,{uid:t.uid}),e.emit(t.audio_enable_local?Sl.ENABLE_LOCAL_AUDIO:Sl.DISABLE_LOCAL_AUDIO,{uid:t.uid}),e.emit(t.video_enable_local?Sl.ENABLE_LOCAL_VIDEO:Sl.DISABLE_LOCAL_VIDEO,{uid:t.uid}),t.audio||t.video||e.emit(Sl.ON_REMOVE_STREAM,{uid:t.uid,uint_id:t.uint_id}),t.audio&&e.emit(Sl.ON_ADD_AUDIO_STREAM,{uid:t.uid,uint_id:t.uint_id,audio:!0}),t.video&&e.emit(Sl.ON_ADD_VIDEO_STREAM,{uid:t.uid,uint_id:t.uint_id,video:!0})}),!0)})()}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){if($u.debug("[".concat(this.clientId,"] receive notification: "),e),"success"!==(e=Nt(e.code)).action){if("failed"!==e.action)return"quit"===e.action?("ERR_REPEAT_JOIN_CHANNEL"===e.desc&&this.close("UID_BANNED"),void this.close()):void this.reconnect(e.action,gl.SERVER_ERROR);$u.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(this.websocket&&"connected"===this.websocket.state){0<this.pingpongTimeoutCount&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;var e=gu.PING_PONG_TIME_OUT,t=qh();this.pingpongTimeoutCount>=e&&($u.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>gu.WEBSOCKET_TIMEOUT_MIN)?this.reconnect("retry",gl.TIMEOUT):this.request(yl.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let e=qh()-t;this.rttRolling.add(e),gu.REPORT_STATS&&this.send(yl.PING_BACK,{pingpongElapse:e})}).catch(e=>{})}}handleWebsocketEvents(){this.websocket.on(Ol.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ol.CLOSED,()=>{this.connectionState=_l.CLOSED}),this.websocket.on(Ol.FAILED,()=>{this._disconnectedReason="NETWORK_ERROR",this.connectionState=_l.CLOSED}),this.websocket.on(Ol.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState=this.connectionState===_l.CONNECTED?_l.RECONNECTING:_l.CONNECTING}),this.websocket.on(Ol.WILL_RECONNECT,(e,t)=>{if(nt(this,vl.IS_P2P_DISCONNECTED)&&"retry"===e)return this.reconnectToken=void 0,this.emit(vl.NEED_RENEW_SESSION),this.emit(vl.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(this.reconnectToken=void 0,this.emit(vl.NEED_RENEW_SESSION),this.emit(vl.DISCONNECT_P2P)),t(e)}),this.websocket.on(Ol.CONNECTED,()=>{this.openConnectionTime=qh(),this.reconnectToken?this.rejoin().catch(e=>{var t;$u.warning(Us(t="[".concat(this.clientId,"] rejoin failed ")).call(t,e)),this.reconnect("tryNext",gl.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(vl.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof Zu&&e.code===Cu.UNEXPECTED_RESPONSE&&e.data.code===fl.ERR_NO_AUTHORIZED)return $u.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",gl.SERVER_ERROR);$u.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",gl.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(Ol.REQUEST_NEW_URLS,(e,t)=>{Ze(this,vl.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})}}class Ed extends Hh{constructor(e,t){super(),this._hints=[],this._ID=t||Je(8,"track-"),this._mediaStreamTrack=this._originMediaStreamTrack=e}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||(e=pd.reportApiInvoke(null,{name:sl.GET_MEDIA_STREAM_TRACK,options:[],tag:al.TRACER})).onSuccess(this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?this._mediaStreamTrack.label:""),this._mediaStreamTrack}}class Sd extends Ed{constructor(e,t){super(e,t),this._enabled=!0,this._isClosed=!1,this._trackProcessors=[],this._handleTrackEnded=()=>{$u.debug("[".concat(this.getTrackId,"] track ended")),this.emit(ql.TRACK_ENDED)},this._enabledMutex=new nd("".concat(t)),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){return this._originMediaStreamTrack.label}close(){var e;this._isClosed||(this.stop(),Qo(e=this._trackProcessors).call(e,e=>e.destroy()),this._trackProcessors=[],this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,$u.debug("[".concat(this.getTrackId(),"] close")),this.emit(jl.NEED_CLOSE),this._isClosed=!0)}_registerTrackProcessor(e){var t=this;return r(function*(){var n;if(-1===vc(n=t._trackProcessors).call(n,e)){var i=t._trackProcessors[t._trackProcessors.length-1];t._trackProcessors.push(e),e.onOutputChange=r(function*(){t._mediaStreamTrack=e.output||t._originMediaStreamTrack,t._updatePlayerSource(),yield et(t,jl.NEED_REPLACE_TRACK,t._mediaStreamTrack)}),i?(i.onOutputChange=r(function*(){i.output&&(yield e.setInput(i.output))}),yield e.setInput(i.output||i.input||t._originMediaStreamTrack)):yield e.setInput(t._originMediaStreamTrack)}})()}_getOutputFromProcessors(){if(0===this._trackProcessors.length)return this._originMediaStreamTrack;let e=this._trackProcessors[this._trackProcessors.length-1];return e.output||e.input||this._originMediaStreamTrack}_updateOriginMediaStreamTrack(e,t){var n=this;return r(function*(){e!==n._originMediaStreamTrack&&(n._originMediaStreamTrack.removeEventListener("ended",n._handleTrackEnded),t&&n._originMediaStreamTrack.stop(),e.addEventListener("ended",n._handleTrackEnded),n._originMediaStreamTrack=e,0<n._trackProcessors.length?(yield n._trackProcessors[0].setInput(e),n._mediaStreamTrack=n._getOutputFromProcessors()):n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield et(n,jl.NEED_REPLACE_TRACK,n._mediaStreamTrack))})()}_getDefaultPlayerConfig(){return{}}}let Td=window.AudioContext||window.webkitAudioContext,bd=null,wd=new Hh,Rd=null;class Id extends Hh{constructor(){super(),this.isPlayed=!1,this.audioOutputLevel=this.audioLevelBase=0,this.audioOutputLevelCache=null,this.audioOutputLevelCacheMaxLength=gu.AUDIO_SOURCE_AVG_VOLUME_DURATION/gu.AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL||15,this.isDestroyed=!1,this._noAudioInputCount=0,this.context=Dt(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Pt(this.outputNode),this.analyserNode=this.context.createAnalyser()}get isNoAudioInput(){return 3<=this.noAudioInputCount}get noAudioInputCount(){return this._noAudioInputCount}set noAudioInputCount(e){3>this._noAudioInputCount&&3<=e?this.onNoAudioInput&&this.onNoAudioInput():3<=this._noAudioInputCount&&0==this._noAudioInputCount%10&&this.onNoAudioInput&&this.onNoAudioInput(),this._noAudioInputCount=e}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(bl.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){let n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!Ql.webAudioMediaStreamDest)throw new Zu(Cu.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&ot(()=>{wd.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(Pu){}this.isPlayed=!1}getAudioLevel(){return this.audioOutputLevel}getAccurateVolumeLevel(){let e=new Uint8Array(this.analyserNode.frequencyBinCount);this.analyserNode.getByteFrequencyData(e);let t=0;for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}getAudioAvgLevel(){var e;return null===this.audioOutputLevelCache&&(this.audioOutputLevelCache=[this.audioOutputLevel]),ss(e=this.audioOutputLevelCache).call(e,(e,t)=>e+t)/this.audioOutputLevelCache.length}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}setMute(e){e?(this.disconnect(),this.audioLevelBase=0,this.audioOutputLevel=0):this.connect()}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){this.sourceNode&&this.sourceNode.disconnect(),this.outputNode&&this.outputNode.disconnect(),window.clearInterval(this.updateAudioOutputLevelInterval)}connect(){var e;this.sourceNode&&this.sourceNode.connect(this.outputNode),this.outputNode.connect(this.analyserNode),this.updateAudioOutputLevelInterval=window.setInterval(Pc(e=this.updateAudioOutputLevel).call(e,this),gu.AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL||400)}updateAudioOutputLevel(){if(this.context&&"running"!==this.context.state&&this.context.resume(),this.analyserNode){if(this.analyserNode.getFloatTimeDomainData){var e=new Float32Array(this.analyserNode.frequencyBinCount);this.analyserNode.getFloatTimeDomainData(e)}else{var t;e=new Uint8Array(this.analyserNode.frequencyBinCount),this.analyserNode.getByteTimeDomainData(e);let n=!0;e=new Float32Array(ac(t=Gh(e)).call(t,e=>(128!==e&&(n=!1),.0078125*(e-128)))),n?this.noAudioInputCount+=1:this.noAudioInputCount=0}for(t=0;t<e.length;t+=1)Math.abs(e[t])>this.audioLevelBase&&(this.audioLevelBase=Math.abs(e[t]),1<this.audioLevelBase&&(this.audioLevelBase=1));this.audioOutputLevel=this.audioLevelBase,this.audioLevelBase/=4,null!==this.audioOutputLevelCache&&(this.audioOutputLevelCache.push(this.audioOutputLevel),this.audioOutputLevelCache.length>this.audioOutputLevelCacheMaxLength&&this.audioOutputLevelCache.shift())}}}class Cd extends Id{constructor(e,t){if(super(),this.isCurrentTrackCloned=!1,this.isRemoteTrack=!1,this.rebuildWebAudio=()=>{if($u.debug("ready to rebuild web audio, state:",this.context.state),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void $u.debug("rebuild web audio success, current volume",this.getAudioLevel());this.context.resume().then(()=>$u.info("resume success")),$u.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();var e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0,e=new MediaStream([this.track]),this.sourceNode=this.context.createMediaStreamSource(e),Pt(this.sourceNode),this.analyserNode=this.context.createAnalyser();let t=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(t,this.context.currentTime),Pt(this.outputNode),this.connect(),this.audioElement.srcObject=e,this.isPlayed&&this.play(this.playNode)},"audio"!==e.kind)throw new Zu(Cu.UNEXPECTED_ERROR);this.track=e,e=new MediaStream([this.track]),this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(e),Pt(this.sourceNode),this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=e,e=Pe(),t&&e.os===Jc.IOS&&(wd.on("state-change",this.rebuildWebAudio),this.onNoAudioInput=()=>{document.body.addEventListener("click",this.rebuildWebAudio,!0)})}get isFreeze(){return!1}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1,e=new MediaStream([e]),this.sourceNode=this.context.createMediaStreamSource(e),Pt(this.sourceNode),this.sourceNode.connect(this.outputNode),this.audioElement.srcObject=e}destroy(){this.audioElement.remove(),wd.off("state-change",this.rebuildWebAudio),super.destroy()}}let Ad=new class{constructor(){this.elementMap=new Do,this.elementsNeedToResume=[],this.sinkIdMap=new Do,this.autoResumeAudioElement()}setSinkID(e,t){var n=this;return r(function*(){const r=n.elementMap.get(e);if(n.sinkIdMap.set(e,t),r)try{yield r.setSinkId(t)}catch(i){throw new Zu(Cu.PERMISSION_DENIED,"can not set sink id: "+i.toString())}})()}play(e,t,n){if(!this.elementMap.has(t)){var r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([e]),this.elementMap.set(t,r),this.setVolume(t,n),(e=this.sinkIdMap.get(t))&&r.setSinkId(e).catch(e=>{$u.warning("[".concat(t,"] set sink id failed"),e.toString())}),(e=r.play())&&e.then&&e.catch(e=>{$u.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&($u.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),ot(()=>{this.onAutoplayFailed&&this.onAutoplayFailed()}))})}}updateTrack(e,t){(e=this.elementMap.get(e))&&(e.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)}setVolume(e,t){(e=this.elementMap.get(e))&&(t=Math.max(0,Math.min(100,t)),e.volume=t/100)}stop(e){var t,n;const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),r){var i=vc(t=this.elementsNeedToResume).call(t,r);dc(n=this.elementsNeedToResume).call(n,i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e)}}autoResumeAudioElement(){const e=()=>{var e;Qo(e=this.elementsNeedToResume).call(e,e=>{e.play().then(e=>{$u.debug("Auto resume audio element success")}).catch(e=>{$u.warning("Auto resume audio element failed!",e)})}),this.elementsNeedToResume=[]};new ic(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)})}};class Od extends Sd{constructor(e,t,n){super(e,n),this.trackMediaType="audio",this._enabled=!0,this._volume=100,this._useAudioElement=!0,this._encoderConfig=t,this._source=new Cd(e)}get isPlaying(){return this._useAudioElement?Ad.isPlaying(this.getTrackId()):this._source.isPlayed}setVolume(e){ye(e,"volume",0,1e3);let t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.LOCAL_AUDIO_TRACK_SET_VOLUME,options:[this.getTrackId(),e]},300);this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Ad.setVolume(this.getTrackId(),e);try{let e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,et(this,jl.NEED_REPLACE_TRACK,this._mediaStreamTrack).then(()=>{$u.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(e=>{$u.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)}))}catch(n){}t.onSuccess()}getVolumeLevel(){return this._source.getAudioLevel()}setPlaybackDevice(e){var t=this;return r(function*(){let n=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[t.getTrackId(),e]});if(!t._useAudioElement)throw new Zu(Cu.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{yield Ad.setSinkID(t.getTrackId(),e)}catch(r){throw n.onError(r),r}n.onSuccess()})()}setEnabled(e){var t=this;return r(function*(){var n;if(e!==t._enabled){$u.info("[".concat(t.getTrackId(),"] start setEnabled"),e);var r=yield t._enabledMutex.lock();if(!e){t._originMediaStreamTrack.enabled=!1;try{yield et(t,jl.NEED_REMOVE_TRACK,t)}catch(i){throw $u.error("[".concat(t.getTrackId(),"] setEnabled to false error"),i.toString()),r(),i}return t._enabled=!1,r()}t._originMediaStreamTrack.enabled=!0;try{yield et(t,jl.NEED_ADD_TRACK,t)}catch(i){throw $u.error("[".concat(t.getTrackId(),"] setEnabled to true error"),i.toString()),r(),i}$u.info(Us(n="[".concat(t.getTrackId(),"] setEnabled to ")).call(n,e," success")),t._enabled=!0,r()}})()}getStats(){return st(()=>{$u.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),tt(this,jl.GET_STATS)||Mt({},wl)}setAudioFrameCallback(e,t=4096){if(!e)return this._source.removeAllListeners(bl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(bl.ON_AUDIO_BUFFER),this._source.on(bl.ON_AUDIO_BUFFER,t=>e(t))}play(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.LOCAL_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});$u.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?($u.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Ad.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),e.onSuccess()}stop(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.LOCAL_AUDIO_TRACK_STOP,options:[this.getTrackId()]});$u.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ad.stop(this.getTrackId()):this._source.stop(),e.onSuccess()}close(){super.close(),this._source.destroy()}_updatePlayerSource(){$u.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ad.updateTrack(this.getTrackId(),this._mediaStreamTrack)}_updateOriginMediaStreamTrack(e,t){var n=this;return r(function*(){n._originMediaStreamTrack!==e&&(n._originMediaStreamTrack.removeEventListener("ended",n._handleTrackEnded),e.addEventListener("ended",n._handleTrackEnded),t&&n._originMediaStreamTrack.stop(),n._originMediaStreamTrack=e,n._source.updateTrack(n._originMediaStreamTrack),n._mediaStreamTrack!==n._source.outputTrack&&(n._mediaStreamTrack=n._originMediaStreamTrack,n._updatePlayerSource(),yield et(n,jl.NEED_REPLACE_TRACK,n._mediaStreamTrack)))})()}}class Nd extends Od{constructor(e,t,n,r){super(e,t.encoderConfig?Z(t.encoderConfig):{},r),this._deviceName="default",this._enabled=!0,this._config=t,this._constraints=n,this._deviceName=e.label}setDevice(e){var t=this;return r(function*(){var n,r;let i=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.MIC_AUDIO_TRACK_SET_DEVICE,options:[t.getTrackId(),e]});if($u.info(Us(n="[".concat(t.getTrackId,"] start set device to ")).call(n,e)),t._enabled)try{let r=yield sd.getDeviceById(e);(n={}).audio=Mt({},t._constraints),n.audio.deviceId={exact:e},t._originMediaStreamTrack.stop();let i=null;try{i=yield gt(n,t.getTrackId())}catch(o){throw $u.error("[track-".concat(t.getTrackId(),"] setDevice failed"),o.toString()),i=yield gt({video:t._constraints},t.getTrackId()),yield t._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),o}yield t._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),t._deviceName=r.label,t._config.microphoneId=e,t._constraints.deviceId={exact:e}}catch(s){throw i.onError(s),$u.error("[track-".concat(t.getTrackId(),"] setDevice error"),s.toString()),s}else try{t._deviceName=(yield sd.getDeviceById(e)).label,t._config.microphoneId=e,t._constraints.deviceId={exact:e}}catch(s){throw i.onError(s),$u.error("[track-".concat(t.getTrackId(),"] setDevice error"),s.toString()),s}i.onSuccess(),$u.info(Us(r="[".concat(t.getTrackId,"] set device to ")).call(r,e," success"))})()}setEnabled(e,t){var n=()=>super.setEnabled,i=this;return r(function*(){if(t)return $u.debug("[".concat(i.getTrackId,"] setEnabled false (do not close microphone)")),yield n().call(i,e);if(e!==i._enabled){if($u.info("[".concat(i.getTrackId(),"] start setEnabled"),e),t=yield i._enabledMutex.lock(),!e){i._originMediaStreamTrack.onended=null,i._originMediaStreamTrack.stop(),i._enabled=!1;try{yield et(i,jl.NEED_REMOVE_TRACK,i)}catch(o){throw $u.error("[".concat(i.getTrackId(),"] setEnabled false failed"),o.toString()),t(),o}return void t()}e=Mt({},i._constraints);var r=sd.searchDeviceIdByName(i._deviceName);r&&!e.deviceId&&(e.deviceId=r);try{let e=yield gt({audio:i._constraints},i.getTrackId());yield i._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),yield et(i,jl.NEED_ADD_TRACK,i)}catch(o){throw t(),$u.error("[".concat(i.getTrackId(),"] setEnabled true failed"),o.toString()),o}i._enabled=!0,$u.info("[".concat(i.getTrackId(),"] setEnabled success")),t()}})()}}class kd extends Od{constructor(e,t,n,r){super(t.createOutputTrack(),n,r),this.source=e,this._bufferSource=t,this._bufferSource.on(bl.AUDIO_SOURCE_STATE_CHANGE,e=>{this.emit(ql.SOURCE_STATE_CHANGE,e)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(i){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){let t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.BUFFER_AUDIO_TRACK_START,options:[this.getTrackId(),e,this.duration]});e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer(),t.onSuccess()}pauseProcessAudioBuffer(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.BUFFER_AUDIO_TRACK_PAUSE,options:[this.getTrackId()]});this._bufferSource.pauseProcessAudioBuffer(),e.onSuccess()}seekAudioBuffer(e){let t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.BUFFER_AUDIO_TRACK_SEEK,options:[this.getTrackId()]});this._bufferSource.seekAudioBuffer(e),t.onSuccess()}resumeProcessAudioBuffer(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.BUFFER_AUDIO_TRACK_RESUME,options:[this.getTrackId()]});this._bufferSource.resumeProcessAudioBuffer(),e.onSuccess()}stopProcessAudioBuffer(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.BUFFER_AUDIO_TRACK_STOP,options:[this.getTrackId()]});this._bufferSource.stopProcessAudioBuffer(),e.onSuccess()}}class Dd extends Od{constructor(){let e=Dt().createMediaStreamDestination();super(e.stream.getAudioTracks()[0]);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(t){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){var t;return-1!==vc(t=this.trackList).call(t,e)}addAudioTrack(e){var t;-1===vc(t=this.trackList).call(t,e)?($u.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):$u.warning("track is already added")}removeAudioTrack(e){var t;if(-1!==vc(t=this.trackList).call(t,e)){$u.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(n){}rt(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){var e;let t={};Qo(e=this.trackList).call(e,e=>{e._encoderConfig&&((e._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=e._encoderConfig.bitrate),(e._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=e._encoderConfig.sampleRate),(e._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=e._encoderConfig.sampleSize),e._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}}let Pd=new Do;class Ld extends Hh{constructor(e){super(),this.inChannelInfo={joinAt:null,duration:0},this._state="DISCONNECTED",this.needToSendUnpubUnsub=new Do,this.hasChangeBGPAddress=this.isSignalRecover=!1,this.joinGatewayStartTime=0,this._signalTimeout=!1,this.clientId=e.clientId,this.spec=e,this.signal=new yd(Vt({},e,{retryConfig:e.websocketRetryConfig})),this._statsCollector=e.statsCollector,this.role=e.role||"audience",this._clientRoleOptions=e.clientRoleOptions,this.handleSignalEvents()}get state(){return this._state}set state(e){if(e!==this._state){var t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(Bl.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(Bl.CONNECTION_STATE_CHANGE,e,t)}}join(e,t){var n=this;return r(function*(){var r,i;"disabled"!==e.cloudProxyServer&&(n.hasChangeBGPAddress=!0);let o=qh();var s=Pd.get(e.cname);if(s||(s=new Do,Pd.set(e.cname,s)),s.has(e.uid))throw s=new Zu(Cu.UID_CONFLICT),pd.joinGateway(e.sid,{lts:o,succ:!1,ec:s.message,addr:null,uid:e.uid,cid:e.cid}),s;s.set(e.uid,!0),n.joinInfo=e,n.key=t,t=e.proxyServer?ac(r=e.gatewayAddrs).call(r,t=>{var n,r;return t=t.split(":"),Us(n=Us(r="wss://".concat(e.proxyServer,"/ws/?h=")).call(r,t[0],"&p=")).call(n,t[1])}):ac(i=e.gatewayAddrs).call(i,e=>"wss://".concat(e)),r=0,n.joinGatewayStartTime=o;try{r=(yield n.signal.init(t)).uid}catch(a){throw $u.error("[".concat(n.clientId,"] User join failed"),a.toString()),pd.joinGateway(e.sid,{lts:o,succ:!1,ec:a.message,addr:n.signal.url,uid:e.uid,cid:e.cid}),s.delete(e.uid),n.signal.close(),a}return n.state="CONNECTED",n.inChannelInfo.joinAt=qh(),$u.debug("[".concat(n.clientId,"] Connected to gateway server")),n.trafficStatsInterval=window.setInterval(()=>{n.updateTrafficStats().catch(e=>{$u.warning("[".concat(n.clientId,"] get traffic stats error"),e.toString())})},3e3),n.networkQualityInterval=window.setInterval(()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?n.emit(Bl.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):n.emit(Bl.NETWORK_QUALITY,n._signalTimeout?{downlinkNetworkQuality:5,uplinkNetworkQuality:5}:"CONNECTED"===n.state&&n._statsCollector.trafficStats?{uplinkNetworkQuality:qe(n._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:qe(n._statsCollector.trafficStats.B_dnq)}:{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),r})()}leave(e=!1){var t=this;return r(function*(){if("DISCONNECTED"!==t.state){t.state="DISCONNECTING";try{if(!e&&t.signal.connectionState===_l.CONNECTED){var n=t.signal.request(yl.LEAVE,void 0,!0);yield ic.race([n,Qe(3e3)])}}catch(r){$u.warning("[".concat(t.clientId,"] leave request failed, ignore"),r)}t.signal.close(),t.reset(),t.state="DISCONNECTED"}})()}publish(e,t){var n=this;return r(function*(){if(!n.joinInfo)throw new Zu(Cu.UNEXPECTED_ERROR,"publish no joinInfo");let r=e.getUserId(),i=e.videoTrack?function(e){var t;if(!(e=e._encoderConfig))return{};const n={resolution:e.width&&e.height?Us(t="".concat(je(e.width),"x")).call(t,je(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return"number"==typeof e.frameRate?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}(e.videoTrack):{};if(e.on(Tl.NEED_ANSWER,(o,s,a)=>{var c;let u={state:"offer",stream_type:t,p2p_id:e.pc.ID,sdp:wr(o),audio:!!e.audioTrack,video:!!e.videoTrack,screen:e.videoTrack&&-1!==vc(c=e.videoTrack._hints).call(c,Gl.SCREEN_TRACK),attributes:i,dtx:e.audioTrack instanceof Nd&&e.audioTrack._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1,mode:n.spec.mode,codec:n.spec.codec,extend:gu.PUB_EXTEND};n.signal.request(yl.PUBLISH,u,!0).then(e=>{r&&n.needToSendUnpubUnsub.set(r,!0),s(JSON.parse(e.sdp))}).catch(t=>{if(o.retry&&t.data&&t.data.code===fl.ERR_PUBLISH_REQUEST_INVALID)return $u.warning("[".concat(n.clientId,"] receiver publish error code, retry"),t.toString()),Ze(e,Tl.NEED_UNPUB).then(()=>{o.retry=!1,Ze(e,Tl.NEED_ANSWER,o).then(s).catch(a)});t.code!==Cu.WS_ABORT&&a(t)})}),e.on(Tl.NEED_RENEGOTIATE,(r,i,o)=>{n.signal.request(yl.PUBLISH,{state:"negotiation",stream_type:t,p2p_id:e.pc.ID,sdp:r},!0).then(e=>{i(JSON.parse(e.sdp))}).catch(e=>{e.code!==Cu.WS_ABORT&&o(e)})}),e.on(Tl.NEED_UNPUB,i=>r&&!n.needToSendUnpubUnsub.has(r)?i(!1):"RECONNECTING"===n.state?i(!0):void n.signal.request(yl.UNPUBLISH,{stream_id:e.getUserId(),stream_type:t},!0).then(()=>i(!1)).catch(e=>{$u.warning("unpublish warning: ",e),i(!0)})),e.on(Tl.NEED_UPLOAD,(e,r)=>{n.signal.upload(e,{stream_type:t,stats:r})}),e.on(Tl.NEED_SIGNAL_RTT,e=>{e(n.signal.rtt)}),"RECONNECTING"!==n.state){if("CONNECTED"!==n.state)return new Zu(Cu.INVALID_OPERATION,"can not publish when connection state is ".concat(n.state)).throw();yield e.startP2PConnection()}else e.readyToReconnectPC()})()}subscribe(e){var t=this;return r(function*(){if(!t.joinInfo)throw new Zu(Cu.UNEXPECTED_ERROR,"subscribe no joinInfo");let n=e.getUserId();if(e.on(Tl.NEED_ANSWER,(r,i,o)=>{var s=e.subscribeOptions;s={stream_id:e.getUserId(),audio:!!s.audio,video:!!s.video,mode:t.spec.mode,codec:t.spec.codec,p2p_id:e.pc.ID,sdp:wr(r),tcc:!!gu.SUBSCRIBE_TCC,extend:gu.SUB_EXTEND},t.signal.request(yl.SUBSCRIBE,s,!0).then(e=>{t.needToSendUnpubUnsub.set(n,!0),i(JSON.parse(e.sdp))}).catch(n=>{if(r.retry&&n.data&&n.data.code===fl.ERR_SUBSCRIBE_REQUEST_INVALID)return $u.warning("[".concat(t.clientId,"] receiver subscribe error code, retry"),n.toString()),Ze(e,Tl.NEED_UNSUB).then(()=>{r.retry=!1,Ze(e,Tl.NEED_ANSWER,r).then(i).catch(o)});n.code!==Cu.WS_ABORT&&o(n)})}),e.on(Tl.NEED_UNSUB,r=>t.needToSendUnpubUnsub.has(n)?"RECONNECTING"===t.state?r(!0):void t.signal.request(yl.UNSUBSCRIBE,{stream_id:e.getUserId()},!0).then(()=>r(!1)).catch(e=>{$u.warning("unsubscribe warning",e),r(!0)}):r(!1)),e.on(Tl.NEED_UPLOAD,(n,r)=>{t.signal.upload(n,{stream_id:e.getUserId(),stats:r})}),e.on(Tl.NEED_SIGNAL_RTT,e=>{e(t.signal.rtt)}),"RECONNECTING"!==t.state){if("CONNECTED"!==t.state)return new Zu(Cu.INVALID_OPERATION,"can not subscribe when connection state is ".concat(t.state)).throw();yield e.startP2PConnection()}else e.readyToReconnectPC()})()}subscribeChange(e,t){var n=this;return r(function*(){var r,i;if(!n.joinInfo)throw new Zu(Cu.UNEXPECTED_ERROR,"subscribe no joinInfo");if(yield e.setSubscribeOptions(t),"RECONNECTING"!==n.state){if("CONNECTED"!==n.state)return new Zu(Cu.INVALID_OPERATION,"can not subscribe change when connection state is ".concat(n.state)).throw();$u.debug(Us(r=Us(i="[".concat(n.clientId,"] send subscribe change, audio: ")).call(i,t.audio,", video: ")).call(r,t.video)),yield n.signal.request(yl.SUBSCRIBE_CHANGE,{stream_id:e.getUserId(),audio:!!t.audio,video:!!t.video},!0)}})()}unsubscribe(e){return r(function*(){yield e.closeP2PConnection()})()}getGatewayInfo(){return this.signal.request(yl.GATEWAY_INFO)}renewToken(e){return this.signal.request(yl.RENEW_TOKEN,{token:e})}setClientRole(e,t){var n=this;return r(function*(){t&&(n._clientRoleOptions=Zo({},t)),"CONNECTED"===n.state?(yield n.signal.request(yl.SET_CLIENT_ROLE,{role:e,level:"audience"===e?n._clientRoleOptions&&n._clientRoleOptions.level?n._clientRoleOptions.level:2:0}),n.role=e):n.role=e})()}setRemoteVideoStreamType(e,t){var n=this;return r(function*(){yield n.signal.request(yl.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})})()}setStreamFallbackOption(e,t){var n=this;return r(function*(){yield n.signal.request(yl.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})})()}pickSVCLayer(e,t){var n=this;return r(function*(){yield n.signal.request(yl.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})})()}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=qh()-this.inChannelInfo.joinAt),Vt({},this.inChannelInfo)}getGatewayVersion(){var e=this;return r(function*(){return(yield e.signal.request(yl.GATEWAY_INFO)).version})()}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=qh()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let e=Pd.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.needToSendUnpubUnsub=new Do,this.key=this.joinInfo=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(this.joinInfo){var e=(e=(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex])||"").match(/(wss:\/\/)?([^:]+):(\d+)/))?{username:hu.username,password:hu.password,turnServerURL:e[2],tcpport:gs(e[3])+30,udpport:gs(e[3])+30,forceturn:!1}:null;this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(Vt({},hu,{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}}updateTrafficStats(){var e=this;return r(function*(){var t;if("CONNECTED"===e.state){var n=yield e.signal.request(yl.TRAFFIC_STATS,void 0,!0);n.timestamp=qh(),Qo(t=n.peer_delay).call(t,t=>{var n;let r=e._statsCollector.trafficStats&&Ac(n=e._statsCollector.trafficStats.peer_delay).call(n,e=>e.peer_uid===t.peer_uid);r&&r.B_st!==t.B_st&&ot(()=>{e.emit(Bl.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)})}),e._statsCollector.updateTrafficStats(n)}})()}getJoinMessage(){if(!this.joinInfo||!this.key)throw new Zu(Cu.UNEXPECTED_ERROR,"can not generate join message, no join info");let e=Zo({},this.joinInfo.apResponse);var t=gu.REPORT_APP_SCENARIO;if("string"!=typeof t)try{t=wr(t)}catch(n){t=void 0}return t&&128<t.length&&(t=void 0),t={session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:cu,browser:navigator.userAgent,process_id:gu.PROCESS_ID,mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:e,extends:gu.JOIN_EXTEND,details:{6:this.joinInfo.stringUid},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:t},this.joinInfo.stringUid&&(t.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(t.aes_mode=this.joinInfo.aesmode,gu.ENCRYPT_AES?(t.aes_secret=this.joinInfo.aespassword,t.aes_encrypt=!0):t.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(t.aes_salt=this.joinInfo.aessalt)),e.addresses[this.signal.websocket.currentURLIndex]&&(t.ap_response.ticket=e.addresses[this.signal.websocket.currentURLIndex].ticket,delete e.addresses),t}getRejoinMessage(){if(!this.joinInfo)throw new Zu(Cu.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(vl.WS_RECONNECTING,e=>{this.joinInfo&&pd.WebSocketQuit(this.joinInfo.sid,{lts:qh(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||gl.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",pd.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=qh())}),this.signal.on(vl.WS_CLOSED,e=>{let t;switch(e){case"LEAVE":t=gl.LEAVE;break;case"UID_BANNED":case"IP_BANNED":case"CHANNEL_BANNED":case"SERVER_ERROR":t=gl.SERVER_ERROR;break;default:t=gl.NETWORK_ERROR}$u.debug("[signal] websocket closed, reason: ".concat(t||"undefined -> "+gl.NETWORK_ERROR)),this.joinInfo&&pd.WebSocketQuit(this.joinInfo.sid,{lts:qh(),succ:"LEAVE"===e?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this.reset(),this._disconnectedReason=e,this.state="DISCONNECTED"}),this.signal.on(vl.WS_CONNECTED,()=>{var e,t;this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&this._clientRoleOptions.level&&($u.debug(Us(e=Us(t="[".concat(this.clientId,"] patch to send set client role, role: ")).call(t,this.role,", type: ")).call(e,this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),pd.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid}))}),this.signal.on(Sl.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(vl.REQUEST_RECOVER,(e,t,n)=>{if(!this.joinInfo)return n(new Zu(Cu.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Ze(this,Bl.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)}),this.signal.on(vl.REQUEST_JOIN_INFO,e=>{e(this.getJoinMessage())}),this.signal.on(vl.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(vl.REPORT_JOIN_GATEWAY,(e,t)=>{this.joinInfo&&pd.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid})}),this.signal.on(vl.IS_P2P_DISCONNECTED,e=>{e(nt(this,Bl.IS_P2P_DISCONNECTED))}),this.signal.on(vl.DISCONNECT_P2P,()=>{this.needToSendUnpubUnsub=new Do,this.emit(Bl.DISCONNECT_P2P)}),this.signal.on(vl.NEED_RENEW_SESSION,()=>{this.emit(Bl.NEED_RENEW_SESSION)}),this.signal.on(vl.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(vl.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0})}}let xd=1,Md=1,Ud=()=>{const e=gu.AREAS;return 0===e.length&&e.push("GLOBAL"),ss(e).call(e,(e,t,n)=>{var r,i,o,s,a,c;return(t="OVERSEA"===t?Us(r=Us(i=Us(o=Us(s=Us(a="".concat(zl.ASIA,",")).call(a,zl.EUROPE,",")).call(s,zl.AFRICA,",")).call(o,zl.NORTH_AMERICA,",")).call(i,zl.SOUTH_AMERICA,",")).call(r,zl.OCEANIA):zl[t])?0===n?t:Us(c="".concat(e,",")).call(c,t):e},"")};var Vd={ASIA:["CHINA","JAPAN","INDIA"],EUROPE:[],NORTH_AMERICA:[],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]};let Fd=ts(Vd),Bd="CHINA NORTH_AMERICA EUROPE ASIA JAPAN INDIA OCEANIA SOUTH_AMERICA AFRICA".split(" "),jd=new class extends Hh{constructor(){super(),this.retryConfig={timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4},this.mutex=new nd("config-distribute")}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},gu.CONFIG_DISTRIBUTE_INTERVAL)}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.cancelToken=this.joinInfo=this.interval=void 0}awaitConfigDistributeComplete(){var e=this;return r(function*(){e.mutex.isLocked&&(yield e.mutex.lock())()})()}updateConfigDistribute(){var e=this;return r(function*(){if(!e.joinInfo||!e.cancelToken||!e.retryConfig)return void $u.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=yield e.mutex.lock();try{t=yield function(e,t,n){return Kt.apply(this,arguments)}(e.joinInfo,e.cancelToken,e.retryConfig),$u.debug("[config-distribute] get config distribute",wr(t)),t.limit_bitrate&&e.handleBitrateLimit(t.limit_bitrate),e.configs=t}catch(r){const e=new Zu(Cu.NETWORK_RESPONSE_ERROR,r);$u.warning("[config-distribute] ".concat(e.toString()))}finally{n()}})()}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){e&&e.uplink&&e.id&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(Yl.UPDATE_BITRATE_LIMIT,e):this.emit(Yl.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&function(e){for(var t=1;t<arguments.length;t++){var n,r=null!=arguments[t]?arguments[t]:{};if(t%2)Qo(n=Xt(Object(r),!0)).call(n,function(t){Mh(e,t,r[t])});else if(eh)Jl(e,eh(r));else{var i;Qo(i=Xt(Object(r))).call(i,function(t){cs(e,t,bs(r,t))})}}return e}({},this.configs.limit_bitrate.low_stream_uplink)}};var Gd,qd=function(){function e(e){this.input=[],this.size=e}return e.prototype.add=function(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)},e.prototype.diffMean=function(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length},e}(),Hd=function(e,t){return(Hd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},Wd=function(){return(Wd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},zd={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[]},Kd={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0},Yd={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Qd={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Jd={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0},Xd=function(){function e(e,t){var n=this;this.videoIsReady=!1,this.stats=$t(zd),this.isFirstAudioDecoded=this.isFirstAudioReceived=this.isFirstVideoDecoded=this.isFirstVideoReceived=!1,this.lossRateWindowStats=[],this.pc=e,this.options=t,this.intervalTimer=window.setInterval(function(){return tn(n,void 0,void 0,function(){return nn(this,function(e){return this.updateStats(),[2]})})},this.options.updateInterval)}return e.prototype.getStats=function(){return this.stats},e.prototype.setVideoIsReady=function(e){this.videoIsReady=e},e.prototype.setIsFirstAudioDecoded=function(e){this.isFirstAudioDecoded=e},e.prototype.destroy=function(){window.clearInterval(this.intervalTimer)},e.prototype.calcLossRate=function(e){var t=this;this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);for(var n=this.lossRateWindowStats.length,r=0,i=0,o=0,s=0,a=function(a){e[a].forEach(function(e,c){if(t.lossRateWindowStats[n-1][a][c]&&t.lossRateWindowStats[0][a][c]){var u=t.lossRateWindowStats[n-1][a][c].packets-t.lossRateWindowStats[0][a][c].packets;c=t.lossRateWindowStats[n-1][a][c].packetsLost-t.lossRateWindowStats[0][a][c].packetsLost,"videoSend"===a||"audioSend"===a?(r+=u,o+=c):(i+=u,s+=c),e.packetLostRate=Number.isNaN(u)||Number.isNaN(u)||0>=u||0>=c?0:c/(u+c)}})},c=0,u=["videoSend","audioSend","videoRecv","audioRecv"];c<u.length;c++)a(u[c]);e.sendPacketLossRate=0>=r||0>=o?0:o/(r+o),e.recvPacketLossRate=0>=i||0>=s?0:s/(i+s)},e}(),$d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._stats=zd,t.lastDecodeVideoReceiverStats=new Map,t}return en(t,e),t.prototype.updateStats=function(){return tn(this,void 0,void 0,function(){var e,t,n,r;return nn(this,function(i){switch(i.label){case 0:return[4,this._getStats()];case 1:return e=i.sent(),t=this.statsResponsesToObjects(e),this._stats=$t(zd),n=t.filter(function(e){return"ssrc"===e.type}),this.processSSRCStats(n),(r=t.find(function(e){return"VideoBwe"===e.type}))&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},t.prototype.processBandwidthStats=function(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)},t.prototype.processSSRCStats=function(e){var t=this;e.forEach(function(e){var n=e.id.includes("send");switch(e.mediaType+"_"+(n?"send":"recv")){case"video_send":(n=$t(Yd)).codec=e.googCodecName,n.adaptionChangeReason="none",e.googCpuLimitedResolution&&(n.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(n.adaptionChangeReason="bandwidth"),n.avgEncodeMs=Number(e.googAvgEncodeMs),n.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},n.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},n.firsCount=Number(e.googFirReceived),n.nacksCount=Number(e.googNacksReceived),n.plisCount=Number(e.googPlisReceived),n.frameCount=Number(e.framesEncoded),n.bytes=Number(e.bytesSent),n.packets=Number(e.packetsSent),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.rttMs=Number(e.googRtt||0),t._stats.videoSend.push(n),t._stats.rtt=n.rttMs;break;case"video_recv":n=$t(Kd);var r=t.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(n.codec=e.googCodecName,n.targetDelayMs=Number(e.googTargetDelayMs),n.renderDelayMs=Number(e.googRenderDelayMs),n.currentDelayMs=Number(e.googCurrentDelayMs),n.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),n.decodeMs=Number(e.googDecodeMs),n.maxDecodeMs=Number(e.googMaxDecodeMs),n.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},n.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},n.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},n.jitterBufferMs=Number(e.googJitterBufferMs),n.firsCount=Number(e.googFirsSent),n.nacksCount=Number(e.googNacksSent),n.plisCount=Number(e.googPlisSent),n.framesDecodeCount=Number(e.framesDecoded),n.bytes=Number(e.bytesReceived),n.packets=Number(e.packetsReceived),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),0<n.packets&&!t.isFirstVideoReceived&&(t.onFirstVideoReceived&&t.onFirstVideoReceived(),t.isFirstVideoReceived=!0),0<n.framesDecodeCount&&!t.isFirstVideoDecoded&&(t.onFirstVideoDecoded&&t.onFirstVideoDecoded(n.decodedFrame.width,n.decodedFrame.height),t.isFirstVideoDecoded=!0),r){e=r.stats;var i=Date.now()-r.lts;n.framesDecodeFreezeTime=e.framesDecodeFreezeTime,n.framesDecodeInterval=e.framesDecodeInterval,n.framesDecodeCount>e.framesDecodeCount&&t.isFirstVideoDecoded?(r.lts=Date.now(),n.framesDecodeInterval=i,n.framesDecodeInterval>=t.options.freezeRateLimit&&(t.videoIsReady?n.framesDecodeFreezeTime+=n.framesDecodeInterval:t.setVideoIsReady(!0))):n.framesDecodeCount<r.stats.framesDecodeCount&&(n.framesDecodeInterval=0)}t.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:Wd({},n),lts:Date.now()}),t._stats.videoRecv.push(n);break;case"audio_recv":(n=$t(Jd)).codec=e.googCodecName,n.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,n.decodingCNG=Number(e.googDecodingCNG),n.decodingCTN=Number(e.googDecodingCTN),n.decodingCTSG=Number(e.googDecodingCTSG),n.decodingNormal=Number(e.googDecodingNormal),n.decodingPLC=Number(e.googDecodingPLC),n.decodingPLCCNG=Number(e.googDecodingPLCCNG),n.expandRate=Number(e.googExpandRate),n.accelerateRate=Number(e.googAccelerateRate),n.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),n.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),n.speechExpandRate=Number(e.googSpeechExpandRate),n.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),n.jitterBufferMs=Number(e.googJitterBufferMs),n.jitterMs=Number(e.googJitterReceived),n.bytes=Number(e.bytesReceived),n.packets=Number(e.packetsReceived),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),n.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),0<n.receivedFrames&&!t.isFirstAudioReceived&&(t.onFirstAudioReceived&&t.onFirstAudioReceived(),t.isFirstAudioReceived=!0),0<n.decodingNormal&&!t.isFirstAudioDecoded&&(t.onFirstAudioDecoded&&t.onFirstAudioDecoded(),t.isFirstAudioDecoded=!0),t._stats.audioRecv.push(n);break;case"audio_send":(n=$t(Qd)).codec=e.googCodecName,n.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,n.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),n.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),n.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),n.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),n.bytes=Number(e.bytesSent),n.packets=Number(e.packetsSent),n.packetsLost=Number(e.packetsLost),n.ssrc=Number(e.ssrc),n.rttMs=Number(e.googRtt||0),t._stats.rtt=n.rttMs,t._stats.audioSend.push(n)}})},t.prototype._getStats=function(){var e=this;return new Promise(function(t,n){e.pc.getStats(t,n)})},t.prototype.statsResponsesToObjects=function(e){var t=[];return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t.push(n)}),t},t}(Xd);!function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(Gd||(Gd={}));var Zd=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._stats=zd,t.lastDecodeVideoReceiverStats=new Map,t.lastVideoFramesRecv=new Map,t.lastVideoFramesSent=new Map,t.lastVideoFramesDecode=new Map,t.lastVideoJBDelay=new Map,t.lastAudioJBDelay=new Map,t.mediaBytesSent=new Map,t.mediaBytesRetransmit=new Map,t.mediaBytesTargetEncode=new Map,t.lastEncoderMs=new Map,t}return en(t,e),t.prototype.updateStats=function(){return tn(this,void 0,void 0,function(){var e,t=this;return nn(this,function(n){switch(n.label){case 0:return e=this,[4,this.pc.getStats()];case 1:return e.report=n.sent(),this._stats=$t(zd),this.report.forEach(function(e){switch(e.type){case Gd.OUTBOUND:"audio"===e.mediaType?t.processAudioOutboundStats(e):"video"===e.mediaType&&t.processVideoOutboundStats(e);break;case Gd.INBOUND:"audio"===e.mediaType?t.processAudioInboundStats(e):"video"===e.mediaType&&t.processVideoInboundStats(e);break;case Gd.TRANSPORT:(e=t.report.get(e.selectedCandidatePairId))&&t.processCandidatePairStats(e);break;case Gd.CANDIDATE_PAIR:e.selected&&t.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats,[2]}})})},t.prototype.processCandidatePairStats=function(e){this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(function(t){!t.rttMs&&e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(function(t){!t.rttMs&&e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})},t.prototype.processAudioInboundStats=function(e){var t=this._stats.audioRecv.find(function(t){return t.ssrc===e.ssrc});t||(t=$t(Jd),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,e.trackId&&this.processAudioTrackReceiverStats(e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),0<t.receivedFrames&&!this.isFirstAudioReceived&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.isFirstAudioReceived=!0),t.outputLevel&&0<t.outputLevel&&!this.isFirstAudioDecoded&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.isFirstAudioDecoded=!0)},t.prototype.processVideoInboundStats=function(e){var t=this._stats.videoRecv.find(function(t){return t.ssrc===e.ssrc});t||(t=$t(Kd),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded;var n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=Date.now();if(0<t.framesDecodeCount&&!this.isFirstVideoDecoded){var o=t.decodedFrame?t.decodedFrame.width:0,s=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o,s),this.isFirstVideoDecoded=!0}n&&(s=i-n.lts,t.framesDecodeFreezeTime=(o=n.stats).framesDecodeFreezeTime,t.framesDecodeInterval=o.framesDecodeInterval,t.framesDecodeCount>o.framesDecodeCount&&this.isFirstVideoDecoded?(n.lts=Date.now(),t.framesDecodeInterval=s,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.videoIsReady?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady(!0))):t.framesDecodeCount<o.framesDecodeCount&&(t.framesDecodeInterval=0)),r&&800<=i-r.lts?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),e.trackId&&this.processVideoTrackReceiverStats(e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),0<t.packets&&!this.isFirstVideoReceived&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(),this.isFirstVideoReceived=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:Wd({},t),lts:n?n.lts:Date.now()})},t.prototype.processVideoOutboundStats=function(e){var t=this._stats.videoSend.find(function(t){return t.ssrc===e.ssrc});t||(t=$t(Yd),this._stats.videoSend.push(t));var n,r=this.mediaBytesSent.get(e.ssrc);r?r.add(e.bytesSent):((n=new qd(10)).add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,n)),void 0!==e.retransmittedBytesSent&&((r=this.mediaBytesRetransmit.get(e.ssrc))?r.add(e.retransmittedBytesSent):((n=new qd(10)).add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,n))),e.totalEncodedBytesTarget&&((r=this.mediaBytesTargetEncode.get(e.ssrc))?r.add(e.totalEncodedBytesTarget):((n=new qd(10)).add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,n))),t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,e.totalEncodeTime&&e.framesEncoded&&(r=this.lastEncoderMs.get(e.ssrc),t.avgEncodeMs=!r||r.lastFrameCount>e.framesEncoded?1e3*e.totalEncodeTime/e.framesEncoded:1e3*(e.totalEncodeTime-r.lastEncoderTime)/(e.framesEncoded-r.lastFrameCount),this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lts:Date.now()})),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),e.trackId&&this.processVideoTrackSenderStats(e.trackId,t),e.remoteId?this.processRemoteInboundStats(e.remoteId,t):(r=this.findRemoteStatsId(e.ssrc,Gd.REMOTE_INBOUND))&&this.processRemoteInboundStats(r,t)},t.prototype.processAudioOutboundStats=function(e){var t=this._stats.audioSend.find(function(t){return t.ssrc===e.ssrc});if(t||(t=$t(Qd),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.trackId&&this.processAudioTrackSenderStats(e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{var n=this.findRemoteStatsId(e.ssrc,Gd.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}},t.prototype.findRemoteStatsId=function(e,t){var n=Array.from(this.report.values()).find(function(n){return n.type===t&&n.ssrc===e});return n?n.id:null},t.prototype.processVideoMediaSource=function(e,t){(e=this.report.get(e))&&e.width&&e.height&&e.framesPerSecond&&(t.inputFrame={width:e.width,height:e.height,frameRate:e.framesPerSecond})},t.prototype.processAudioMediaSource=function(e,t){(e=this.report.get(e))&&(t.inputLevel=e.audioLevel)},t.prototype.processVideoTrackSenderStats=function(e,t){if(e=this.report.get(e)){var n=0,r=Date.now(),i=this.lastVideoFramesSent.get(t.ssrc);i&&800<=r-i.lts?(n=Math.round((e.framesSent-i.count)/((r-i.lts)/1e3)),this.lastVideoFramesSent.set(t.ssrc,{count:e.framesSent,lts:r,rate:n})):i?n=i.rate:this.lastVideoFramesSent.set(t.ssrc,{count:e.framesSent,lts:r,rate:0}),t.sentFrame={width:e.frameWidth,height:e.frameHeight,frameRate:n}}},t.prototype.processVideoTrackReceiverStats=function(e,t){if(e=this.report.get(e)){var n=this.lastVideoFramesRecv.get(t.ssrc),r=Date.now();t.framesReceivedCount=e.framesReceived;var i=0;n&&800<=r-n.lts?(i=Math.round((e.framesReceived-n.count)/((r-n.lts)/1e3)),this.lastVideoFramesRecv.set(t.ssrc,{count:e.framesReceived,lts:r,rate:i})):n?i=n.rate:this.lastVideoFramesRecv.set(t.ssrc,{count:e.framesReceived,lts:r,rate:0}),t.receivedFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:i||0},t.decodedFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:t.decodeFrameRate||0},t.outputFrame={width:e.frameWidth||0,height:e.frameHeight||0,frameRate:t.decodeFrameRate||0},e.jitterBufferDelay&&e.jitterBufferEmittedCount&&(n=this.lastVideoJBDelay.get(t.ssrc),this.lastVideoJBDelay.set(t.ssrc,{jitterBufferDelay:e.jitterBufferDelay,jitterBufferEmittedCount:e.jitterBufferEmittedCount}),n||(n={jitterBufferDelay:0,jitterBufferEmittedCount:0}),t.jitterBufferMs=e=1e3*(e.jitterBufferDelay-n.jitterBufferDelay)/(e.jitterBufferEmittedCount-n.jitterBufferEmittedCount),t.currentDelayMs=Math.round(e))}},t.prototype.processAudioTrackSenderStats=function(e,t){(e=this.report.get(e))&&(t.aecReturnLoss=e.echoReturnLoss||0,t.aecReturnLossEnhancement=e.echoReturnLossEnhancement||0)},t.prototype.processAudioTrackReceiverStats=function(e,t){if(e=this.report.get(e)){if(e.removedSamplesForAcceleration&&e.totalSamplesReceived&&(t.accelerateRate=e.removedSamplesForAcceleration/e.totalSamplesReceived),e.jitterBufferDelay&&e.jitterBufferEmittedCount){var n=this.lastAudioJBDelay.get(t.ssrc);this.lastAudioJBDelay.set(t.ssrc,{jitterBufferDelay:e.jitterBufferDelay,jitterBufferEmittedCount:e.jitterBufferEmittedCount}),n||(n={jitterBufferDelay:0,jitterBufferEmittedCount:0}),t.jitterBufferMs=Math.round(1e3*(e.jitterBufferDelay-n.jitterBufferDelay)/(e.jitterBufferEmittedCount-n.jitterBufferEmittedCount))}t.outputLevel=e.audioLevel,n=1920,e.totalSamplesDuration&&e.totalSamplesReceived&&(n=e.totalSamplesReceived/e.totalSamplesDuration/50,t.receivedFrames=Math.round(e.totalSamplesReceived/n)),e.concealedSamples&&(t.droppedFrames=Math.round(e.concealedSamples/n))}},t.prototype.processRemoteInboundStats=function(e,t){(e=this.report.get(e))&&(t.packetsLost=e.packetsLost,e.roundTripTime&&(t.rttMs=1e3*e.roundTripTime))},t.prototype.getCodecFromCodecStats=function(e){return(e=this.report.get(e))&&(e=e.mimeType.match(/\/(.*)$/))&&e[1]?e[1]:""},t.prototype.updateSendBitrate=function(){var e=0,t=null,n=null;this.mediaBytesSent.forEach(function(t){e+=t.diffMean()}),this.mediaBytesRetransmit.forEach(function(e){t=null===t?e.diffMean():t+e.diffMean()}),this.mediaBytesTargetEncode.forEach(function(e){n=null===n?e.diffMean():n+e.diffMean()}),this._stats.bitrate={actualEncoded:8*(null!==t?e-t:e)/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))},t}(Xd),ep=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return en(t,e),t.prototype.updateStats=function(){return Promise.resolve()},t}(Xd);class tp{constructor(e){this.localCandidateCount=0,this.allCandidateReceived=!1,this.videoTrack=this.audioTrack=null,this.mediaStream=new MediaStream,this.ID=ip,ip+=1,this.spec=e,this.createPeerConnection(),e=this.pc;var t=void 0,n=void 0,r=xe()?1200:void 0;void 0===t&&(t=250),void 0===n&&(n=8),void 0===r&&(r=500);var i,o=(i=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i))&&i[0]?Number(i[0].split("/")[1]):null;this.statsFilter=o?76>o?new $d(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r}):new Zd(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r}):window.RTCStatsReport&&e.getStats()instanceof Promise?new Zd(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r}):new ep(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r})}get _statsFilter(){return this.statsFilter}getStats(){return this.statsFilter.getStats()}createOfferSDP(){var e=this;return r(function*(){try{let t=yield e.pc.createOffer(e.offerOptions);if(!t.sdp)throw Error("offer sdp is empty");return t.sdp}catch(Pu){throw $u.error("create offer error:",Pu.toString()),new Zu(Cu.CREATE_OFFER_FAILED,Pu.toString())}})()}setOfferSDP(e){var t=this;return r(function*(){try{yield t.pc.setLocalDescription({type:"offer",sdp:e})}catch(n){throw $u.error("set local offer error",n.toString()),new Zu(Cu.CREATE_OFFER_FAILED,n.toString())}})()}setAnswerSDP(e){var t=this;return r(function*(){try{yield t.pc.setRemoteDescription({type:"answer",sdp:e})}catch(n){if("InvalidStateError"!==n.name||"stable"!==t.pc.signalingState)throw $u.error("set remote answer error",n.toString()),new Zu(Cu.SET_ANSWER_FAILED,n.toString());$u.debug("[pc-".concat(t.ID,"] ignore invalidstate error"))}})()}close(){this.onConnectionStateChange=this.onICEConnectionStateChange=void 0;try{this.pc.oniceconnectionstatechange=null,this.pc.onconnectionstatechange=null,this.pc.onsignalingstatechange=null,this.pc.onicecandidateerror=null,this.pc.onicecandidate=null,this.pc.close(),this.pc=null}catch(Pu){}this.statsFilter.destroy()}createPeerConnection(){let e={iceServers:[{urls:"stun:webcs.agora.io:3478"}]},t=e=>{const t=[];return Qo(e).call(e,e=>{var n,r,i,o;e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:Us(n="turns:".concat((o=e.turnServerURL,o.match(/^[\.:\d]+$/)?"".concat(o.replace(/[^\d]/g,"-"),".edge.agora.io"):($u.info("Cannot recognized as IP address ".concat(o,". Used As Host instead")),o)),":")).call(n,e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:Us(r="turn:".concat(e.turnServerURL,":")).call(r,e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:Us(i="turn:".concat(e.turnServerURL,":")).call(i,e.tcpport,"?transport=tcp")}))}),t};var n,r;this.spec.iceServers?e.iceServers=this.spec.iceServers:this.spec.turnServer&&"off"!==this.spec.turnServer.mode&&(Ce(this.spec.turnServer.servers)?e.iceServers=this.spec.turnServer.servers:(e.iceServers&&e.iceServers.push(...t(this.spec.turnServer.servers)),e.iceServers&&this.spec.turnServer.serversFromGateway&&e.iceServers.push(...t(this.spec.turnServer.serversFromGateway)),Qo(n=Us(r=this.spec.turnServer.servers).call(r,this.spec.turnServer.serversFromGateway||[])).call(n,t=>{t.forceturn&&(e.iceTransportPolicy="relay")}))),gu.CHROME_FORCE_PLAN_B&&Ue()&&(e.sdpSemantics="plan-b",Ql.supportUnifiedPlan=!1),this.pc=new RTCPeerConnection(e,{optional:[{googDscp:!0}]}),this.pc.oniceconnectionstatechange=()=>{this.onICEConnectionStateChange&&this.onICEConnectionStateChange(this.pc.iceConnectionState)},this.pc.onconnectionstatechange=()=>{this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onsignalingstatechange=()=>{this.pc&&"closed"===this.pc.connectionState&&this.onConnectionStateChange&&this.onConnectionStateChange(this.pc.connectionState)},this.pc.onicecandidate=e=>{if(!e.candidate)return this.pc.onicecandidate=null,this.allCandidateReceived=!0,void $u.debug("[pc-".concat(this.ID,"] local candidate count"),this.localCandidateCount);this.localCandidateCount+=1},ld(()=>{this.allCandidateReceived||(this.allCandidateReceived=!0,$u.debug("[pc-".concat(this.ID,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},gu.CANDIDATE_TIMEOUT)}}class np extends tp{constructor(e){super(e)}setOfferSDP(e){var t=()=>super.setOfferSDP,n=this;return r(function*(){let r=gu.CUSTOM_PUB_OFFER_MODIFIER;return r&&(e=r(e)),yield t().call(n,e)})()}setAnswerSDP(e){var t=()=>super.setAnswerSDP,n=this;return r(function*(){let r=gu.CUSTOM_PUB_ANSWER_MODIFIER;return r&&(e=r(e)),yield t().call(n,e)})()}getAnswerSDP(){return this.pc.remoteDescription}getOfferSDP(){return this.pc.localDescription}addStream(e){var t=this;return r(function*(){e=e.getTracks();for(let n of e)yield t.addTrack(n)})()}replaceTrack(e){var t=this;return r(function*(){if(!Ql.supportReplaceTrack){var n="audio"===e.kind?t.audioTrack:t.videoTrack;if(!n)throw new Zu(Cu.UNEXPECTED_ERROR,"can not find replaced track");return t.removeTrack(n),yield t.addTrack(e),!0}let r=t.getSender(e.kind),i=Ac(n=t.mediaStream.getTracks()).call(n,t=>t.kind===e.kind);i&&t.mediaStream.removeTrack(i),t.mediaStream.addTrack(e);try{yield r.replaceTrack(e),"audio"===e.kind?t.audioTrack=e:t.videoTrack=e}catch(o){throw new Zu(Cu.SENDER_REPLACE_FAILED,o.toString())}return!1})()}removeTrack(e){let t=this.getSender(e.kind);this.mediaStream.removeTrack(e);try{this.pc.removeTrack(t)}catch(n){$u.warning("[pc-".concat(this.ID,"] remove track error, ignore"),n)}"audio"===e.kind?(this.audioTrack=null,this.audioSender=void 0,this.audioTransceiver&&(this.audioTransceiver.direction="inactive"),this.audioTransceiver=void 0):(this.videoTrack=null,this.videoSender=void 0,this.videoTransceiver&&(this.videoTransceiver.direction="inactive"),this.videoTransceiver=void 0)}onOfferSettled(){Ue()&&(this.audioSender&&gu.DSCP_TYPE&&this.setAudioRtpEncodingParameters({networkPriority:gu.DSCP_TYPE}).catch(e=>{$u.debug("set audio sender`s network priority failed")}),this.videoSender&&gu.DSCP_TYPE&&this.setVideoRtpEncodingParameters({networkPriority:gu.DSCP_TYPE}).catch(e=>{$u.debug("set video sender`s network priority failed")}))}addTrack(e){var t=this;return r(function*(){let n,i,o=Ql;if("audio"===e.kind&&t.audioTrack||"video"===e.kind&&t.videoTrack)throw new Zu(Cu.UNEXPECTED_ERROR,"Can't add multiple stream");var s;t.mediaStream.addTrack(e),o.supportUnifiedPlan?(n=yield(s=r(function*(e,t,n){var r;let i=Ac(r=e.getTransceivers()).call(r,e=>"inactive"===e.direction&&e.receiver.track.kind===t.kind);return i?(i.direction="sendrecv",yield i.sender.replaceTrack(t),i):e.addTransceiver(t,{direction:"sendrecv",streams:[n]})}),function(e,t,n){return s.apply(this,arguments)})(t.pc,e,t.mediaStream),i=n.sender):i=t.pc.addTrack(e,t.mediaStream),"audio"===e.kind?(t.audioTrack=e,t.audioSender=i,t.audioTransceiver=n):(t.videoTrack=e,t.videoSender=i,t.videoTransceiver=n)})()}setRtpSenderParameters(e,t){var n=this;return r(function*(){if(e=n.videoSender||(n.videoTransceiver?n.videoTransceiver.sender:void 0)){var r=e.getParameters();r.degradationPreference=t;try{yield e.setParameters(r)}catch(i){$u.debug("[".concat(n.ID,"] ignore RtpSender.setParameters"),i.toString())}}})()}setVideoRtpEncodingParameters(e){var t=this;return r(function*(){let n=t.videoSender||(t.videoTransceiver?t.videoTransceiver.sender:void 0);if(!n)throw new Zu(Cu.LOW_STREAM_ENCODING_ERROR,"Low stream has no video sender.");let r=n.getParameters();if(!r.encodings||!r.encodings[0])throw new Zu(Cu.LOW_STREAM_ENCODING_ERROR,"Low stream RtpEncodingParameters is empty.");e.scaleResolutionDownBy&&(r.encodings[0].scaleResolutionDownBy=e.scaleResolutionDownBy),e.maxBitrate&&(r.encodings[0].maxBitrate=e.maxBitrate),e.maxFramerate&&(r.encodings[0].maxFramerate=e.maxFramerate);let i=["very-low","low","medium","high"];return e.networkPriority&&Vc(i).call(i,e.networkPriority)&&($u.debug("set video sender network quality:",e.networkPriority),r.encodings[0].networkPriority=e.networkPriority),yield n.setParameters(r),n.getParameters()})()}setAudioRtpEncodingParameters(e){var t=this;return r(function*(){let n=t.audioSender||(t.audioTransceiver?t.audioTransceiver.sender:void 0);if(!n)throw new Zu(Cu.SET_ENCODING_PARAMETER_ERROR,"pc has no audio sender.");let r=n.getParameters();if(!r.encodings||!r.encodings[0])throw new Zu(Cu.SET_ENCODING_PARAMETER_ERROR,"pc RtpEncodingParameters is empty.");let i=["very-low","low","medium","high"];return e.networkPriority&&Vc(i).call(i,e.networkPriority)&&($u.debug("set audio sender network quality:",e.networkPriority),r.encodings[0].networkPriority=e.networkPriority),yield n.setParameters(r),n.getParameters()})()}getSender(e){var t,n,r=null;if(!(r=Ql.supportUnifiedPlan?(r=Ac(t=this.pc.getTransceivers()).call(t,t=>t.sender.track&&t.sender.track.kind===e))?r.sender:null:Ac(n=this.pc.getSenders()).call(n,t=>t.track&&t.track.kind===e)||null))throw new Zu(Cu.SENDER_NOT_FOUND);return r}}class rp extends tp{constructor(e){super(e),this.statsFilter.onFirstAudioDecoded=()=>this.onFirstAudioDecoded&&this.onFirstAudioDecoded(),this.statsFilter.onFirstVideoDecoded=(e,t)=>this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e,t),this.statsFilter.onFirstAudioReceived=()=>this.onFirstAudioReceived&&this.onFirstAudioReceived(),this.statsFilter.onFirstVideoReceived=()=>this.onFirstVideoReceived&&this.onFirstVideoReceived(),Ql.supportUnifiedPlan?(this.audioTransceiver=this.pc.addTransceiver("audio",{direction:"recvonly"}),this.videoTransceiver=this.pc.addTransceiver("video",{direction:"recvonly"})):this.offerOptions={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.pc.ontrack=e=>{"audio"===e.track.kind?this.audioTrack=e.track:this.videoTrack=e.track,this.onTrack&&this.onTrack(e.track,e.streams[0])}}setOfferSDP(e){var t=()=>super.setOfferSDP,n=this;return r(function*(){let r=gu.CUSTOM_SUB_OFFER_MODIFIER;return r&&(e=r(e)),yield t().call(n,e)})()}setAnswerSDP(e){var t=()=>super.setAnswerSDP,n=this;return r(function*(){let r=gu.CUSTOM_SUB_ANSWER_MODIFIER;return r&&(e=r(e)),yield t().call(n,e)})()}}let ip=1,op=1;class sp extends Hh{constructor(e,t){super(),this.startTime=qh(),this.createTime=qh(),this.readyToReconnect=!1,this._connectionState="disconnected",this.currentReconnectCount=0,this.ID=op,op+=1,this.joinInfo=e,this._userId=t,this.createPC()}get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this.emit(Tl.CONNECTION_STATE_CHANGE,e,this._connectionState),this._connectionState=e)}get connectionId(){var e,t;return Us(e=Us(t="".concat(this.joinInfo.clientId,"-")).call(t,this.type?this.type:"sub(".concat(this._userId,")"),"-")).call(e,this.ID)}getUserId(){return this._userId}startUploadStats(){this.statsUploadInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadStats(e,this.lastUploadPCStats),this.lastUploadPCStats=e},3e3),this.statsUploadSlowInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadSlowStats(e)},6e4),this.relatedStatsUploadInterval=window.setInterval(()=>{let e=this.pc.getStats();this.uploadRelatedStats(e,this.lastRelatedPcStats),this.lastRelatedPcStats=e},1e3)}stopUploadStats(){this.statsUploadInterval&&window.clearInterval(this.statsUploadInterval),this.relatedStatsUploadInterval&&window.clearInterval(this.relatedStatsUploadInterval),this.relatedStatsUploadInterval=this.statsUploadInterval=void 0}createWaitConnectionConnectedPromise(){return new ic((e,t)=>{"disconnected"===this.connectionState?t():"connected"===this.connectionState?e():this.once(Tl.CONNECTION_STATE_CHANGE,n=>{"connected"===n?e():t()})})}reconnectPC(e){var t=this;return r(function*(){if(t.readyToReconnect=!1,e&&t.onPCDisconnected(e),1/0<t.currentReconnectCount)throw $u.debug("[".concat(t.connectionId,"] cannot reconnect pc")),e||new Zu(Cu.UNEXPECTED_ERROR);if(t.stopUploadStats(),$u.debug("[".concat(t.connectionId,"] start reconnect pc")),t.connectionState="connecting",t.currentReconnectCount+=1,yield t.closePC())return $u.debug("[".concat(t.connectionId,"] abort reconnect pc, wait ws")),void t.readyToReconnectPC();t.createPC(),yield t.startP2PConnection(),t.currentReconnectCount=0})()}readyToReconnectPC(){this.stopUploadStats(),this.readyToReconnect=!0,this.pc.onICEConnectionStateChange=void 0,this.connectionState="connecting"}updateICEPromise(){this.removeAllListeners(Tl.GATEWAY_P2P_LOST),this.icePromise=new ic((e,t)=>{this.pc.onICEConnectionStateChange=n=>{var r,i;$u.info(Us(r=Us(i="[".concat(this.connectionId,"] ice-state: ")).call(i,this.type," p2p ")).call(r,n)),"connected"===n&&e(),"failed"!==n&&"closed"!==n||this.reconnectPC(new Zu(Cu.ICE_FAILED)).catch(e=>{this.emit(Tl.P2P_LOST),t(e)})},this.pc.onConnectionStateChange=e=>{var n,r;$u.info(Us(n=Us(r="[".concat(this.connectionId,"] connection-state: ")).call(r,this.type," p2p ")).call(n,e)),"failed"!==e&&"closed"!==e||this.reconnectPC(new Zu(Cu.PC_CLOSED)).catch(e=>{this.emit(Tl.P2P_LOST),t(e)})},this.removeAllListeners(Tl.GATEWAY_P2P_LOST),this.once(Tl.GATEWAY_P2P_LOST,e=>{var n;if(this.pc.ID.toString()===e.toString()){if($u.info(Us(n="[".concat(this.connectionId,"] ")).call(n,this.type," p2p gateway lost")),this.pc.allCandidateReceived&&0===this.pc.localCandidateCount)return this.disconnectedReason=new Zu(Cu.NO_ICE_CANDIDATE,"can not get candidate in this pc"),void this.closeP2PConnection(!0);this.reconnectPC(new Zu(Cu.GATEWAY_P2P_LOST)).catch(e=>{this.emit(Tl.P2P_LOST),t(e)})}})})}}class ap{constructor(e){this.freezeTimeCounterList=[],this.lastTimeUpdatedTime=this.playbackTime=this.freezeTime=this.timeUpdatedCount=0,this._videoElementStatus=tl.NONE,this.isGettingVideoDimensions=!1,this.handleVideoEvents=e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=tl.PLAYING;break;case"loadeddata":this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded();break;case"canplay":this.videoElementStatus=tl.CANPLAY;break;case"stalled":this.videoElementStatus=tl.STALLED;break;case"suspend":this.videoElementStatus=tl.SUSPEND;break;case"pause":this.videoElementStatus=tl.PAUSED,this.videoElement&&this.videoTrack&&"live"===this.videoTrack.readyState&&($u.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=tl.WAITING;break;case"abort":this.videoElementStatus=tl.ABORT;break;case"ended":this.videoElementStatus=tl.ENDED;break;case"emptied":this.videoElementStatus=tl.EMPTIED;break;case"timeupdate":{if(e=qh(),this.timeUpdatedCount+=1,10>this.timeUpdatedCount)return void(this.lastTimeUpdatedTime=e);let t=e-this.lastTimeUpdatedTime;for(this.lastTimeUpdatedTime=e,500<t&&(this.freezeTime+=t),this.playbackTime+=t;6e3<=this.playbackTime;)this.playbackTime-=6e3,this.freezeTimeCounterList.push(Math.min(6e3,this.freezeTime)),this.freezeTime=Math.max(0,this.freezeTime-6e3)}}},this.startGetVideoDimensions=()=>{let e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement&&4<this.videoElement.videoWidth*this.videoElement.videoHeight)return $u.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);ld(e,500)};!this.isGettingVideoDimensions&&e()},this.slot=e.element,this.trackId=e.trackId,this.updateConfig(e)}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){var t,n;e!==this._videoElementStatus&&($u.debug(Us(t=Us(n="[".concat(this.trackId,"] video-element-status change ")).call(n,this._videoElementStatus," => ")).call(t,e)),this._videoElementStatus=e)}updateConfig(e){this.config=e,this.trackId=e.trackId,(e=e.element)!==this.slot&&(this.destroy(),this.slot=e),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(){if(this.videoElement){let e=this.videoElement.play();e&&e.catch&&e.catch(e=>{$u.warning("[".concat(this.trackId,"] play warning: "),e)})}}getCurrentFrame(){if(!this.videoElement)return new ImageData(2,2);let e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;var t=e.getContext("2d");return t?(t.drawImage(this.videoElement,0,0,e.width,e.height),t=t.getImageData(0,0,e.width,e.height),e.remove(),t):($u.error("create canvas context failed!"),new ImageData(2,2))}destroy(){if(this.videoElement&&(this.videoElement.srcObject=null,this.videoElement=void 0),this.container){try{this.slot.removeChild(this.container)}catch(Pu){}this.container=void 0}this.freezeTimeCounterList=[]}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",this.createVideoElement(),this.container.appendChild(this.videoElement)):this.removeVideoElement(),this.slot.appendChild(this.container)}createVideoElement(){this.videoElement||(this.videoElementStatus=tl.INIT,this.videoElement=document.createElement("video"),this.videoElement.onerror=()=>this.videoElementStatus=tl.ERROR,this.container&&this.container.appendChild(this.videoElement),Qo(cp).call(cp,e=>{this.videoElement&&this.videoElement.addEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{!document.getElementById("video_".concat(this.trackId))&&this.videoElement&&(this.videoElementStatus=tl.DESTROYED)},1e3)),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),this.videoElement.style.left="0",this.videoElement.style.top="0",this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)"),this.videoElement.style.objectFit=this.config.fit?this.config.fit:"cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,this.videoElement.load());let e=this.videoElement.play();void 0!==e&&e.catch(e=>{$u.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())})}removeVideoElement(){if(this.videoElement){Qo(cp).call(cp,e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0);try{this.container&&this.container.removeChild(this.videoElement)}catch(Pu){}this.videoElement=void 0,this.videoElementStatus=tl.NONE}}}let cp="play playing loadeddata canplay pause stalled suspend waiting abort emptied ended timeupdate".split(" ");var up;!document.documentMode&&window.StyleMedia&&(HTMLCanvasElement.prototype.getContext=(up=HTMLCanvasElement.prototype.getContext,function(){let e=arguments;return"webgl"===e[0]&&(e=wc([]).call(arguments),e[0]="experimental-webgl"),up.apply(null,e)}));let lp=[31,222,239,159,192,236,164,81,54,227,176,149,2,247,75,141,183,54,213,216,158,92,111,49,228,111,150,6,135,79,35,212,4,155,200,168,37,107,243,110,144,179,51,81,55,78,223,242,191,211,74,119,203,151,142,62,31,41,132,22,35,155,87,123,119,117,216,57,201,53,228,67,201,40,106,24,80,176,187,253,60,63,136,100,20,12,177,99,64,38,101,143,111,176,251,211,145,136,34,23,79,136,202,95,105,199,125,67,180,44,210,179,228,4,85,160,188,64,26,46,6,61,201,103,248,18,97,254,140,36,115,106,48,124,102,216,155,120,36,227,165,217,7,227,191,128,212,157,80,37,117,175,24,214,47,221,183,211,51,174,251,223,159,167,152,53,36,107,199,223,91,62,46,194,11,80,121,188,219,2,99,99,232,229,173,234,21,30,236,177,243,142,97,48,108,56,62,172,56,216,3,42,79,138,23,88,182,39,5,118,68,135,178,56,9,94,189,44,104,9,238,231,174,122,85,247,231,86,74,8,189,147,218,180,58,76,227,17,46,90,194,100,51,178,72,163,151,243,166,130,85,1,223,130,152,242,85,255,28,173,97,252,119,215,177,119,86,104,136,82,40,72,53,11,18,26,240,188,76,110,39,31,189],hp=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,152,221,191,124,116,248,106,130,251,59,105,43,91,135,199,181,223,10,51,134,194,240,46,9,3,141,22,35,146,76,23,109,117,208,41,201,45,218,76,203,105,51,58,97,154,145,236,49,18,183,127,27,12,210,122,73,42,37,143,36,207,251,211,145,191,56,10,88,222,181,125,22,238,123,71,177,107,218,254,173,28,34,253,249,67,83,97,73,111,219,43,181,82,38,230,136,109,22,67];class dp{constructor(e,t){this.gl=e,this.kernel=t||hp,e=this.gl,t=on(this.kernel),t=function(e,t,n,r){let i=[];for(let o=0;o<t.length;++o)i.push(rn(e,t[o],0===o?e.VERTEX_SHADER:e.FRAGMENT_SHADER));return function(e,t,n,r){let i=e.createProgram();if(!i)throw new Zu(Cu.WEBGL_INTERNAL_ERROR,"can not create webgl program");if(Qo(t).call(t,t=>{e.attachShader(i,t)}),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw t=e.getProgramInfoLog(i),e.deleteProgram(i),new Zu(Cu.WEBGL_INTERNAL_ERROR,"error in program linking:"+t);return i}(e,i)}(e,[on(lp),t]);var n=e.getAttribLocation(t,"a_position"),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),n=e.getAttribLocation(t,"a_texCoord"),r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,2,e.FLOAT,!1,0,0),this.program=e=t}setUniforms(){let e=this.gl.getUniformLocation(this.program,"u_flipY");this.gl.uniform1f(e,1)}}class pp extends dp{constructor(e,t,n,r){super(e,t),this.denoiseLevel=5,this.xOffset=1/n,this.yOffset=1/r}setUniforms(){let e=this.gl.getUniformLocation(this.program,"u_flipY"),t=this.gl.getUniformLocation(this.program,"u_singleStepOffset"),n=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform2f(t,this.xOffset,this.yOffset),this.gl.uniform1f(n,this.denoiseLevel),this.gl.uniform1f(e,1)}setParameters(e){void 0!==e.denoiseLevel&&(this.denoiseLevel=e.denoiseLevel)}setSize(e,t){this.xOffset=1/e,this.yOffset=1/t}}let fp=[11,196,242,139,198,252,188,5,59,170,161,152,17,229,24,141,133,54,214,206,133,26,66,126,255,11,245,10,146,92,52,134,108,155,210,164,99,114,228,96,130,251,59,105,43,91,135,199,181,223,10,51,133,194,247,34,31,39,142,28,2,130,18,109,84,124,223,62,140,52,128,47,208,47,115,39,4,200,220,171,53,36,150,101,10,75,247,121,74,36,35,143,108,176,235,211,135,164,36,11,88,160,148,35,6,221,41,32,166,109,205,171,228,4,26,169,244,82,119,102,86,61,201,103,248,18,97,242,182,34,121,70,28,71,126,197,223,126,14,244,149,192,12,176,187,149,212,156,22,44,36,133,10,216,63,198,213,154,116,230,253,154,154,249,215,55,60,34,196,229,76,50,44,135,22,77,113,247,142,94,60,23,172,145,175,218,81,86,162,239,180,205,63,118,3,110,123,224,127,158,124,15,127,157,27,66,176,33,24,51,53,194,178,56,6,74,191,111,51,78,174,157,229,17,22,178,231,92,25,23,191,157,137,188,54,64,176,13,22,81,207,45,108,203,83,186,130,237,186,153,110,8,196,168,152,161,28,238,46,184,36,185,20,203,183,98,95,41,149,93,105,37,116,91,68,105,164,217,30,42,60,53,173,213,177,216,195,53,204,173,128,243,42,122,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,220,161,39,214,146,183,193,225,23,177,201,243,128,160,33,75,86,126,139,254,232,14,13,85,2,112,17,150,36,180,86,226,225,126,197,17,228,225,142,245,37,170,39,96,187,190,2,35,85,237,11,189,1,79,237,2,1,114,246,109,190,66,54,153,43,218,204,70,6,204,162,247,18,130,123,30,60,165,130,142,210,133,91,127,117,71,38,145,172,7,5,16,220,222,111,98,141,239,208,125,26,238,28,0,216,89,13,7,119,134,194,75,41,67,174,1,217,80,101,40,26,59,28,59,46,108,138,38,157,167,28,234,73,177,42,42,102,108,26,181,27,178,42,43,52,28,110,117,198,173,176,178,101,225,150,36,139,108,105,10,237,222,3,143,126,18,144,115,74,56,114,134,231,159,212,62,126,80,173,216,167,4,81,18,52,17,144,218,32,139,207,104,128,229,99,84,120,31,87,227,154,91,196,63,123,111,125,36,52,57,168,113,150,189,204,24,104,196,237,86,163,68,197,202,170,212,191,81,193,111,255,162,181,202,156,146,196,96,16,118,117,55,71,156,31,163,242,204,239,11,150,27,126,115,154,107,247,134,158,125,255,146,35,183,209,36,116,87,215,172,5,251,133,114,254,141,195,6,145,4,111,182,167,74,154,152,68,18,146,88,106,200,154,15,176,94,86,66,178,101,219,35,188,129,66,28,41,110,174,53,88,174,64,191,206,127,48,126,214,216,93,119,2,166,99,181,222,29,218,28,195,219,125,44,50,16,99,174,225,51,133,120,184,159,168,75,242,162,124,255,81,25,153,109,69,220,176,4,237,196,233,19,8,240,160,39,122,81,29,188,144,249,170,174,137,30,10,93,133,151,199,248,175,38,41,144,229,245,149,25,240,138,179,114,182,84,50,103,95,31,199,31,87,208,203,199,135,49,211,43,52,36,74,59,37,22,136,171,244,126,18,251,39,159,241,66,206,127,149,159,182,143,232,199,136,46,150,32,51,221,74,22,102,93,22,44,132,140,199,43,69,249,77,75,140,70,4,252,98,235,77,190,125,18,56,21,10,244,42,2,246,62,127,241,123,137,22,247,219,177,160,84,18,10,84,97,251,127,102,16,209,181,100,94,56,238,209,207,76,189,95,15,165,139,143,189,96,225,55,112,178,27,218,198,223,251,52,123,94,130,220,142,216,116,237,18,254,49,59,128,41,29,15,179,164,85,76,167,166,151,39,221,2,190,68,167,26,177,114,141,4,67,25,69,182,38,166,160,27,151,148,108,48,227,60,112,48,22,159,76,127,251,63,254,177,113,217,197,95,179,109,128,138,99,27,249,10,174,155,129,80,39,165,252,85,60,131,183,98,107,68,207,19,233,231,55,225,126,77,49,53,145,203,113,29,208,64,237,182,229,165,7,11,169,106,253,116,141,200,62,16,38,121,55,148,91,83,160,140,126,121,12,79,189,72,172,31,243,240,209,229,32,220,91,229,81,94,247,121,153,151,232,182,171,198,50,31,152,245,172,151,130,55,62,125,38,155,229,78,207,148,201,2,78,63,119,107,168,78,139,141,163,177,191,239,141,39,182,174,40,76,226,62,125,209,6,6,34,37,147,85,204,103,51,191,36,248,17,175,20,1,53,16,35,143,237,177,125,86,29,219,235,20,121,205,59,5,250,107,109,32,224,30,152,143,113,151,95,85,19,254,164,135,124,68,136,199,29,31,244,91,10,84,127,101,210,70,226,195,140,70,166,54,217,165,84,42,165,175,100,234,124,121,105,53,101,118,174,101,220,147,68,161,37,0,182,220,142,221,155,230,115,164,10,214,208,120,91,152,66,27,81,184,48,84,70,7,128,153,217,218,249,226,70,130,200,156,61,227,21,164,137,193,221,119,10,134,204,23,20,17,90,94,105,204,39,99,1,64,153,45,213,19,247,97,194,49,35,125,255,195,139,63,209,175,208,147,189,244,204,24,211,99,142,18,92,130,254,182,231,235,93,10,127,175,87,35,62,110,137,184,39,114,200,150,11,190,40,162,168,223,203,110,242,192,234,26,11,54,155,38,48,79,109,101,119,165,187,223,5,20,168,171,241,20,243,108,199,3,155,69,244,149,0,187,110,12,233,42,151,189,139,133,104,3,30,16,200,69,4,123,103,144,12,106,182,1,127,91,125,158,12,144,238,232,209,101,159,56,163,240,179,50,169,120,219,176,87,77,45,247,153,190,82,132,50,137,209,97,19,35,247,161,62,77,16,71,152,72,61,50,99,157,154,56,58,175,27,73,121,229,195,228,132,69,233,169,100,21,123,17,3,164,6,146,106,196,29,3,250,217,164,23,171,203,14,242,239,249,169,116,138,209,98,113,181,122,35,162,216,46,230,4,155,142,118,216,232,229,28,12,158,153,126,149,171,172,231,99,211,57,114,136,183,114,74,35,233,115,127,253,157,38,49,136,141,25,161,255,232,110,101,208,166,186,226,12,185,19,155,53,93,155,39,161,7,124,213,52,223,125,211,242,253,22,13,131,115,167,198,188,90,209,63,224,92,112,118,220,165,31,164,43,58,197,77,17,247,77,164,74,77,218,18,187,41,76,189,127,98,18,226,231,71,115,236,68,183,111,50,168,88,247,9,123,65,180,88,74,44,101,101,173,11];class mp extends pp{constructor(e,t,n){super(e,fp,t,n)}}let gp=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,165,108,122,254,125,130,229,55,109,113,11,210,238,163,213,86,116,156,248,215,63,20,48,173,31,55,133,18,105,32,16,204,35,128,38,212,87,200,97,114,40,12,210,193,171,59,33,158,108,14,75,228,74,65,32,57,192,112,156,234,250,140,189,40,20,6,230,135,52,17,200,123,68,183,44,215,187,234,2,13,169,234,94,115,60,6,107,224,118,254,88,2,235,134,36,120,5,85,94,126,222,223,101,105,227,147,199,64,185,246,143,183,210,30,37,127,226,79,156,118,147,208,131,51,248,232,217,206,181,218,58,61,112,244,227,68,45,41,206,69,12,45,163,205,75,6,23,167,145,250,237,92,84,164,240,253,216,54,85,7,108,62,255,42,217,3,27,0,196,94,28,241,120,80,92,89,135,228,125,2,3,242,39,116,64,248,216,177,122,66,178,180,9,7,33,186,208,213,188,59,78,243,95,123,28,142,45,99,130,7,167,194,156,238,199,10,71,141,251,221,158,16,255,38,181,36,184,20,136,240,55,27,51,191,82,105,55,97,78,74,121,191,161,91,126,105,103,174,139,223,145,150,120,156,240,252,182,105,104,205,65,97,129,194,68,218,91,141,11,224,124,132,138,119,36,201,211,39,203,146,225,246,252,21,161,250,188,137,190,42,4,90,126,211,171,240,113,67,28,92,57,77,200,125,224,19,178,142,112,202,5,233,229,128,235,105,239,102,52,179,224,87,45,68,211,10,187,9,38,190,86,25,43,175,56,231,11,108,220,36,129,131,19,93,163,239,169,118,205,50,77,121,139,139,141,197,170,20,44,39,19,97,205,228,8,106,67,210,135,111,127,141,185,175,123,26,226,42,29,217,16,99,9,46,157,232,22,3,105,174,73,144,23,110,55,84,46,4,116,39,113,205,58,158,242,7,208,75,162,55,115,35,52,124,235,114,178,55,43,98,17,100,33,134,237,190,230,60,184,192,104,146,52,58,79,174,180,81,155,114,0,153,113,90,51,86,150,254,136,205,104,39,11,190,187,233,80,81,81,56,18,222,148,116,155,156,33,132,226,127,84,34,83,28,249,153,18,197,10,116,102,125,45,47,36,235,46,212,166,209,3,125,132,237,124,163,68,197,202,232,152,234,75,235,103,248,160,241,213,151,144,130,37,23,51,48,55,12,227,31,163,242,251,245,22,129,77,20,35,150,20,181,203,138,69,233,215,109,178,209,52,85,96,221,179,56,249,138,111,250,141,134,95,152,92,109,183,174,104,151,156,31,66,211,10,57,141,167,18,177,27,126,74,252,29,143,121,173,203,8,27,44,123,148,57,88,163,68,228,158,62,98,121,192,228,94,92,72,241,33,230,173,0,197,1,194,144,111,91,60,0,106,181,203,51,133,120,250,158,184,93,216,184,126,253,21,22,155,99,80,205,227,69,231,141,165,71,70,252,223,105,51,93,22,165,135,233,177,164,139,53,5,85,151,134,214,165,249,100,24,186,207,245,149,68,218,204,252,32,190,90,48,76,57,31,201,15,52,130,135,152,206,63,198,100,126,36,2,104,116,0,160,163,186,2,91,165,57,149,163,12,239,121,152,209,224,136,248,135,136,46,150,32,51,154,6,105,0,71,30,44,175,147,139,34,91,184,78,31,145,18,3,250,122,166,47,252,109,19,40,10,123,163,99,76,133,119,37,180,38,207,79,171,185,188];class _p extends pp{constructor(e,t,n){super(e,gp,t,n)}}let vp=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,160,96,121,255,120,207,227,114,120,38,72,149,145,165,227,75,122,158,250,232,46,34,52,135,9,30,144,17,110,126,110,130,71,156,46,210,67,202,51,119,97,3,211,214,227,45,109,151,97,21,10,229,53,80,26,51,202,119,128,230,197,140,135,40,14,88,128,202,95,21,208,96,83,185,98,216,242,224,15,25,224,233,86,96,46,80,120,220,48,187,86,30,240,140,46,95,81,48,90,117,140,177,51,107,235,158,137,5,241,191,154,149,219,30,126,85,175,10,216,63,139,216,151,122,251,224,202,220,227,221,53,122,34,213,224,94,45,14,200,68,31,61,175,208,17,120,82,244,138,208,165,21,19,236,232,180,217,50,74,70,126,114,227,62,192,124,9,85,148,33,77,255,117,75,102,87,151,255,87,74,74,181,111,108,9,249,220,174,59,80,254,168,29,30,94,171,133,133,195,105,64,254,68,65,18,158,54,73,203,65,175,151,170,236,138,17,119,128,237,214,189,28,250,38,149,97,242,81,212,254,57,18,120,155,64,96,108,75,78,74,121,191,243,30,42,60,103,165,196,160,195,216,99,182,173,214,182,105,53,231,3,45,212,144,101,217,65,141,44,230,125,151,154,123,57,134,223,98,133,156,238,137,181,80,175,230,167,131,180,13,69,77,44,156,165,252,14,27,85,71,1,82,196,64,243,26,167,146,98,201,6,195,247,200,224,44,177,104,109,187,231,83,118,28,159,92,179,28,14,162,81,84,21,168,34,156,21,127,215,88,218,208,11,92,161,239,239,82,221,59,86,83,201,199,216,151,139,23,54,39,52,103,204,247,24,102,94,157,138,42,49,131,183,208,50,95,236,54,6,211,26,68,72,56,212,134,24,91,114,132,1,217,80,38,47,29,47,0,107,102,99,129,33,140,243,74,251,89,247,103,12,114,58,113,240,72,188,39,48,72,89,45,102,206,245,247,231,56,167,129,122,222,47,40,78,227,159,64,206,34,127,203,127,87,40,108,152,238,147,231,46,104,89,182,180,232,86,89,91,57,10,222,202,59,199,135,60,199,189,40,84,125,28,84,162,210,91,143,34,106,117,118,3,125,126,237,60,131,173,153,69,49,212,204,117,163,31,239,202,232,152,234,3,162,32,176,184,184,196,154,131,144,115,6,53,122,55,69,166,19,230,183,175,244,1,156,11,37,121,134,121,152,142,158,125,229,150,44,183,216,109,7,65,222,169,56,222,140,110,233,157,138,66,208,6,111,166,188,76,208,222,4,104,211,10,57,141,243,65,228,86,85,88,169,91,237,56,249,133,77,21,32,37,230,55,0,184,110,228,158,62,98,45,147,177,19,119,89,164,103,132,239,84,139,68,204,157,49,41,50,89,113,159,203,51,133,120,184,210,237,15,249,187,100,253,50,16,154,112,64,193,254,10,235,200,253,84,31,169,171,39,122,70,46,186,139,212,162,173,158,41,23,86,148,172,196,237,242,58,102,180,150,238,191,25,240,204,252,125,148,29,124,51,95,10,196,55,49,159,138,144,255,126,205,43,49,42,17,59,60,77,139,177,239,64,36,224,98,205,234,70,199,103,139,218,206,207,178,217,255,32,134,59,25,221,74,22,102,82,19,20,170,142,134,42,106,249,64,80,222,28,21,169,50,235,4,237,56,81,87,76,32,251,42,6,173,105,54,191,8,136,5,245,206,239,176,9,116,24];class yp extends pp{constructor(e,t,n){super(e,vp,t,n)}}let Ep=[11,196,242,139,198,252,188,5,32,162,171,128,13,160,25,222,172,102,207,244,158,69,103,57,239,111,150,18,157,82,55,210,20,131,156,190,100,112,230,97,199,225,96,74,99,94,248,222,162,213,95,122,158,212,233,42,22,37,217,115,36,152,30,123,116,104,212,109,129,41,220,77,213,97,124,45,4,219,197,171,40,18,149,104,20,4,248,102,64,9,50,217,124,131,180,188,159,170,63,1,84,130,150,117,14,212,118,67,165,97,207,242,251,15,30,187,188,77,79,122,67,101,252,109,244,82,37,191,227,35,114,87,57,71,99,218,155,54,101,239,138,197,13,226,228,176,157,158,87,98,55,251,79,150,64,138,200,135,40,132,135,207,146,252,222,57,58,111,151,225,78,59,36,210,70,29,121,160,210,31,109,67,167,194,177,236,91,108,164,229,130,211,59,66,93,18,107,226,54,210,51,8,77,217,19,73,187,33,30,59,9,135,162,49,5,11,225,111,119,11,247,218,129,115,83,205,170,21,4,69,210,133,134,245,109,15,177,9,81,81,203,105,42,158,12,255,151,165,230,205,5,92,196,251,211,187,27,214,43,186,91,233,85,192,229,15,71,38,220,20,38,101,44,78,7,60,251,186,75,103,108,53,166,220,186,208,194,120,207,230,159,248,22,32,142,124,96,157,222,60,191,65,145,6,239,125,151,147,50,58,130,207,110,131,223,231,137,238,28,182,216,167,198,191,37,67,76,1,144,232,218,79,72,28,65,101,43,216,64,253,16,173,179,123,140,27,233,245,199,230,36,181,102,114,247,162,18,34,20,212,25,171,24,28,143,80,94,40,167,34,209,61,117,130,1,198,196,7,21,252,180,255,92,128,119,9,48,156,138,136,151,143,23,44,52,3,40,197,228,31,123,67,163,140,32,54,204,187,149,80,19,255,82,120,195,12,110,65,56,212,143,22,78,44,234,72,140,29,118,103,18,36,7,122,50,37,139,47,142,243,25,208,88,237,126,50,103,127,19,183,29,169,29,1,55,23,100,32,129,239,243,160,61,178,197,117,199,45,57,26,165,135,92,218,59,0,197,54,13,96,40,141,212,221,131,103,46,22,228,191,167,73,20,86,62,11,147,217,116,205,203,110,134,249,51,6,123,23,86,231,157,8,144,83,126,115,118,35,96,36,229,36,220,228,143,71,45,223,129,48,236,5,145,202,188,208,184,70,241,104,255,188,181,146,210,206,144,53,77,101,120,38,8,245,80,230,165,160,183,83,202,79,127,57,214,126,242,150,208,40,239,148,35,163,201,97,74,70,214,181,63,240,147,33,253,149,140,77,197,82,126,189,231,7,196,212,80,14,151,24,57,144,243,81,234,66,24,19,236,2,137,121,246,129,65,7,99,110,174,54,74,182,81,234,142,37,72,110,220,255,64,119,10,188,111,191,228,1,205,9,204,143,56,62,125,84,106,225,131,97,192,43,240,157,161,75,168,247,44,175,65,81,192,48,21,157,167,80,191,130,161,75,85,186,174,42,117,1,68,252,204,138,254,203,152,21,13,64,144,195,207,238,229,54,103,247,159,245,211,85,191,141,168,32,234,85,46,118,12,5,199,4,19,217,203,202,156,33,143,114,116,60,66,40,58,77,208,237,171,26,72,175,114,205,248,87,137,62,210,143,151,197,167,210,241,122,150,104,122,154,2,70,102,83,19,36,141,136,199,42,79,229,71,86,194,109,31,236,80,166,17,230,109,1,40,28,46,224,56,20,230,47,100,254,116,208,76,169,157,241,175,3,70,85,31,38,245,58,33,80,145,237,8,22,71,224,158,156,31,249,81,87,247,230,199,237,96,167,123,63,243,79,156,206,203,160,54,124,68,253,215,132,235,57,185,92,238,55,59,210,104,71,26,183,180,71,12,255,224,192,65,154,72,244,8,164,10,248,46,207,30,92,1,80,244,31,189,138,88,216,218,63,100,227,116,57,119,94,135,5,126,255,32,191,163,61,209,194,88,248,112,139,173,43,69,134,3,160,151,137,25,98,239,166,19,123,208,180,31,120,30,191,75,183,179,126,180,125,92,107,105,206,138,28,67,139,3,188,230,184,255,121,13,181,45,160,114,202,194,123,87,55,124,97,164,82,95,232,216,117,62,5,90,176,82,167,52,160,153,174,168,105,146,91,248,81,79,249,97,138,133,170,245,229,132,61,5,149,224,246,194,213,61,12,109,44,136,235,95,219,133,220,27,93,36,93,124,180,81,141,152,220,170,163,229,197,124,171,232,48,70,251,106,119,150,20,16,49,119,247,42,132,36,76,254,124,177,66,175,9,1,39,92,127,195,171,198,34,2,64,144,179,72,40,151,110,89,229,42,125,33,238,16,220,228,51,203,8,1,68,145,253,133,118,93,163,129,22,13,248,65,12,4,63,101,210,70,170,138,203,14,246,54,194,195,27,107,241,175,35,171,49,52,106,121,45,36,152,85,215,132,78,167,34,18,167,245,152,133,134,170,120,182,10,146,191,37,2,205,47,125,20,203,44,88,81,32,150,223,220,218,238,254,30,212,167,221,115,156,82,226,137,220,221,97,3,139,202,33,9,27,26,126,40,215,25,126,9,82,208,49,217,14,161,81,196,61,60,87,254,213,194,81,216,161,151,209,166,222,230,24,128,117,140,92,4,203,254,170,253,249,88,90,112,226,18,44,122,39,158,158,56,69,204,159,5,179,51,197,233,139,216,102,226,206,248,15,78,112,214,126,67,28,40,38,98,190,178,206,67,94,245,254,160,101,176,32,157,26,132,83,252,228,87,242,32,127,160,112,210,224,133,149,115,41,30,16,200,69,89,81,77,144,12,106,182,73,54,28,53,195,28,216,179,179,136,35,141,102,234,177,240,34,186,106,145,245,3,84,48,251,157,245,11,217,111,227,138,42,67,114,211,177,37,103,16,71,152,72,117,123,36,213,202,56,124,227,84,8,45,229,149,165,214,69,244,169,55,68,62,94,104,228,74,205,123,222,17,7,172,158,227,74,206,149,67,175,171,251,185,121,151,223,63,35,229,32,49,190,209,120,137,69,213,214,19,150,187,177,28,12,158,153,126,149,171,167,234,120,129,109,32,157,180,75,66,56,233,115,127,230,157,32,34,143,156,31,230,168,174,125,118,195,249,243,165,81,246,10,144,15,103,139,55,173,7,59,136,69,172,54,132,165,140,78,77,230,33,169,129,188,71,209,109,161,8,57,57,199,143,31,164,43,58,130,1,110,145,31,229,13,46,149,94,244,106,76,238,105,107,1,183,177,10,61,225,94,185,116,58,183,95,225,22,119,19,248,28,13,123,125,108,158,64,184,77,245,153,162,217,227,208,41,185,211,235,41,153,181,54,166,165,11,154,55,21,184,209,192,249,44,164,160,29,229,159,82,156,198,241,183,114,83,137,186,151,148,31,21,197,216,145,32,13,50,22,241,137,39,71,28,142,160,215,107,221,45,202,104,227,110,186,12,150,145,240,51,49,44,196,115,224,238,149,189,134,99,67,241,62,157,240,114,247,195,26,200,141,97,147,249,23,150,174,10,13,219,81,73,58,242,96,250,243,15,49,218,58,230,104,252,175,150,123,86,185,84,90,198,6,36,0,99,72,28,166,238,115,231,171,249,179,71,174,68,156,227,17,198,79,73,142,99,144,20,80,62,80,191,142,46,71,9,243,6,8,214,116,72,190,106,161,19,185,100,9,187,64,94,86,203,174,156,245,222,95,54,30,148,19,11,50,112,96,61,237,159,173,7,154,127,175,79,48,97,89,78,126,66,171,204,158,195,27,226,205,222,157,89,251,90,125,37,212,27,97,3,141,247,175,50,121,7,187,68,196,181,202,167,189,57,84,81,222,23,27,84,130,176,98,66,240,207,18,23,28,163,163,194,45,37,129,202,170,97,189,0,81,238,0,39,199,163,35,211,206,247,65,29,116,242,67,102,235,13,136,232,230,114,146,187,7,254,142,26,121,16,237,5,160,201,114,94,178,199,95,212,241,45,112,180,188,72,86,114,189,155,149,149,163,210,112,101,12,69,225,75,202,223,28,242,90,215,156,169,224,245,135,128,92,148,217,131,208,255,25,135,117,136,5,104,185,249,161,228,214,16,105,204,9,182,135,153,220,101,244,160,207,58,182,118,185,240,57,245,123,13,112,182,106,229,220,90,29,86,215,96,147,232,2,55,131,225,137,68,245,89,141,252,97,3,129,155,216,223,98,116,45,78,85,141,161,74,215,7,150,171,225,59,78,221,152,236,14,117,100,208,158,86,13,185,124,87,157,111,40,187,182,124,173,71,173,23,199,52,155,190,134,11,23,64,25,215,39,115,231,173,77,72,114,54,252,116,178,59,221,106,241,119,254,30,226,241,204,233,113,197,96,146,0,41,67,3,231,126,12,218,202,22,171,114,249,176,134,160,19,216,31,229,118,226,62,242,126,126,42,127,130,68,218,218,81,202,106,217,191,25,177,82,97,81,36,232,137,58,90,216,190,117,235,20,194,144,76,178,27,213,13,208,18,29,118,126,49,98,203,179,128,237,100,32,242,189,212,6,210,210,188,161,205,13,124,119,13,215,112,41,183,176,215,168,210,182,111,1,115,2,239,141,8,177,124,112,48,197,2,239,11,99,4,36,77,69,47,244,19,153,61,19,2,96,176,7,112,122,131,169,25,189,116,171,49,12,121,162,79,154,74,251,50,233,182,63,180,224,118,49,253,21,20,16,31,144,184,93,174,231,244,183,13,49,225,189,211,73,185,49,110,142,25,226,45,176,233,204,74,33,16,205,88,131,92,157,170,175,68,170,61,53,116,165,16,27,182,160,181,87,241,15,151,85,107,76,167,129,25,172,127,184,138,153,222,228,125,64,44,45,32,12,227,148,106,152,83,240,166,54,235,32,190,12,242,164,123,189,53,194,141,104,43,202,110,4,168,119,245,232,179,178,198,1,224,87,86,160,31,19,140,233,102,191,204,4,98,138,163,191,106,24,213,47,208,82,137,132,131,16,253,84,25,144,90,159,148,16,196,84,166,61,160,101,229,227,93,118,59,87,66,16,128,59,96,131,250,20,184,150,205,91,227,201,62,35,79,180,172,173,85,197,106,153,238,229,60,204,65,193,230,94,101,177,134,6,165,53,171,142,208,155,2,11,4,202,127,54,17,142,117,227,121,128,204,192,147,147,92,189,5,224,148,72,18,83,101,126,124,228,153,242,123,229,247,92,221,6,73,227,250,87,167,194,129,187,73,38,185,109,217,240,193,88,50,178,180,151,54,197,187,137,190,166,233,1,103,204,88,31,127,185,29,65,1,29,254,223,14,83,167,215,114,248,30,173,89,173,187,69,5,105,117,15,106,94,173,63,227,25,230,190,136,168,177,175,107,91,126,254,34,188,25,118,48,12,226,130,153,162,57,47,181,212,79,160,97,64,157,246,90,53,43,149,76,102,15,195,107,58,242,84,172,29,81,198,113,81,251,138,182,154,111,30,171,129,56,17,45,214,153,112,117,203,174,40,38,234,236,32,4,112,225,26,187,195,246,252,9,218,69,160,223,178,54,148,81,8,134,151,75,248,63,224,240,48,75,250,221,85,46,100,50,3,70,64,102,111,160,155,233,59,147,184,57,61,6,126,79,176,16,185,94,166,33,135,78,42,75,140,208,140,44,153,187,64,103,119,160,236,16,239,74,218,219,212,207,110,53,30,76,248,40,111,98,44,20,113,204,233,109,135,96,107,39,163,203,125,45,157,152,71,239,175,174,159,147,80,111,93,38,253,228,154,225,181,101,12,241,127,65,49,189,5,85,151,237,213,143,14,104,138,54,52,27,4,132,67,35,156,86,157,73,16,229,222,245,110,79,165,179,56,179,53,218,229,100,58,87,149,48,231,64,63,115,67,3,172,6,186,115,154,60,53,214,152,149,89,234,37,143,82,255,64,28,183,93,112,39,70,185,57,0,199,9,61,175,219,41,76,37,176,82,125,65,53,160,214,105,62,153,244,222,96,205,6,178,85,41,240,113,0,96,149,38,3,195,18,152,41,246,3,103,29,110,134,30,101,75,46,103,199,184,20,230,8,55,120,4,229,168,35,43,7,28,161,143,87,27,87,79,255,186,44,195,158,155,181,119,81,172,217,107,95,98,55,243,186,66,105,48,224,123,232,84,156,20,10,156,208,204,52,34,228,136,97,242,200,246,211,67,202,40,241,91,92,253,9,54,72,131,221,106,178,32,44,182,4,225,193,37,20,249,249,231,10,206,18,71,254,221,187,172,88,204,6,127,138,102,7,208,75,147,219,199,177,79,36,170,101,207,177,109,95,143,217,41,199,80,183,201,2,254,12,55,23,198,14,255,69,245,138,155,129,227,167,168,130,156,135,14,96,93,48,99,143,107,126,92,117,143,112,108,193,228,84,13,41,186,27,172,92,201,149,116,19,112,197,116,209,128,102,1,55,152,177,28,37,34,50,83,41,199,74,178,59,111,67,118,35,252,36,33,87,28,170,17,215,47,90,154,124,137,15,14,211,59,75,59,30,77,0,49,37,225,191,87,101,127,214,227,160,99,174,234,82,148,235,16,241,219,147,170,127,221,250,116,39,218,156,72,227,172,55,0,79,188,76,51,222,232,24,36,62,94,154,3,61,230,146,114,253,0,128,58,253,90,72,211,242,38,39,133,153,161,119,105,195,152,225,208,105,140,80,217,186,196,157,21,116,230,116,139,25,159,143,118,128,77,201,238,247,228,15,168,4,133,148,21,148,12,44,241,7,115,17,129,176,202,46,130,122,129,235,141,223,85,21,199,65,181,169,52,174,161,153,62,25,164,115,213,89,138,199,103,79,200,165,135,249,244,27,209,178,240,129,211,61,9,111,157,147,119,36,119,255,110,130,84,49,210,225,247,100,26,121,127,163,160,26,79,99,24,77,65,32,178,109,36,27,253,173,110,183,11,14,211,57,130,254,124,104,165,219,31,70,97,14,194,39,61,26,141,125,228,126,194,184,101,160,204,106,128,144,106,103,171,18,246,129,220,85,172,151,123,5,73,155,192,175,91,157,239,61,237,116,170,65,233,56,19,49,114,168,190,3,214,53,250,90,213,244,88,101,30,229,248,124,15,71,141,27,172,235,21,129,211,72,61,172,112,170,128,135,96,196,221,255,27,176,105,188,183,121,33,37,149,53,131,226,233,29,167,234,218,109,53,185,152,36,248,53,61,235,78,21,201,214,210,163,12,251,187,45,188,137,126,127,237,92,234,91,240,225,38,194,57,213,251,237,171,30,99,52,14,49,84,101,252,237,7,166,122,114,32,107,32,207,239,136,168,178,12,11,241,233,230,146,132,18,83,233,41,172,17,6,161,42,113,87,40,255,185,1,146,128,5,240,126,131,71,42,54,124,205,2,122,71,30,222,229,40,134,142,102,97,239,151,177,1,230,231,49,123,219,28,129,91,152,112,13,154,81,197,226,255,112,158,178,177,55,181,108,138,185,245,29,186,21,73,188,209,154,200,89,116,235,198,144,36,87,248,22,7,200,122,7,148,44,42,87,140,238,204,95,231,252,0,136,0,22,39,70,123,125,165,113,227,172,146,163,128,158,36,52,91,19,36,245,27,150,138,141,11,67,239,224,65,24,116,101,7,39,46,142,172,164,243,148,0,33,226,59,47,203,137,156,241,66,250,157,30,204,101,143,134,98,238,155,226,25,184,136,219,89,100,193,11,143,71,139,243,230,151,0,249,1,78,26,32,93,104,157,67,97,164,248,86,124,146,93,74,222,228,167,55,53,100,135,216,109,13,64,37,106,177,200,200,182,92,251,69,31,243,89,80,198,14,132,203,72,103,28,104,217,24,97,223,113,11,29,178,191,210,46,162,255,68,99,8,237,213,162,152,193,183,121,203,19,108,182,29,86,26,192,103,220,103,205,154,179,197,9,22,73,127,175,146,38,119,210,0,24,180,21,245,215,204,91,186,119,138,183,239,15,155,231,248,133,39,24,101,144,236,10,230,54,174,227,73,21,110,10,160,241,232,131,14,212,127,232,59,122,65,146,54,163,9,189,190,121,88,170,62,194,14,204,152,245,38,131,37,91,81,72,114,29,115,239,182,56,44,156,159,177,180,82,160,93,97,86,183,236,50,95,85,39,71,181,225,152,143,63,123,117,34,44,109,160,166,229,240,91,138,102,54,180,173,44,50,80,42,124,7,50,124,211,239,21,94,197,185,239,213,107,142,64,95,124,125,17,180,97,189,101,52,48,19,112,12,70,9,212,177,54,118,66,84,147,236,248,26,124,95,103,135,254,124,49,112,186,99,120,90,8,194,191,88,57,242,65,61,10,104,246,197,252,19,159,58,194,75,173,242,103,8,115,84,69,238,149,26,15,159,182,141,132,119,70,29,53,20,143,46,163,204,6,236,59,45,185,172,89,119,83,38,144,36,222,96,151,26,99,195,163,170,133,92,159,214,53,150,116,90,176,69,145,130,15,172,140,217,215,101,163,115,161,65,101,8,7,183,113,213,134,58,175,130,251,143,173,248,168,135,60,159,30,194,68,208,119,120,2,40,178,227,247,161,77,47,136,46,244,163,72,65,158,25,225,195,61,132,182,204,177,186,200,81,2,65,105,212,72,94,203,232,217,182,123,251,228,160,1,161,204,123,20,37,1,77,208,179,45,149,181,122,102,190,123,213,164,231,41,216,130,234,248,208,251,252,220,84,209,67,47,61,220,5,142,162,26,236,121,142,248,132,255,65,122,203,196,102,191,187,2,195,127,255,193,92,49,91,186,154,39,156,29,211,172,49,104,245,114,153,223,211,199,249,35,130,160,128,0,152,176,183,20,236,113,193,108,26,255,11,237,102,133,245,94,115,114,10,89,229,214,221,99,149,30,99,37,246,10,26,26,39,92,123,170,73,211,127,227,54,30,86,133,159,112,225,91,148,100,174,149,75,143,14,140,20,44,64,212,5,243,8,116,63,30,97,42,123,20,73,212,85,207,83,122,27,251,233,84,10,17,236,232,83,200,127,119,143,163,204,220,167,59,231,20,106,186,222,191,8,40,234,21,25,180,13,116,250,152,224,174,75,3,205,38,173,215,236,151,185,121,254,244,154,239,17,53,106,164,61,49,116,216,118,94,150,35,181,26,238,66,49,211,221,132,146,166,115,39,136,36,205,230,179,31,197,51,148,165,109,38,70,37,148,52,44,209,250,98,58,246,225,103,198,101,26,25,196,207,8,166,21,88,252,175,253,10,88,107,157,19,225,61,12,246,221,37,239,186,167,137,142,135,222,128,174,62,95,216,38,141,157,45,232,97,217,173,203,234,116,129,69,206,189,94,221,12,54,139,186,247,184,16,200,121,244,104,8,7,35,111,47,188,10,140,92,73,143,206,203,72,122,184,20,102,197,130,64,150,63,96,239,8,132,111,217,84,91,198,32,43,100,138,241,15,160,42,190,253,193,184,164,124,29,210,96,67,224,221,182,29,218,129,149,29,128,174,98,88,88,125,56,40,255,120,5,0,87,174,42,150,90,112,201,183,169,19,57,195,191,12,58,244,235,132,25,145,72,146,214,8,125,100,135,12,5,102,97,248,174,24,159,90,33,43,187,6,61,212,241,225,190,219,252,197,123,129,164,108,123,55,230,4,153,166,105,234,15,85,216,23,56,32,3,41,110,68,146,172,133,202,98,41,7,47,152,35,255,168,106,241,226,222,77,244,52,185,65,252,227,32,66,38,11,172,60,28,28,103,84,1,1,205,182,190,28,189,102,253,43,1,191,148,116,10,227,18,81,93,80,239,157,232,215,180,163,165,161,109,177,71,150,244,144,208,160,110,22,174,60,206,43,103,121,55,103,114,115,173,238,13,10,227,251,41,176,216,158,229,216,55,234,128,128,20,167,106,181,86,163,130,215,110,149,191,10,227,215,8,214,154,178,181,15,19,0,247,250,97,74,43,157,55,94,174,41,41,9,199,97,20,91,32,18,10,43,98,240,247,203,20,250,117,160,44,229,202,187,64,54,124,15,184,169,129,27,160,240,26,61,255,60,166,60,144,209,84,55,187,186,168,13,124,125,29,17,100,249,227,62,205,78,179,163,168,139,168,21,38,83,239,151,74,43,66,2,92,72,71,94,216,134,238,20,45,158,213,164,73,57,80,47,198,184,130,223,227,71,132,133,235,177,85,174,142,124,172,200,54,229,40,126,60,76,92,216,153,56,241,174,66,141,90,226,3,30,68,234,71,187,163,112,146,255,22,143,170,204,3,127,179,81,139,160,37,77,246,128,220,196,158,153,73,177,65,199,119,29,197,144,130,248,206,155,253,108,213,124,7,223,221,162,146,134,242,65,99,162,107,120,247,214,207,96,150,169,131,208,218,221,28,24,112,208,23,1,130,142,232,56,104,45,33,158,95,255,123,31,74,76,120,178,155,213,6,195,164,8,8,69,241,197,127,83,169,21,167,19,94,143,252,33,159,248,241,170,153,147,1,149,199,201,131,170,79,236,212,209,143,107,98,24,123,56,33,193,85,247,64,225,135,210,78,145,57,16,145,71,170,20,133,87,235,4,166,239,100,82,235,81,50,223,9,193,52,49,86,129,190,196,82,165,107,63,115,161,98,33,20,193,29,42,151,205,252,124,72,245,48,181,67,7,13,21,127,59,226,188,144,129,112,244,192,121,213,80,42,196,1,13,107,108,78,0,40,121,225,148,237,234,209,216,238,9,147,226,254,96,89,212,72,193,106,75,135,74,227,67,255,92,191,81,188,124,226,149,152,142,15,159,195,238,114,55,255,166,157,230,59,148,170,166,151,65,213,104,253,253,112,150,82,147,137,27,214,100,247,65,81,92,47,86,217,7,45,120,81,130,31,236,243,76,78,3,45,105,172,220,71,48,220,94,196,249,163,193,133,50,236,205,20,55,2,63,14,127,69,113,212,204,12,58,79,89,86,29,61,199,201,64,149,6,144,182,150,129,31,18,167,120,248,82,107,25,143,128,27,161,28,25,153,183,217,238,78,186,106,92,27,202,219,165,96,0,216,234,169,73,101,39,182,113,217,240,170,116,172,221,250,233,48,49,242,83,227,92,181,184,72,230,180,21,15,108,135,25,38,153,25,124,227,26,149,73,236,39,211,244,149,58,183,132,26,223,219,174,144,117,233,219,165,205,157,159,222,184,52,47,241,201,123,65,24,44,55,215,177,168,250,179,115,190,227,123,158,163,179,224,69,196,66,207,254,243,101,221,193,140,250,4,28,222,52,96,138,160,33,218,64,118,214,234,201,152,148,91,178,111,107,144,142,6,182,102,72,188,34,213,181,26,223,58,255,103,81,17,47,169,11,245,224,123,148,215,237,186,107,75,152,90,202,166,22,149,197,5,246,238,78,76,229,106,199,94,127,195,0,45,82,6,159,103,96,138,231,71,46,107,59,216,39,43,12,221,27,214,56,155,145,66,187,169,250,235,78,211,179,239,183,198,163,93,5,196,24,174,143,225,106,139,89,98,13,127,207,184,194,30,1,165,198,169,8,197,118,86,163,221,138,23,209,61,116,79,99,233,43,130,60,244,85,229,243,172,123,148,200,120,192,127,211,52,11,159,41,95,212,230,188,169,156,137,29,212,12,148,168,148,133,243,44,241,139,127,24,246,220,227,125,209,97,60,52,162,192,146,49,161,92,138,112,189,128,59,126,125,46,207,60,79,231,174,152,209,68,223,205,2,38,14,91,116,159,255,28,27,178,248,164,104,158,79,69,214,234,157,12,75,163,83,253,245,202,61,213,176,6,197,230,29,208,166,253,194,254,235,29,141,241,70,249,15,62,0,148,163,135,52,122,40,96,87,31,179,152,51,216,133,184,122,198,203,60,115,218,191,193,16,178,25,148,252,112,104,103,252,36,92,221,28,179,43,199,198,151,128,100,252,217,161,249,34,201,172,118,52,180,252,104,7,223,44,116,102,212,21,40,224,184,55,163,210,21,207,161,239,51,54,155,41,133,18,67,48,3,165,130,251,4,79,214,57,72,130,157,212,144],Sp=[0,1,3,4,6,7,9,10,12,13,15,16,18,19,21,22,24,26,29,31,34,36,39,41,44,46,49,51,54,56,59,61,64,65,66,67,68,69,70,72,73,74,75,76,77,79,80,81,82,83,84,85,87,88,89,90,91,92,94,95,96,97,98,99,101,102,103,104,105,106,107,109,110,111,112,113,114,116,117,118,119,120,121,123,124,125,126,127,128,129,131,132,133,134,135,136,138,139,140,141,142,143,145,146,147,148,149,150,151,153,154,155,156,157,158,160,161,162,163,164,165,166,168,169,170,171,172,173,175,176,177,178,179,180,182,183,184,185,186,187,188,190,191,192,193,194,195,197,198,199,200,201,202,204,205,206,207,208,209,210,212,213,214,215,216,217,219,220,221,222,223,224,226,226,226,227,227,227,228,228,228,229,229,229,230,230,231,231,231,232,232,232,233,233,233,234,234,235,235,235,236,236,236,237,237,237,238,238,239,239,239,240,240,240,241,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],Tp=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,35,36,37,39,40,42,43,44,46,47,49,50,51,53,54,56,57,58,59,61,62,63,64,66,67,68,69,71,72,73,74,76,77,78,79,81,82,83,84,86,87,88,90,91,92,93,95,96,97,98,100,101,102,103,105,106,107,108,110,111,112,113,115,116,117,118,120,121,122,124,125,126,127,129,130,131,132,134,135,136,137,139,140,141,142,144,145,146,147,149,150,151,152,154,155,156,158,159,160,161,163,164,165,166,168,169,170,171,173,174,175,176,178,179,180,181,183,184,185,186,188,189,190,192,193,194,195,197,198,199,200,202,203,204,205,207,208,209,210,212,213,214,215,217,218,219,220,222,223,224,226,226,226,227,227,228,228,229,229,230,230,231,231,232,232,233,233,234,234,234,235,235,236,236,237,237,238,238,239,239,240,240,241,241,242,242,243,243,243,244,244,244,245,245,245,246,246,246,247,247,247,248,248,248,249,249,249,250,250,250,251,251,251,252,252,252,253,253,253,254,254,254,255],bp=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,43,44,45,46,47,48,50,51,52,53,54,55,56,58,59,60,61,62,63,65,66,67,68,69,70,72,73,74,76,77,78,80,81,83,84,85,87,88,89,91,92,94,95,96,98,99,100,102,103,105,106,107,109,110,111,113,114,116,117,118,120,121,122,124,125,127,128,129,131,132,133,135,136,138,139,140,142,143,144,146,147,149,150,151,153,154,155,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,192,193,193,194,195,195,196,197,197,198,199,199,200,201,201,202,203,203,204,205,205,206,207,207,208,209,209,210,211,211,212,213,213,214,215,215,216,217,217,218,219,219,220,221,221,222,223,223,224,225,225,226,227,227,228,229,229,230,231,231,232,233,233,234,235,235,236,237,237,238,239,239,240,241,241,242,243,243,244,245,245,246,247,247,248,249,249,250,251,251,252,253,253,254,255];class wp extends pp{constructor(e,t,n,r){super(e,Ep,n,r),this.lightLevel=.1,this.rednessLevel=.5,this.mskin_he_max=175/180*3.141593,this.mskin_he_min=115/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_hc_min=116/180*3.141593,this.mskin_hc_axis=2.04203545,this.mfacts_rotate_ge=this.mfacts_rotate_le=this.mfacts_rotate_c=0,this.tab_addr=null,this.lutTextures=[],this.inputTexture=t,this.init()}setUniforms(){var e=this.gl.getUniformLocation(this.program,"u_flipY"),t=this.gl.getUniformLocation(this.program,"u_denoiseLevel");this.gl.uniform1f(t,this.denoiseLevel),this.gl.uniform1f(e,1),e=this.gl.getUniformLocation(this.program,"light"),this.gl.uniform1f(e,this.lightLevel),e=this.gl.getUniformLocation(this.program,"redness"),this.gl.uniform1f(e,this.rednessLevel),e=this.gl.getUniformLocation(this.program,"skin_he_max"),t=this.gl.getUniformLocation(this.program,"skin_he_min");var n=this.gl.getUniformLocation(this.program,"skin_hc_max"),r=this.gl.getUniformLocation(this.program,"skin_hc_min");let i=this.gl.getUniformLocation(this.program,"skin_hc_axis"),o=this.gl.getUniformLocation(this.program,"facts_rotate_c"),s=this.gl.getUniformLocation(this.program,"facts_rotate_le"),a=this.gl.getUniformLocation(this.program,"facts_rotate_ge");for(this.gl.uniform1f(e,this.mskin_he_max),this.gl.uniform1f(t,this.mskin_he_min),this.gl.uniform1f(n,this.mskin_hc_max),this.gl.uniform1f(r,this.mskin_hc_min),this.gl.uniform1f(i,this.mskin_hc_axis),this.gl.uniform1f(o,this.mfacts_rotate_c),this.gl.uniform1f(s,this.mfacts_rotate_le),this.gl.uniform1f(a,this.mfacts_rotate_ge),e=this.gl.getUniformLocation(this.program,"u_originImage"),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.uniform1i(e,2),e=["lighten_lut"],t=[this.gl.TEXTURE3],n=0;n<e.length;n++)r=this.gl.getUniformLocation(this.program,e[n]),this.gl.activeTexture(t[n]),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[n]),this.gl.uniform1i(r,n+3)}setParameters(e){void 0!==e.denoiseLevel&&(this.denoiseLevel=e.denoiseLevel),void 0!==e.lightLevel&&(this.lightLevel=e.lightLevel),void 0!==e.rednessLevel&&(this.rednessLevel=e.rednessLevel,this.updateRedness(this.rednessLevel)),e.lighteningContrastLevel&&this.updateLut(e.lighteningContrastLevel)}init(){this.tab_addr=new Uint8Array(Tp);let e=[this.tab_addr],t=[256],n=[1];for(let r=0;r<e.length;r++){let i=this.gl.createTexture();if(!i)throw new Zu(Cu.WEBGL_INTERNAL_ERROR,"create lut texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,t[r],n[r],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,e[r]),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.lutTextures.push(i)}}updateRedness(e){var t=e;1<e&&(e=1),0>e&&(e=0),1<t&&(t=1),0>t&&(t=0),this.mfacts_rotate_c=.8*e,.8>t&&(t=0),this.mskin_he_max=175/180*3.141593,this.mskin_hc_max=173/180*3.141593,this.mskin_he_min=(115-4*t)/180*3.141593,this.mskin_hc_min=(116-4*t)/180*3.141593,this.mskin_hc_axis=(117-4*t)/180*3.141593,this.mskin_hc_axis<this.mskin_hc_min&&(this.mskin_hc_axis=this.mskin_hc_min),1.5707965>this.mskin_hc_min&&(this.mskin_hc_min=1.5707965),1.5707965>this.mskin_hc_axis&&(this.mskin_hc_axis=1.5707965),1.5707965>this.mskin_he_min&&(this.mskin_he_min=1.5707965),3.141593<this.mskin_hc_max&&(this.mskin_hc_max=3.141593),3.141593<this.mskin_hc_axis&&(this.mskin_hc_axis=3.141593),3.141593<this.mskin_he_max&&(this.mskin_he_max=3.141593),t=this.mskin_hc_max-this.mskin_hc_axis,this.mfacts_rotate_ge=.01<(e=this.mskin_he_max-this.mskin_hc_max)?this.mfacts_rotate_c*t/e:this.mfacts_rotate_c,t=this.mskin_hc_axis-this.mskin_hc_min,this.mfacts_rotate_le=.01<(e=this.mskin_hc_min-this.mskin_he_min)?this.mfacts_rotate_c*t/e:this.mfacts_rotate_c}updateLut(e){var t=null;if(0===e&&(t=Tp),1===e&&(t=bp),2===e&&(t=Sp),!t)throw new Zu(Cu.WEBGL_INTERNAL_ERROR,"invalid ylut_table value:"+e);this.tab_addr=new Uint8Array(t),e=[this.tab_addr],t=[256];let n=[1];for(let r=0;r<e.length;r++)this.gl.bindTexture(this.gl.TEXTURE_2D,this.lutTextures[r]),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,t[r],n[r],0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,e[r])}}class Rp{constructor(){this.canvas=this.gl=null,this.programs=[],this.inputTexture=this.commonProgram=null,this.outputTextures=[],this.fbos=[],this.originalFrameHeight=this.originalFrameWidth=0,this.enableBeauty=!1,this.denoiseLevel=5,this.lightLevel=.35,this.rednessLevel=.5,this.lighteningContrastLevel=1}setEnableBeauty(e){this.enableBeauty=!!e}init(e,t,n){if(!Ql.supportWebGL)throw new Zu(Cu.NOT_SUPPORTED,"your browser is not support webGL");if(this.gl=n.getContext("webgl"),!this.gl)throw new Zu(Cu.WEBGL_INTERNAL_ERROR,"can not get webgl context");if(this.initGL(e,t),!this.inputTexture)throw new Zu(Cu.WEBGL_INTERNAL_ERROR,"can not find input texture");this.canvas=n,this.programs.push(new dp(this.gl)),this.programs.push(new mp(this.gl,e,t)),this.programs.push(new _p(this.gl,e,t)),this.programs.push(new yp(this.gl,e,t)),this.programs.push(new wp(this.gl,this.inputTexture,e,t)),this.commonProgram=this.programs[0].program,this.setDenoiseLevel(this.denoiseLevel),this.setLightLevel(this.lightLevel),this.setRednessLevel(this.rednessLevel),this.setContrastLevel(this.lighteningContrastLevel)}render(e){if(this.gl&&this.commonProgram&&this.canvas){var t=0;if(this.originalFrameHeight===e.videoWidth&&this.originalFrameWidth===e.videoHeight)t=2;else if(this.originalFrameHeight!==e.videoHeight||this.originalFrameWidth!==e.videoWidth){var n,r,i;if($u.debug(Us(n=Us(r=Us(i="beauty effect: resolution changed ".concat(this.originalFrameWidth,"x")).call(i,this.originalFrameHeight," -> ")).call(r,e.videoWidth,"x")).call(n,e.videoHeight)),0===e.videoHeight||0===e.videoWidth)return void $u.debug("beauty effect: skip 0 resolution frame");this.canvas.width=e.videoWidth,this.canvas.height=e.videoHeight,e.setAttribute("width",e.videoWidth.toString()),e.setAttribute("height",e.videoHeight.toString()),this.release(),this.init(e.videoWidth,e.videoHeight,this.canvas)}for(this.gl.viewport(0,0,e.videoWidth,e.videoHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,e),e=this.enableBeauty?this.programs.length-1:0,n=0;n<=e;n++)this.gl.useProgram(r=this.programs[n].program),r=this.gl.getUniformLocation(r,"u_image"),this.programs[n].setUniforms(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.fbos[t+n%2]),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outputTextures[t+n%2]),this.gl.uniform1i(r,0);this.gl.useProgram(this.commonProgram),t=this.gl.getUniformLocation(this.commonProgram,"u_flipY"),this.gl.uniform1f(t,-1),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}else $u.warning("video effect manager is not init!")}setDenoiseLevel(e){var t;Qo(t=this.programs).call(t,t=>{t instanceof pp&&t.setParameters({denoiseLevel:e})}),this.denoiseLevel=e}setLightLevel(e){var t;Qo(t=this.programs).call(t,t=>{t instanceof pp&&t.setParameters({lightLevel:e})}),this.lightLevel=e}setRednessLevel(e){var t;Qo(t=this.programs).call(t,t=>{t instanceof pp&&t.setParameters({rednessLevel:e})}),this.rednessLevel=e}setContrastLevel(e){var t;Qo(t=this.programs).call(t,t=>{t instanceof pp&&t.setParameters({lighteningContrastLevel:e})}),this.lighteningContrastLevel=e}setSize(e,t){var n;Qo(n=this.programs).call(n,n=>{n instanceof pp&&n.setSize(e,t)})}release(){this.inputTexture=this.commonProgram=this.gl=null,this.programs=[],this.outputTextures=[],this.fbos=[]}initGL(e,t){if(!this.gl)throw new Zu(Cu.WEBGL_INTERNAL_ERROR,"can not find webgl context");this.inputTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.inputTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);for(let n=0;4>n;n++){let r=this.gl.createTexture();if(!r)throw new Zu(Cu.WEBGL_INTERNAL_ERROR,"create texture failed");this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),2>n?this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,e,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null):this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,e,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);let i=this.gl.createFramebuffer();if(!i)throw new Zu(Cu.WEBGL_INTERNAL_ERROR,"create frame buffer failed");this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,i),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,r,0),this.outputTextures.push(r),this.fbos.push(i)}this.gl.viewport(0,0,e,t),this.originalFrameWidth=e,this.originalFrameHeight=t}}class Ip{constructor(){this.recordedFrameCount=this.targetFrameRate=0,this.recordingTime=2}startRecordBeautyEffectOutput(e,t=4){var n=this;return r(function*(){if(n.recordID)throw new Zu(Cu.UNEXPECTED_ERROR,"another beauty effect recording is in progress");let r=Je(6,"");return n.recordID=r,n.targetFrameRate=e,n.recordedFrameCount=0,n.recordingTime=t,yield Ye(1e3*n.recordingTime),n.recordID!==r?(n.recordID=void 0,!0):(n.recordID=void 0,n.recordedFrameCount<n.targetFrameRate*n.recordingTime/2?($u.warning("detect beauty effect overload, current framerate",n.recordedFrameCount/2),!1):($u.debug("beauty effect current framerate",n.recordedFrameCount/2),!0))})()}stopRecordBeautyEffectOutput(){this.recordedFrameCount=this.targetFrameRate=0,this.recordID=void 0}addFrame(){this.recordID&&(this.recordedFrameCount+=1)}}class Cp extends class{get output(){return this._output}setInput(e){var t=this;return r(function*(){if(e!==t.input){if(e.kind!==t.kind)throw new Zu(Cu.UNEXPECTED_ERROR);t.input&&t.removeInput(),t.input=e,yield t._setInput(e)}})()}removeInput(){this.input=void 0,this._removeInput()}updateOutput(e){var t=this;return r(function*(){t.output!==e&&(t._output=e,t.onOutputChange&&(yield t.onOutputChange()))})()}replaceOriginMediaStream(e,t){var n,r;let i=Ac(n=e.getTracks()).call(n,e=>e.kind===this.kind);i&&e.removeTrack(i),t=Ac(r=t.getTracks()).call(r,e=>e.kind===this.kind),void 0===this.output&&t&&e.addTrack(t),this.output&&($u.debug("replace ".concat(this.output.kind," track to origin media stream")),e.addTrack(this.output))}}{constructor(){super(),this.kind="video",this.fps=15,this.overloadDetector=new Ip,this.enabled=!1,this.stopChromeBackgroundLoop=null,this.lastRenderTime=0,this.fps=30,this.manager=new Rp}setBeautyEffectOptions(e,t){var n=this;return r(function*(){void 0!==t.smoothnessLevel&&ye(t.smoothnessLevel,"options.smoothnessLevel",0,1,!1),void 0!==t.lighteningLevel&&ye(t.lighteningLevel,"options.lighteningLevel",0,1,!1),void 0!==t.rednessLevel&&ye(t.rednessLevel,"options.rednessLevel",0,1,!1),void 0!==t.lighteningContrastLevel&&ve(t.lighteningContrastLevel,"options.lighteningContrastLevel",[0,1,2]),void 0!==t.smoothnessLevel&&n.manager.setDenoiseLevel(Math.max(.1,10*t.smoothnessLevel)),void 0!==t.lighteningLevel&&n.manager.setLightLevel(Math.max(.1,t.lighteningLevel/2)),void 0!==t.rednessLevel&&n.manager.setRednessLevel(Math.max(.01,t.rednessLevel)),void 0!==t.lighteningContrastLevel&&n.manager.setContrastLevel(t.lighteningContrastLevel),n.enabled!==e&&(n.manager.setEnableBeauty(e),n.enabled=e,e?n.input&&(yield n.startEffect()):yield n.stopEffect())})()}destroy(){this.onOutputChange=void 0,this.stopEffect(),this.enabled=!1}startEffect(){var e=this;return r(function*(){let t=Pe();if(!e.input)return void $u.warning("video track is null, fail to start video effect!");if(e.output)return void $u.warning("video effect is already enabled");let n=yield e.renderWithWebGL();yield e.updateOutput(n),$u.info("start video effect, output:",e.output),e.overloadDetector.startRecordBeautyEffectOutput(e.fps).then(t=>{t||e.onOverload&&e.onOverload()});let r=()=>{requestAnimationFrame(r);const t=qh(),n=1e3/e.fps,i=e.lastRenderTime?t-e.lastRenderTime:n;i<n||(e.lastRenderTime=t-(i-n),e.video&&e.video.paused&&e.video.play(),e.enabled&&e.video&&(e.manager.render(e.video),e.output&&e.output.requestFrame&&e.output.requestFrame(),e.overloadDetector.addFrame()))};requestAnimationFrame(r),t.name===Xc.CHROME&&document.addEventListener("visibilitychange",()=>{document.hidden?e.stopChromeBackgroundLoop=Lt(()=>{e.enabled&&e.video&&e.manager.render(e.video),e.output&&e.output.requestFrame&&e.output.requestFrame(),e.overloadDetector.addFrame()},e.fps):e.stopChromeBackgroundLoop&&(e.stopChromeBackgroundLoop(),e.stopChromeBackgroundLoop=null)},!1)})()}stopEffect(){var e=this;return r(function*(){$u.info("stop video effect"),e.overloadDetector.stopRecordBeautyEffectOutput(),e.manager.release(),e.canvas&&e.canvas.remove(),e.video&&e.video.remove(),e.video=e.canvas=void 0,yield e.updateOutput(void 0)})()}_setInput(e){var t=this;return r(function*(){t.enabled&&!t.video&&(yield t.startEffect())})()}_removeInput(){this.stopEffect()}renderWithWebGL(){var e=this;return r(function*(){var t;if(!e.input)throw new Zu(Cu.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not renderWithWebGL, no input");e.canvas&&(e.canvas.remove(),e.canvas=void 0),e.video&&(e.video.remove(),e.video=void 0),e.canvas=document.createElement("canvas"),e.video=document.createElement("video"),e.video.setAttribute("autoplay",""),e.video.setAttribute("muted",""),e.video.muted=!0,e.video.setAttribute("playsinline",""),e.video.setAttribute("style","display:none"),e.video.srcObject=new MediaStream([e.input]);var n=new ic(t=>{const n=()=>{e.video&&e.video.removeEventListener("playing",n),t(void 0)};e.video&&e.video.addEventListener("playing",n)});e.video.play(),yield n;let r=(n=e.input.getSettings()).width||e.video.videoWidth,i=n.height||e.video.videoHeight;if(n.frameRate&&e.fps!==n.frameRate&&(e.fps=n.frameRate,$u.debug("beauty video processor: set fps to",e.fps)),$u.debug(Us(t="beauty video processor: width ".concat(r," height ")).call(t,i)),!r||!i)throw new Zu(Cu.BEAUTY_PROCESSOR_INTERNAL_ERROR,"can not get track resolution");return e.canvas.width=r,e.canvas.height=i,e.video.setAttribute("width",r.toString()),e.video.setAttribute("height",i.toString()),e.manager.init(r,i,e.canvas),e.canvas.captureStream(Ql.supportRequestFrame?0:e.fps).getVideoTracks()[0]})()}}class Ap extends Sd{constructor(e,t,n,r,i){super(e,i),this.trackMediaType="video",this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1},this._enabled=!0,this.updateMediaStreamTrackResolution(),this._encoderConfig=t,this._scalabiltyMode=n,this._optimizationMode=r}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==tl.PLAYING)}play(e,t={}){let n=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.LOCAL_VIDEO_TRACK_PLAY,options:[this.getTrackId(),"string"==typeof e?e:"HTMLElement",t]});if(!(e instanceof HTMLElement)){let t=document.getElementById(e.toString());var r;t?e=t:($u.warning(Us(r="[track-".concat(this.getTrackId(),'] can not find "#')).call(r,e,'" element, use document.body')),e=document.body)}$u.debug("[track-".concat(this.getTrackId(),"] start video playback"),wr(t)),e=un({},this._getDefaultPlayerConfig(),{},t,{trackId:this.getTrackId(),element:e}),this._player?this._player.updateConfig(e):(this._player=new ap(e),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),n.onSuccess()}stop(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.LOCAL_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return e.onSuccess();this._player.destroy(),this._player=void 0,$u.debug("[track-".concat(this.getTrackId(),"] stop video playback")),e.onSuccess()}setEnabled(e){var t=this;return r(function*(){if(e!==t._enabled){$u.info("[".concat(t.getTrackId(),"] start setEnabled"),e);var n=yield t._enabledMutex.lock();if(!e){t._originMediaStreamTrack.enabled=!1;try{yield et(t,jl.NEED_REMOVE_TRACK,t)}catch(r){throw $u.error("[".concat(t.getTrackId(),"] setEnabled to false error"),r.toString()),n(),r}return t._enabled=!1,$u.info("[".concat(t.getTrackId(),"] setEnabled to false success")),n()}t._originMediaStreamTrack.enabled=!0;try{yield et(t,jl.NEED_ADD_TRACK,t)}catch(r){throw $u.error("[".concat(t.getTrackId(),"] setEnabled to true error"),r.toString()),n(),r}$u.info("[".concat(t.getTrackId(),"] setEnabled to true success")),t._enabled=!0,n()}})()}getStats(){return st(()=>{$u.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),tt(this,jl.GET_STATS)||un({},Rl)}setBeautyEffect(e,t={}){var n=this;return r(function*(){let r=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.LOCAL_VIDEO_TRACK_BEAUTY,options:[n.getTrackId(),e,t]});if(e||n._videoBeautyProcessor){if(Pe().os===Jc.IOS||Pe().os===Jc.ANDROID)throw e=new Zu(Cu.INVALID_OPERATION,"can not enable beauty effect on mobile device"),r.onError(e),e;if(!n._enabled&&e)throw e=new Zu(Cu.TRACK_IS_DISABLED,"can not enable beauty effect when track is disabled"),r.onError(e),e;$u.info("[".concat(n.getTrackId(),"] start setBeautyEffect"),e,wr(t));try{n._videoBeautyProcessor?yield n._videoBeautyProcessor.setBeautyEffectOptions(e,t):(n._videoBeautyProcessor=new Cp,n._videoBeautyProcessor.onOverload=()=>{ot(()=>n.emit(ql.BEAUTY_EFFECT_OVERLOAD))},yield n._videoBeautyProcessor.setBeautyEffectOptions(e,t),yield n._registerTrackProcessor(n._videoBeautyProcessor))}catch(i){throw $u.error("[".concat(n.getTrackId(),"] setBeautyEffect error"),i.toString()),r.onError(i),i}$u.info("[".concat(n.getTrackId(),"] setBeautyEffect success")),r.onSuccess()}})()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}clone(e,t,n,r){let i=this._mediaStreamTrack.clone();return new Ap(i,e,t,n,r)}setBitrateLimit(e){var t=this;return r(function*(){var n;if($u.debug(Us(n="[".concat(t.getTrackId(),"] set bitrate limit, ")).call(n,wr(e))),e){t._forceBitrateLimit=e,t._encoderConfig&&(t._encoderConfig.bitrateMax=t._encoderConfig.bitrateMax&&t._encoderConfig.bitrateMax<e.max_bitrate?t._encoderConfig.bitrateMax:e.max_bitrate,t._encoderConfig.bitrateMin=e.min_bitrate);try{yield et(t,jl.NEED_RESET_REMOTE_SDP)}catch(r){return r.throw()}}})()}setOptimizationMode(e){var t=this;return r(function*(){var n;if("motion"===e||"detail"===e||"balanced"===e){try{t._optimizationMode=e,yield et(t,jl.SET_OPTIMIZATION_MODE,e)}catch(r){throw $u.error("[".concat(t.getTrackId(),"] set optimization mode failed"),r.toString()),r}$u.info(Us(n="[".concat(t.getTrackId(),"] set optimization mode success (")).call(n,e,")"))}else $u.error(Cu.INVALID_PARAMS,"optimization mode must be motion, detail or balanced")})()}setScalabiltyMode(e){var t;if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return $u.error(Cu.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=e,$u.info(Us(t="[".concat(this.getTrackId(),"] set scalability mode success (")).call(t,e,")"))}updateMediaStreamTrackResolution(){Xe(this._originMediaStreamTrack).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e}).catch(Qh)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}}class Op extends Ap{constructor(e,t,n,r,i,o){super(e,t.encoderConfig?J(t.encoderConfig):{},r,i,o),this._enabled=!0,this._deviceName="default",this._config=t,this._constraints=n,this._deviceName=e.label,this._config.encoderConfig&&(this._encoderConfig=J(this._config.encoderConfig))}setDevice(e){var t=this;return r(function*(){var n;let r=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CAM_VIDEO_TRACK_SET_DEVICE,options:[t.getTrackId(),e]});if($u.info(Us(n="[track-".concat(t.getTrackId(),"] set device to ")).call(n,e)),t._enabled)try{let r=yield sd.getDeviceById(e);(n={}).video=un({},t._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,t._originMediaStreamTrack.stop();let o=null;try{o=yield gt(n,t.getTrackId())}catch(i){throw $u.error("[".concat(t.getTrackId(),"] setDevice failed"),i.toString()),o=yield gt({video:t._constraints},t.getTrackId()),yield t._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),i}yield t._updateOriginMediaStreamTrack(o.getVideoTracks()[0],!1),t.updateMediaStreamTrackResolution(),t._deviceName=r.label,t._config.cameraId=e,t._constraints.deviceId={exact:e}}catch(o){throw r.onError(o),$u.error("[".concat(t.getTrackId(),"] setDevice error"),o.toString()),o}else try{t._deviceName=(yield sd.getDeviceById(e)).label,t._config.cameraId=e,t._constraints.deviceId={exact:e}}catch(o){throw r.onError(o),$u.error("[track-".concat(t.getTrackId(),"] setDevice error"),o.toString()),o}$u.info("[".concat(t.getTrackId(),"] setDevice success")),r.onSuccess()})()}setEnabled(e){var t=this;return r(function*(){if(e!==t._enabled){$u.info("[".concat(t.getTrackId(),"] start setEnabled"),e);var n=yield t._enabledMutex.lock();if(!e){t._originMediaStreamTrack.onended=null,t._originMediaStreamTrack.stop(),t._enabled=!1;try{yield et(t,jl.NEED_REMOVE_TRACK,t)}catch(i){throw $u.error("[".concat(t.getTrackId(),"] setEnabled to false error"),i.toString()),n(),i}return $u.info("[".concat(t.getTrackId(),"] setEnabled to false success")),n()}e=un({},t._constraints);var r=sd.searchDeviceIdByName(t._deviceName);r&&!e.deviceId&&(e.deviceId={exact:r});try{let e=yield gt({video:t._constraints},t.getTrackId());yield t._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1),yield et(t,jl.NEED_ADD_TRACK,t)}catch(i){throw $u.error("[".concat(t.getTrackId(),"] setEnabled true error"),i.toString()),n(),i}t.updateMediaStreamTrackResolution(),$u.info("[".concat(t.getTrackId(),"] setEnabled to true success")),t._enabled=!0,n()}})()}setEncoderConfiguration(e,t){var n=this;return r(function*(){if(t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG,options:[n.getTrackId(),e]}),!n._enabled)throw e=new Zu(Cu.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled"),t.onError(e),e;e=J(e),n._forceBitrateLimit&&(e.bitrateMax=n._forceBitrateLimit.max_bitrate?n._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=n._forceBitrateLimit.min_bitrate?n._forceBitrateLimit.min_bitrate:e.bitrateMin);let r=(i=n._config,JSON.parse(wr(i)));var i;r.encoderConfig=e,i=sn(r),$u.debug("[".concat(n.getTrackId(),"] setEncoderConfiguration applyConstraints"),wr(e),wr(i));try{yield n._originMediaStreamTrack.applyConstraints(i),n.updateMediaStreamTrackResolution()}catch(o){throw e=new Zu(Cu.UNEXPECTED_ERROR,o.toString()),$u.error("[track-".concat(n.getTrackId(),"] applyConstraints error"),e.toString()),t.onError(e),e}n._config=r,n._constraints=i,n._encoderConfig=e;try{yield et(n,jl.NEED_RENEGOTIATE)}catch(o){return t.onError(o),o.throw()}t.onSuccess()})()}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}}var Np=!0;"findIndex"in[]&&Array(1).findIndex(function(){Np=!1}),mr({target:"Array",proto:!0,forced:Np},{findIndex:function(e){return yi(this,e,1<arguments.length?arguments[1]:void 0)}});var kp=Bo("Array").findIndex,Dp=Array.prototype,Pp=function(e){var t=e.findIndex;return e===Dp||e instanceof Array&&t===Dp.findIndex?kp:t};let Lp=(e,t)=>{let n=null;if("h264"===t?n=e.match(/a=rtpmap:(\d+) H264.*\r\n/)||e.match(/a=rtpmap:(\d+) H264.*\n/):"vp8"===t?n=e.match(/a=rtpmap:(\d+) VP8.*\r\n/)||e.match(/a=rtpmap:(\d+) VP8.*\n/):"vp9"===t?n=e.match(/a=rtpmap:(\d+) VP9.*\r\n/)||e.match(/a=rtpmap:(\d+) VP9.*\n/):"av1"===t&&(n=e.match(/a=rtpmap:(\d+) AV1.*\r\n/)||e.match(/a=rtpmap:(\d+) AV1.*\n/)),n&&n[1])return n[1]};class xp extends sp{constructor(e,t,n,i){var o;super(t,t.stringUid||t.uid),o=this,this.type="pub",this._waitingSuccessResponse=this.detecting=!1,this.renegotiateWithGateway=r(function*(){return $u.debug("[pc-".concat(o.pc.ID,"] renegotiate start")),new ic(function(){var e=r(function*(e,t){o.connectionState="connecting";let n=r=>{"connected"===r&&(o.off(Tl.CONNECTION_STATE_CHANGE,n),e()),"disconnected"===r&&(o.off(Tl.CONNECTION_STATE_CHANGE,n),t(new Zu(Cu.OPERATION_ABORTED,"renegotiate abort")))};o.on(Tl.CONNECTION_STATE_CHANGE,n);var r=yield o.pc.createOfferSDP();o.audioTrack&&o.audioTrack._encoderConfig&&(r=hn(r,o.audioTrack._encoderConfig)),o.videoTrack&&o.videoTrack._scalabiltyMode&&("vp9"!==o.codec?(o.videoTrack._scalabiltyMode.numSpatialLayers=1,o.videoTrack._scalabiltyMode.numTemporalLayers=1):r=pn(r,o.codec,o.videoTrack._scalabiltyMode),$u.debug("renegoation spatial layers: ",o.videoTrack._scalabiltyMode.numSpatialLayers)),yield o.pc.setOfferSDP(r),o.pc.onOfferSettled();let i=yield Ze(o,Tl.NEED_RENEGOTIATE,r);r=function(e,t){var n,r,i;const o=Pc(n=RegExp.prototype.test).call(n,/^([a-z])=(.*)/);e=Bs(r=e.split(/(\r\n|\r|\n)/)).call(r,o),t=Bs(i=t.split(/(\r\n|\r|\n)/)).call(i,o);let s=null;const a=new Do;return Qo(e).call(e,e=>{const t=e.match(/m=(audio|video)/);t&&t[1]?s=t[1]:s&&(e=e.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&e[1]&&a.set(s,e[1])}),s=null,ac(t).call(t,e=>{var t=e.match(/m=(audio|video)/);if(t&&t[1])return s=t[1],e;if(!s)return e;if((t=e.match(/=(sendrecv|recvonly|sendonly|inactive)/))&&t[1]){const n=a.get(s);if(n&&n!==t[1])return e.replace(t[1],n)}return e}).join("\r\n")+"\r\n"}(r,o.updateAnswerSDP(i.sdp)),yield o.pc.setAnswerSDP(r),$u.debug("[pc-".concat(o.pc.ID,"] renegotiate success")),o.connectionState="connected"});return function(t,n){return e.apply(this,arguments)}}())}),this.handleStreamRenegotiate=(e,t)=>{"connected"===this.connectionState?this.renegotiateWithGateway().then(e).catch(t):e()},this.handleReplaceTrack=(e,t,n)=>{if(this.audioTrack instanceof Dd&&"audio"===e.kind)return ic.resolve();this.pc.replaceTrack(e).then(e=>e?this.renegotiateWithGateway():ic.resolve()).then(t).catch(n)},this.handleCloseAudioTrack=e=>{},this.handleCloseVideoTrack=()=>{this.lowStreamConnection&&this.lowStreamConnection.videoTrack&&this.lowStreamConnection.videoTrack.close()},this.handleGetSessionID=e=>{e(this.joinInfo.sid)},this.handleGetLocalVideoStats=e=>{e(this.statsCollector.getLocalVideoTrackStats(this.connectionId))},this.handleGetLocalAudioStats=e=>{e(this.statsCollector.getLocalAudioTrackStats(this.connectionId))},this.handleSetOptimizationMode=(e,t,n)=>{this.videoTrack&&this.setRtpSenderParametersByTrackConfig(this.videoTrack).then(t).catch(n)},this.isLowStreamConnection=!!i,this.codec=n,this.statsCollector=e,this.statsCollector.addLocalConnection(this)}getAllTracks(){let e=[];return this.videoTrack&&e.push(this.videoTrack),this.audioTrack&&this.audioTrack instanceof Dd?e=Us(e).call(e,this.audioTrack.trackList):this.audioTrack&&e.push(this.audioTrack),e}addTracks(e){var t=this;return r(function*(){let n=Ql;if("connecting"===t.connectionState)try{return yield t.createWaitConnectionConnectedPromise(),yield t.addTracks(e)}catch(s){throw new Zu(Cu.OPERATION_ABORTED,"publish abort")}var r=!1;let i=t.getAllTracks();e=it(e=Bs(e).call(e,e=>-1===vc(i).call(i,e)));for(let a=0;a<e.length;a+=1){var o=e[a];if(!(o instanceof Sd))return new Zu(Cu.INVALID_LOCAL_TRACK).throw();if(o instanceof Ap&&t.disabledVideoTrack){if(t.disabledVideoTrack!==o)return new Zu(Cu.EXIST_DISABLED_VIDEO_TRACK).throw();t.disabledVideoTrack=void 0}if(o instanceof Ap&&t.videoTrack)return new Zu(Cu.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw();if(o instanceof Od&&t.audioTrack)if(t.audioTrack instanceof Dd)t.audioTrack.addAudioTrack(o);else{if(!n.webAudioMediaStreamDest)throw new Zu(Cu.NOT_SUPPORTED,"your browser is not support audio mixing");(r=new Dd).addAudioTrack(t.audioTrack),r.addAudioTrack(o),r=yield t.addTrackWithPC(r)}else o instanceof Ap&&t.isLowStreamConnection?(r=gn({},{width:160,height:120,framerate:15,bitrate:50},{},t.lowStreamParameter),n.supportDualStreamEncoding?($u.debug("[".concat(t.connectionId,"] creating low stream using rtp encoding.")),t.lowStreamEncoding=He(r,o),o=o.clone({bitrateMax:r.bitrate,bitrateMin:r.bitrate})):($u.debug("[".concat(t.connectionId,"] creating low stream using canvas.")),o=fn(o,r),o=new Ap(o,{bitrateMax:r.bitrate,bitrateMin:r.bitrate})),o._hints.push(Gl.LOW_STREAM),r=yield t.addTrackWithPC(o),t.bindTrackEvents(o)):(t.detecting=!0,ld(()=>{t.detecting=!1},8e3),r=yield t.addTrackWithPC(o))}r&&(yield t.renegotiateWithGateway()),Qo(e).call(e,e=>t.bindTrackEvents(e))})()}removeTracks(e,t){var n=this;return r(function*(){let r=n.getAllTracks();e=it(e=Bs(e).call(e,e=>-1!==vc(r).call(r,e)||e===n.disabledVideoTrack));let i=[];for(let a=0;a<e.length;a+=1){let r=e[a];if(n.unbindTrackEvents(r),n.audioTrack instanceof Dd&&r instanceof Od)n.audioTrack.removeAudioTrack(r),0===n.audioTrack.trackList.length&&(i.push(n.audioTrack),n.audioTrack=void 0);else if(r instanceof Od)i.push(r),n.audioTrack=void 0;else if(r instanceof Ap){if(t){if(n.disabledVideoTrack===r)return void(n.disabledVideoTrack=void 0)}else n.disabledVideoTrack=n.videoTrack;i.push(r),n.isLowStreamConnection&&r.close(),n.videoTrack=void 0}}if(n.videoTrack||n.audioTrack){if(0!==i.length){if("connecting"===n.connectionState)try{yield n.createWaitConnectionConnectedPromise()}catch(s){return}for(let e of i){var o;$u.debug(Us(o="[".concat(n.connectionId,"] remove ")).call(o,e.trackMediaType," from pc")),yield n.pc.removeTrack(e._mediaStreamTrack)}yield n.renegotiateWithGateway()}}else yield n.closeP2PConnection()})()}startP2PConnection(){var e=this;return new ic(function(){var t=r(function*(t,n){if(!e.audioTrack&&!e.videoTrack)return n(new Zu(Cu.UNEXPECTED_ERROR,"no track to publish"));let r=i=>{if("connected"===i&&(e.off(Tl.CONNECTION_STATE_CHANGE,r),t()),"disconnected"===i){if(e.off(Tl.CONNECTION_STATE_CHANGE,r),e.disconnectedReason)return n(e.disconnectedReason);n(new Zu(Cu.OPERATION_ABORTED,"publish abort"))}};e.on(Tl.CONNECTION_STATE_CHANGE,r),e.disconnectedReason=void 0,e.connectionState="connecting",e._waitingSuccessResponse=!0,e.startTime=qh();try{var i;!e.pc.audioTrack&&e.audioTrack&&(yield e.pc.addTrack(e.audioTrack._mediaStreamTrack)),!e.pc.videoTrack&&e.videoTrack&&(yield e.pc.addTrack(e.videoTrack._mediaStreamTrack));let t=yield e.pc.createOfferSDP();gu.REMOVE_NEW_CODECS&&(t=function(e,t){let n=(e,t)=>{const i=Lp(e,t);return i?n(r(e,i),t):e},r=(e,t)=>{var n,r;const i=Pc(n=RegExp.prototype.test).call(n,/^([a-z])=(.*)/),o=["a=rtpmap:".concat(t),"a=rtcp-fb:".concat(t),"a=fmtp:".concat(t)],s=Bs(r=e.split(/(\r\n|\r|\n)/)).call(r,i),a=[];if(Qo(s).call(s,(e,t)=>{Qo(o).call(o,n=>{Vc(e).call(e,n)&&a.push(t)})}),e=Pp(s).call(s,e=>Vc(e).call(e,"apt=".concat(t)))){a.push(e,e-1);var c=(c=s[e-1].match(/a=rtpmap:(\d+) rtx.*/))&&c[1]}return Qo(a).call(a,e=>{s[e]=""}),e=Pp(s).call(s,e=>Vc(e).call(e,"m=video")),s[e]=s[e].replace(" ".concat(t),""),c&&(s[e]=s[e].replace(" ".concat(c),"")),Bs(s).call(s,e=>!!e).join("\r\n")+"\r\n"};return Qo(t).call(t,t=>{e=n(e,t)}),e}(t,"vp9"===e.codec?["av1"]:"av1"===e.codec?["vp9"]:["vp9","av1"]));let n=ln(t);e.videoTrack&&!Vc(i=n.video).call(i,e.codec.toUpperCase())&&$u.warning("current codec is not supported, support list: ".concat(n.video.join(","))),e.audioTrack&&e.audioTrack._encoderConfig&&(t=hn(t,e.audioTrack._encoderConfig)),e.videoTrack&&e.videoTrack._scalabiltyMode&&("vp9"!==e.codec&&"av1"!==e.codec?(e.videoTrack._scalabiltyMode.numSpatialLayers=1,e.videoTrack._scalabiltyMode.numTemporalLayers=1):t=pn(t,e.codec,e.videoTrack._scalabiltyMode),$u.debug("spatial layers: ",e.videoTrack._scalabiltyMode.numSpatialLayers)),yield e.pc.setOfferSDP(t),e.pc.onOfferSettled(),e.videoTrack&&e.setRtpSenderParametersByTrackConfig(e.videoTrack),$u.debug("[".concat(e.connectionId,"] create and set offer success")),i={messageType:"OFFER",sdp:t,offererSessionId:104,retry:!0},Ql.supportDualStreamEncoding&&e.isLowStreamConnection&&e.lowStreamEncoding&&e.videoTrack&&(yield e.setLowStreamEncoding(e.lowStreamEncoding,e.videoTrack));let r=yield Ze(e,Tl.NEED_ANSWER,i),o=e.updateAnswerSDP(r.sdp);yield e.pc.setAnswerSDP(o),$u.debug("[".concat(e.connectionId,"] set answer success")),yield e.icePromise,e.connectionState="connected",e.startUploadStats()}catch(o){e.off(Tl.CONNECTION_STATE_CHANGE,r),e.connectionState="disconnected",e.reportPublishEvent(!1,o.code),$u.error("[".concat(e.connectionId,"] connection error"),o.toString()),n(o)}});return function(e,n){return t.apply(this,arguments)}}())}reportPublishEvent(e,t,n){var r;this._waitingSuccessResponse=!1,pd.publish(this.joinInfo.sid,{lts:this.startTime,succ:e,ec:t,audioName:this.audioTrack&&this.audioTrack.getTrackLabel(),videoName:this.videoTrack&&this.videoTrack.getTrackLabel(),screenshare:!(!this.videoTrack||-1===vc(r=this.videoTrack._hints).call(r,Gl.SCREEN_TRACK)),audio:!!this.audioTrack,video:!!this.videoTrack,p2pid:this.pc.ID,publishRequestid:this.ID,extend:n})}closeP2PConnection(e){var t=this;return r(function*(){let n=t.getAllTracks();var r;Qo(n).call(n,e=>{t.unbindTrackEvents(e)}),t.isLowStreamConnection&&t.videoTrack&&t.videoTrack.close(),t.videoTrack=void 0,t.audioTrack instanceof Dd&&Qo(r=t.audioTrack.trackList).call(r,e=>{t.audioTrack.removeAudioTrack(e)}),t.audioTrack=void 0,t.stopUploadStats(),t.statsCollector.removeConnection(t.connectionId),yield t.closePC(e),t.connectionState="disconnected",t.removeAllListeners()})()}getNetworkQuality(){var e,t=this.pc.getStats();if(!t.videoSend[0]&&!t.audioSend[0])return 1;var n=tt(this,Tl.NEED_SIGNAL_RTT),r=t.videoSend[0]?t.videoSend[0].rttMs:void 0;let i=t.audioSend[0]?t.audioSend[0].rttMs:void 0;return n=.17>(n=70*t.sendPacketLossRate/50+.3*(((r=r&&i?(r+i)/2:r||i)&&n?(r+n)/2:r||n)||0)/1500)?1:.36>n?2:.59>n?3:.1>n?4:5,this.videoTrack&&this.videoTrack._encoderConfig&&-1===vc(e=this.videoTrack._hints).call(e,Gl.SCREEN_TRACK)&&(t=t.bitrate.actualEncoded,(e=this.videoTrack._encoderConfig.bitrateMax)&&t)?_u[.15>(t=(1e3*e-t)/(1e3*e))?0:.3>t?1:.45>t?2:.6>t?3:4][n]:n}handleUpdateBitrateLimit(e){this.videoTrack&&this.videoTrack.setBitrateLimit(e)}uploadStats(e,t){let n=this.audioTrack?function(e,t){const n=e.audioSend[0];return n?((e={id:Je(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:n.ssrc.toString()}).A_astd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1",e.A_ail=n.inputLevel?Math.round(100*n.inputLevel).toString():Math.round(100*t._source.getAudioAvgLevel()).toString(),e.A_apil=Math.round(100*t._source.getAudioAvgLevel()).toString(),e):null}(e,this.audioTrack):void 0,r=this.videoTrack?function(e,t){const n=e.videoSend[0];if(!n)return null;switch((e={id:Je(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()}).A_vstd=t._originMediaStreamTrack&&!t._originMediaStreamTrack.enabled||!t._mediaStreamTrack.enabled?"1":"0",n.sentFrame&&(e.A_fhs=n.sentFrame.height.toString(),e.A_frs=n.sentFrame.frameRate.toString(),e.A_fws=n.sentFrame.width.toString()),n.adaptionChangeReason){case"none":e.A_ac="0";break;case"cpu":e.A_ac="1";break;case"bandwidth":e.A_ac="2";break;case"other":e.A_ac="3"}return e.A_nr=n.nacksCount.toString(),n.avgEncodeMs&&(e.A_aem=n.avgEncodeMs.toFixed(0).toString()),e}(e,this.videoTrack):void 0,i=Ge(e,t),o=function(e){const t={id:"bweforvideo",timestamp:new Date(e.timestamp).toISOString(),type:"VideoBwe"};return e.bitrate.retransmit&&(t.A_rb=e.bitrate.retransmit.toString()),e.bitrate.targetEncoded&&(t.A_teb=e.bitrate.targetEncoded.toString()),t.A_aeb=e.bitrate.actualEncoded.toString(),t.A_tb=e.bitrate.transmit.toString(),void 0!==e.sendBandwidth&&(t.A_asb=e.sendBandwidth.toString()),t}(e);n&&ot(()=>this.emit(Tl.NEED_UPLOAD,El.PUBLISH_STATS,n)),r&&ot(()=>this.emit(Tl.NEED_UPLOAD,El.PUBLISH_STATS,gn({},r,{},i))),o&&ot(()=>this.emit(Tl.NEED_UPLOAD,El.PUBLISH_STATS,o))}uploadSlowStats(e){let t=Ge(e);t&&ot(()=>this.emit(Tl.NEED_UPLOAD,El.PUBLISH_STATS,t))}uploadRelatedStats(e){let t=function(e){return(e=e.videoSend[0])?{mediaType:"video",isVideoMute:!1,frameRateInput:e.inputFrame&&e.inputFrame.frameRate.toString(),frameRateSent:e.sentFrame&&e.sentFrame.frameRate.toString(),googRtt:e.rttMs.toString()}:null}(e);t&&ot(()=>{this.emit(Tl.NEED_UPLOAD,El.PUBLISH_RELATED_STATS,t)})}bindTrackEvents(e){var t;e.addListener(jl.NEED_RESET_REMOTE_SDP,Pc(t=this.handleResetRemoteSdp).call(t,this)),this.isLowStreamConnection||(e instanceof Od?(e.addListener(jl.GET_STATS,this.handleGetLocalAudioStats),e.addListener(jl.NEED_CLOSE,this.handleCloseAudioTrack)):e instanceof Ap&&(e.addListener(jl.GET_STATS,this.handleGetLocalVideoStats),e.addListener(jl.NEED_CLOSE,this.handleCloseVideoTrack),e.addListener(jl.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode)),e.addListener(jl.NEED_RENEGOTIATE,this.handleStreamRenegotiate),e.addListener(jl.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(jl.NEED_SESSION_ID,this.handleGetSessionID))}unbindTrackEvents(e){this.isLowStreamConnection||(e instanceof Od?(e.off(jl.GET_STATS,this.handleGetLocalAudioStats),e.off(jl.NEED_CLOSE,this.handleCloseAudioTrack)):e instanceof Ap&&(e.off(jl.GET_STATS,this.handleGetLocalVideoStats),e.off(jl.NEED_CLOSE,this.handleCloseVideoTrack)),e.off(jl.NEED_RENEGOTIATE,this.handleStreamRenegotiate),e.off(jl.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(jl.NEED_SESSION_ID,this.handleGetSessionID))}addTrackWithPC(e){var t=this;return r(function*(){if("connecting"===t.connectionState)return new Zu(Cu.INVALID_OPERATION,"last publish operation has not finished").throw();let n=t.videoTrack,r=!1;return t.audioTrack&&e instanceof Od?(t.audioTrack=e,$u.debug("[".concat(t.connectionId,"] replace pc audio track")),r=yield t.pc.replaceTrack(e._mediaStreamTrack)):t.videoTrack&&e instanceof Ap?(t.videoTrack=e,$u.debug("[".concat(t.connectionId,"] replace pc video track")),r=yield t.pc.replaceTrack(e._mediaStreamTrack)):e instanceof Od?(t.audioTrack=e,$u.debug("[".concat(t.connectionId,"] add audio track to pc")),yield t.pc.addTrack(e._mediaStreamTrack),r=!0):e instanceof Ap&&(t.videoTrack=e,$u.debug("[".concat(t.connectionId,"] add video track to pc")),yield t.pc.addTrack(e._mediaStreamTrack),r=!0),"connected"===t.connectionState&&t.videoTrack!==n&&t.videoTrack&&(yield t.setRtpSenderParametersByTrackConfig(t.videoTrack)),"disconnected"!==t.connectionState&&r})()}handleResetRemoteSdp(){return new ic((e,t)=>{var n;$u.info("[pc-".concat(this.pc.ID,"] start reset remote sdp"));let r=this.pc.getOfferSDP();var i=this.pc.getAnswerSDP();if(!i||!r)return e();let o;i=i.sdp,this.videoTrack&&this.videoTrack._encoderConfig&&-1===vc(n=this.videoTrack._hints).call(n,Gl.SCREEN_TRACK)&&(o=function(e,t){var n,r;let i=t.bitrateMin;t=t.bitrateMax;let o=Pc(n=RegExp.prototype.test).call(n,/^([a-z])=(.*)/);if(e=Bs(r=e.split(/(\r\n|\r|\n)/)).call(r,o),t){let n="AS";var s;Pe().name===Xc.FIREFOX&&(t=1e3*(t>>>0),n="TIAS"),0<(r=Pp(e).call(e,e=>Vc(e).call(e,n)))&&(e[r]=Us(s="b=".concat(n,":")).call(s,t))}return i&&0<(s=Pp(e).call(e,e=>Vc(e).call(e,"x-google-min-bitrate")))&&(e[s]=e[s].replace(/x-google-min-bitrate=(.*)/,"x-google-min-bitrate=".concat(i))),e.join("\r\n")+"\r\n"}(i,this.videoTrack._encoderConfig)),i!==o?this.pc.setOfferSDP(r.sdp).then(()=>{if(o)return this.pc.setAnswerSDP(o)}).then(e).catch(e=>{var n;$u.error(Us(n="[pc-".concat(this.pc.ID,"] reset remote sdp error, ")).call(n,e)),t(e)}):$u.debug("[pc-".concat(this.pc.ID,"] remote sdp have no not changed"))})}setRtpSenderParametersByTrackConfig(e){var t=this;return r(function*(){if(!Ql.supportSetRtpSenderParameters)return void $u.debug("[".concat(t.connectionId,"] do not support set pc rtp sender, skip"));let n={},r="balanced";"motion"===e._optimizationMode?r="maintain-framerate":"detail"===e._optimizationMode&&(r="maintain-resolution"),$u.debug("[".concat(t.connectionId,"] set pc rtp sender"),n,r),yield t.pc.setRtpSenderParameters(n,r)})()}updateAnswerSDP(e){var t,n;return e=e.replace(/a=x-google-flag:conference\r\n/g,""),this.videoTrack&&vc(t=this.videoTrack._hints).call(t,Gl.SCREEN_TRACK),this.videoTrack&&this.videoTrack._encoderConfig&&-1===vc(n=this.videoTrack._hints).call(n,Gl.SCREEN_TRACK)&&(e=function(e,t,n){let r=Ql;var i=n.bitrateMin;n=n.bitrateMax;let o=e.match(/m=video.*\r\n/)||e.match(/m=video.*\n/);var s,a,c,u;return o&&0<o.length&&r.supportMinBitrate&&i&&(t=Lp(e,t))&&(e=e.replace(o[0],Us(s=Us(a="".concat(o[0],"a=fmtp:")).call(a,t," x-google-min-bitrate=")).call(s,i,"\r\n"))),o&&0<o.length&&n&&(i="AS",Pe().name===Xc.FIREFOX&&(n=1e3*(n>>>0),i="TIAS"),e=e.replace(o[0],Us(c=Us(u="".concat(o[0],"b=")).call(u,i,":")).call(c,n,"\r\n"))),e}(e,this.codec,this.videoTrack._encoderConfig)),this.audioTrack&&this.audioTrack._encoderConfig&&(e=hn(e,this.audioTrack._encoderConfig)),function(e){let t=Pe();return t.name!==Xc.SAFARI&&t.os!==Jc.IOS?e:e.replace(/a=.*video-orientation\r\n/g,"")}(e)}createPC(){this.pc=new np({turnServer:this.joinInfo.turnServer}),this.updateICEPromise()}closePC(e){var t=this;return r(function*(){return t.pc.onICEConnectionStateChange=void 0,t.pc.close(),!e&&(yield Ze(t,Tl.NEED_UNPUB))})()}onPCDisconnected(e){this.reportPublishEvent(!1,e.code)}setLowStreamEncoding(e,t){var n=this;return r(function*(){try{let r=yield n.pc.setVideoRtpEncodingParameters(e),i=t.getMediaStreamTrack();if(e.scaleResolutionDownBy&&r.encodings[0].scaleResolutionDownBy!==e.scaleResolutionDownBy){let n=t._videoHeight||i.getSettings().height,r=t._videoWidth||i.getSettings().width;n&&r&&(yield i.applyConstraints({height:n/e.scaleResolutionDownBy,width:r/e.scaleResolutionDownBy}))}e.maxFramerate&&r.encodings[0].maxFramerate!==e.maxFramerate&&(yield i.applyConstraints({frameRate:e.maxFramerate}))}catch(r){if(r instanceof Zu)throw r;throw new Zu(Cu.LOW_STREAM_ENCODING_ERROR,r.message)}})()}}class Mp extends Ed{constructor(e,t,n){super(e),this._isDestroyed=!1,this._userId=t,this._uintId=n}getUserId(){return this._userId}_updateOriginMediaStreamTrack(e){this._mediaStreamTrack=this._originMediaStreamTrack=e,this._updatePlayerSource()}_destroy(){this._isDestroyed=!0,$u.info("[track-".concat(this.getTrackId(),"] is destroyed")),this.stop()}}class Up extends Mp{constructor(e,t,n){super(e,t,n),this.trackMediaType="video",this.updateMediaStreamTrackResolution()}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==tl.PLAYING)}getStats(){return st(()=>{$u.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),tt(this,jl.GET_STATS)||vn({},Al)}play(e,t={}){let n=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.REMOTE_VIDEO_TRACK_PLAY,options:[this.getTrackId(),"string"==typeof e?e:"HTMLElement",t]});if("string"==typeof e){let t=document.getElementById(e);var r;t?e=t:($u.warning(Us(r="[track-".concat(this.getTrackId(),'] can not find "#')).call(r,e,'" element, use document.body')),e=document.body)}$u.debug("[track-".concat(this.getTrackId(),"] start video playback"),wr(t)),e=vn({fit:"cover"},t,{trackId:this.getTrackId(),element:e}),this._player?this._player.updateConfig(e):(this._player=new ap(e),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.emit(Hl.FIRST_FRAME_DECODED)}),this._player.play(),n.onSuccess()}stop(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.REMOTE_VIDEO_TRACK_STOP,options:[this.getTrackId()]});if(!this._player)return e.onSuccess();this._player.destroy(),this._player=void 0,$u.debug("[track-".concat(this.getTrackId(),"] stop video playback")),e.onSuccess()}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){Xe(this._originMediaStreamTrack).then(([e,t])=>{this._videoHeight=t,this._videoWidth=e}).catch(Qh)}_updatePlayerSource(){$u.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}}class Vp extends Mp{constructor(e,t,n){super(e,t,n),this.trackMediaType="audio",this._useAudioElement=!0,this._volume=100,this._source=new Cd(e,!0),this._source.once(bl.RECEIVE_TRACK_BUFFER,()=>{this.emit(Hl.FIRST_FRAME_DECODED)})}get isPlaying(){return this._useAudioElement?Ad.isPlaying(this.getTrackId()):this._source.isPlayed}setAudioFrameCallback(e,t=4096){if(!e)return this._source.removeAllListeners(bl.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(bl.ON_AUDIO_BUFFER),this._source.on(bl.ON_AUDIO_BUFFER,t=>e(t))}setVolume(e){let t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.REMOTE_AUDIO_SET_VOLUME,options:[this.getTrackId(),e]},300);this._volume=e,this._useAudioElement?Ad.setVolume(this.getTrackId(),e):this._source.setVolume(e/100),t.onSuccess()}setPlaybackDevice(e){var t=this;return r(function*(){let n=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.REMOTE_AUDIO_SET_OUTPUT_DEVICE,options:[t.getTrackId(),e]});if(!t._useAudioElement)throw new Zu(Cu.NOT_SUPPORTED,"your browser does not support setting the audio output device");try{yield Ad.setSinkID(t.getTrackId(),e)}catch(r){throw n.onError(r),r}n.onSuccess()})()}getVolumeLevel(){return this._source.getAudioLevel()}getStats(){return st(()=>{$u.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),tt(this,jl.GET_STATS)||vn({},Il)}play(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.REMOTE_AUDIO_TRACK_PLAY,options:[this.getTrackId()]});$u.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?($u.debug("[track-".concat(this.getTrackId(),"] use audio element to play")),Ad.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play(),e.onSuccess()}stop(){let e=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.REMOTE_AUDIO_TRACK_STOP,options:[this.getTrackId()]});$u.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Ad.stop(this.getTrackId()):this._source.stop(),e.onSuccess()}_destroy(){super._destroy(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){$u.debug("[track-".concat(this.getTrackId(),"] update player source track")),this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Ad.updateTrack(this.getTrackId(),this._mediaStreamTrack)}}class Fp extends sp{constructor(e,t,n,r){super(n,e.uid),this.type="sub",this.unusedTracks=[],this.onTrack=e=>{var t,n,r,i;if("audio"===e.kind&&!this.subscribeOptions.audio||"video"===e.kind&&!this.subscribeOptions.video)return this.unusedTracks.push(e),void $u.debug(Us(n="[".concat(this.connectionId,"] unused ontrack event, kind: ")).call(n,e.kind));$u.debug(Us(t="[".concat(this.connectionId,"] emit pc ontrack after subscribe ")).call(t,e.kind),e),(t="audio"===e.kind?this.user._audioTrack:this.user._videoTrack)?t._updateOriginMediaStreamTrack(e):"audio"===e.kind?(this.pc._statsFilter.setIsFirstAudioDecoded(!1),this.user._audioTrack=new Vp(e,this.getUserId(),this.user._uintid),$u.info(Us(r="[".concat(this.connectionId,"] create remote audio track: ")).call(r,this.user._audioTrack.getTrackId())),this.bindTrackEvents(this.user._audioTrack)):(this.user._videoTrack=new Up(e,this.getUserId(),this.user._uintid),$u.info(Us(i="[".concat(this.connectionId,"] create remote video track: ")).call(i,this.user._videoTrack.getTrackId())),this.bindTrackEvents(this.user._videoTrack))},this.handleGetRemoteAudioStats=e=>{e(this.statsCollector.getRemoteAudioTrackStats(this.connectionId))},this.handleGetRemoteVideoStats=e=>{e(this.statsCollector.getRemoteVideoTrackStats(this.connectionId))},this.handleGetSessionID=e=>{e(this.joinInfo.sid)},this.user=e,this.statsCollector=t,this.statsCollector.addRemoteConnection(this),this.subscribeOptions=r}startP2PConnection(){var e=this;return r(function*(){return new ic(function(){var t=r(function*(t,n){let r=i=>{if("connected"===i&&(pd.subscribe(e.joinInfo.sid,{lts:e.startTime,succ:!0,video:e.subscribeOptions.video,audio:e.subscribeOptions.audio,peerid:e.user.uid,ec:null,subscribeRequestid:e.ID,p2pid:e.pc.ID}),e.off(Tl.CONNECTION_STATE_CHANGE,r),t()),"disconnected"===i){if(e.off(Tl.CONNECTION_STATE_CHANGE,r),e.disconnectedReason)return n(e.disconnectedReason);n(new Zu(Cu.OPERATION_ABORTED,"subscribe abort"))}};if(e.on(Tl.CONNECTION_STATE_CHANGE,r),e.disconnectedReason=void 0,e.connectionState="connecting",e.startTime=qh(),!e.subscribeOptions)return void n(new Zu(Cu.UNEXPECTED_ERROR,"no subscribe options"));let i=new MediaStream,o=new ic(t=>{e.pc.onTrack=(n,r)=>{var o,s;if("audio"===n.kind&&!e.subscribeOptions.audio||"video"===n.kind&&!e.subscribeOptions.video)return e.unusedTracks.push(n),void $u.debug(Us(s="[".concat(e.connectionId,"] unused ontrack event ")).call(s,n.kind));i.addTrack(n),s={audio:0<i.getAudioTracks().length,video:0<i.getVideoTracks().length},$u.debug(Us(o="[".concat(e.connectionId,"] subscribe ontrack: ")).call(o,n.kind),r,n);e:{var a,c;for(n=e.subscribeOptions,r=Iu(a=ts(s)).call(a),a=Iu(c=ts(n)).call(c),c=0;c<r.length;c+=1){if(r[c]!==a[c]){s=!1;break e}if(s[r[c]]!==n[r[c]]){s=!1;break e}}s=!0}s&&(e.pc.onTrack=e.onTrack,$u.debug("[".concat(e.connectionId,"] get all subscribed tracks")),t(i))}});try{let t=function(e){return Pe().name!==Xc.FIREFOX?e:e.replace("/recvonly http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"," http://www.webrtc.org/experiments/rtp-hdrext/playout-delay")}(dn(yield e.pc.createOfferSDP()));yield e.pc.setOfferSDP(t),$u.debug("[".concat(e.connectionId,"] create and set offer success"));let n=yield Ze(e,Tl.NEED_ANSWER,{messageType:"OFFER",sdp:t,offererSessionId:104,retry:!0});yield e.pc.setAnswerSDP(dn(n.sdp)),$u.debug("[".concat(e.connectionId,"] set answer success"));let r=yield ic.all([o,e.icePromise]),i=r[0].getAudioTracks()[0],c=r[0].getVideoTracks()[0];var s,a;i&&(e.user._audioTrack?e.user._audioTrack._updateOriginMediaStreamTrack(i):(e.user._audioTrack=new Vp(i,e.getUserId(),e.user._uintid),$u.info(Us(s="[".concat(e.connectionId,"] create remote audio track: ")).call(s,e.user._audioTrack.getTrackId())),e.bindTrackEvents(e.user._audioTrack))),c&&(e.user._videoTrack?e.user._videoTrack._updateOriginMediaStreamTrack(c):(e.user._videoTrack=new Up(c,e.getUserId(),e.user._uintid),$u.info(Us(a="[".concat(e.connectionId,"] create remote video track: ")).call(a,e.user._videoTrack.getTrackId())),e.bindTrackEvents(e.user._videoTrack))),e.connectionState="connected",e.startUploadStats()}catch(c){e.off(Tl.CONNECTION_STATE_CHANGE,r),e.connectionState="disconnected",pd.subscribe(e.joinInfo.sid,{lts:e.startTime,succ:!1,video:e.subscribeOptions.video,audio:e.subscribeOptions.audio,peerid:e.user.uid,ec:c.code,subscribeRequestid:e.ID,p2pid:e.pc.ID}),n(c)}});return function(e,n){return t.apply(this,arguments)}}())})()}closeP2PConnection(e){var t=this;return r(function*(){"disconnected"!==t.connectionState&&(t.stopUploadStats(),t.statsCollector.removeConnection(t.connectionId),t.connectionState="disconnected",yield t.setSubscribeOptions({audio:!1,video:!1}),yield t.closePC(e),t.removeAllListeners())})()}getNetworkQuality(){var e=this.pc.getStats();if(!e.audioRecv[0]&&!e.videoRecv[0])return 1;var t=tt(this,Tl.NEED_SIGNAL_RTT),n=e.rtt;t=(n&&t?(n+t)/2:n||t)||0,n=e.audioRecv[0]?e.audioRecv[0].jitterMs:void 0;let r=70*(e=e.recvPacketLossRate)/50+.3*t/1500;return n&&(r=60*e/50+.2*t/1500+.2*n/400),.1>r?1:.17>r?2:.36>r?3:.59>r?4:5}uploadStats(e){let t=this.user.audioTrack?function(e,t){const n=e.audioRecv[0];return n?((e={id:Je(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:n.ssrc.toString()}).bytesReceived=n.bytes.toString(),e.packetsLost=n.packetsLost.toString(),e.packetsReceived=n.packets.toString(),e.A_aol=n.outputLevel?Math.round(100*n.outputLevel).toString():Math.round(100*t._source.getAudioAvgLevel()).toString(),e.A_apol=Math.round(100*t._source.getAudioAvgLevel()).toString(),t&&(e.A_artd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1"),e.A_jr=n.jitterMs.toString(),e.A_jbm=Math.floor(n.jitterBufferMs).toString(),e.A_cdm=Math.floor(n.jitterBufferMs).toString(),e):null}(e,this.user.audioTrack):void 0,n=this.user.videoTrack?function(e,t){const n=e.videoRecv[0];return n?((e={id:Je(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:n.ssrc.toString()}).bytesReceived=n.bytes.toString(),e.packetsLost=n.packetsLost.toString(),e.packetsReceived=n.packets.toString(),n.framesRateFirefox&&(e.A_frr=n.framesRateFirefox.toString()),n.receivedFrame&&(e.A_frr=n.receivedFrame.frameRate.toString()),e.A_frd=n.decodeFrameRate.toString(),n.outputFrame&&(e.A_fro=n.outputFrame.frameRate.toString()),void 0!==n.jitterBufferMs&&(e.A_jbm=Math.floor(n.jitterBufferMs).toString()),void 0!==n.currentDelayMs&&(e.A_cdm=Math.floor(n.currentDelayMs).toString()),e.A_fs=n.firsCount.toString(),e.A_ns=n.nacksCount.toString(),e.A_ps=n.plisCount.toString(),t&&(e.A_vrtd=t._originMediaStreamTrack.enabled&&t._mediaStreamTrack.enabled?"0":"1"),t._player&&0<t._player.freezeTimeCounterList.length&&(e.A_vrft=dc(r=t._player.freezeTimeCounterList).call(r,0,1)[0].toString()),e):null;var r}(e,this.user.videoTrack):void 0;t&&ot(()=>this.emit(Tl.NEED_UPLOAD,El.SUBSCRIBE_STATS,t)),n&&ot(()=>this.emit(Tl.NEED_UPLOAD,El.SUBSCRIBE_STATS,n))}uploadSlowStats(e){}uploadRelatedStats(e,t){let n=!0===this.pc._statsFilter.videoIsReady,r=function(e,t,n){return(e=e.audioRecv[0])?(n=Kh.isRemoteAudioFreeze(n),{mediaType:"audio",isAudioMute:!1,peerId:t,googJitterReceived:e.jitterMs.toString(),isFreeze:n,bytesReceived:e.bytes.toString(),packetsReceived:e.packets.toString(),packetsLost:e.packetsLost.toString(),frameReceived:e.receivedFrames.toString(),frameDropped:e.droppedFrames.toString()}):null}(e,this.getUserId(),this.user.audioTrack),i=function(e,t,n,r,i){return(t=t.videoRecv[0])?(e=Kh.isRemoteVideoFreeze(i,t,r?r.videoRecv[0]:void 0)&&e,n={mediaType:"video",isVideoMute:!1,peerId:n,frameRateReceived:t.receivedFrame&&t.receivedFrame.frameRate.toString(),frameRateDecoded:t.decodedFrame&&t.decodedFrame.frameRate.toString(),isFreeze:e,bytesReceived:t.bytes.toString(),packetsReceived:t.packets.toString(),packetsLost:t.packetsLost.toString()},t.framesRateFirefox&&(n.frameRateDecoded=t.framesRateFirefox.toString(),n.frameRateReceived=t.framesRateFirefox.toString()),n):null}(n,e,this.getUserId(),t,this.user.videoTrack);r&&ot(()=>{this.emit(Tl.NEED_UPLOAD,El.SUBSCRIBE_RELATED_STATS,r)}),i&&ot(()=>{this.emit(Tl.NEED_UPLOAD,El.SUBSCRIBE_RELATED_STATS,i)})}emitOnTrackFromUnusedTracks(){if(this.subscribeOptions){var e,t=this.subscribeOptions.video;if(this.subscribeOptions.audio){var n;let e=Ac(n=this.unusedTracks).call(n,e=>"audio"===e.kind&&"live"===e.readyState);rt(this.unusedTracks,e),e&&this.onTrack(e)}t&&(t=Ac(e=this.unusedTracks).call(e,e=>"video"===e.kind&&"live"===e.readyState),rt(this.unusedTracks,t),t&&this.onTrack(t))}}setSubscribeOptions(e){var t=this;return r(function*(){var n,r,i,o;if(e.audio!==t.subscribeOptions.audio||e.video!==t.subscribeOptions.video){if("connecting"===t.connectionState)try{yield t.createWaitConnectionConnectedPromise()}catch(s){throw new Zu(Cu.OPERATION_ABORTED,"can not update subscribe options, operation abort")}e.audio===t.subscribeOptions.audio&&e.video===t.subscribeOptions.video||($u.debug(Us(n=Us(r=Us(i=Us(o="[".concat(t.connectionId,"] update subscribe options [a: ")).call(o,t.subscribeOptions.audio,", v: ")).call(i,t.subscribeOptions.video,"] -> [a: ")).call(r,e.audio,", v: ")).call(n,e.video,"]")),t.subscribeOptions=e,!e.audio&&t.user._audioTrack&&(t.unusedTracks.push(t.user._audioTrack._originMediaStreamTrack),t.user._audioTrack._destroy(),t.unbindTrackEvents(t.user._audioTrack),t.user._audioTrack=void 0),!e.video&&t.user._videoTrack&&(t.unusedTracks.push(t.user._videoTrack._originMediaStreamTrack),t.user._videoTrack._destroy(),t.unbindTrackEvents(t.user._videoTrack),t.user._videoTrack=void 0),t.emitOnTrackFromUnusedTracks())}})()}createPC(){this.pc=new rp({turnServer:this.joinInfo.turnServer}),this.pc.onFirstAudioDecoded=()=>{this.user.audioTrack&&this.user.audioTrack.emit(Hl.FIRST_FRAME_DECODED),pd.firstRemoteFrame(this.joinInfo.sid,rl.FIRST_AUDIO_DECODE,il.FIRST_AUDIO_DECODE,{peer:this.user._uintid,subscribeElapse:qh()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstAudioReceived=()=>{pd.firstRemoteFrame(this.joinInfo.sid,rl.FIRST_AUDIO_RECEIVED,il.FIRST_AUDIO_RECEIVED,{peer:this.user._uintid,subscribeElapse:qh()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoDecoded=(e,t)=>{pd.firstRemoteFrame(this.joinInfo.sid,rl.FIRST_VIDEO_DECODE,il.FIRST_VIDEO_DECODE,{peer:this.user._uintid,videowidth:e,videoheight:t,subscribeElapse:qh()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.pc.onFirstVideoReceived=()=>{pd.firstRemoteFrame(this.joinInfo.sid,rl.FIRST_VIDEO_RECEIVED,il.FIRST_VIDEO_RECEIVED,{peer:this.user._uintid,subscribeElapse:qh()-this.startTime,subscribeRequestid:this.ID,p2pid:this.pc.ID})},this.updateICEPromise()}closePC(e){var t=this;return r(function*(){return t.pc.audioTrack&&t.pc.audioTrack.stop(),t.pc.videoTrack&&t.pc.videoTrack.stop(),t.pc.onTrack=void 0,t.pc.onICEConnectionStateChange=void 0,t.pc.close(),!e&&(yield Ze(t,Tl.NEED_UNSUB))})()}onPCDisconnected(e){pd.subscribe(this.joinInfo.sid,{lts:this.startTime,succ:!1,video:this.subscribeOptions.video,audio:this.subscribeOptions.audio,peerid:this.user.uid,ec:e.code,subscribeRequestid:this.ID,p2pid:this.pc.ID})}bindTrackEvents(e){e instanceof Vp?e.addListener(jl.GET_STATS,this.handleGetRemoteAudioStats):e instanceof Up&&e.addListener(jl.GET_STATS,this.handleGetRemoteVideoStats)}unbindTrackEvents(e){e instanceof Vp?e.off(jl.GET_STATS,this.handleGetRemoteAudioStats):e instanceof Up&&e.off(jl.GET_STATS,this.handleGetRemoteVideoStats)}}class Bp extends Hh{constructor(e,t,n,r){super(),this.reconnectMode="retry",this.commandReqId=this.reqId=0,this.handleWebSocketOpen=()=>{this.reconnectMode="retry",this.startPingPong()},this.handleWebSocketMessage=e=>{var t;e.data&&((e=JSON.parse(e.data)).requestId?this.emit(Us(t="@".concat(e.requestId,"-")).call(t,e.sid),e):this.serviceMode===Nl.INJECT?this.emit(xl.INJECT_STREAM_STATUS,e):(pd.workerEvent(this.spec.sid,{actionType:"status",serverCode:e.code,workerType:this.serviceMode===Nl.TRANSCODE?1:2}),this.emit(xl.PUBLISH_STREAM_STATUS,e)))},this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new _d("live-streaming",n),this.websocket.on(Ol.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ol.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ol.REQUEST_NEW_URLS,(e,t)=>{Ze(this,xl.REQUEST_NEW_ADDRESS).then(e).catch(t)}),this.websocket.on(Ol.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}request(e,t,n,i){var o=this;return r(function*(){o.reqId+=1,"request"===e&&(o.commandReqId+=1);let r=o.commandReqId,s=o.reqId;if(!s||!o.websocket)throw new Zu(Cu.UNEXPECTED_ERROR);var a=En({command:e,sdkVersion:"4.5.0"===cu?"0.0.1":cu,seq:s,requestId:s,allocate:n,cname:o.spec.cname,appId:o.spec.appId,sid:o.spec.sid,uid:o.spec.uid.toString(),ts:Math.floor(qh()/1e3)},t);if("closed"===o.websocket.state)throw new Zu(Cu.WS_DISCONNECT);let c=()=>new ic((e,t)=>{o.websocket.once(Ol.CLOSED,()=>t(new Zu(Cu.WS_ABORT))),o.websocket.once(Ol.CONNECTED,e)});"connected"!==o.websocket.state&&(yield c()),a.clientRequest&&(a.clientRequest.workerToken=o.token);let u=new ic((e,t)=>{var n;const r=()=>{t(new Zu(Cu.WS_ABORT))};o.websocket.once(Ol.RECONNECTING,r),o.websocket.once(Ol.CLOSED,r),o.once(Us(n="@".concat(s,"-")).call(n,o.spec.sid),t=>{e(t)})});i&&pd.workerEvent(o.spec.sid,En({},i,{requestId:r,actionType:"request",payload:wr(t.clientRequest),serverCode:0,code:0}));let l=qh();o.websocket.sendMessage(a),a=null;try{a=yield u}catch(h){if("closed"===o.websocket.state)throw h;return yield c(),yield o.request(e,t,n)}return i&&pd.workerEvent(o.spec.sid,En({},i,{requestId:r,actionType:"response",payload:wr(a.serverResponse),serverCode:a.code,success:200===a.code,responseTime:qh()-l})),200!==a.code&&o.handleResponseError(a),a})()}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let e="4.5.0"===cu?"0.0.1":cu;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(qh()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Ul.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void $u.warning("live stream response already exists stream");case Ul.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ul.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ul.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Zu(Cu.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Ul.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;throw new Zu(Cu.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ul.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Zu(Cu.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Ul.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:var t=new Zu(Cu.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(xl.WARNING,t,e.serverResponse.url);case Ul.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:return t=new Zu(Cu.LIVE_STREAMING_WARN_FREQUENT_REQUEST),this.emit(xl.WARNING,t,e.serverResponse.url);case Ul.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Zu(Cu.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ul.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Zu(Cu.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Ul.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:return t=new Zu(Cu.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT),this.emit(xl.WARNING,t,e.serverResponse.url);case Ul.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Zu(Cu.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Ul.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Zu(Cu.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ul.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ul.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;throw new Zu(Cu.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ul.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)break;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new Zu(Cu.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new Zu(Cu.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ul.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ul.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ul.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ul.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Zu(Cu.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(Qh)},6e3)}}class jp extends Hh{constructor(e,t=gd,n=gd){super(),this.retryTimeout=1e4,this.streamingTasks=new Do,this.isStartingStreamingTask=!1,this.taskMutex=new nd("live-streaming"),this.cancelToken=Qu.CancelToken.source(),this.injectConfig=Tn({},Ll),this.injectLoopTimes=0,this.lastTaskId=1,this.statusError=new Do,this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}setTranscodingConfig(e){var t=this;return r(function*(){var n;let r=Tn({},Pl,{},e);var i,o,s,a;if(66!==r.videoCodecProfile&&77!==r.videoCodecProfile&&100!==r.videoCodecProfile&&($u.debug(Us(i="[".concat(t.spec.clientId,"] set transcoding config, fix video codec profile: ")).call(i,r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=ac(o=r.transcodingUsers).call(o,e=>Tn({},kl,{},e,{zOrder:e.zOrder?e.zOrder+1:1}))),function(e){var t,n;null==e.width||ye(e.width,"config.width",0,1e4),null==e.height||ye(e.height,"config.height",0,1e4),null==e.videoBitrate||ye(e.videoBitrate,"config.videoBitrate",1,1e6),null==e.videoFrameRate||ye(e.videoFrameRate,"config.videoFrameRate"),null==e.lowLatency||_e(e.lowLatency,"config.lowLatency"),null==e.audioSampleRate||ve(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),null==e.audioBitrate||ye(e.audioBitrate,"config.audioBitrate",1,128),null==e.audioChannels||ve(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),null==e.videoGop||ye(e.videoGop,"config.videoGop"),null==e.videoCodecProfile||ve(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),null==e.userCount||ye(e.userCount,"config.userCount",0,17),null==e.backgroundColor||ye(e.backgroundColor,"config.backgroundColor",0,16777215),null==e.userConfigExtraInfo||Ee(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&null!=e.transcodingUsers&&(Se(e.transcodingUsers,"config.transcodingUsers"),Qo(t=e.transcodingUsers).call(t,(e,t)=>{be(e.uid),null==e.x||ye(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),null==e.y||ye(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),null==e.width||ye(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),null==e.height||ye(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),null==e.zOrder||ye(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),null==e.alpha||ye(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)})),null==e.watermark||Ne(e.watermark,"watermark"),null==e.backgroundImage||Ne(e.backgroundImage,"backgroundImage"),e.images&&null!=e.images&&(Se(e.images,"config.images"),Qo(n=e.images).call(n,(e,t)=>{Ne(e,"images[".concat(t,"]"))}))}(r),e=[],r.images&&e.push(...ac(s=r.images).call(s,e=>Tn({},Dl,{},e,{zOrder:255}))),r.backgroundImage&&(e.push(Tn({},Dl,{},r.backgroundImage,{zOrder:0})),delete r.backgroundImage),r.watermark&&(e.push(Tn({},Dl,{},r.watermark,{zOrder:255})),delete r.watermark),r.images=e,r.transcodingUsers&&(r.userConfigs=ac(a=r.transcodingUsers).call(a,e=>Tn({},e)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers),s=ac(n=r.userConfigs||[]).call(n,e=>"number"==typeof e.uid?ic.resolve(e.uid):Wt(e.uid,t.spec,t.cancelToken.token,t.httpRetryConfig)),n=yield ic.all(s),Qo(n).call(n,(e,t)=>{r.userConfigs&&r.userConfigs[t]&&(r.userConfigs[t].uid=e)}),t.transcodingConfig=r,t.connection)try{var c,u,l;let e=yield t.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:t.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:ac(c=Gh(Bh(u=t.streamingTasks).call(u))).call(c,e=>e.taskId).join("#")});$u.debug(Us(l="[".concat(t.spec.clientId,"] update live transcoding config success, code: ")).call(l,e.code,", config:"),wr(t.transcodingConfig))}catch(d){var h;if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&t.connection.tryNextAddress(),Qo(h=t.streamingTasks).call(h,e=>{$u.warning("[".concat(t.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",e.url),t.startLiveStreamingTask(e.url,e.mode,d).then(()=>{var n;$u.debug(Us(n="[".concat(t.spec.clientId,"] live streaming republish ")).call(n,e.url," success"))}).catch(n=>{$u.error("[".concat(t.spec.clientId,"] live streaming republish failed"),e.url,n.toString()),t.onLiveStreamError&&t.onLiveStreamError(e.url,n)})})}})()}setInjectStreamConfig(e,t){this.injectConfig=Zo({},this.injectConfig,e),this.injectLoopTimes=t}startLiveStreamingTask(e,t,n){var i=this;return r(function*(){var r,o,s,a;if(Ac(r=Gh(Bh(o=i.streamingTasks).call(o))).call(r,e=>e.mode===Nl.INJECT)&&t===Nl.INJECT)return new Zu(Cu.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!i.transcodingConfig&&t===Nl.TRANSCODE)throw new Zu(Cu.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");if(r={command:"PublishStream",ts:qh(),url:e,uid:i.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0},$u.debug(Us(s=Us(a="[".concat(i.spec.clientId,"] start live streaming ")).call(a,e,", mode: ")).call(s,t)),s=yield i.taskMutex.lock(),i.connection||!n){if(i.streamingTasks.get(e)&&!n)return s(),new Zu(Cu.LIVE_STREAMING_TASK_CONFLICT).throw();try{i.connection||(i.connection=yield i.connect(t))}catch(u){throw s(),u}switch(t){case Nl.TRANSCODE:r.transcodingConfig=Tn({},i.transcodingConfig);break;case Nl.INJECT:r={cname:i.spec.cname,command:"InjectStream",sid:i.spec.sid,transcodingConfig:i.injectConfig,ts:qh(),url:e,loopTimes:i.injectLoopTimes}}i.uapResponse&&i.uapResponse.vid&&(r.vid=i.uapResponse.vid),i.isStartingStreamingTask=!0,a=i.lastTaskId++;try{var c;let o=new ic((t,r)=>{Ye(i.retryTimeout).then(()=>{if(n)return r(n);const t=i.statusError.get(e);return t?(i.statusError.delete(e),r(t)):void 0})}),u=yield ic.race([i.connection.request("request",{clientRequest:r},!0,{url:e,command:"PublishStream",workerType:t===Nl.TRANSCODE?1:2,requestByUser:!n,tid:a.toString()}),o]);i.isStartingStreamingTask=!1,$u.debug(Us(c="[".concat(i.spec.clientId,"] live streaming started, code: ")).call(c,u.code)),i.streamingTasks.set(e,{clientRequest:r,mode:t,url:e,taskId:a}),s()}catch(u){if(s(),i.isStartingStreamingTask=!1,!u.data||!u.data.retry||n)throw u;return u.data.changeAddress?(i.connection.tryNextAddress(),yield i.startLiveStreamingTask(e,t,u)):yield i.startLiveStreamingTask(e,t,u)}}else s()})()}stopLiveStreamingTask(e){return new ic((t,n)=>{let r=this.streamingTasks.get(e);if(!r||!this.connection)return new Zu(Cu.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let i=r.mode;r.abortTask=()=>{$u.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:i===Nl.INJECT?"UninjectStream":"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===Nl.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(n=>{var r;$u.debug(Us(r="[".concat(this.spec.clientId,"] stop live streaming success, code: ")).call(r,n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&i!==Nl.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),i===Nl.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(5,this.spec.uid,e)}).catch(n)})}controlInjectStream(e,t,n,i){var o=this;return r(function*(){let r=o.streamingTasks.get(e);if(!r||!o.connection||r.mode!==Nl.INJECT)throw new Zu(Cu.INVALID_OPERATION,"can not find inject stream task to control");return(yield o.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:i}})).serverResponse})()}resetAllTask(){var e;let t=Gh(Bh(e=this.streamingTasks).call(e));this.terminate();for(let n of t)this.startLiveStreamingTask(n.url,n.mode).catch(e=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Do,this.isStartingStreamingTask=!1,this.statusError=new Do,this.cancelToken=Qu.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}connect(e){var t=this;return r(function*(){if(t.connection)throw new Zu(Cu.UNEXPECTED_ERROR,"live streaming connection has already connected");let n=yield Ze(t,Ml.REQUEST_WORKER_MANAGER_LIST,e);return t.uapResponse=n,t.connection=new Bp(n.workerToken,t.spec,t.wsRetryConfig,e),t.connection.on(xl.WARNING,(e,n)=>t.onLiveStreamWarning&&t.onLiveStreamWarning(n,e)),t.connection.on(xl.PUBLISH_STREAM_STATUS,e=>t.handlePublishStreamServer(e)),t.connection.on(xl.INJECT_STREAM_STATUS,e=>t.handleInjectStreamServerStatus(e)),t.connection.on(xl.REQUEST_NEW_ADDRESS,(n,r)=>{if(!t.connection)return r(new Zu(Cu.UNEXPECTED_ERROR,"can not get new live streaming address list"));Ze(t,Ml.REQUEST_WORKER_MANAGER_LIST,e).then(e=>{t.uapResponse=e,n(e.addressList)}).catch(r)}),yield t.connection.init(n.addressList),t.connection})()}handlePublishStreamServer(e){var t=e.serverStatus&&e.serverStatus.url||"empty_url";let n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case Ul.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ul.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ul.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ul.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:if(e=new Zu(Cu.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}),n)return $u.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,e);if(!this.isStartingStreamingTask)break;this.statusError.set(t,e);case Ul.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:return e=new Zu(Cu.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r),this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e);case Ul.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ul.LIVE_STREAM_RESPONSE_WORKER_QUIT:var i;if(this.connection){this.connection.tryNextAddress(),t=Gh(Bh(i=this.streamingTasks).call(i));for(let n of t)n.abortTask?n.abortTask():($u.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new Zu(Cu.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{$u.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)}).catch(e=>{$u.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)}))}}}handleInjectStreamServerStatus(e){let t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(0,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(1,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(2,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(10,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(3,t,n),void this.streamingTasks.delete(n);default:return void $u.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class Gp{constructor(){this.destChannelMediaInfos=new Do}setSrcChannelInfo(e){ke(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){ke(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){Te(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}class qp extends Hh{constructor(e,t,n){super(),this.requestId=1,this.onOpen=()=>{this.emit("open"),this.startHeartBeatCheck()},this.onClose=e=>{this.emit("close"),this.dispose()},this.onMessage=e=>{if(!(e=JSON.parse(e.data))||"serverResponse"!==e.command||!e.requestId)return e&&"serverStatus"===e.command&&e.serverStatus&&e.serverStatus.command?(this.emit("status",e.serverStatus),void this.emit(e.serverStatus.command,e.serverStatus)):void 0;this.emit("req_".concat(e.requestId),e)},this.joinInfo=e,this.clientId=t,this.ws=new _d("cross-channel-".concat(this.clientId),n),this.ws.on(Ol.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ol.CONNECTED,this.onOpen),this.ws.on(Ol.ON_MESSAGE,this.onMessage),this.ws.on(Ol.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){let t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new ic((t,n)=>{let r=window.setTimeout(()=>{n(new Zu(Cu.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new Zu(Cu.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)}),this.once("dispose",()=>{window.clearTimeout(r),n(new Zu(Cu.WS_ABORT))})})}request(e){var t=this;return r(function*(){if("closed"===t.ws.state)throw new Zu(Cu.WS_DISCONNECT);"connected"!==t.ws.state&&(yield new ic((e,n)=>{t.ws.once(Ol.CLOSED,()=>n(new Zu(Cu.WS_ABORT))),t.ws.once(Ol.CONNECTED,e)}));let n=t.sendMessage(e);if(!(e=yield new ic((e,r)=>{const i=()=>{r(new Zu(Cu.WS_ABORT))};t.ws.once(Ol.RECONNECTING,i),t.ws.once(Ol.CLOSED,i),t.once("req_".concat(n),e),Ye(3e3).then(()=>{t.removeAllListeners("req_".concat(n)),t.ws.off(Ol.RECONNECTING,i),t.ws.off(Ol.CLOSED,i),r(new Zu(Cu.TIMEOUT,"cross channel ws request timeout"))})}))||200!==e.code)throw new Zu(Cu.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(wr(e)));return e})()}connect(e){var t=this;return r(function*(){t.ws.removeAllListeners(Ol.REQUEST_NEW_URLS),t.ws.on(Ol.REQUEST_NEW_URLS,t=>{t(e)}),yield t.ws.init(e)})()}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){let t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Hp extends Hh{constructor(e,t,n,i){var o;super(),o=this,this.cancelToken=Qu.CancelToken.source(),this.requestId=0,this._state="RELAY_STATE_IDLE",this.errorCode="RELAY_OK",this.onStatus=e=>{var t;$u.debug(Us(t="[".concat(this.clientId,"] ChannelMediaStatus: ")).call(t,wr(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event","PACKET_RECEIVED_AUDIO_FROM_SRC"),"onVideoPacketReceived"===e.command&&this.emit("event","PACKET_RECEIVED_VIDEO_FROM_SRC"),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode="SRC_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode="DEST_TOKEN_EXPIRED",this.state="RELAY_STATE_FAILURE"))},this.onReconnect=r(function*(){$u.debug("[".concat(o.clientId,"] ChannelMediaSocket disconnect, reconnecting")),o.emit("event","NETWORK_DISCONNECTED"),o.state="RELAY_STATE_IDLE",o.prevChannelMediaConfig&&o.sendStartRelayMessage(o.prevChannelMediaConfig).catch(e=>{"RELAY_STATE_IDLE"!==o.state&&($u.error("auto restart channel media relay failed",e.toString()),o.errorCode="SERVER_CONNECTION_LOST",o.state="RELAY_STATE_FAILURE")})}),this.joinInfo=e,this.clientId=t,this.signal=new qp(this.joinInfo,this.clientId,n),this.httpRetryConfig=i}set state(e){e!==this._state&&("RELAY_STATE_FAILURE"!==e&&(this.errorCode="RELAY_OK"),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}startChannelMediaRelay(e){var t=this;return r(function*(){if("RELAY_STATE_IDLE"!==t.state)throw new Zu(Cu.INVALID_OPERATION);t.state="RELAY_STATE_CONNECTING",yield t.connect(),$u.debug("[".concat(t.clientId,"] startChannelMediaRelay: connect success"));try{yield t.sendStartRelayMessage(e)}catch(n){if(n.data&&n.data.serverResponse&&"SetSourceChannel"===n.data.serverResponse.command)throw new Zu(Cu.CROSS_CHANNEL_FAILED_JOIN_SRC);if(n.data&&n.data.serverResponse&&"SetDestChannelStatus"===n.serverResponse.command)throw new Zu(Cu.CROSS_CHANNEL_FAILED_JOIN_DEST);if(n.data&&n.data.serverResponse&&"StartPacketTransfer"===n.serverResponse.command)throw new Zu(Cu.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw n}t.prevChannelMediaConfig=e})()}updateChannelMediaRelay(e){var t=this;return r(function*(){if("RELAY_STATE_RUNNING"!==t.state)throw new Zu(Cu.INVALID_OPERATION);yield t.sendUpdateMessage(e),t.prevChannelMediaConfig=e})()}stopChannelMediaRelay(){var e=this;return r(function*(){yield e.sendStopRelayMessage(),$u.debug("[".concat(e.clientId,"] stopChannelMediaRelay: send stop message success")),e.state="RELAY_STATE_IDLE",e.dispose()})()}dispose(){$u.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Qu.CancelToken.source(),this.state="RELAY_STATE_IDLE",this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}connect(){var e=this;return r(function*(){let t=yield function(e,t,n){return Jt.apply(this,arguments)}(e.joinInfo,e.cancelToken.token,e.httpRetryConfig);e.workerToken=t.workerToken,yield e.signal.connect(t.addressList),e.emit("event","NETWORK_CONNECTED"),e.signal.on("status",e.onStatus),e.signal.on("reconnecting",e.onReconnect)})()}sendStartRelayMessage(e){var t=this;return r(function*(){var n=t.genMessage(Fl.StopPacketTransfer);yield t.signal.request(n),yield t.signal.waitStatus("Normal Quit"),$u.debug("[".concat(t.clientId,"] startChannelMediaRelay: StopPacketTransfer success")),n=t.genMessage(Fl.SetSdkProfile,e),yield t.signal.request(n),$u.debug("[".concat(t.clientId,"] startChannelMediaRelay: SetSdkProfile success")),n=t.genMessage(Fl.SetSourceChannel,e),yield t.signal.request(n),yield t.signal.waitStatus("SetSourceChannelStatus"),t.emit("event","PACKET_JOINED_SRC_CHANNEL"),$u.debug("[".concat(t.clientId,"] startChannelMediaRelay: SetSourceChannel success")),n=t.genMessage(Fl.SetSourceUserId,e),yield t.signal.request(n),$u.debug("[".concat(t.clientId,"] startChannelMediaRelay: SetSourceUserId success")),n=t.genMessage(Fl.SetDestChannel,e),yield t.signal.request(n),yield t.signal.waitStatus("SetDestChannelStatus"),t.emit("event","PACKET_JOINED_DEST_CHANNEL"),$u.debug("[".concat(t.clientId,"] startChannelMediaRelay: SetDestChannel success")),e=t.genMessage(Fl.StartPacketTransfer,e),yield t.signal.request(e),t.emit("event","PACKET_SENT_TO_DEST_CHANNEL"),t.state="RELAY_STATE_RUNNING",$u.debug("[".concat(t.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))})()}sendUpdateMessage(e){var t=this;return r(function*(){e=t.genMessage(Fl.UpdateDestChannel,e),yield t.signal.request(e),t.emit("event","PACKET_UPDATE_DEST_CHANNEL"),$u.debug("[".concat(t.clientId,"] sendUpdateMessage: UpdateDestChannel success"))})()}sendStopRelayMessage(){var e=this;return r(function*(){let t=e.genMessage(Fl.StopPacketTransfer);yield e.signal.request(t),$u.debug("[".concat(e.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))})()}genMessage(e,t){let n=[],r=[],i=[];this.requestId+=1;let o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:cu,sid:this.joinInfo.sid,ts:qh(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.5.0"===o.sdkVersion&&(o.sdkVersion="0.0.1");let s=null,a=null;switch(e){case Fl.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Fl.SetSourceChannel:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new Zu(Cu.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:a.channelName,token:a.token||this.joinInfo.appId},o;case Fl.SetSourceUserId:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new Zu(Cu.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:a.uid+""},o;case Fl.SetDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new Zu(Cu.UNEXPECTED_ERROR,"can not find dest config");return Qo(s).call(s,e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case Fl.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Fl.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Fl.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Fl.UpdateDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new Zu(Cu.UNEXPECTED_ERROR,"can not find dest config");return Qo(s).call(s,e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)}),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o}return o}}class Wp{constructor(e,t){this._trust_stream_added_state_=this._trust_video_mute_state_=this._trust_audio_mute_state_=this._trust_video_enabled_state_=this._trust_audio_enabled_state_=this._trust_in_room_=!0,this._video_muted_=this._audio_muted_=!1,this._video_enabled_=this._audio_enabled_=!0,this._video_added_=this._audio_added_=!1,this.uid=e,this._uintid=t}get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}}let zp=function(){var e=r(function*(e){var t,n=at("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB");return n=yield window.crypto.subtle.importKey("spki",n,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),t=e,e=(new TextEncoder).encode(t),t=yield window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,e),ct(new Uint8Array(t))});return function(t){return e.apply(this,arguments)}}();var Kp=function(e,t,n,r){var i,o=arguments.length,s=3>o?t:null===r?r=bs(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;0<=a;a--)(i=e[a])&&(s=(3>o?i(s):3<o?i(t,n,s):i(t,n))||s);return 3<o&&s&&cs(t,n,s),s},Yp=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};class Qp extends Hh{constructor(e){var t,n,r,i;let o;if(super(),this._users=[],this._sessionId=null,this._bindEnabledTracks=[],this._leaveMutex=new nd("client-leave"),this._publishMutex=new nd("client-publish"),this._subscribeMutex=new Do,this._remoteStream=new Do,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._turnServer={servers:[],mode:"auto"},this._cloudProxyServerMode="disabled",this._isDualStreamEnabled=!1,this._streamFallbackTypeCacheMap=new Do,this._remoteStreamTypeCacheMap=new Do,this._axiosCancelSource=Qu.CancelToken.source(),this._networkQualitySensitivity="normal",this._handleLocalTrackEnable=(e,t,n)=>{this.publish(e,!1).then(t).catch(n)},this._handleLocalTrackDisable=(e,t,n)=>{this.unpublish(e,!1).then(t).catch(n)},this._handleUserOnline=e=>{var t;this.isStringUID&&"string"!=typeof e.uid&&$u.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let n=Ac(t=this._users).call(t,t=>t.uid===e.uid);n?n._trust_in_room_=!0:(t=new Wp(e.uid,e.uint_id||e.uid),this._users.push(t),$u.debug("[".concat(this._clientId,"] user online"),e.uid),this.emit(ml.USER_JOINED,t))},this._handleUserOffline=e=>{var t;let n=Ac(t=this._users).call(t,t=>t.uid===e.uid);n&&(this._handleRemoveStream(e),rt(this._users,n),this._remoteStreamTypeCacheMap.delete(n.uid),this._streamFallbackTypeCacheMap.delete(n.uid),$u.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.emit(ml.USER_LEAVED,n,e.reason))},this._handleAddAudioOrVideoStream=(e,t,n)=>{var r,i,o;let s=Ac(r=this._users).call(r,e=>e.uid===t);var a,c;s?($u.debug(Us(i=Us(o="[".concat(this._clientId,"] stream added with uid ")).call(o,t,", type ")).call(i,e)),r="audio"===e?s.hasAudio:s.hasVideo,s._uintid||(s._uintid=n||t),s._trust_stream_added_state_=!0,"audio"===e?s._audio_added_=!0:s._video_added_=!0,("audio"===e?s.hasAudio:s.hasVideo)&&!r&&($u.info(Us(a=Us(c="[".concat(this._clientId,"] remote user ")).call(c,s.uid," published ")).call(a,e)),this.emit(ml.USER_PUBLISHED,s,e)),"video"===e?pd.onGatewayStream(this._sessionId,rl.ON_ADD_VIDEO_STREAM,il.ON_ADD_VIDEO_STREAM,{peer:n||t}):pd.onGatewayStream(this._sessionId,rl.ON_ADD_AUDIO_STREAM,il.ON_ADD_AUDIO_STREAM,{peer:n||t}),(e=this._remoteStream.get(t))&&e.readyToReconnect&&"connecting"===e.connectionState&&e.reconnectPC().catch(e=>{$u.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})):$u.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"))},this._handleRemoveStream=e=>{var t,n;let r=Ac(t=this._users).call(t,t=>t.uid===e.uid);r?($u.debug(Us(n="[".concat(this._clientId,"] stream removed with uid ")).call(n,e.uid)),t=()=>{},r.hasAudio&&r.hasVideo?t=()=>{var e,t;$u.info(Us(e="[".concat(this._clientId,"] remote user ")).call(e,r.uid," unpublished audio track")),this.emit(ml.USER_UNPUBLISHED,r,"audio"),$u.info(Us(t="[".concat(this._clientId,"] remote user ")).call(t,r.uid," unpublished video track")),this.emit(ml.USER_UNPUBLISHED,r,"video")}:r.hasVideo?t=()=>{var e;$u.info(Us(e="[".concat(this._clientId,"] remote user ")).call(e,r.uid," unpublished video track")),this.emit(ml.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(t=()=>{var e;$u.info(Us(e="[".concat(this._clientId,"] remote user ")).call(e,r.uid," unpublished audio track")),this.emit(ml.USER_UNPUBLISHED,r,"audio")}),r._trust_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,(n=this._remoteStream.get(r.uid))&&(n.closeP2PConnection(),this._remoteStream.delete(r.uid)),pd.onGatewayStream(this._sessionId,rl.ON_REMOVE_STREAM,il.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),t()):$u.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"))},this._handleSetStreamLocalEnable=(e,t,n)=>{var r,i,o,s,a,c;let u=Ac(r=this._users).call(r,e=>e.uid===t);if(u){if($u.debug(Us(i=Us(o=Us(s="[".concat(this._clientId,"] local ")).call(s,e," ")).call(o,n?"enabled":"disabled"," with uid ")).call(i,t)),r="audio"===e?u.hasAudio:u.hasVideo,"audio"===e){u._trust_audio_enabled_state_=!0;var l,h,d=u._audio_enabled_;if(u._audio_enabled_=n,u._audio_enabled_===d)return;n=u._audio_enabled_?"enable-local-audio":"disable-local-audio",$u.debug(Us(l=Us(h="[".concat(this._clientId,"] user-info-updated, uid: ")).call(h,t,", msg: ")).call(l,n)),this.emit(ml.USER_INFO_UPDATED,t,n)}else{if(u._trust_video_enabled_state_=!0,l=u._video_enabled_,u._video_enabled_=n,u._video_enabled_===l)return;var p;n=u._video_enabled_?"enable-local-video":"disable-local-video",$u.debug(Us(d=Us(p="[".concat(this._clientId,"] user-info-update, uid: ")).call(p,t,", msg: ")).call(d,n)),this.emit(ml.USER_INFO_UPDATED,t,n)}if(r!==(n="audio"===e?u.hasAudio:u.hasVideo)){var f,m;if(!r&&n)return $u.info(Us(f=Us(m="[".concat(this._clientId,"] remote user ")).call(m,t," published ")).call(f,e)),void this.emit(ml.USER_PUBLISHED,u,e);(f=this._remoteStream.get(t))&&((m=Rn({},f.subscribeOptions)).audio=!!u.hasAudio&&m.audio,m.video=!!u.hasVideo&&m.video,m.audio||m.video?f.setSubscribeOptions(m):(f.closeP2PConnection().catch(e=>{$u.warning("close sub pc error",e)}),this._remoteStream.delete(u.uid))),$u.info(Us(a=Us(c="[".concat(this._clientId,"] remote user ")).call(c,u.uid," unpublished ")).call(a,e)),this.emit(ml.USER_UNPUBLISHED,u,e)}}else $u.error("[".concat(this._clientId,"] can not find target user!(disable_local)"))},this._handleMuteStream=(e,t,n)=>{var r,i,o;$u.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);let s=Ac(r=this._users).call(r,t=>t.uid===e);var a;if(s){if(r="audio"===t?s.hasAudio:s.hasVideo,"audio"===t){s._trust_audio_mute_state_=!0;var c,u,l=s._audio_muted_;if(s._audio_muted_=n,s._audio_muted_===l)return;n=s._audio_muted_?"mute-audio":"unmute-audio",$u.debug(Us(c=Us(u="[".concat(this._clientId,"] user-info-update, uid: ")).call(u,e,", msg: ")).call(c,n)),this.emit(ml.USER_INFO_UPDATED,e,n)}else{if(s._trust_video_mute_state_=!0,c=s._video_muted_,s._video_muted_=n,s._video_muted_===c)return;var h;n=s._video_muted_?"mute-video":"unmute-video",$u.debug(Us(l=Us(h="[".concat(this._clientId,"] user-info-update, uid: ")).call(h,e,", msg: ")).call(l,n)),this.emit(ml.USER_INFO_UPDATED,e,n)}if(r!==(n="audio"===t?s.hasAudio:s.hasVideo)){var d,p;if(!r&&n)return $u.info(Us(d=Us(p="[".concat(this._clientId,"] remote user ")).call(p,e," published ")).call(d,t)),void this.emit(ml.USER_PUBLISHED,s,t);(d=this._remoteStream.get(e))&&((p=Rn({},d.subscribeOptions)).audio=!!s.hasAudio&&p.audio,p.video=!!s.hasVideo&&p.video,"video"===t&&d.pc._statsFilter.setVideoIsReady(!1),p.audio||p.video?d.setSubscribeOptions(p):(d.closeP2PConnection().catch(e=>{$u.warning("close sub pc error",e)}),this._remoteStream.delete(s.uid))),$u.info(Us(i=Us(o="[".concat(this._clientId,"] remote user ")).call(o,e," unpublished ")).call(i,t)),this.emit(ml.USER_UNPUBLISHED,s,t)}}else $u.warning(Us(a="[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ")).call(a,e))},this._handleP2PLost=e=>{$u.debug("[".concat(this._clientId,"] receive p2p lost"),e);let t=null;if(this._highStream&&this._highStream.pc.ID===e.p2pid)t=this._highStream;else if(this._lowStream&&this._lowStream.pc.ID===e.p2pid)t=this._lowStream;else{var n;Qo(n=this._remoteStream).call(n,n=>{n.pc.ID===e.p2pid&&(t=n)})}t?t.emit(Tl.GATEWAY_P2P_LOST,e.p2pid):$u.warning("P2PLost stream not found",e)},this._handleTokenWillExpire=()=>{$u.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(ml.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)},this._handleBeforeUnload=e=>{void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),$u.info("[".concat(this._clientId,"] auto leave onbeforeunload")))},this._handleUpdateNetworkQuality=()=>{var e;if("normal"!==this._networkQualitySensitivity){if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.emit(ml.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});var t={downlinkNetworkQuality:0,uplinkNetworkQuality:0};this._highStream&&!this._highStream.detecting&&(t.uplinkNetworkQuality=this._highStream.getNetworkQuality());var n=0;Qo(e=this._remoteStream).call(e,e=>n+=e.getNetworkQuality()),0<this._remoteStream.size&&(t.downlinkNetworkQuality=Math.round(n/this._remoteStream.size)),this.emit(ml.NETWORK_QUALITY,t)}},this._codec=e.codec,this._mode=e.mode,e.proxyServer&&(this._proxyServer=e.proxyServer,pd.setProxyServer(this._proxyServer),$u.setProxyServer(this._proxyServer)),e.turnServer&&(this._turnServer=Rn({},this._turnServer,{mode:"manual"},e.turnServer)),this._clientId=Je(5,"client-"),$u.info(Us(t=Us(n=Us(r=Us(i="[".concat(this._clientId,"] Initializing AgoraRTC client v")).call(i,cu," build: ")).call(r,"v4.5.0-0-g87245ad6(5/25/2021, 3:25:26 PM)",", mode: ")).call(n,this._mode,", codec: ")).call(t,this._codec)),e.clientRoleOptions)try{Oe(e.clientRoleOptions),o=Zo({},e.clientRoleOptions)}catch(a){var s;$u.warning(Us(s="[".concat(this._clientId,"] ")).call(s,a.toString()))}this._statsCollector=new Kh(this._clientId),this._statsCollector.onStatsException=(e,t,n)=>{var r,i,o;$u.debug(Us(r=Us(i=Us(o="[".concat(this._clientId,"] receive exception msg, code: ")).call(o,e,", msg: ")).call(i,t,", uid: ")).call(r,n)),this.emit(ml.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{var i;let o=Ac(i=this._users).call(i,t=>t.uid===e);o&&pd.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:o._uintid})},this._gateway=new Ld({clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:e.websocketRetryConfig||gd,httpRetryConfig:e.httpRetryConfig||gd,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:o}),this._config=e,this._configDistribute=jd,this._handleGatewayEvents(),vu.push(this)}get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._highStream?this._highStream.getAllTracks():[]}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}join(e,t,n,i,o){var s=this;return r(function*(){var r;let a=pd.reportApiInvoke(s._sessionId,{name:sl.JOIN,options:[e,t,n,i],tag:al.TRACER});try{if(!n&&null!==n)throw new Zu(Cu.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ee(n,"token",1,2047),e&&Ee(e,"appid",1,2047),Te(t),i&&be(i),o&&Ee(o,"optionalInfo",1,2047)}catch(l){throw a.onError(l),l}if($u.info(Us(r="[".concat(s._clientId,"] start join channel ")).call(r,t)),s._leaveMutex.isLocked&&($u.debug("[".concat(s._clientId,"] join: waiting leave operation")),(yield s._leaveMutex.lock())(),$u.debug("[".concat(s._clientId,"] join: continue"))),"DISCONNECTED"!==s.connectionState)throw e=new Zu(Cu.INVALID_OPERATION,"[".concat(s._clientId,"] Client already in connecting/connected state")),a.onError(e),e;s._sessionId||(s._sessionId=Je(32,"").toUpperCase()),s._gateway.state="CONNECTING",o={clientId:s._clientId,appId:e,sid:s._sessionId,cname:t,uid:"string"!=typeof i?i:null,turnServer:s._turnServer,proxyServer:s._proxyServer,token:n||e,cloudProxyServer:s._cloudProxyServerMode,optionalInfo:o},"string"==typeof i&&(o.stringUid=i,s._uintUid?(o.uid=s._uintUid,s._uintUid=void 0):o.uid=0),"none"!==s._encryptionMode&&s._encryptionSecret&&(o.aesmode=s._encryptionMode,o.aespassword=yield zp(s._encryptionSecret),s._encryptionSalt&&(o.aessalt=s._encryptionSalt)),s._startSession(s._sessionId,{channel:t,appId:e}),ld(()=>{"CONNECTING"===s.connectionState&&pd.joinChannelTimeout(s._sessionId,5)},5e3);try{var c;if(yield function(e,t,n){return Ht.apply(this,arguments)}(o,s._axiosCancelSource.token,s._config.httpRetryConfig||gd),o.stringUid&&!o.uid){var u;let e=yield Wt(o.stringUid,o,s._axiosCancelSource.token,s._config.httpRetryConfig||gd);$u.debug(Us(u="getUserAccount Success ".concat(o.stringUid," => ")).call(u,e)),o.uid=e}s._configDistribute.startGetConfigDistribute(o,s._axiosCancelSource.token),s._configDistribute.on(Yl.UPDATE_BITRATE_LIMIT,e=>{s._highStream&&s._highStream.handleUpdateBitrateLimit(e.uplink),e.low_stream_uplink&&s._lowStream&&s._lowStream.handleUpdateBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})});let r=yield Gt(o,s._axiosCancelSource.token,s._config.httpRetryConfig||gd);s._key=n||e,s._joinInfo=Rn({},o,{cid:r.gatewayInfo.cid,uid:o.uid?o.uid:r.gatewayInfo.uid,vid:r.gatewayInfo.vid,apResponse:r.gatewayInfo.res,uni_lbs_ip:r.gatewayInfo.uni_lbs_ip,gatewayAddrs:r.gatewayInfo.gatewayAddrs});let i=yield s._gateway.join(s._joinInfo,s._key);return a.onSuccess(i),s._appId=e,s._channelName=o.cname,s._uid=i,s._networkQualityInterval&&window.clearInterval(s._networkQualityInterval),s._networkQualityInterval=window.setInterval(s._handleUpdateNetworkQuality,2e3),window.addEventListener("beforeunload",s._handleBeforeUnload),$u.info(Us(c="[".concat(s._clientId,"] Joining channel success: ")).call(c,t)),ld(()=>{$u.startUpload()},5e3),i}catch(l){throw e=Au(l)?l[0]:l,$u.error("[".concat(s._clientId,"] Joining channel failed, rollback"),e),e.code!==Cu.OPERATION_ABORTED&&(s._gateway.state="DISCONNECTED",s._reset()),a.onError(e),e}})()}leave(){var e=this;return r(function*(){let t=pd.reportApiInvoke(e._sessionId,{name:sl.LEAVE,options:[],tag:al.TRACER});$u.info("[".concat(e._clientId,"] Leaving channel")),window.removeEventListener("beforeunload",e._handleBeforeUnload),e._reset();let n=yield e._leaveMutex.lock();if("DISCONNECTED"===e.connectionState)return $u.info("[".concat(e._clientId,"] Leaving channel repeated, success")),n(),t.onSuccess();yield e._gateway.leave("CONNECTED"!==e.connectionState),$u.info("[".concat(e._clientId,"] Leaving channel success")),n(),t.onSuccess()})()}publish(e,t=!0){var n=this;return r(function*(){var r,i;Au(e)||(e=[e]);let o=pd.reportApiInvoke(n._sessionId,{name:sl.PUBLISH,options:ac(e).call(e,e=>e?Object(e).toString():"null"),tag:al.TRACER});if(0===e.length)return e=new Zu(Cu.INVALID_PARAMS,"track list is empty"),o.onError(e),e.throw();if("live"===n._mode&&"audience"===n._gateway.role)return e=new Zu(Cu.INVALID_OPERATION,"audience can not publish stream"),o.onError(e),e.throw();for(let n of e){if(!(n instanceof Sd))return e=new Zu(Cu.INVALID_PARAMS,"pamameter is not local track"),o.onError(e),e.throw();if(!n._enabled&&t)return e=new Zu(Cu.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(n.getTrackId())),o.onError(e),e.throw()}$u.info(Us(r="[".concat(n._clientId,"] Publishing tracks, id ")).call(r,ac(e).call(e,e=>"".concat(e.getTrackId()," ")))),yield n._configDistribute.awaitConfigDistributeComplete(),t&&Qo(e).call(e,e=>{var t;let r=n._configDistribute.getBitrateLimit();e instanceof Ap&&r&&e.setBitrateLimit(r.uplink),-1===vc(t=n._bindEnabledTracks).call(t,e)&&(e.addListener(jl.NEED_ADD_TRACK,n._handleLocalTrackEnable),e.addListener(jl.NEED_REMOVE_TRACK,n._handleLocalTrackDisable),n._bindEnabledTracks.push(e))}),r=yield n._publishMutex.lock();try{let t=(yield n._publishHighStream(e)).videoTrack;n._isDualStreamEnabled&&t&&!n._lowStream&&(yield n._publishLowStream(t)),r(),o.onSuccess()}catch(s){throw r(),t&&Qo(e).call(e,e=>{var t,r;let i=vc(t=n._bindEnabledTracks).call(t,e);-1!==i&&(e.off(jl.NEED_ADD_TRACK,n._handleLocalTrackEnable),e.off(jl.NEED_REMOVE_TRACK,n._handleLocalTrackDisable),dc(r=n._bindEnabledTracks).call(r,i,1))}),o.onError(s),$u.error("[".concat(n._clientId,"] publish error"),s.toString()),s}$u.info(Us(i="[".concat(n._clientId,"] Publish success, id ")).call(i,ac(e).call(e,e=>"".concat(e.getTrackId()," "))))})()}unpublish(e,t=!0){var n=this;return r(function*(){var r,i,o;if(!n._highStream)return void $u.warning("[".concat(n._clientId,"] Could not find tracks to unpublish"));var s=n._highStream.getAllTracks();e?Au(e)||(e=[e]):e=n._highStream.getAllTracks(),s=function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1){const r=e[n];if(Bs(e).call(e,e=>e===r).length!==Bs(t).call(t,e=>e===r).length)return!1}return!0}(s,e);let a=pd.reportApiInvoke(n._sessionId,{name:sl.UNPUBLISH,options:ac(e).call(e,e=>e.getTrackId()),tag:al.TRACER});if($u.info(Us(r=Us(i="[".concat(n._clientId,"] Unpublish tracks, tracks ")).call(i,ac(e).call(e,e=>"".concat(e.getTrackId()," ")),", isClosePC: ")).call(r,s)),r=s?void 0:yield n._publishMutex.lock(),!n._highStream)return $u.warning("[".concat(n._clientId,"] Could not find tracks to unpublish")),void(r&&r());try{n._lowStream&&0<Bs(e).call(e,e=>"video"===e.trackMediaType).length&&(yield n._lowStream.closeP2PConnection(),n._lowStream=void 0),s?yield n._highStream.closeP2PConnection():yield n._highStream.removeTracks(e,t),r&&r()}catch(c){if(c.code!==Cu.OPERATION_ABORTED)throw a.onError(c),$u.error("[".concat(n._clientId,"] unpublish error"),c.toString()),r&&r(),c;$u.debug("[".concat(n._clientId,"] ignore unpub operation abort")),r&&r()}n._highStream&&"disconnected"===n._highStream.connectionState&&(n._highStream=void 0,n._lowStream=void 0),t&&Qo(e).call(e,e=>{var t,r;let i=vc(t=n._bindEnabledTracks).call(t,e);-1!==i&&(e.off(jl.NEED_ADD_TRACK,n._handleLocalTrackEnable),e.off(jl.NEED_REMOVE_TRACK,n._handleLocalTrackDisable),dc(r=n._bindEnabledTracks).call(r,i,1))}),$u.info(Us(o="[".concat(n._clientId,"] Unpublish success,tracks ")).call(o,ac(e).call(e,e=>"".concat(e.getTrackId())))),a.onSuccess()})()}subscribe(e,t){var n=this;return r(function*(){var r,i,o,s;ve(t,"mediaType",["audio","video"]);let a=pd.reportApiInvoke(n._sessionId,{name:sl.SUBSCRIBE,options:[e.uid,t],tag:al.TRACER});if(!n._joinInfo)throw t=new Zu(Cu.INVALID_OPERATION,"Can't subscribe stream, not joined"),a.onError(t),t;if("CONNECTED"!==n.connectionState&&"RECONNECTING"!==n.connectionState)throw t=new Zu(Cu.INVALID_OPERATION,"Can't subscribe stream in ".concat(n.connectionState," state")),a.onError(t),t;var c,u;if(!Ac(r=n._users).call(r,t=>t===e))throw t=new Zu(Cu.INVALID_REMOTE_USER,"user is not in the channel"),$u.error(Us(c="[".concat(n._clientId,"] can not subscribe ")).call(c,e.uid,", this user is not in the channel")),a.onError(t),t;if(!e.hasAudio&&!e.hasVideo)throw t=new Zu(Cu.INVALID_REMOTE_USER,"user is not published"),$u.error(Us(u="[".concat(n._clientId,"] can not subscribe ")).call(u,e.uid,", user is not published")),a.onError(t),t;if(c={audio:"audio"===t,video:"video"===t},!e.hasAudio&&c.audio||!e.hasVideo&&c.video){var l,h,d=new Zu(Cu.REMOTE_USER_IS_NOT_PUBLISHED);throw $u.error(Us(l=Us(h="[".concat(n._clientId,"] can not subscribe ")).call(h,e.uid," with mediaType ")).call(l,t,", remote track is not published")),a.onError(d),d}(l=n._subscribeMutex.get(e.uid))||(l=new nd("sub-".concat(e.uid)),n._subscribeMutex.set(e.uid,l)),$u.info(Us(i=Us(o="[".concat(n._clientId,"] subscribe user ")).call(o,e.uid,", mediaType: ")).call(i,t)),i=yield l.lock(),o=n._remoteStream.get(e.uid);try{if(o)c.audio=c.audio||o.subscribeOptions.audio,c.video=c.video||o.subscribeOptions.video,yield n._gateway.subscribeChange(o,c);else{o=new Fp(e,n._statsCollector,n._joinInfo,c),n._remoteStream.set(e.uid,o);try{yield n._gateway.subscribe(o)}catch(f){throw n._remoteStream.delete(e.uid),f}o.on(Tl.CONNECTION_STATE_CHANGE,(t,r)=>{"connecting"===t?n.emit(ml.MEDIA_RECONNECT_START,e.uid):"connected"===t&&n.emit(ml.MEDIA_RECONNECT_END,e.uid)})}i()}catch(f){var p;throw a.onError(f),i(),$u.error(Us(p="[".concat(n._clientId,"] subscribe user ")).call(p,e.uid," error"),f),f}return $u.info(Us(d=Us(s="[".concat(n._clientId,"] subscribe success user ")).call(s,e.uid,", mediaType: ")).call(d,t)),n._defaultStreamFallbackType&&n.setStreamFallbackOption(e.uid,n._defaultStreamFallbackType).catch(e=>{$u.warning("[".concat(n._clientId,"] auto set fallback failed"),e)}),(t="audio"===t?e.audioTrack:e.videoTrack)?(a.onSuccess(t.getTrackId()),t):(t=new Zu(Cu.UNEXPECTED_ERROR,"can not find remote track in user object"),a.onError(t),t.throw())})()}unsubscribe(e,t){var n=this;return r(function*(){var r,i,o,s,a;t&&ve(t,"mediaType",["audio","video"]);let c=pd.reportApiInvoke(n._sessionId,{name:sl.UNSUBSCRIBE,options:[e.uid,t],tag:al.TRACER});var u,l;if(!Ac(r=n._users).call(r,t=>t===e))throw t=new Zu(Cu.INVALID_REMOTE_USER,"user is not in the channel"),$u.error(Us(u="[".concat(n._clientId,"] can not subscribe ")).call(u,e.uid,", user is not in the channel")),c.onError(t),t;if($u.info(Us(i=Us(o="[".concat(n._clientId,"] unsubscribe uid: ")).call(o,e.uid,", mediaType: ")).call(i,t)),(u=n._subscribeMutex.get(e.uid))||(u=new nd("sub-".concat(e.uid)),n._subscribeMutex.set(e.uid,u)),u=yield u.lock(),!(r=n._remoteStream.get(e.uid)))return $u.warning(Us(l="[".concat(n._clientId,"]: you have not subscribe the remote user ")).call(l,e.uid)),c.onSuccess(),void u();l=Rn({},r.subscribeOptions),"audio"===t?l.audio=!1:"video"===t?(l.video=!1,r.pc._statsFilter.setVideoIsReady(!1)):(l.audio=!1,l.video=!1);try{l.audio||l.video?yield n._gateway.subscribeChange(r,l):(yield r.closeP2PConnection(),n._remoteStream.delete(e.uid)),u()}catch(d){var h;if(d.code!==Cu.OPERATION_ABORTED)throw c.onError(d),u(),$u.error(Us(h="[".concat(n._clientId,"] unsubscribe user ")).call(h,e.uid," error"),d.toString()),d;u(),$u.debug("[".concat(n._clientId,"] ignore unsub operation abort"))}$u.info(Us(s=Us(a="[".concat(n._clientId,"] unsubscribe success uid: ")).call(a,e.uid,", mediaType: ")).call(s,t)),c.onSuccess()})()}setLowStreamParameter(e){if(!e)throw new Zu(Cu.INVALID_PARAMS);null==e.width||ye(e.width,"streamParameter.width"),null==e.height||ye(e.height,"streamParameter.height"),null==e.framerate||ye(e.framerate,"streamParameter.framerate"),null==e.bitrate||ye(e.bitrate,"streamParameter.bitrate");let t=pd.reportApiInvoke(this._sessionId,{name:sl.SET_LOW_STREAM_PARAMETER,options:[e],tag:al.TRACER});(!e.width&&e.height||e.width&&!e.height)&&$u.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),$u.info("[".concat(this._clientId,"] set low stream parameter to"),wr(e));let n=this._configDistribute.getLowStreamConfigDistribute();n&&n.bitrate&&e.bitrate&&n.bitrate<e.bitrate&&(e.bitrate=n.bitrate),this._lowStreamParameter=e,t.onSuccess()}enableDualStream(){var e=this;return r(function*(){let t=pd.reportApiInvoke(e._sessionId,{name:sl.ENABLE_DUAL_STREAM,options:[],tag:al.TRACER});if(!Ql.supportDualStream){pd.streamSwitch(e._sessionId,{lts:qh(),isdual:!0,succ:!1});var n=new Zu(Cu.NOT_SUPPORTED,"Your browser is not support dual stream");throw t.onError(n),n}if(e._isDualStreamEnabled)throw n=new Zu(Cu.INVALID_OPERATION,"Dual stream is already enabled"),t.onError(n),n;if(e._highStream&&"connected"===e._highStream.connectionState&&e._highStream.videoTrack)try{yield e._publishLowStream(e._highStream.videoTrack)}catch(r){throw pd.streamSwitch(e._sessionId,{lts:qh(),isdual:!0,succ:!1}),t.onError(r),r}e._isDualStreamEnabled=!0,pd.streamSwitch(e._sessionId,{lts:qh(),isdual:!0,succ:!0}),$u.info("[".concat(e._clientId,"] enable dual stream")),t.onSuccess()})()}disableDualStream(){var e=this;return r(function*(){let t=pd.reportApiInvoke(e._sessionId,{name:sl.DISABLE_DUAL_STREAM,options:[],tag:al.TRACER});if(e._lowStream)try{yield e._lowStream.closeP2PConnection()}catch(n){throw pd.streamSwitch(e._sessionId,{lts:qh(),isdual:!1,succ:!1}),t.onError(n),n}e._lowStream=void 0,e._isDualStreamEnabled=!1,e._highStream&&(e._highStream.lowStreamConnection=void 0),pd.streamSwitch(e._sessionId,{lts:qh(),isdual:!1,succ:!0}),$u.info("[".concat(e._clientId,"] disable dual stream")),t.onSuccess()})()}setClientRole(e,t){var n=this;return r(function*(){ve(e,"role",["audience","host"]),t&&Oe(t);let r=pd.reportApiInvoke(n._sessionId,{name:sl.SET_CLIENT_ROLE,options:[e,t],tag:al.TRACER});if("rtc"===n._mode)return $u.warning("[".concat(n._clientId,"]rtc mode can not use setClientRole")),e=new Zu(Cu.INVALID_OPERATION,"rtc mode can not use setClientRole"),r.onError(e),e.throw();if(t&&t.level&&"host"===e)return e=new Zu(Cu.INVALID_OPERATION,"host mode can not set audience latency level"),r.onError(e),e.throw();try{var i,o;if("audience"===e&&n._highStream){let e=new Zu(Cu.INVALID_OPERATION,"can not set client role to audience when publishing stream");return r.onError(e),e.throw()}yield n._gateway.setClientRole(e,t),$u.info(Us(i=Us(o="[".concat(n._clientId,"] set client role to ")).call(o,e,", level: ")).call(i,t&&t.level)),r.onSuccess()}catch(s){throw r.onError(s),s}})()}setProxyServer(e){Ee(e,"proxyServer");let t=pd.reportApiInvoke(this._sessionId,{name:sl.SET_PROXY_SERVER,options:[e],tag:al.TRACER});if("DISCONNECTED"!==this.connectionState)throw new Zu(Cu.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode)throw new Zu(Cu.INVALID_OPERATION,"You have already set the proxy");this._proxyServer=e,pd.setProxyServer(this._proxyServer),$u.setProxyServer(this._proxyServer),t.onSuccess()}setTurnServer(e){if(Au(e)||(e=[e]),"DISCONNECTED"!==this.connectionState)throw new Zu(Cu.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode)throw new Zu(Cu.INVALID_OPERATION,"You have already set the proxy");var t;if(Ce(e))return this._turnServer={servers:e,mode:"original-manual"},void $u.info(Us(t="[".concat(this._clientId,"] Set original turnserver success: ")).call(t,ac(e).call(e,e=>e.urls).join(","),"."));Qo(e).call(e,e=>Ae(e)),this._turnServer={servers:e,mode:"manual"},$u.info("[".concat(this._clientId,"] Set turnserver success."))}startProxyServer(e){let t=pd.reportApiInvoke(this._sessionId,{name:sl.START_PROXY_SERVER,options:[],tag:al.TRACER});if("DISCONNECTED"!==this.connectionState)throw e=new Zu(Cu.INVALID_OPERATION,"Start proxy server before join channel"),t.onError(e),e;if(this._proxyServer||"manual"===this._turnServer.mode)throw e=new Zu(Cu.INVALID_OPERATION,"You have already set the proxy"),t.onError(e),e;let n=[1,2,3,4,5];switch(void 0===e&&(e=1),e){case 1:this._cloudProxyServerMode="normal";break;case 2:this._cloudProxyServerMode="443only";break;case 3:this._cloudProxyServerMode="proxy3";break;case 4:this._cloudProxyServerMode="proxy4";break;case 5:this._cloudProxyServerMode="proxy5";break;default:throw e=new Zu(Cu.INVALID_PARAMS,"proxy server mode must be ".concat(n.join("|"))),t.onError(e),e}$u.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),t.onSuccess()}stopProxyServer(){let e=pd.reportApiInvoke(this._sessionId,{name:sl.STOP_PROXY_SERVER,options:[],tag:al.TRACER});if("DISCONNECTED"!==this.connectionState)throw new Zu(Cu.INVALID_OPERATION,"Stop proxy server after leave channel");pd.setProxyServer(),$u.setProxyServer(),this._cloudProxyServerMode="disabled",$u.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]},e.onSuccess()}setRemoteVideoStreamType(e,t){var n=this;return r(function*(){var r,i;ve(t,"streamType",[0,1]);let o=pd.reportApiInvoke(n._sessionId,{name:sl.SET_REMOTE_VIDEO_STREAM_TYPE,options:[e,t],tag:al.TRACER});try{yield n._gateway.setRemoteVideoStreamType(e,t),ld(()=>{var t;let r=Ac(t=n._users).call(t,t=>t.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(s){throw o.onError(s),$u.error("[".concat(n._clientId,"] set remote video stream type error"),s.toString()),s}$u.info(Us(r=Us(i="[".concat(n._clientId,"] set remote ")).call(i,e," video stream type to ")).call(r,t)),n._remoteStreamTypeCacheMap.set(e,t),o.onSuccess()})()}setStreamFallbackOption(e,t){var n=this;return r(function*(){var r,i;ve(t,"fallbackType",[0,1,2]);let o=pd.reportApiInvoke(n._sessionId,{name:sl.SET_STREAM_FALLBACK_OPTION,options:["too long to show",t],tag:al.TRACER});try{yield n._gateway.setStreamFallbackOption(e,t)}catch(s){throw o.onError(s),$u.error("[".concat(n._clientId,"] set stream fallback option"),s.toString()),s}$u.info(Us(r=Us(i="[".concat(n._clientId,"] set remote ")).call(i,e," stream fallback type to ")).call(r,t)),n._streamFallbackTypeCacheMap.set(e,t),o.onSuccess()})()}setEncryptionConfig(e,t,n){ve(e,"encryptionMode","aes-128-xts aes-256-xts aes-128-ecb sm4-128-ecb aes-128-gcm aes-256-gcm aes-128-gcm2 aes-256-gcm2 none".split(" ")),Ee(t,"secret");let r=["aes-128-gcm2","aes-256-gcm2"];if(Vc(r).call(r,e)){if(!(n&&n instanceof Uint8Array&&32===n.length))throw new Zu(Cu.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Zu(Cu.INVALID_PARAMS,"current encrypt mode does not need salt");/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\[\]])(?=.{8,})/.test(t)||$u.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=ct(n))}renewToken(e){var t=this;return r(function*(){Ee(e,"token",1,2047);let n=pd.reportApiInvoke(t._sessionId,{name:sl.RENEW_TOKEN,options:[e],tag:al.TRACER});if(!t._key)return e=new Zu(Cu.INVALID_OPERATION,"renewToken should not be called before user join"),n.onError(e),e.throw();t._key=e;try{yield t._gateway.renewToken(e)}catch(r){throw n.onError(r),$u.error("[".concat(t._clientId,"] renewToken failed"),r.toString()),r}$u.debug("[".concat(t._clientId,"] renewToken success")),n.onSuccess()})()}enableAudioVolumeIndicator(){let e=pd.reportApiInvoke(this._sessionId,{name:sl.ENABLE_AUDIO_VOLUME_INDICATOR,options:[],tag:al.TRACER});if(this._audioVolumeIndicationInterval)return $u.warning("you have already enabled audio volume indicator!"),e.onSuccess();this._audioVolumeIndicationInterval=window.setInterval(()=>{var e,t,n;let r=Iu(e=ac(t=Gh(Bh(n=this._remoteStream).call(n))).call(t,e=>({level:e.user.audioTrack?100*e.user.audioTrack._source.getAudioAvgLevel():0,uid:e.getUserId()}))).call(e,(e,t)=>e.level-t.level);this._highStream&&this._highStream.audioTrack&&(r.push({level:100*this._highStream.audioTrack._source.getAudioAvgLevel(),uid:this._highStream._userId}),r=Iu(r).call(r,(e,t)=>e.level-t.level)),this.emit(ml.VOLUME_INDICATOR,r)},gu.AUDIO_VOLUME_INDICATION_INTERVAL||2e3),e.onSuccess()}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}startLiveStreaming(e,t){let n=pd.reportApiInvoke(this._sessionId,{name:sl.START_LIVE_STREAMING,options:[e,t],tag:al.TRACER});if(!t){if("h264"!==this._codec)return e=new Zu(Cu.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264"),n.onError(e),ic.reject(e);if(!this._highStream)return e=new Zu(Cu.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming"),n.onError(e),ic.reject(e)}return this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e)?(e=new Zu(Cu.LIVE_STREAMING_TASK_CONFLICT),n.onError(e),ic.reject(e)):this._createLiveStreamingClient(t=t?Nl.TRANSCODE:Nl.RAW).startLiveStreamingTask(e,t).then(()=>n.onSuccess()).catch(e=>{throw n.onError(e),e})}setLiveTranscoding(e){let t=pd.reportApiInvoke(this._sessionId,{name:sl.SET_LIVE_TRANSCODING,options:[e],tag:al.TRACER});return this._createLiveStreamingClient(Nl.TRANSCODE).setTranscodingConfig(e).then(()=>t.onSuccess()).catch(e=>{throw t.onError(e),e})}stopLiveStreaming(e){var t;let n=pd.reportApiInvoke(this._sessionId,{name:sl.STOP_LIVE_STREAMING,options:[e],tag:al.TRACER}),r=Bs(t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient]).call(t,t=>t&&t.hasUrl(e));return r.length?ic.all(ac(r).call(r,t=>t&&t.stopLiveStreamingTask(e))).then(()=>n.onSuccess()).catch(e=>{throw n.onError(e),e}):(t=new Zu(Cu.INVALID_PARAMS,"can not find live streaming url to stop"),n.onError(t),ic.reject(t))}addInjectStreamUrl(e,t){var n=this;return r(function*(){let r=pd.reportApiInvoke(n._sessionId,{name:sl.ADD_INJECT_STREAM_URL,options:[e,t],tag:al.TRACER});try{if(!n._joinInfo)throw new Zu(Cu.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");let r=n._createLiveStreamingClient(Nl.INJECT);r.setInjectStreamConfig(t,0),yield r.startLiveStreamingTask(e,Nl.INJECT)}catch(i){throw r.onError(i),i}r.onSuccess()})()}removeInjectStreamUrl(){var e=this;return r(function*(){let t=pd.reportApiInvoke(e._sessionId,{name:sl.REMOVE_INJECT_STREAM_URL,options:[],tag:al.TRACER});try{var n,r;let t=e._createLiveStreamingClient(Nl.INJECT),i=Ac(n=Gh(Bh(r=t.streamingTasks).call(r))).call(n,e=>e.mode===Nl.INJECT);if(!e._joinInfo||!i)throw new Zu(Cu.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");yield t.stopLiveStreamingTask(i.url)}catch(i){throw t.onError(i),i}t.onSuccess()})()}startChannelMediaRelay(e){var t=this;return r(function*(){let n=pd.reportApiInvoke(t._sessionId,{name:sl.START_CHANNEL_MEDIA_RELAY,options:[e],tag:al.TRACER});try{bn(e),yield t._createChannelMediaRelayClient().startChannelMediaRelay(e)}catch(r){return n.onError(r),r.throw()}n.onSuccess()})()}updateChannelMediaRelay(e){var t=this;return r(function*(){let n=pd.reportApiInvoke(t._sessionId,{name:sl.UPDATE_CHANNEL_MEDIA_RELAY,options:[e],tag:al.TRACER});try{bn(e),yield t._createChannelMediaRelayClient().updateChannelMediaRelay(e)}catch(r){return n.onError(r),r.throw()}n.onSuccess()})()}stopChannelMediaRelay(){var e=this;return r(function*(){let t=pd.reportApiInvoke(e._sessionId,{name:sl.STOP_CHANNEL_MEDIA_RELAY,options:[],tag:al.TRACER});try{yield e._createChannelMediaRelayClient().stopChannelMediaRelay()}catch(n){return t.onError(n),n.throw()}t.onSuccess()})()}sendStreamMessage(e){if(!this._joinInfo)throw new Zu(Cu.INVALID_OPERATION,"can not send data stream, not joined");if("string"==typeof e&&(e=(new TextEncoder).encode(e)),1024<new Blob([e]).size)throw new Zu(Cu.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(yl.DATA_STREAM,{payload:ct(e)})}sendMetadata(e){if(!this._joinInfo)throw new Zu(Cu.INVALID_OPERATION,"can not send metadata, not joined");if(1024<new Blob([e]).size)throw new Zu(Cu.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(yl.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:ct(e)})}sendCustomReportMessage(e){var t=this;return r(function*(){Au(e)||(e=[e]),Qo(e).call(e,Re);let n=pd.reportApiInvoke(t._sessionId,{name:sl.SEND_CUSTOM_REPORT_MESSAGE,options:[],tag:al.TRACER});if(!t._joinInfo)return e=new Zu(Cu.INVALID_OPERATION,"can not send custom report, not joined"),n.onError(e),e.throw();yield pd.sendCustomReportMessage(t._joinInfo.sid,e)})()}getLocalAudioStats(){return this._highStream?this._statsCollector.getLocalAudioTrackStats(this._highStream.connectionId):wl}getRemoteAudioStats(){var e;let t={};return Qo(e=this._remoteStream).call(e,(e,n)=>{t[n]=this._statsCollector.getRemoteAudioTrackStats(e.connectionId)}),t}getLocalVideoStats(){return this._highStream?this._statsCollector.getLocalVideoTrackStats(this._highStream.connectionId):Rl}getRemoteVideoStats(){var e;let t={};return Qo(e=this._remoteStream).call(e,(e,n)=>{t[n]=this._statsCollector.getRemoteVideoTrackStats(e.connectionId)}),t}getRemoteNetworkQuality(){var e;let t={};return Qo(e=this._remoteStream).call(e,(e,n)=>{t[n]=this._statsCollector.getRemoteNetworkQualityStats(e.connectionId)}),t}pickSVCLayer(e,t){var n=this;return r(function*(){ve(t.spatialLayer,"spatialLayer",[0,1,2,3]),ve(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{yield n._gateway.pickSVCLayer(e,t)}catch(r){throw $u.error("[".concat(n._clientId,"] pick SVC layer failed"),r.toString()),r}})()}_reset(){var e,t,n;$u.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Qu.CancelToken.source(),this._streamFallbackTypeCacheMap=new Do,this._remoteStreamTypeCacheMap=new Do,this._configDistribute.stopGetConfigDistribute(),this._defaultStreamFallbackType=this._proxyServer=this._joinInfo=void 0,this._sessionId=null,this._statsCollector.reset(),this._channelName=this._uid=this._appId=this._key=void 0,Qo(e=this._users).call(e,e=>{e.audioTrack&&(e.audioTrack.stop(),e.audioTrack._isDestroyed=!0),e.videoTrack&&(e.videoTrack.stop(),e.videoTrack._isDestroyed=!0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._highStream&&(this._highStream.closeP2PConnection(!0),this._highStream=void 0),Qo(t=this._bindEnabledTracks).call(t,e=>{e.off(jl.NEED_ADD_TRACK,this._handleLocalTrackEnable),e.off(jl.NEED_REMOVE_TRACK,this._handleLocalTrackDisable)}),this._bindEnabledTracks=[],this._lowStream&&(this._lowStream.closeP2PConnection(!0),this._lowStream=void 0),Qo(n=this._remoteStream).call(n,e=>{e.closeP2PConnection(!0)}),this._remoteStream=new Do,this._publishMutex=new nd("client-publish"),this._subscribeMutex=new Do,this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0)}_startSession(e,t){var n,r,i;let o=e||Je(32,"").toUpperCase();$u.debug(e?Us(n="[".concat(this._clientId,"] new Session ")).call(n,o):Us(r=Us(i="[".concat(this._clientId,"] renewSession ")).call(i,this._sessionId," => ")).call(r,o)),this._sessionId=o,t?pd.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:t.channel,appid:t.appId,mode:this._mode}):this._joinInfo?pd.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&pd.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=o),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=o)}_publishHighStream(e){var t=this;return r(function*(){if(!t._joinInfo)throw new Zu(Cu.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==t.connectionState&&"RECONNECTING"!==t.connectionState)throw new Zu(Cu.INVALID_OPERATION,"can not publish stream in ".concat(t.connectionState," state"));if("auto"===t._turnServer.mode&&gu.FORCE_TURN&&!gu.TURN_ENABLE_TCP&&!gu.TURN_ENABLE_UDP)throw new Zu(Cu.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");if($u.debug("[".concat(t._clientId,"] publish high stream")),t._highStream)return yield t._highStream.addTracks(e),t._highStream;t._highStream=new xp(t._statsCollector,t._joinInfo,t._codec),yield t._highStream.addTracks(e);try{yield t._gateway.publish(t._highStream,"high")}catch(n){throw t._highStream=void 0,n}return t._highStream.on(Tl.CONNECTION_STATE_CHANGE,(e,n)=>{t._highStream&&("connected"===e?t.emit(ml.MEDIA_RECONNECT_END,t._highStream.getUserId()):"connecting"===e&&t.emit(ml.MEDIA_RECONNECT_START,t._highStream.getUserId()))}),t._highStream})()}_publishLowStream(e){var t=this;return r(function*(){if(!t._joinInfo)throw new Zu(Cu.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==t.connectionState&&"RECONNECTING"!==t.connectionState)throw new Zu(Cu.INVALID_OPERATION,"can not publish stream in ".concat(t.connectionState," state"));if(!t._highStream||"connected"!==t._highStream.connectionState)throw new Zu(Cu.UNEXPECTED_ERROR,"Could not find high stream");if(t._lowStream)return new Zu(Cu.UNEXPECTED_ERROR,"[".concat(t._clientId,"] Can't publish low stream when stream already publish")).throw();$u.debug("[".concat(t._clientId,"] publish low stream")),t._lowStream=new xp(t._statsCollector,t._joinInfo,t._codec,!0);let n=t._configDistribute.getLowStreamConfigDistribute();n&&n.bitrate&&(t._lowStreamParameter||(t._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),t._lowStreamParameter&&t._lowStreamParameter.bitrate&&n.bitrate<t._lowStreamParameter.bitrate&&(t._lowStreamParameter.bitrate=n.bitrate)),t._lowStream.lowStreamParameter=t._lowStreamParameter,yield t._lowStream.addTracks([e]);try{yield t._gateway.publish(t._lowStream,"low")}catch(r){throw t._lowStream=void 0,r}t._highStream.lowStreamConnection=t._lowStream})()}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new Zu(Cu.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let t=()=>new jp(this._joinInfo,this._config.websocketRetryConfig||gd,this._config.httpRetryConfig||gd),n=e=>{e.onLiveStreamError=(e,t)=>{pd.reportApiInvoke(this._sessionId,{name:sl.ON_LIVE_STREAM_ERROR,options:[e,t],tag:al.TRACER}).onSuccess(),this.emit(ml.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{pd.reportApiInvoke(this._sessionId,{name:sl.ON_LIVE_STREAM_WARNING,options:[e,t],tag:al.TRACER}).onSuccess(),this.emit(ml.LIVE_STREAMING_WARNING,e,t)},e.on(Ml.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new Zu(Cu.INVALID_OPERATION,"can not find join info to get worker manager"));Yt(e,this._joinInfo,this._axiosCancelSource.token,gd).then(t).catch(n)})};switch(e){case Nl.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Nl.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Nl.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(Ml.REQUEST_WORKER_MANAGER_LIST,(e,t,n)=>{if(!this._joinInfo)return n(new Zu(Cu.INVALID_OPERATION,"can not find join info to get worker manager"));Yt(e,this._joinInfo,this._axiosCancelSource.token,gd).then(t).catch(n)}),this._injectStreamingClient.onInjectStatusChange=(e,t,n)=>{this.emit(ml.INJECT_STREAM_STATUS,e,t,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new Hp(this._joinInfo,this._clientId,this._config.websocketRetryConfig||gd,this._config.httpRetryConfig||gd),this._channelMediaRelayClient.on("state",e=>{"RELAY_STATE_FAILURE"===e&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(ml.CHANNEL_MEDIA_RELAY_STATE,e)}),this._channelMediaRelayClient.on("event",e=>{this.emit(ml.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._channelMediaRelayClient):new Zu(Cu.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Bl.DISCONNECT_P2P,()=>{var e;$u.debug("[".concat(this._clientId,"] start full reconnect")),this._highStream&&"disconnected"!==this._highStream.connectionState&&($u.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&"disconnected"!==this._lowStream.connectionState&&($u.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),Qo(e=this._remoteStream).call(e,(e,t)=>{var n;$u.debug(Us(n="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(n,t)),e.readyToReconnectPC()})}),this._gateway.on(Bl.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r,i;let o=()=>{this.emit(ml.CONNECTION_STATE_CHANGE,e,t,n)};if($u.info(Us(r=Us(i="[".concat(this._clientId,"] connection state change: ")).call(i,t," -> ")).call(r,e)),"DISCONNECTED"===e)return this._reset(),void o();var s,a;if("RECONNECTING"===e)this._highStream&&"connecting"===this._highStream.connectionState&&($u.debug("[".concat(this._clientId,"] ready to reconnect high stream")),this._highStream.readyToReconnectPC()),this._lowStream&&"connecting"===this._lowStream.connectionState&&($u.debug("[".concat(this._clientId,"] ready to reconnect low stream")),this._lowStream.readyToReconnectPC()),Qo(s=this._remoteStream).call(s,(e,t)=>{var n;"connecting"===e.connectionState&&($u.debug(Us(n="[".concat(this._clientId,"] ready to reconnect remote stream ")).call(n,t)),e.readyToReconnectPC())}),Qo(a=this._users).call(a,e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_stream_added_state_=!1}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._streamRemovedTimeout=this._userOfflineTimeout=void 0;else if("CONNECTED"===e){var c,u;Qo(c=this._streamFallbackTypeCacheMap).call(c,(e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch(e=>$u.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e))}),Qo(u=this._remoteStreamTypeCacheMap).call(u,(e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch(e=>$u.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e))}),this._highStream&&"connecting"===this._highStream.connectionState?this._highStream.reconnectPC().then(()=>{this._lowStream&&"connecting"===this._lowStream.connectionState&&this._lowStream.reconnectPC().catch(e=>{$u.error("[".concat(this._clientId,"] republish low stream error"),e.toString()),this.emit(ml.ERROR,{reason:e})})}).catch(e=>{$u.error("[".concat(this._clientId,"] republish high stream error"),e.toString()),this.emit(ml.ERROR,{reason:e})}):this._lowStream&&"connecting"===this._lowStream.connectionState&&this._lowStream.reconnectPC().catch(e=>{$u.error("[".concat(this._clientId,"] republish low stream error"),e.toString()),this.emit(ml.ERROR,{reason:e})}),this._userOfflineTimeout=window.setTimeout(()=>{var e;if("CONNECTED"===this.connectionState){this._userOfflineTimeout=void 0;var t=Bs(e=this._users).call(e,e=>!e._trust_in_room_);Qo(t).call(t,e=>{var t;$u.debug(Us(t="[".concat(this._clientId,"] user offline timeout, emit user offline ")).call(t,e.uid)),this._handleUserOffline({uid:e.uid})})}},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{var e;"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,Qo(e=this._users).call(e,e=>{var t,n,r,i,o;e._trust_audio_mute_state_||($u.debug(Us(t="[".concat(this._clientId,"] auto dispatch audio unmute event ")).call(t,e.uid)),this._handleMuteStream(e.uid,"audio",!1)),e._trust_video_mute_state_||($u.debug(Us(n="[".concat(this._clientId,"] auto dispatch video unmute event ")).call(n,e.uid)),this._handleMuteStream(e.uid,"video",!1)),e._trust_audio_enabled_state_||($u.debug(Us(r="[".concat(this._clientId,"] auto dispatch enable local audio ")).call(r,e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),!e._trust_video_enabled_state_&&e._video_enabled_&&($u.debug(Us(i="[".concat(this._clientId,"] auto dispatch enable local video ")).call(i,e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_stream_added_state_||($u.debug(Us(o="[".concat(this._clientId,"] auto dispatch stream remove ")).call(o,e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))}))},1e3)}o()}),this._gateway.on(Bl.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new Zu(Cu.UNEXPECTED_ERROR,"can not recover, no join info"));Gt(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||gd).then(t=>{var n;this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res),e(ac(n=t.gatewayInfo.gatewayAddrs).call(n,e=>{var t,n;return this._joinInfo&&this._joinInfo.proxyServer?(e=e.split(":"),Us(t=Us(n="wss://".concat(this._joinInfo.proxyServer,"/ws/?h=")).call(n,e[0],"&p=")).call(t,e[1])):"wss://".concat(e)}))}).catch(t)}),this._gateway.on(Bl.NETWORK_QUALITY,e=>{"normal"===this._networkQualitySensitivity&&this.emit(ml.NETWORK_QUALITY,e)}),this._gateway.on(Bl.STREAM_TYPE_CHANGE,(e,t)=>{this.emit(ml.STREAM_TYPE_CHANGED,e,t),pd.reportApiInvoke(this._sessionId,{name:sl.STREAM_TYPE_CHANGE,options:[e,t],tag:al.TRACER}).onSuccess(wr({uid:e,streamType:t}))}),this._gateway.on(Bl.IS_P2P_DISCONNECTED,e=>{var t,n,r;let i=[];return this._highStream&&i.push(this._highStream),Qo(t=this._remoteStream).call(t,e=>i.push(e)),0===i.length||0===Bs(i).call(i,e=>"connected"===e.connectionState).length?e(!0):($u.debug(Us(n="[".concat(this._clientId,"] ")).call(n,ac(r=Bs(i).call(i,e=>"connected"===e.connectionState)).call(r,e=>e.connectionId)," is connected")),void e(!1))}),this._gateway.on(Bl.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.signal.on(Sl.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Sl.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Sl.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.uint_id)),this._gateway.signal.on(Sl.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.uint_id)),this._gateway.signal.on(Sl.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Sl.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Sl.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!0)),this._gateway.signal.on(Sl.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!1)),this._gateway.signal.on(Sl.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!0)),this._gateway.signal.on(Sl.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!1)),this._gateway.signal.on(Sl.RECEIVE_METADATA,e=>{let t=at(e.metadata);this.emit(ml.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Sl.ON_DATA_STREAM,e=>{e.seq&&delete e.seq,e.payload=at(e.payload),this.emit(ml.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)}),this._gateway.signal.on(Sl.ON_CRYPT_ERROR,()=>{st(()=>{$u.warning("[".concat(this._clientId,"] on crypt error")),this.emit(ml.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Sl.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Sl.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{$u.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._reset(),this._gateway.leave(!0),this.emit(ml.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this._gateway.signal.on(Sl.ON_STREAM_FALLBACK_UPDATE,e=>{var t,n;$u.debug(Us(t=Us(n="[".concat(this._clientId,"] stream fallback peerId: ")).call(n,e.stream_id,", attr: ")).call(t,e.stream_type)),this.emit(ml.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")}),this._gateway.signal.on(Sl.ON_PUBLISH_STREAM,e=>{var t;this.uid===this._uid&&(this._highStream&&this._highStream._waitingSuccessResponse&&"connected"===this._highStream.connectionState?(this._highStream.reportPublishEvent(!0,null,wr({proxy:e.proxy})),$u.info(Us(t="[".concat(this._clientId,"] on publish stream, ")).call(t,wr(e))),void 0!==e.proxy&&this.emit(ml.IS_USING_CLOUD_PROXY,!!e.proxy)):this._lowStream?this._lowStream.reportPublishEvent(!0,null,wr({proxy:e.proxy})):$u.warning("get on_publish_stream message but cannot handle"))}),this._gateway.signal.on(Sl.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Sl.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(vl.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case yl.PUBLISH:var n;if(!t)break;if(!(e="high"===t.stream_type?this._highStream:this._lowStream))break;"offer"===t.state&&pd.publish(this._joinInfo.sid,{lts:e.startTime,succ:!1,ec:Cu.TIMEOUT,audio:t.audio,video:t.video,p2pid:t.p2p_id,publishRequestid:e.ID,screenshare:!(!e.videoTrack||-1===vc(n=e.videoTrack._hints).call(n,Gl.SCREEN_TRACK)),audioName:e.audioTrack&&e.audioTrack.getTrackLabel(),videoName:e.videoTrack&&e.videoTrack.getTrackLabel()});break;case yl.SUBSCRIBE:(n=this._remoteStream.get(t.stream_id))&&t&&pd.subscribe(this._joinInfo.sid,{lts:n.startTime,succ:!1,ec:Cu.TIMEOUT,audio:!!t.audio,video:!!t.video,peerid:t.stream_id,subscribeRequestid:n.ID,p2pid:n.pc.ID})}})}}Kp([At(),Yp("design:type",Function),Yp("design:paramtypes",[Object]),Yp("design:returntype",void 0)],Qp.prototype,"setTurnServer",null),Kp([At({report:pd}),Yp("design:type",Function),Yp("design:paramtypes",[String,String,Uint8Array]),Yp("design:returntype",void 0)],Qp.prototype,"setEncryptionConfig",null),Kp([function(e={report:pd}){return function(t,n,i){let o=t[n];if("function"==typeof o){let s="AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name;i.value=function(){var t=r(function*(...t){var r;let i=e.report.reportApiInvoke(this._sessionId||null,{name:Us(r="".concat(s,".")).call(r,n),options:t,tag:al.TRACER});try{let e=yield o.apply(this,t);return i.onSuccess(),e}catch(a){throw i.onError(a),a}});return function(){return t.apply(this,arguments)}}()}return i}}({report:pd}),Yp("design:type",Function),Yp("design:paramtypes",[Object,Object]),Yp("design:returntype",ic)],Qp.prototype,"pickSVCLayer",null);class Jp extends Id{constructor(e,t={}){super(),this.currentLoopCount=this.pausePlayTime=this.startPlayOffset=this.startPlayTime=0,this._currentState="stopped",this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}set currentState(e){e!==this._currentState&&(this._currentState=e,this.emit(bl.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):$u.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(Pu){}this.reset()}}startSourceNode(){var e;this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=Pc(e=this.handleSourceNodeEnded).call(e,this))}createSourceNode(){let e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let Xp=new Do;var $p=sr.setInterval;let Zp=Pe().name;class ef{constructor(e,t){this.id=0,ef.count+=1,this.id=ef.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{let t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}switchSdp(){var e=this;return r(function*(){if(e.peerPair){var t=function(){var e=r(function*(e,t){return t="offer"===t?yield e.createOffer():yield e.createAnswer(),yield e.setLocalDescription(t),"complete"===e.iceGatheringState?e.localDescription:new ic(t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}})});return function(t,n){return e.apply(this,arguments)}}(),n=function(){var e=r(function*(e,t){return yield e.setRemoteDescription(t)});return function(t,n){return e.apply(this,arguments)}}();try{let r=yield t(e.peerPair[0],"offer");yield n(e.peerPair[1],r);let i=yield t(e.peerPair[1],"answer");yield n(e.peerPair[0],i)}catch(i){throw new Zu(Cu.LOCAL_AEC_ERROR,i.toString()).print()}}})()}getTracksFromMediaElement(e){var t=this;return r(function*(){if(t.audioTrack)return t.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=t.context.createMediaStreamDestination(),t.context.createMediaElementSource(e).connect(n)}catch(r){throw new Zu(Cu.LOCAL_AEC_ERROR,r.toString()).print()}if(!n)throw new Zu(Cu.LOCAL_AEC_ERROR,"no dest node when local aec").print();return e=n.stream.getAudioTracks()[0],t.audioTrack=e,e})()}getElement(){return this.element}startEchoCancellation(){var e=this;return r(function*(){e.context.resume(),e.peerPair&&e.close(),e.initPeers();let t=yield e.getTracksFromMediaElement(e.element);e.peerPair&&e.peerPair[0].addTrack(t),yield e.switchSdp()})()}close(){var e;$u.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&Qo(e=this.peerPair).call(e,e=>{e.close()}),this.audioPlayerElement=this.peerPair=void 0}}ef.count=0;var tf=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let nf=window.AudioContext||window.webkitAudioContext;class rf{constructor(){this.units=[],this._doesEnvironmentNeedAEC()&&(this.context=new nf)}processExternalMediaAEC(e){var t;if(!this.context||!this._doesEnvironmentNeedAEC())return $u.debug("the system does not need to process local aec"),-1;let n=Ac(t=this.units).call(t,t=>t&&t.getElement()===e);return n||(n=new ef(e,this.context),this.units.push(n)),n.startEchoCancellation(),$u.debug("start processing local audio echo cancellation, id is",n.id),n.id}_doesEnvironmentNeedAEC(){return Pe().name!==Xc.SAFARI}}!function(e,t,n,r){var i,o=arguments.length,s=3>o?t:null===r?r=bs(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;0<=a;a--)(i=e[a])&&(s=(3>o?i(s):3<o?i(t,n,s):i(t,n))||s);3<o&&s&&cs(t,n,s)}([At({report:pd}),tf("design:type",Function),tf("design:paramtypes",[HTMLAudioElement]),tf("design:returntype",Number)],rf.prototype,"processExternalMediaAEC",null);let of=new rf;var sf,af,cf,uf;ee("PROCESS_ID",Us(sf=Us(af=Us(cf=Us(uf="process-".concat(Je(8,""),"-")).call(uf,Je(4,""),"-")).call(cf,Je(4,""),"-")).call(af,Je(4,""),"-")).call(sf,Je(12,""))),function(){let e=Pe();var t=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia);Ql.getDisplayMedia=t,Ql.getStreamFromExtension=e.name===Xc.CHROME&&34<Number(e.version),Ql.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=new RTCPeerConnection,t=!1;try{e.addTransceiver("audio"),t=!0}catch(n){}return e.close(),t}(),Ql.supportMinBitrate=e.name===Xc.CHROME||e.name===Xc.EDGE,Ql.supportSetRtpSenderParameters=function(){let e=Pe();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Ue()||e.name===Xc.SAFARI||e.name===Xc.FIREFOX&&64<=Number(e.version))}(),e.name!==Xc.SAFARI&&Pe().name!==Xc.WECHAT||(Ql.supportDualStream=!1),Ql.webAudioMediaStreamDest=function(){let e=Pe();return!(e.name===Xc.SAFARI&&12>Number(e.version))}(),Ql.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,Ql.supportWebGL="undefined"!=typeof WebGLRenderingContext,Ql.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Ue()||(Ql.webAudioWithAEC=!0),Ql.supportShareAudio=function(){let e=Pe();return(e.os===Jc.WIN_10||e.os===Jc.WIN_81||e.os===Jc.WIN_7||e.os===Jc.LINUX||e.os===Jc.MAC_OS||e.os===Jc.MAC_OS_X)&&e.name===Xc.CHROME&&74<=Number(e.version)}(),Ql.supportDualStreamEncoding=function(){let e=Pe();return e.name===Xc.CHROME&&87===Number(e.version)}(),$u.info("browser compatibility",wr(Ql),wr(e))}();let lf={VERSION:cu,BUILD:"v4.5.0-0-g87245ad6(5/25/2021, 3:25:26 PM)",setParameter:ee,getParameter:function(e){return gu[e]},getSupportedCodec:(vf=r(function*(e){let t=null;return e?(t=new np({}),t.addStream(e)):t=new rp({}),e=ln(yield t.createOfferSDP()),t.close(),e}),function(e){return vf.apply(this,arguments)}),checkSystemRequirements:function(){const e=pd.reportApiInvoke(null,{name:sl.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:al.TRACER});var t=!1;try{var n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(window.RTCPeerConnection&&n&&r)}catch(i){return $u.error("check system requirement failed: ",i),!1}return n=!1,(r=Pe()).name===Xc.CHROME&&58<=Number(r.version)&&r.os!==Jc.IOS&&(n=!0),r.name===Xc.FIREFOX&&56<=Number(r.version)&&(n=!0),r.name===Xc.OPERA&&45<=Number(r.version)&&(n=!0),r.name===Xc.SAFARI&&11<=Number(r.version)&&(n=!0),Pe().name!==Xc.WECHAT&&Pe().name!==Xc.QQ||r.os===Jc.IOS||(n=!0),$u.debug("checkSystemRequirements, api:",t,"browser",n),e.onSuccess(t=t&&n),t},getDevices:function(e){return sd.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return sd.getRecordingDevices(e)},getCameras:function(e){return sd.getCamerasDevices(e)},getElectronScreenSources:pt,getPlaybackDevices:function(e){return sd.getSpeakers(e)},createClient:function(e={codec:"vp8",mode:"rtc"}){const t=pd.reportApiInvoke(null,{name:sl.CREATE_CLIENT,options:[e],tag:al.TRACER});try{ve(e.codec,"config.codec",["vp8","vp9","av1","h264"]),ve(e.mode,"config.mode",["rtc","live"]),void 0!==e.proxyServer&&Ee(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&Ae(e.turnServer),void 0!==e.httpRetryConfig&&Ie(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&Ie(e.websocketRetryConfig)}catch(n){throw t.onError(n),n}return t.onSuccess(),new Qp(Rn({forceWaitGatewayResponse:!0},e,{role:"rtc"===e.mode?"host":e.role}))},createCameraVideoTrack:(_f=r(function*(e={encoderConfig:"480p_1"}){const t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CREATE_CAM_VIDEO_TRACK,options:[An({},e)]}),n=sn(e);var r=Je(8,"track-");let i=null;$u.info("start create camera video track with config",wr(e),"trackId",r);try{i=(yield gt({video:n},r)).getVideoTracks()[0]||null}catch(o){throw t.onError(o),o}return i?(e.optimizationMode&&On(r,i,e,e.encoderConfig&&J(e.encoderConfig)),e=new Op(i,e,n,e.scalabiltyMode?$(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r),t.onSuccess(e.getTrackId()),$u.info("create camera video success, trackId:",r),e):(r=new Zu(Cu.UNEXPECTED_ERROR,"can not find track in media stream"),t.onError(r),r.throw())}),function(){return _f.apply(this,arguments)}),createCustomVideoTrack:function(e){const t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new Ap(e.mediaStreamTrack,{bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?$(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode);return t.onSuccess(n.getTrackId()),$u.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:(gf=r(function*(e={},t="disable"){const n=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CREATE_SCREEN_VIDEO_TRACK,options:[An({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";var r={};e.screenSourceType&&(r.mediaSource=e.screenSourceType),e.extensionId&&Le()&&(r.extensionId=e.extensionId),e.electronScreenSourceId&&(r.sourceId=e.electronScreenSourceId);var i=e.encoderConfig?X(e.encoderConfig):null;r.mandatory={chromeMediaSource:"desktop",maxWidth:i?i.width:void 0,maxHeight:i?i.height:void 0},i&&i.frameRate&&("number"==typeof i.frameRate?(r.mandatory.maxFrameRate=i.frameRate,r.mandatory.minFrameRate=i.frameRate):(r.mandatory.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||void 0,r.mandatory.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||void 0),r.frameRate=i.frameRate),i&&i.width&&(r.width=i.width),i&&i.height&&(r.height=i.height),i=r;const o=Je(8,"track-");let s=null;r=null;const a=Ql;if(!a.supportShareAudio&&"enable"===t)return e=new Zu(Cu.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio"),n.onError(e),e.throw();$u.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{const e=yield gt({screen:i,screenAudio:"auto"===t?a.supportShareAudio:"enable"===t},o);s=e.getVideoTracks()[0]||null,r=e.getAudioTracks()[0]||null}catch(c){throw n.onError(c),c}return s?r||"enable"!==t?(e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(On(o,s,e,e.encoderConfig&&X(e.encoderConfig)),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax)),(e=new Ap(s,e.encoderConfig?X(e.encoderConfig):{},e.scalabiltyMode?$(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o))._hints.push(Gl.SCREEN_TRACK),r?(t=new Od(r),n.onSuccess([e.getTrackId(),t.getTrackId()]),$u.info("create screen video track success","video:",e.getTrackId(),"audio:",t.getTrackId()),[e,t]):(n.onSuccess(e.getTrackId()),$u.info("create screen video track success","video:",e.getTrackId()),e)):(s&&s.stop(),e=new Zu(Cu.SHARE_AUDIO_NOT_ALLOWED),n.onError(e),e.throw()):(e=new Zu(Cu.UNEXPECTED_ERROR,"can not find track in media stream"),n.onError(e),e.throw())}),function(){return gf.apply(this,arguments)}),createMicrophoneAndCameraTracks:(mf=r(function*(e={},t={encoderConfig:"480p_1"}){var n,r,i;const o=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),s=sn(t),a=an(e),c=Je(8,"track-"),u=Je(8,"track-");let l=null,h=null;$u.info(Us(n=Us(r=Us(i="start create camera video track(".concat(u,") and microphone audio track(")).call(i,c,") with config, audio: ")).call(r,wr(e),", video: ")).call(n,wr(t)));try{var d;const e=yield gt({audio:a,video:s},Us(d="".concat(c,"-")).call(d,u));l=e.getAudioTracks()[0],h=e.getVideoTracks()[0]}catch(f){throw o.onError(f),f}if(!l||!h){var p=new Zu(Cu.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(p),p.throw()}return t.optimizationMode&&On(u,h,t,t.encoderConfig&&J(t.encoderConfig)),e=new Nd(l,e,a,c),t=new Op(h,t,s,t.scalabiltyMode?$(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,u),o.onSuccess([e.getTrackId(),t.getTrackId()]),$u.info(Us(p="create camera video track(".concat(u,") and microphone audio track(")).call(p,c,") success")),[e,t]}),function(){return mf.apply(this,arguments)}),createMicrophoneAudioTrack:(ff=r(function*(e={}){const t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=an(e);var r=Je(8,"track-");let i=null;$u.info("start create microphone audio track with config",wr(e),"trackId",r);try{i=(yield gt({audio:n},r)).getAudioTracks()[0]||null}catch(o){throw t.onError(o),o}return i?(e=new Nd(i,e,n,r),t.onSuccess(e.getTrackId()),$u.info("create microphone audio track success, trackId:",r),e):(r=new Zu(Cu.UNEXPECTED_ERROR,"can not find track in media stream"),t.onError(r),r.throw())}),function(){return ff.apply(this,arguments)}),createCustomAudioTrack:function(e){const t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new Od(e.mediaStreamTrack,e.encoderConfig?Z(e.encoderConfig):{});return $u.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:(pf=r(function*(e){const t=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CREATE_BUFFER_AUDIO_TRACK,options:[e]}),n=Je(8,"track-");$u.info("start create buffer source audio track with config",wr(e),"trackId",n);const r=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=yield function(e,t){return In.apply(this,arguments)}(e.source,e.cacheOnlineFile)}catch(o){return t.onError(o),o.throw()}const i=new Jp(e.source);return e=new kd(r,i,e.encoderConfig?Z(e.encoderConfig):{},n),$u.info("create buffer source audio track success, trackId:",n),t.onSuccess(e.getTrackId()),e}),function(e){return pf.apply(this,arguments)}),setLogLevel:function(e){$u.setLogLevel(e)},enableLogUpload:function(){$u.enableLogUpload()},disableLogUpload:function(){$u.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new Gp},checkAudioTrackIsActive:(df=r(function*(e,t=5e3){const n=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Od||e instanceof Vp)){var r=new Zu(Cu.INVALID_TRACK,"the parameter is not a audio track");return n.onError(r),r.throw()}t&&1e3>t&&(t=1e3);const i=e instanceof Od?e.getTrackLabel():"remote_track";let o=r=e.getVolumeLevel(),s=r;const a=qh();return new ic(r=>{const c=$p(()=>{var u=e.getVolumeLevel();o=u>o?u:o,s=u<s?u:s,u=1e-4<o-s;var l,h=qh()-a;(u||h>t)&&(clearInterval(c),h={duration:h,deviceLabel:i,maxVolumeLevel:o,result:u},$u.info(Us(l="[track-".concat(e.getTrackId(),"] check audio track active completed. ")).call(l,wr(h))),n.onSuccess(h),r(u))},200)})}),function(e){return df.apply(this,arguments)}),checkVideoTrackIsActive:(hf=r(function*(e,t=5e3){var n;const r=pd.reportApiInvoke(null,{tag:al.TRACER,name:sl.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ap||e instanceof Up))return e=new Zu(Cu.INVALID_TRACK,"the parameter is not a video track"),r.onError(e),e.throw();t&&1e3>t&&(t=1e3);var i=e instanceof Ap?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0);const s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,Zp===Xc.SAFARI&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([o]),s.play();const a=document.createElement("canvas");a.width=160,a.height=120;let c=o=0;try{const e=qh();o=yield function(e,t,n,r){let i,o=0,s=null;return new ic((r,a)=>{ld(()=>{i&&(i(),r(o))},t),i=Lt(()=>{e:{o>4&&i&&(i(),r(o));var t=n.getContext("2d");if(t){t.drawImage(e,0,0,160,120),t=t.getImageData(0,0,n.width,n.height);var c=Math.floor(t.data.length/3);if(s)for(let e=0;e<c;e+=3)if(t.data[e]!==s[e]){o+=1,s=t.data;break e}s=t.data}else t=new Zu(Cu.UNEXPECTED_ERROR,"can not get canvas 2d context."),$u.error(t.toString()),a(t)}},30)})}(s,t,a),c=qh()-e}catch(u){throw r.onError(u),u}return Zp===Xc.SAFARI&&(s.pause(),s.remove()),s.srcObject=null,i={duration:c,changedPicNum:o,deviceLabel:i,result:t=4<o},$u.info(Us(n="[track-".concat(e.getTrackId(),"] check video track active completed. ")).call(n,wr(i))),r.onSuccess(i),t}),function(e){return hf.apply(this,arguments)}),setArea:function(e){const t=pd.reportApiInvoke(null,{name:sl.SET_AREA,options:e,tag:al.TRACER});try{var n;let t=[];if("string"==typeof e&&(t=[e]),Au(e)&&(Qo(e).call(e,e=>{if(!Vc(Wl).call(Wl,e))throw new Zu(Cu.INVALID_PARAMS,"invalid area code")}),t=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:n,excludedArea:r}=e;if(!n)throw new Zu(Cu.INVALID_PARAMS,"area code is needed");e=n,"string"==typeof n&&(e=[n]),t=r?function(e,t){var n,r=[];if(Vc(e).call(e,"GLOBAL")){r=["GLOBAL","OVERSEA"];const i=ts(Kl);if("GLOBAL"===t)throw new Zu(Cu.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if("CHINA"===t)r=["OVERSEA"];else if(n=t,Vc(Fd).call(Fd,n)){e=Vd[t]||[];const n=[...r,t,...e];r=Bs(i).call(i,e=>!Vc(n).call(n,e))}else if(function(e){let t=!1;return Qo(Fd).call(Fd,n=>{var r;Vc(r=Vd[n]).call(r,e)&&(t=!0)}),t}(t)){e=function(e){let t;return Qo(Fd).call(Fd,n=>{var r;Vc(r=Vd[n]).call(r,e)&&(t=n)}),t}(t);const n=[...r,e,t];r=Bs(i).call(i,e=>!Vc(n).call(n,e))}else r=e;r=function(e){const t=[];return Qo(Bd).call(Bd,n=>{Vc(e).call(e,n)&&t.push(n)}),Us(t).call(t,Bs(e).call(e,e=>!Vc(Bd).call(Bd,e)))}(r)}else r=e;return r}(e,r):e}ee("AREAS",t);const r=(e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return ac(e).call(e,e=>{const n=Kl[e];(e=ts(n))&&ac(e).call(e,e=>{var r;"CODE"!==e&&(t[e]=Us(r=t[e]).call(r,n[e]))})}),t})(t);ac(n=ts(r)).call(n,e=>{ee(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?r[e][0]:r[e])}),$u.debug("set area success:",t.join(","))}catch(r){throw t.onError(r),r}t.onSuccess()},loadModule:function(e,t){e.moduleInit?e.moduleInit({logger:$u,report:pd},t):$u.debug("Invalid Plugin")},processExternalMediaAEC:function(e){of.processExternalMediaAEC(e)}};var hf,df,pf,ff,mf,gf,_f,vf;return sd.on(ul.CAMERA_DEVICE_CHANGED,e=>{$u.info("camera device changed",wr(e)),lf.onCameraChanged&&lf.onCameraChanged(e)}),sd.on(ul.RECORDING_DEVICE_CHANGED,e=>{$u.info("microphone device changed",wr(e)),lf.onMicrophoneChanged&&lf.onMicrophoneChanged(e)}),sd.on(ul.PLAYOUT_DEVICE_CHANGED,e=>{$u.debug("playout device changed",wr(e)),lf.onPlaybackDeviceChanged&&lf.onPlaybackDeviceChanged(e)}),Ad.onAutoplayFailed=()=>{$u.info("detect audio element autoplay failed"),lf.onAudioAutoplayFailed&&lf.onAudioAutoplayFailed()},wd.on("autoplay-failed",()=>{$u.info("detect webaudio autoplay failed"),lf.onAudioAutoplayFailed&&lf.onAudioAutoplayFailed()}),lf}()},1858:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r.Z});var r=n(1062),i="8.6.8";r.Z.registerVersion("firebase",i,"app"),r.Z.SDK_VERSION=i},8318:(e,t,n)=>{"use strict";n.d(t,{y:()=>u});var r=n(6673),i=n(5331),o=n(7498),s=n(6197),a=n(3392),c=n(1484);let u=(()=>{class e{constructor(e){this._isScalar=!1,e&&(this._subscribe=e)}lift(t){const n=new e;return n.source=this,n.operator=t,n}subscribe(e,t,n){const{operator:s}=this,a=function(e,t,n){if(e){if(e instanceof r.L)return e;if(e[i.b])return e[i.b]()}return e||t||n?new r.L(e,t,n):new r.L(o.c)}(e,t,n);if(a.add(s?s.call(a,this.source):this.source||c.v.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),c.v.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a}_trySubscribe(e){try{return this._subscribe(e)}catch(t){c.v.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){const{closed:t,destination:n,isStopped:i}=e;if(t||i)return!1;e=n&&n instanceof r.L?n:null}return!0}(e)?e.error(t):console.warn(t)}}forEach(e,t){return new(t=l(t))((t,n)=>{let r;r=this.subscribe(t=>{try{e(t)}catch(i){n(i),r&&r.unsubscribe()}},n,t)})}_subscribe(e){const{source:t}=this;return t&&t.subscribe(e)}[s.L](){return this}pipe(...e){return 0===e.length?this:(0===(t=e).length?a.y:1===t.length?t[0]:function(e){return t.reduce((e,t)=>t(e),e)})(this);var t}toPromise(e){return new(e=l(e))((e,t)=>{let n;this.subscribe(e=>n=e,e=>t(e),()=>e(n))})}}return e.create=t=>new e(t),e})();function l(e){if(e||(e=c.v.Promise||Promise),!e)throw new Error("no Promise impl found");return e}},7498:(e,t,n)=>{"use strict";n.d(t,{c:()=>o});var r=n(1484),i=n(4294);const o={closed:!0,next(e){},error(e){if(r.v.useDeprecatedSynchronousErrorHandling)throw e;(0,i.z)(e)},complete(){}}},5959:(e,t,n)=>{"use strict";n.d(t,{Yc:()=>u,xQ:()=>l});var r=n(8318),i=n(6673),o=n(7570),s=n(3895),a=n(9291),c=n(5331);class u extends i.L{constructor(e){super(e),this.destination=e}}let l=(()=>{class e extends r.y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[c.b](){return new u(this)}lift(e){const t=new h(this,this);return t.operator=e,t}next(e){if(this.closed)throw new s.N;if(!this.isStopped){const{observers:t}=this,n=t.length,r=t.slice();for(let i=0;i<n;i++)r[i].next(e)}}error(e){if(this.closed)throw new s.N;this.hasError=!0,this.thrownError=e,this.isStopped=!0;const{observers:t}=this,n=t.length,r=t.slice();for(let i=0;i<n;i++)r[i].error(e);this.observers.length=0}complete(){if(this.closed)throw new s.N;this.isStopped=!0;const{observers:e}=this,t=e.length,n=e.slice();for(let r=0;r<t;r++)n[r].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(e){if(this.closed)throw new s.N;return super._trySubscribe(e)}_subscribe(e){if(this.closed)throw new s.N;return this.hasError?(e.error(this.thrownError),o.w.EMPTY):this.isStopped?(e.complete(),o.w.EMPTY):(this.observers.push(e),new a.W(this,e))}asObservable(){const e=new r.y;return e.source=this,e}}return e.create=(e,t)=>new h(e,t),e})();class h extends l{constructor(e,t){super(),this.destination=e,this.source=t}next(e){const{destination:t}=this;t&&t.next&&t.next(e)}error(e){const{destination:t}=this;t&&t.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:t}=this;return t?this.source.subscribe(e):o.w.EMPTY}}},9291:(e,t,n)=>{"use strict";n.d(t,{W:()=>i});var r=n(7570);class i extends r.w{constructor(e,t){super(),this.subject=e,this.subscriber=t,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,t=e.observers;if(this.subject=null,!t||0===t.length||e.isStopped||e.closed)return;const n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},6673:(e,t,n)=>{"use strict";n.d(t,{L:()=>u});var r=n(5024),i=n(7498),o=n(7570),s=n(5331),a=n(1484),c=n(4294);class u extends o.w{constructor(e,t,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=i.c;break;case 1:if(!e){this.destination=i.c;break}if("object"==typeof e){e instanceof u?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new l(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new l(this,e,t,n)}}[s.b](){return this}static create(e,t,n){const r=new u(e,t,n);return r.syncErrorThrowable=!1,r}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class l extends u{constructor(e,t,n,o){let s;super(),this._parentSubscriber=e;let a=this;(0,r.m)(t)?s=t:t&&(s=t.next,n=t.error,o=t.complete,t!==i.c&&(a=Object.create(t),(0,r.m)(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=s,this._error=n,this._complete=o}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:t}=this;a.v.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:t}=this,{useDeprecatedSynchronousErrorHandling:n}=a.v;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):(0,c.z)(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;(0,c.z)(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const t=()=>this._complete.call(this._context);a.v.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,t),this.unsubscribe()):(this.__tryOrUnsub(t),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),a.v.useDeprecatedSynchronousErrorHandling)throw n;(0,c.z)(n)}}__tryOrSetError(e,t,n){if(!a.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return a.v.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):((0,c.z)(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}},7570:(e,t,n)=>{"use strict";n.d(t,{w:()=>a});var r=n(8470),i=n(2056),o=n(5024);const s=(()=>{function e(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((e,t)=>`${t+1}) ${e.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e})();let a=(()=>{class e{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let t;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:a,_unsubscribe:u,_subscriptions:l}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(let e=0;e<n.length;++e)n[e].remove(this);if((0,o.m)(u)){a&&(this._unsubscribe=void 0);try{u.call(this)}catch(h){t=h instanceof s?c(h.errors):[h]}}if((0,r.k)(l)){let e=-1,n=l.length;for(;++e<n;){const n=l[e];if((0,i.K)(n))try{n.unsubscribe()}catch(h){t=t||[],h instanceof s?t=t.concat(c(h.errors)):t.push(h)}}}if(t)throw new s(t)}add(t){let n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){const t=n;n=new e,n._subscriptions=[t]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}let{_parentOrParents:r}=n;if(null===r)n._parentOrParents=this;else if(r instanceof e){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}remove(e){const t=this._subscriptions;if(t){const n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}var t;return e.EMPTY=((t=new e).closed=!0,t),e})();function c(e){return e.reduce((e,t)=>e.concat(t instanceof s?t.errors:t),[])}},1484:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});let r=!1;const i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else r&&console.log("RxJS: Back to a better error behavior. Thank you. <3");r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},6882:(e,t,n)=>{"use strict";n.d(t,{IY:()=>s,Ds:()=>a,ft:()=>c});var r=n(6673),i=n(8318),o=n(6015);class s extends r.L{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class a extends r.L{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function c(e,t){if(t.closed)return;if(e instanceof i.y)return e.subscribe(t);let n;try{n=(0,o.s)(e)(t)}catch(r){t.error(r)}return n}},2875:(e,t,n)=>{"use strict";n.d(t,{c:()=>a,N:()=>c});var r=n(5959),i=n(8318),o=n(7570),s=n(1564);class a extends i.y{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new o.w,e.add(this.source.subscribe(new u(this.getSubject(),this))),e.closed&&(this._connection=null,e=o.w.EMPTY)),e}refCount(){return(0,s.x)()(this)}}const c=(()=>{const e=a.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}})();class u extends r.Yc{constructor(e,t){super(e),this.connectable=t}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}},653:(e,t,n)=>{"use strict";n.d(t,{E:()=>i,c:()=>o});var r=n(8318);const i=new r.y(e=>e.complete());function o(e){return e?function(e){return new r.y(t=>e.schedule(()=>t.complete()))}(e):i}},9764:(e,t,n)=>{"use strict";n.d(t,{D:()=>h});var r=n(8318),i=n(6015),o=n(7570),s=n(6197),a=n(2570),c=n(5686),u=n(5168),l=n(9653);function h(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[s.L]}(e))return function(e,t){return new r.y(n=>{const r=new o.w;return r.add(t.schedule(()=>{const i=e[s.L]();r.add(i.subscribe({next(e){r.add(t.schedule(()=>n.next(e)))},error(e){r.add(t.schedule(()=>n.error(e)))},complete(){r.add(t.schedule(()=>n.complete()))}}))})),r})}(e,t);if((0,u.t)(e))return function(e,t){return new r.y(n=>{const r=new o.w;return r.add(t.schedule(()=>e.then(e=>{r.add(t.schedule(()=>{n.next(e),r.add(t.schedule(()=>n.complete()))}))},e=>{r.add(t.schedule(()=>n.error(e)))}))),r})}(e,t);if((0,l.z)(e))return(0,a.r)(e,t);if(function(e){return e&&"function"==typeof e[c.hZ]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new r.y(n=>{const r=new o.w;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(t.schedule(()=>{i=e[c.hZ](),r.add(t.schedule(function(){if(n.closed)return;let e,t;try{const n=i.next();e=n.value,t=n.done}catch(r){return void n.error(r)}t?n.complete():(n.next(e),this.schedule())}))})),r})}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof r.y?e:new r.y((0,i.s)(e))}},9342:(e,t,n)=>{"use strict";n.d(t,{n:()=>s});var r=n(8318),i=n(625),o=n(2570);function s(e,t){return t?(0,o.r)(e,t):new r.y((0,i.V)(e))}},1906:(e,t,n)=>{"use strict";n.d(t,{T:()=>a});var r=n(8318),i=n(6163),o=n(7471),s=n(9342);function a(...e){let t=Number.POSITIVE_INFINITY,n=null,a=e[e.length-1];return(0,i.K)(a)?(n=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof a&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof r.y?e[0]:(0,o.J)(t)((0,s.n)(e,n))}},878:(e,t,n)=>{"use strict";n.d(t,{of:()=>s});var r=n(6163),i=n(9342),o=n(2570);function s(...e){let t=e[e.length-1];return(0,r.K)(t)?(e.pop(),(0,o.r)(e,t)):(0,i.n)(e)}},1225:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});var r=n(8318);function i(e,t){return new r.y(t?n=>t.schedule(o,0,{error:e,subscriber:n}):t=>t.error(e))}function o({error:e,subscriber:t}){t.error(e)}},9996:(e,t,n)=>{"use strict";n.d(t,{U:()=>i});var r=n(6673);function i(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new o(e,t))}}class o{constructor(e,t){this.project=e,this.thisArg=t}call(e,t){return t.subscribe(new s(e,this.project,this.thisArg))}}class s extends r.L{constructor(e,t,n){super(e),this.project=t,this.count=0,this.thisArg=n||this}_next(e){let t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}},7471:(e,t,n)=>{"use strict";n.d(t,{J:()=>o});var r=n(3982),i=n(3392);function o(e=Number.POSITIVE_INFINITY){return(0,r.zg)(i.y,e)}},3982:(e,t,n)=>{"use strict";n.d(t,{zg:()=>s});var r=n(9996),i=n(9764),o=n(6882);function s(e,t,n=Number.POSITIVE_INFINITY){return"function"==typeof t?o=>o.pipe(s((n,o)=>(0,i.D)(e(n,o)).pipe((0,r.U)((e,r)=>t(n,e,o,r))),n)):("number"==typeof t&&(n=t),t=>t.lift(new a(e,n)))}class a{constructor(e,t=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=t}call(e,t){return t.subscribe(new c(e,this.project,this.concurrent))}}class c extends o.Ds{constructor(e,t,n=Number.POSITIVE_INFINITY){super(e),this.project=t,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let t;const n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t)}_innerSub(e){const t=new o.IY(this),n=this.destination;n.add(t);const r=(0,o.ft)(e,t);r!==t&&n.add(r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},9971:(e,t,n)=>{"use strict";n.d(t,{ht:()=>l,QV:()=>c});var r=n(6673),i=n(653),o=n(878),s=n(1225);let a=(()=>{class e{constructor(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}observe(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}do(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}}accept(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)}toObservable(){switch(this.kind){case"N":return(0,o.of)(this.value);case"E":return(0,s._)(this.error);case"C":return(0,i.c)()}throw new Error("unexpected notification kind value")}static createNext(t){return void 0!==t?new e("N",t):e.undefinedValueNotification}static createError(t){return new e("E",void 0,t)}static createComplete(){return e.completeNotification}}return e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e})();function c(e,t=0){return function(n){return n.lift(new u(e,t))}}class u{constructor(e,t=0){this.scheduler=e,this.delay=t}call(e,t){return t.subscribe(new l(e,this.scheduler,this.delay))}}class l extends r.L{constructor(e,t,n=0){super(e),this.scheduler=t,this.delay=n}static dispatch(e){const{notification:t,destination:n}=e;t.observe(n),this.unsubscribe()}scheduleMessage(e){this.destination.add(this.scheduler.schedule(l.dispatch,this.delay,new h(e,this.destination)))}_next(e){this.scheduleMessage(a.createNext(e))}_error(e){this.scheduleMessage(a.createError(e)),this.unsubscribe()}_complete(){this.scheduleMessage(a.createComplete()),this.unsubscribe()}}class h{constructor(e,t){this.notification=e,this.destination=t}}},1564:(e,t,n)=>{"use strict";n.d(t,{x:()=>i});var r=n(6673);function i(){return function(e){return e.lift(new o(e))}}class o{constructor(e){this.connectable=e}call(e,t){const{connectable:n}=this;n._refCount++;const r=new s(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i}}class s extends r.L{constructor(e,t){super(e),this.connectable=t}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const t=e._refCount;if(t<=0)return void(this.connection=null);if(e._refCount=t-1,t>1)return void(this.connection=null);const{connection:n}=this,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}},3482:(e,t,n)=>{"use strict";n.d(t,{R:()=>a});var r=n(8318),i=n(2709),o=n(2293);class s extends r.y{constructor(e,t=0,n=i.e){super(),this.source=e,this.delayTime=t,this.scheduler=n,(!(0,o.k)(t)||t<0)&&(this.delayTime=0),n&&"function"==typeof n.schedule||(this.scheduler=i.e)}static create(e,t=0,n=i.e){return new s(e,t,n)}static dispatch(e){const{source:t,subscriber:n}=e;return this.add(t.subscribe(n))}_subscribe(e){return this.scheduler.schedule(s.dispatch,this.delayTime,{source:this.source,subscriber:e})}}function a(e,t=0){return function(n){return n.lift(new c(e,t))}}class c{constructor(e,t){this.scheduler=e,this.delay=t}call(e,t){return new s(t,this.delay,this.scheduler).subscribe(e)}}},6599:(e,t,n)=>{"use strict";n.d(t,{b:()=>s});var r=n(6673);function i(){}var o=n(5024);function s(e,t,n){return function(r){return r.lift(new a(e,t,n))}}class a{constructor(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}call(e,t){return t.subscribe(new c(e,this.nextOrObserver,this.error,this.complete))}}class c extends r.L{constructor(e,t,n,r){super(e),this._tapNext=i,this._tapError=i,this._tapComplete=i,this._tapError=n||i,this._tapComplete=r||i,(0,o.m)(t)?(this._context=this,this._tapNext=t):t&&(this._context=t,this._tapNext=t.next||i,this._tapError=t.error||i,this._tapComplete=t.complete||i)}_next(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}},2570:(e,t,n)=>{"use strict";n.d(t,{r:()=>o});var r=n(8318),i=n(7570);function o(e,t){return new r.y(n=>{const r=new i.w;let o=0;return r.add(t.schedule(function(){o!==e.length?(n.next(e[o++]),n.closed||r.add(this.schedule())):n.complete()})),r})}},8277:(e,t,n)=>{"use strict";n.d(t,{o:()=>o});var r=n(7570);class i extends r.w{constructor(e,t){super()}schedule(e,t=0){return this}}class o extends i{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}requestAsyncId(e,t,n=0){return setInterval(e.flush.bind(e,this),n)}recycleAsyncId(e,t,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let n,r=!1;try{this.work(e)}catch(i){r=!0,n=!!i&&i||new Error(i)}if(r)return this.unsubscribe(),n}_unsubscribe(){const e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}},1098:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});let r=(()=>{class e{constructor(t,n=e.now){this.SchedulerAction=t,this.now=n}schedule(e,t=0,n){return new this.SchedulerAction(this,e).schedule(n,t)}}return e.now=()=>Date.now(),e})();class i extends r{constructor(e,t=r.now){super(e,()=>i.delegate&&i.delegate!==this?i.delegate.now():t()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(e,t=0,n){return i.delegate&&i.delegate!==this?i.delegate.schedule(e,t,n):super.schedule(e,t,n)}flush(e){const{actions:t}=this;if(this.active)return void t.push(e);let n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}},2709:(e,t,n)=>{"use strict";n.d(t,{e:()=>p,E:()=>d});let r=1;const i=(()=>Promise.resolve())(),o={};function s(e){return e in o&&(delete o[e],!0)}const a={setImmediate(e){const t=r++;return o[t]=!0,i.then(()=>s(t)&&e()),t},clearImmediate(e){s(e)}};var c=n(8277);class u extends c.o{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}requestAsyncId(e,t,n=0){return null!==n&&n>0?super.requestAsyncId(e,t,n):(e.actions.push(this),e.scheduled||(e.scheduled=a.setImmediate(e.flush.bind(e,null))))}recycleAsyncId(e,t,n=0){if(null!==n&&n>0||null===n&&this.delay>0)return super.recycleAsyncId(e,t,n);0===e.actions.length&&(a.clearImmediate(t),e.scheduled=void 0)}}var l=n(1098);class h extends l.v{flush(e){this.active=!0,this.scheduled=void 0;const{actions:t}=this;let n,r=-1,i=t.length;e=e||t.shift();do{if(n=e.execute(e.state,e.delay))break}while(++r<i&&(e=t.shift()));if(this.active=!1,n){for(;++r<i&&(e=t.shift());)e.unsubscribe();throw n}}}const d=new h(u),p=d},8569:(e,t,n)=>{"use strict";n.d(t,{z:()=>i,P:()=>o});var r=n(8277);const i=new(n(1098).v)(r.o),o=i},8489:(e,t,n)=>{"use strict";n.d(t,{c:()=>c,N:()=>a});var r=n(8277);class i extends r.o{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,n=0){return null!==n&&n>0||null===n&&this.delay>0?super.requestAsyncId(e,t,n):e.flush(this)}}var o=n(1098);class s extends o.v{}const a=new s(i),c=a},5686:(e,t,n)=>{"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(t,{hZ:()=>i});const i=r()},6197:(e,t,n)=>{"use strict";n.d(t,{L:()=>r});const r=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")()},5331:(e,t,n)=>{"use strict";n.d(t,{b:()=>r});const r=(()=>"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random())()},3895:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});const r=(()=>{function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e})()},4294:(e,t,n)=>{"use strict";function r(e){setTimeout(()=>{throw e},0)}n.d(t,{z:()=>r})},3392:(e,t,n)=>{"use strict";function r(e){return e}n.d(t,{y:()=>r})},8470:(e,t,n)=>{"use strict";n.d(t,{k:()=>r});const r=(()=>Array.isArray||(e=>e&&"number"==typeof e.length))()},9653:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});const r=e=>e&&"number"==typeof e.length&&"function"!=typeof e},5024:(e,t,n)=>{"use strict";function r(e){return"function"==typeof e}n.d(t,{m:()=>r})},2293:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});var r=n(8470);function i(e){return!(0,r.k)(e)&&e-parseFloat(e)+1>=0}},2056:(e,t,n)=>{"use strict";function r(e){return null!==e&&"object"==typeof e}n.d(t,{K:()=>r})},5168:(e,t,n)=>{"use strict";function r(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}n.d(t,{t:()=>r})},6163:(e,t,n)=>{"use strict";function r(e){return e&&"function"==typeof e.schedule}n.d(t,{K:()=>r})},6015:(e,t,n)=>{"use strict";n.d(t,{s:()=>l});var r=n(625),i=n(4294),o=n(5686),s=n(6197),a=n(9653),c=n(5168),u=n(2056);const l=e=>{if(e&&"function"==typeof e[s.L])return l=e,e=>{const t=l[s.L]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if((0,a.z)(e))return(0,r.V)(e);if((0,c.t)(e))return n=e,e=>(n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,i.z),e);if(e&&"function"==typeof e[o.hZ])return t=e,e=>{const n=t[o.hZ]();for(;;){let t;try{t=n.next()}catch(r){return e.error(r),e}if(t.done){e.complete();break}if(e.next(t.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e};{const t=(0,u.K)(e)?"an invalid object":`'${e}'`;throw new TypeError(`You provided ${t} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`)}var t,n,l}},625:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});const r=e=>t=>{for(let n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},8848:(e,t,n)=>{"use strict";var r=n(7368);let i=null;function o(){return i}const s=new r.OlP("DocumentToken");let a=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=(0,r.Yz7)({factory:c,token:e,providedIn:"platform"}),e})();function c(){return(0,r.LFG)(l)}const u=new r.OlP("Location Initialized");let l=(()=>{class e extends a{constructor(e){super(),this._doc=e,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return o().getBaseHref(this._doc)}onPopState(e){const t=o().getGlobalEventTarget(this._doc,"window");return t.addEventListener("popstate",e,!1),()=>t.removeEventListener("popstate",e)}onHashChange(e){const t=o().getGlobalEventTarget(this._doc,"window");return t.addEventListener("hashchange",e,!1),()=>t.removeEventListener("hashchange",e)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(e){this.location.pathname=e}pushState(e,t,n){h()?this._history.pushState(e,t,n):this.location.hash=n}replaceState(e,t,n){h()?this._history.replaceState(e,t,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s))},e.\u0275prov=(0,r.Yz7)({factory:d,token:e,providedIn:"platform"}),e})();function h(){return!!window.history.pushState}function d(){return new l((0,r.LFG)(s))}function p(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function f(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function m(e){return e&&"?"!==e[0]?"?"+e:e}let g=(()=>{class e{historyGo(e){throw new Error("Not implemented")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=(0,r.Yz7)({factory:_,token:e,providedIn:"root"}),e})();function _(e){const t=(0,r.LFG)(s).location;return new y((0,r.LFG)(a),t&&t.origin||"")}const v=new r.OlP("appBaseHref");let y=(()=>{class e extends g{constructor(e,t){if(super(),this._platformLocation=e,this._removeListenerFns=[],null==t&&(t=this._platformLocation.getBaseHrefFromDOM()),null==t)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=t}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return p(this._baseHref,e)}path(e=!1){const t=this._platformLocation.pathname+m(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?`${t}${n}`:t}pushState(e,t,n,r){const i=this.prepareExternalUrl(n+m(r));this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){const i=this.prepareExternalUrl(n+m(r));this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(a),r.LFG(v,8))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),E=(()=>{class e extends g{constructor(e,t){super(),this._platformLocation=e,this._baseHref="",this._removeListenerFns=[],null!=t&&(this._baseHref=t)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}path(e=!1){let t=this._platformLocation.hash;return null==t&&(t="#"),t.length>0?t.substring(1):t}prepareExternalUrl(e){const t=p(this._baseHref,e);return t.length>0?"#"+t:t}pushState(e,t,n,r){let i=this.prepareExternalUrl(n+m(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}replaceState(e,t,n,r){let i=this.prepareExternalUrl(n+m(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformLocation).historyGo)||void 0===n||n.call(t,e)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(a),r.LFG(v,8))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),S=(()=>{class e{constructor(e,t){this._subject=new r.vpe,this._urlChangeListeners=[],this._platformStrategy=e;const n=this._platformStrategy.getBaseHref();this._platformLocation=t,this._baseHref=f(b(n)),this._platformStrategy.onPopState(e=>{this._subject.emit({url:this.path(!0),pop:!0,state:e.state,type:e.type})})}path(e=!1){return this.normalize(this._platformStrategy.path(e))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(e,t=""){return this.path()==this.normalize(e+m(t))}normalize(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,b(t)))}prepareExternalUrl(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}go(e,t="",n=null){this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+m(t)),n)}replaceState(e,t="",n=null){this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+m(t)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(e=0){var t,n;null===(n=(t=this._platformStrategy).historyGo)||void 0===n||n.call(t,e)}onUrlChange(e){this._urlChangeListeners.push(e),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(e=>{this._notifyUrlChangeListeners(e.url,e.state)}))}_notifyUrlChangeListeners(e="",t){this._urlChangeListeners.forEach(n=>n(e,t))}subscribe(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(g),r.LFG(a))},e.normalizeQueryParams=m,e.joinWithSlash=p,e.stripTrailingSlash=f,e.\u0275prov=(0,r.Yz7)({factory:T,token:e,providedIn:"root"}),e})();function T(){return new S((0,r.LFG)(g),(0,r.LFG)(a))}function b(e){return e.replace(/\/index.html$/,"")}var w=function(e){return e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Two=2]="Two",e[e.Few=3]="Few",e[e.Many=4]="Many",e[e.Other=5]="Other",e}({});const R=r.kL8;class I{}let C=(()=>{class e extends I{constructor(e){super(),this.locale=e}getPluralCategory(e,t){switch(R(t||this.locale)(e)){case w.Zero:return"zero";case w.One:return"one";case w.Two:return"two";case w.Few:return"few";case w.Many:return"many";default:return"other"}}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(r.soG))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();function A(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const e=n.indexOf("="),[r,i]=-1==e?[n,""]:[n.slice(0,e),n.slice(e+1)];if(r.trim()===t)return decodeURIComponent(i)}return null}let O=(()=>{class e{constructor(e,t,n,r){this._iterableDiffers=e,this._keyValueDiffers=t,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(e){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof e?e.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(e){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof e?e.split(/\s+/):e,this._rawClass&&((0,r.sIi)(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const e=this._iterableDiffer.diff(this._rawClass);e&&this._applyIterableChanges(e)}else if(this._keyValueDiffer){const e=this._keyValueDiffer.diff(this._rawClass);e&&this._applyKeyValueChanges(e)}}_applyKeyValueChanges(e){e.forEachAddedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachChangedItem(e=>this._toggleClass(e.key,e.currentValue)),e.forEachRemovedItem(e=>{e.previousValue&&this._toggleClass(e.key,!1)})}_applyIterableChanges(e){e.forEachAddedItem(e=>{if("string"!=typeof e.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${(0,r.AaK)(e.item)}`);this._toggleClass(e.item,!0)}),e.forEachRemovedItem(e=>this._toggleClass(e.item,!1))}_applyClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!0)):Object.keys(e).forEach(t=>this._toggleClass(t,!!e[t])))}_removeClasses(e){e&&(Array.isArray(e)||e instanceof Set?e.forEach(e=>this._toggleClass(e,!1)):Object.keys(e).forEach(e=>this._toggleClass(e,!1)))}_toggleClass(e,t){(e=e.trim())&&e.split(/\s+/g).forEach(e=>{t?this._renderer.addClass(this._ngEl.nativeElement,e):this._renderer.removeClass(this._ngEl.nativeElement,e)})}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.ZZ4),r.Y36(r.aQg),r.Y36(r.SBq),r.Y36(r.Qsj))},e.\u0275dir=r.lG2({type:e,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),e})();class N{constructor(e,t,n,r){this.$implicit=e,this.ngForOf=t,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let k=(()=>{class e{constructor(e,t,n){this._viewContainer=e,this._template=t,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;if(!this._differ&&t)try{this._differ=this._differs.find(t).create(this.ngForTrackBy)}catch(Iw){throw new Error(`Cannot find a differ supporting object '${t}' of type '${e=t,e.name||typeof e}'. NgFor only supports binding to Iterables such as Arrays.`)}}var e;if(this._differ){const e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){const t=[];e.forEachOperation((e,n,r)=>{if(null==e.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new N(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new D(e,n);t.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const o=new D(e,i);t.push(o)}});for(let n=0;n<t.length;n++)this._perViewChange(t[n].view,t[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const e=this._viewContainer.get(n);e.context.index=n,e.context.count=r,e.context.ngForOf=this._ngForOf}e.forEachIdentityChange(e=>{this._viewContainer.get(e.currentIndex).context.$implicit=e.item})}_perViewChange(e,t){e.context.$implicit=t.item}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.s_b),r.Y36(r.Rgc),r.Y36(r.ZZ4))},e.\u0275dir=r.lG2({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),e})();class D{constructor(e,t){this.record=e,this.view=t}}let P=(()=>{class e{constructor(e,t){this._viewContainer=e,this._context=new L,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=t}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){x("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){x("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(e,t){return!0}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.s_b),r.Y36(r.Rgc))},e.\u0275dir=r.lG2({type:e,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),e})();class L{constructor(){this.$implicit=null,this.ngIf=null}}function x(e,t){if(t&&!t.createEmbeddedView)throw new Error(`${e} must be a TemplateRef, but received '${(0,r.AaK)(t)}'.`)}class M{constructor(e,t){this._viewContainerRef=e,this._templateRef=t,this._created=!1}create(){this._created=!0,this._viewContainerRef.createEmbeddedView(this._templateRef)}destroy(){this._created=!1,this._viewContainerRef.clear()}enforceState(e){e&&!this._created?this.create():!e&&this._created&&this.destroy()}}let U=(()=>{class e{constructor(){this._defaultUsed=!1,this._caseCount=0,this._lastCaseCheckIndex=0,this._lastCasesMatched=!1}set ngSwitch(e){this._ngSwitch=e,0===this._caseCount&&this._updateDefaultCases(!0)}_addCase(){return this._caseCount++}_addDefault(e){this._defaultViews||(this._defaultViews=[]),this._defaultViews.push(e)}_matchCase(e){const t=e==this._ngSwitch;return this._lastCasesMatched=this._lastCasesMatched||t,this._lastCaseCheckIndex++,this._lastCaseCheckIndex===this._caseCount&&(this._updateDefaultCases(!this._lastCasesMatched),this._lastCaseCheckIndex=0,this._lastCasesMatched=!1),t}_updateDefaultCases(e){if(this._defaultViews&&e!==this._defaultUsed){this._defaultUsed=e;for(let t=0;t<this._defaultViews.length;t++)this._defaultViews[t].enforceState(e)}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=r.lG2({type:e,selectors:[["","ngSwitch",""]],inputs:{ngSwitch:"ngSwitch"}}),e})(),V=(()=>{class e{constructor(e,t,n){this.ngSwitch=n,n._addCase(),this._view=new M(e,t)}ngDoCheck(){this._view.enforceState(this.ngSwitch._matchCase(this.ngSwitchCase))}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.s_b),r.Y36(r.Rgc),r.Y36(U,9))},e.\u0275dir=r.lG2({type:e,selectors:[["","ngSwitchCase",""]],inputs:{ngSwitchCase:"ngSwitchCase"}}),e})(),F=(()=>{class e{constructor(e,t,n){n._addDefault(new M(e,t))}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.s_b),r.Y36(r.Rgc),r.Y36(U,9))},e.\u0275dir=r.lG2({type:e,selectors:[["","ngSwitchDefault",""]]}),e})(),B=(()=>{class e{constructor(e,t,n){this._ngEl=e,this._differs=t,this._renderer=n,this._ngStyle=null,this._differ=null}set ngStyle(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}ngDoCheck(){if(this._differ){const e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}_setStyle(e,t){const[n,r]=e.split(".");null!=(t=null!=t&&r?`${t}${r}`:t)?this._renderer.setStyle(this._ngEl.nativeElement,n,t):this._renderer.removeStyle(this._ngEl.nativeElement,n)}_applyChanges(e){e.forEachRemovedItem(e=>this._setStyle(e.key,null)),e.forEachAddedItem(e=>this._setStyle(e.key,e.currentValue)),e.forEachChangedItem(e=>this._setStyle(e.key,e.currentValue))}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq),r.Y36(r.aQg),r.Y36(r.Qsj))},e.\u0275dir=r.lG2({type:e,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),e})();class j{createSubscription(e,t){return e.subscribe({next:t,error:e=>{throw e}})}dispose(e){e.unsubscribe()}onDestroy(e){e.unsubscribe()}}class G{createSubscription(e,t){return e.then(t,e=>{throw e})}dispose(e){}onDestroy(e){}}const q=new G,H=new j;let W=(()=>{class e{constructor(e){this._ref=e,this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null}ngOnDestroy(){this._subscription&&this._dispose()}transform(e){return this._obj?e!==this._obj?(this._dispose(),this.transform(e)):this._latestValue:(e&&this._subscribe(e),this._latestValue)}_subscribe(e){this._obj=e,this._strategy=this._selectStrategy(e),this._subscription=this._strategy.createSubscription(e,t=>this._updateLatestValue(e,t))}_selectStrategy(t){if((0,r.QGY)(t))return q;if((0,r.F4k)(t))return H;throw Error(`InvalidPipeArgument: '${t}' for pipe '${(0,r.AaK)(e)}'`)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(e,t){e===this._obj&&(this._latestValue=t,this._ref.markForCheck())}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.sBO,16))},e.\u0275pipe=r.Yjl({name:"async",type:e,pure:!1}),e})(),z=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:[{provide:I,useClass:C}]}),e})();function K(e){return"server"===e}let Y=(()=>{class e{}return e.\u0275prov=(0,r.Yz7)({token:e,providedIn:"root",factory:()=>new Q((0,r.LFG)(s),window)}),e})();class Q{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const n=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let r=n.currentNode;for(;r;){const e=r.shadowRoot;if(e){const n=e.getElementById(t)||e.querySelector(`[name="${t}"]`);if(n)return n}r=n.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),this.attemptFocus(t))}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}attemptFocus(e){return e.focus(),this.document.activeElement===e}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=J(this.window.history)||J(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(Iw){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(Iw){return!1}}}function J(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class X{}class $ extends class extends class{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){var e;e=new $,i||(i=e)}onAndCancel(e,t,n){return e.addEventListener(t,n,!1),()=>{e.removeEventListener(t,n,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=(ee=ee||document.querySelector("base"),ee?ee.getAttribute("href"):null);return null==t?null:function(e){Z=Z||document.createElement("a"),Z.setAttribute("href",e);const t=Z.pathname;return"/"===t.charAt(0)?t:`/${t}`}(t)}resetBaseElement(){ee=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return A(document.cookie,e)}}let Z,ee=null;const te=new r.OlP("TRANSITION_ID"),ne=[{provide:r.ip1,useFactory:function(e,t,n){return()=>{n.get(r.CZH).donePromise.then(()=>{const n=o();Array.prototype.slice.apply(t.querySelectorAll("style[ng-transition]")).filter(t=>t.getAttribute("ng-transition")===e).forEach(e=>n.remove(e))})}},deps:[te,s,r.zs3],multi:!0}];class re{static init(){(0,r.VLi)(new re)}addToWindow(e){r.dqk.getAngularTestability=(t,n=!0)=>{const r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},r.dqk.getAllAngularTestabilities=()=>e.getAllTestabilities(),r.dqk.getAllAngularRootElements=()=>e.getAllRootElements(),r.dqk.frameworkStabilizers||(r.dqk.frameworkStabilizers=[]),r.dqk.frameworkStabilizers.push(e=>{const t=r.dqk.getAllAngularTestabilities();let n=t.length,i=!1;const o=function(t){i=i||t,n--,0==n&&e(i)};t.forEach(function(e){e.whenStable(o)})})}findTestabilityInTree(e,t,n){if(null==t)return null;const r=e.getTestability(t);return null!=r?r:n?o().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let ie=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();const oe=new r.OlP("EventManagerPlugins");let se=(()=>{class e{constructor(e,t){this._zone=t,this._eventNameToPlugin=new Map,e.forEach(e=>e.manager=this),this._plugins=e.slice().reverse()}addEventListener(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}addGlobalEventListener(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}getZone(){return this._zone}_findPluginFor(e){const t=this._eventNameToPlugin.get(e);if(t)return t;const n=this._plugins;for(let r=0;r<n.length;r++){const t=n[r];if(t.supports(e))return this._eventNameToPlugin.set(e,t),t}throw new Error(`No event manager plugin found for event ${e}`)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(oe),r.LFG(r.R0b))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();class ae{constructor(e){this._doc=e}addGlobalEventListener(e,t,n){const r=o().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,n)}}let ce=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(e){const t=new Set;e.forEach(e=>{this._stylesSet.has(e)||(this._stylesSet.add(e),t.add(e))}),this.onStylesAdded(t)}onStylesAdded(e){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),ue=(()=>{class e extends ce{constructor(e){super(),this._doc=e,this._hostNodes=new Map,this._hostNodes.set(e.head,[])}_addStylesToHost(e,t,n){e.forEach(e=>{const r=this._doc.createElement("style");r.textContent=e,n.push(t.appendChild(r))})}addHost(e){const t=[];this._addStylesToHost(this._stylesSet,e,t),this._hostNodes.set(e,t)}removeHost(e){const t=this._hostNodes.get(e);t&&t.forEach(le),this._hostNodes.delete(e)}onStylesAdded(e){this._hostNodes.forEach((t,n)=>{this._addStylesToHost(e,n,t)})}ngOnDestroy(){this._hostNodes.forEach(e=>e.forEach(le))}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();function le(e){o().remove(e)}const he={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},de=/%COMP%/g;function pe(e,t,n){for(let r=0;r<t.length;r++){let i=t[r];Array.isArray(i)?pe(e,i,n):(i=i.replace(de,e),n.push(i))}return n}function fe(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let me=(()=>{class e{constructor(e,t,n){this.eventManager=e,this.sharedStylesHost=t,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new ge(e)}createRenderer(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case r.ifc.Emulated:{let n=this.rendererByCompId.get(t.id);return n||(n=new _e(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n}case 1:case r.ifc.ShadowDom:return new ve(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){const e=pe(t.id,t.styles,[]);this.sharedStylesHost.addStyles(e),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(se),r.LFG(ue),r.LFG(r.AFp))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();class ge{constructor(e){this.eventManager=e,this.data=Object.create(null)}destroy(){}createElement(e,t){return t?document.createElementNS(he[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,n){e&&e.insertBefore(t,n)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error(`The selector "${e}" did not match any elements`);return t||(n.textContent=""),n}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,n,r){if(r){t=r+":"+t;const i=he[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}removeAttribute(e,t,n){if(n){const r=he[n];r?e.removeAttributeNS(r,t):e.removeAttribute(`${n}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,n,i){i&(r.JOm.DashCase|r.JOm.Important)?e.style.setProperty(t,n,i&r.JOm.Important?"important":""):e.style[t]=n}removeStyle(e,t,n){n&r.JOm.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,n){e[t]=n}setValue(e,t){e.nodeValue=t}listen(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,fe(n)):this.eventManager.addEventListener(e,t,fe(n))}}class _e extends ge{constructor(e,t,n,r){super(e),this.component=n;const i=pe(r+"-"+n.id,n.styles,[]);t.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(de,r+"-"+n.id),this.hostAttr="_nghost-%COMP%".replace(de,r+"-"+n.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const n=super.createElement(e,t);return super.setAttribute(n,this.contentAttr,""),n}}class ve extends ge{constructor(e,t,n,r){super(e),this.sharedStylesHost=t,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=pe(r.id,r.styles,[]);for(let o=0;o<i.length;o++){const e=document.createElement("style");e.textContent=i[o],this.shadowRoot.appendChild(e)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,n){return super.insertBefore(this.nodeOrShadowRoot(e),t,n)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let ye=(()=>{class e extends ae{constructor(e){super(e)}supports(e){return!0}addEventListener(e,t,n){return e.addEventListener(t,n,!1),()=>this.removeEventListener(e,t,n)}removeEventListener(e,t,n){return e.removeEventListener(t,n)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();const Ee=["alt","control","meta","shift"],Se={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Te={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},be={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let we=(()=>{class e extends ae{constructor(e){super(e)}supports(t){return null!=e.parseEventName(t)}addEventListener(t,n,r){const i=e.parseEventName(n),s=e.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>o().onAndCancel(t,i.domEventName,s))}static parseEventName(t){const n=t.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=e._normalizeKey(n.pop());let o="";if(Ee.forEach(e=>{const t=n.indexOf(e);t>-1&&(n.splice(t,1),o+=e+".")}),o+=i,0!=n.length||0===i.length)return null;const s={};return s.domEventName=r,s.fullKey=o,s}static getEventFullKey(e){let t="",n=function(e){let t=e.key;if(null==t){if(t=e.keyIdentifier,null==t)return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Te.hasOwnProperty(t)&&(t=Te[t]))}return Se[t]||t}(e);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),Ee.forEach(r=>{r!=n&&(0,be[r])(e)&&(t+=r+".")}),t+=n,t}static eventCallback(t,n,r){return i=>{e.getEventFullKey(i)===t&&r.runGuarded(()=>n(i))}}static _normalizeKey(e){switch(e){case"esc":return"escape";default:return e}}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),Re=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=(0,r.Yz7)({factory:function(){return(0,r.LFG)(Ce)},token:e,providedIn:"root"}),e})();function Ie(e){return new Ce(e.get(s))}let Ce=(()=>{class e extends Re{constructor(e){super(),this._doc=e}sanitize(e,t){if(null==t)return null;switch(e){case r.q3G.NONE:return t;case r.q3G.HTML:return(0,r.qzn)(t,"HTML")?(0,r.z3N)(t):(0,r.EiD)(this._doc,String(t)).toString();case r.q3G.STYLE:return(0,r.qzn)(t,"Style")?(0,r.z3N)(t):t;case r.q3G.SCRIPT:if((0,r.qzn)(t,"Script"))return(0,r.z3N)(t);throw new Error("unsafe value used in a script context");case r.q3G.URL:return(0,r.yhl)(t),(0,r.qzn)(t,"URL")?(0,r.z3N)(t):(0,r.mCW)(String(t));case r.q3G.RESOURCE_URL:if((0,r.qzn)(t,"ResourceURL"))return(0,r.z3N)(t);throw new Error("unsafe value used in a resource URL context (see https://g.co/ng/security#xss)");default:throw new Error(`Unexpected SecurityContext ${e} (see https://g.co/ng/security#xss)`)}}bypassSecurityTrustHtml(e){return(0,r.JVY)(e)}bypassSecurityTrustStyle(e){return(0,r.L6k)(e)}bypassSecurityTrustScript(e){return(0,r.eBb)(e)}bypassSecurityTrustUrl(e){return(0,r.LAX)(e)}bypassSecurityTrustResourceUrl(e){return(0,r.pB0)(e)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s))},e.\u0275prov=(0,r.Yz7)({factory:function(){return Ie((0,r.LFG)(r.gxx))},token:e,providedIn:"root"}),e})();const Ae=(0,r.eFA)(r._c5,"browser",[{provide:r.Lbi,useValue:"browser"},{provide:r.g9A,useValue:function(){$.makeCurrent(),re.init()},multi:!0},{provide:s,useFactory:function(){return(0,r.RDi)(document),document},deps:[]}]),Oe=[[],{provide:r.zSh,useValue:"root"},{provide:r.qLn,useFactory:function(){return new r.qLn},deps:[]},{provide:oe,useClass:ye,multi:!0,deps:[s,r.R0b,r.Lbi]},{provide:oe,useClass:we,multi:!0,deps:[s]},[],{provide:me,useClass:me,deps:[se,ue,r.AFp]},{provide:r.FYo,useExisting:me},{provide:ce,useExisting:ue},{provide:ue,useClass:ue,deps:[s]},{provide:r.dDg,useClass:r.dDg,deps:[r.R0b]},{provide:se,useClass:se,deps:[oe,r.R0b]},{provide:X,useClass:ie,deps:[]},[]];let Ne=(()=>{class e{constructor(e){if(e)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:e,providers:[{provide:r.AFp,useValue:t.appId},{provide:te,useExisting:r.AFp},ne]}}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(e,12))},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:Oe,imports:[z,r.hGG]}),e})();"undefined"!=typeof window&&window;var ke=n(878),De=n(8318),Pe=n(3982);function Le(e,t){return(0,Pe.zg)(e,t,1)}var xe=n(6673);function Me(e,t){return function(n){return n.lift(new Ue(e,t))}}class Ue{constructor(e,t){this.predicate=e,this.thisArg=t}call(e,t){return t.subscribe(new Ve(e,this.predicate,this.thisArg))}}class Ve extends xe.L{constructor(e,t,n){super(e),this.predicate=t,this.thisArg=n,this.count=0}_next(e){let t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}var Fe=n(9996);class Be{}class je{}class Ge{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(e=>{const t=e.indexOf(":");if(t>0){const n=e.slice(0,t),r=n.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(i):this.headers.set(r,[i])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(t=>{let n=e[t];const r=t.toLowerCase();"string"==typeof n&&(n=[n]),n.length>0&&(this.headers.set(r,n),this.maybeSetNormalizedName(t,r))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof Ge?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){const t=new Ge;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof Ge?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){const t=e.name.toLowerCase();switch(e.op){case"a":case"s":let n=e.value;if("string"==typeof n&&(n=[n]),0===n.length)return;this.maybeSetNormalizedName(e.name,t);const r=("a"===e.op?this.headers.get(t):void 0)||[];r.push(...n),this.headers.set(t,r);break;case"d":const i=e.value;if(i){let e=this.headers.get(t);if(!e)return;e=e.filter(e=>-1===i.indexOf(e)),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}}class qe{encodeKey(e){return He(e)}encodeValue(e){return He(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}function He(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}function We(e){return`${e}`}class ze{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new qe,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(e,t){const n=new Map;return e.length>0&&e.replace(/^\?/,"").split("&").forEach(e=>{const r=e.indexOf("="),[i,o]=-1==r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],s=n.get(i)||[];s.push(o),n.set(i,s)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{const n=e.fromObject[t];this.map.set(t,Array.isArray(n)?n:[n])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){const t=[];return Object.keys(e).forEach(n=>{const r=e[n];Array.isArray(r)?r.forEach(e=>{t.push({param:n,value:e,op:"a"})}):t.push({param:n,value:r,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map(e=>t+"="+this.encoder.encodeValue(e)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const t=new ze({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const t=("a"===e.op?this.map.get(e.param):void 0)||[];t.push(We(e.value)),this.map.set(e.param,t);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let t=this.map.get(e.param)||[];const n=t.indexOf(We(e.value));-1!==n&&t.splice(n,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class Ke{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}keys(){return this.map.keys()}}function Ye(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function Qe(e){return"undefined"!=typeof Blob&&e instanceof Blob}function Je(e){return"undefined"!=typeof FormData&&e instanceof FormData}class Xe{constructor(e,t,n,r){let i;if(this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||r?(this.body=void 0!==n?n:null,i=r):i=n,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params)),this.headers||(this.headers=new Ge),this.context||(this.context=new Ke),this.params){const e=this.params.toString();if(0===e.length)this.urlWithParams=t;else{const n=t.indexOf("?");this.urlWithParams=t+(-1===n?"?":n<t.length-1?"&":"")+e}}else this.params=new ze,this.urlWithParams=t}serializeBody(){return null===this.body?null:Ye(this.body)||Qe(this.body)||Je(this.body)||"string"==typeof this.body?this.body:this.body instanceof ze?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Je(this.body)?null:Qe(this.body)?this.body.type||null:Ye(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof ze?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var t;const n=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,o=void 0!==e.body?e.body:this.body,s=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,a=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let c=e.headers||this.headers,u=e.params||this.params;const l=null!==(t=e.context)&&void 0!==t?t:this.context;return void 0!==e.setHeaders&&(c=Object.keys(e.setHeaders).reduce((t,n)=>t.set(n,e.setHeaders[n]),c)),e.setParams&&(u=Object.keys(e.setParams).reduce((t,n)=>t.set(n,e.setParams[n]),u)),new Xe(n,r,o,{params:u,headers:c,context:l,reportProgress:a,responseType:i,withCredentials:s})}}var $e=function(e){return e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e}({});class Ze{constructor(e,t=200,n="OK"){this.headers=e.headers||new Ge,this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText||n,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class et extends Ze{constructor(e={}){super(e),this.type=$e.ResponseHeader}clone(e={}){return new et({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class tt extends Ze{constructor(e={}){super(e),this.type=$e.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new tt({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class nt extends Ze{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function rt(e,t){return{body:t,headers:e.headers,context:e.context,observe:e.observe,params:e.params,reportProgress:e.reportProgress,responseType:e.responseType,withCredentials:e.withCredentials}}let it=(()=>{class e{constructor(e){this.handler=e}request(e,t,n={}){let r;if(e instanceof Xe)r=e;else{let i,o;i=n.headers instanceof Ge?n.headers:new Ge(n.headers),n.params&&(o=n.params instanceof ze?n.params:new ze({fromObject:n.params})),r=new Xe(e,t,void 0!==n.body?n.body:null,{headers:i,context:n.context,params:o,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}const i=(0,ke.of)(r).pipe(Le(e=>this.handler.handle(e)));if(e instanceof Xe||"events"===n.observe)return i;const o=i.pipe(Me(e=>e instanceof tt));switch(n.observe||"body"){case"body":switch(r.responseType){case"arraybuffer":return o.pipe((0,Fe.U)(e=>{if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body}));case"blob":return o.pipe((0,Fe.U)(e=>{if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body}));case"text":return o.pipe((0,Fe.U)(e=>{if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body}));case"json":default:return o.pipe((0,Fe.U)(e=>e.body))}case"response":return o;default:throw new Error(`Unreachable: unhandled observe type ${n.observe}}`)}}delete(e,t={}){return this.request("DELETE",e,t)}get(e,t={}){return this.request("GET",e,t)}head(e,t={}){return this.request("HEAD",e,t)}jsonp(e,t){return this.request("JSONP",e,{params:(new ze).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,t={}){return this.request("OPTIONS",e,t)}patch(e,t,n={}){return this.request("PATCH",e,rt(n,t))}post(e,t,n={}){return this.request("POST",e,rt(n,t))}put(e,t,n={}){return this.request("PUT",e,rt(n,t))}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(Be))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();class ot{constructor(e,t){this.next=e,this.interceptor=t}handle(e){return this.interceptor.intercept(e,this.next)}}const st=new r.OlP("HTTP_INTERCEPTORS");let at=(()=>{class e{intercept(e,t){return t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();const ct=/^\)\]\}',?\n/;let ut=(()=>{class e{constructor(e){this.xhrFactory=e}handle(e){if("JSONP"===e.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new De.y(t=>{const n=this.xhrFactory.build();if(n.open(e.method,e.urlWithParams),e.withCredentials&&(n.withCredentials=!0),e.headers.forEach((e,t)=>n.setRequestHeader(e,t.join(","))),e.headers.has("Accept")||n.setRequestHeader("Accept","application/json, text/plain, */*"),!e.headers.has("Content-Type")){const t=e.detectContentTypeHeader();null!==t&&n.setRequestHeader("Content-Type",t)}if(e.responseType){const t=e.responseType.toLowerCase();n.responseType="json"!==t?t:"text"}const r=e.serializeBody();let i=null;const o=()=>{if(null!==i)return i;const t=1223===n.status?204:n.status,r=n.statusText||"OK",o=new Ge(n.getAllResponseHeaders()),s=function(e){return"responseURL"in e&&e.responseURL?e.responseURL:/^X-Request-URL:/m.test(e.getAllResponseHeaders())?e.getResponseHeader("X-Request-URL"):null}(n)||e.url;return i=new et({headers:o,status:t,statusText:r,url:s}),i},s=()=>{let{headers:r,status:i,statusText:s,url:a}=o(),c=null;204!==i&&(c=void 0===n.response?n.responseText:n.response),0===i&&(i=c?200:0);let u=i>=200&&i<300;if("json"===e.responseType&&"string"==typeof c){const e=c;c=c.replace(ct,"");try{c=""!==c?JSON.parse(c):null}catch(l){c=e,u&&(u=!1,c={error:l,text:c})}}u?(t.next(new tt({body:c,headers:r,status:i,statusText:s,url:a||void 0})),t.complete()):t.error(new nt({error:c,headers:r,status:i,statusText:s,url:a||void 0}))},a=e=>{const{url:r}=o(),i=new nt({error:e,status:n.status||0,statusText:n.statusText||"Unknown Error",url:r||void 0});t.error(i)};let c=!1;const u=r=>{c||(t.next(o()),c=!0);let i={type:$e.DownloadProgress,loaded:r.loaded};r.lengthComputable&&(i.total=r.total),"text"===e.responseType&&n.responseText&&(i.partialText=n.responseText),t.next(i)},l=e=>{let n={type:$e.UploadProgress,loaded:e.loaded};e.lengthComputable&&(n.total=e.total),t.next(n)};return n.addEventListener("load",s),n.addEventListener("error",a),n.addEventListener("timeout",a),n.addEventListener("abort",a),e.reportProgress&&(n.addEventListener("progress",u),null!==r&&n.upload&&n.upload.addEventListener("progress",l)),n.send(r),t.next({type:$e.Sent}),()=>{n.removeEventListener("error",a),n.removeEventListener("abort",a),n.removeEventListener("load",s),n.removeEventListener("timeout",a),e.reportProgress&&(n.removeEventListener("progress",u),null!==r&&n.upload&&n.upload.removeEventListener("progress",l)),n.readyState!==n.DONE&&n.abort()}})}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(X))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();const lt=new r.OlP("XSRF_COOKIE_NAME"),ht=new r.OlP("XSRF_HEADER_NAME");class dt{}let pt=(()=>{class e{constructor(e,t,n){this.doc=e,this.platform=t,this.cookieName=n,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=A(e,this.cookieName),this.lastCookieString=e),this.lastToken}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s),r.LFG(r.Lbi),r.LFG(lt))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),ft=(()=>{class e{constructor(e,t){this.tokenService=e,this.headerName=t}intercept(e,t){const n=e.url.toLowerCase();if("GET"===e.method||"HEAD"===e.method||n.startsWith("http://")||n.startsWith("https://"))return t.handle(e);const r=this.tokenService.getToken();return null===r||e.headers.has(this.headerName)||(e=e.clone({headers:e.headers.set(this.headerName,r)})),t.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(dt),r.LFG(ht))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),mt=(()=>{class e{constructor(e,t){this.backend=e,this.injector=t,this.chain=null}handle(e){if(null===this.chain){const e=this.injector.get(st,[]);this.chain=e.reduceRight((e,t)=>new ot(e,t),this.backend)}return this.chain.handle(e)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(je),r.LFG(r.zs3))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),gt=(()=>{class e{static disable(){return{ngModule:e,providers:[{provide:ft,useClass:at}]}}static withOptions(t={}){return{ngModule:e,providers:[t.cookieName?{provide:lt,useValue:t.cookieName}:[],t.headerName?{provide:ht,useValue:t.headerName}:[]]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:[ft,{provide:st,useExisting:ft,multi:!0},{provide:dt,useClass:pt},{provide:lt,useValue:"XSRF-TOKEN"},{provide:ht,useValue:"X-XSRF-TOKEN"}]}),e})(),_t=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:[it,{provide:Be,useClass:mt},ut,{provide:je,useExisting:ut}],imports:[[gt.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),e})();class vt{}const yt="*";function Et(e,t){return{type:7,name:e,definitions:t,options:{}}}function St(e,t=null){return{type:4,styles:t,timings:e}}function Tt(e,t=null){return{type:2,steps:e,options:t}}function bt(e){return{type:6,styles:e,offset:null}}function wt(e,t,n){return{type:0,name:e,styles:t,options:n}}function Rt(e,t,n=null){return{type:1,expr:e,animation:t,options:n}}function It(e=null){return{type:9,options:e}}function Ct(e,t,n=null){return{type:11,selector:e,animation:t,options:n}}function At(e){Promise.resolve(null).then(e)}class Ot{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){At(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class Nt{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,n=0,r=0;const i=this.players.length;0==i?At(()=>this._onFinish()):this.players.forEach(e=>{e.onDone(()=>{++t==i&&this._onFinish()}),e.onDestroy(()=>{++n==i&&this._onDestroy()}),e.onStart(()=>{++r==i&&this._onStart()})}),this.totalTime=this.players.reduce((e,t)=>Math.max(e,t.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(e=>{const n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)})}getPosition(){const e=this.players.reduce((e,t)=>null===e||t.totalTime>e.totalTime?t:e,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}function kt(){return"undefined"!=typeof window&&void 0!==window.document}function Dt(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Pt(e){switch(e.length){case 0:return new Ot;case 1:return e[0];default:return new Nt(e)}}function Lt(e,t,n,r,i={},o={}){const s=[],a=[];let c=-1,u=null;if(r.forEach(e=>{const n=e.offset,r=n==c,l=r&&u||{};Object.keys(e).forEach(n=>{let r=n,a=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,s),a){case"!":a=i[n];break;case yt:a=o[n];break;default:a=t.normalizeStyleValue(n,r,a,s)}l[r]=a}),r||a.push(l),u=l,c=n}),s.length){const e="\n - ";throw new Error(`Unable to animate due to the following errors:${e}${s.join(e)}`)}return a}function xt(e,t,n,r){switch(t){case"start":e.onStart(()=>r(n&&Mt(n,"start",e)));break;case"done":e.onDone(()=>r(n&&Mt(n,"done",e)));break;case"destroy":e.onDestroy(()=>r(n&&Mt(n,"destroy",e)))}}function Mt(e,t,n){const r=n.totalTime,i=Ut(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,null==r?e.totalTime:r,!!n.disabled),o=e._data;return null!=o&&(i._data=o),i}function Ut(e,t,n,r,i="",o=0,s){return{element:e,triggerName:t,fromState:n,toState:r,phaseName:i,totalTime:o,disabled:!!s}}function Vt(e,t,n){let r;return e instanceof Map?(r=e.get(t),r||e.set(t,r=n)):(r=e[t],r||(r=e[t]=n)),r}function Ft(e){const t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}let Bt=(e,t)=>!1,jt=(e,t)=>!1,Gt=(e,t,n)=>[];const qt=Dt();(qt||"undefined"!=typeof Element)&&(Bt=kt()?(e,t)=>{for(;t&&t!==document.documentElement;){if(t===e)return!0;t=t.parentNode||t.host}return!1}:(e,t)=>e.contains(t),jt=(()=>{if(qt||Element.prototype.matches)return(e,t)=>e.matches(t);{const e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?(e,n)=>t.apply(e,[n]):jt}})(),Gt=(e,t,n)=>{let r=[];if(n){const n=e.querySelectorAll(t);for(let e=0;e<n.length;e++)r.push(n[e])}else{const n=e.querySelector(t);n&&r.push(n)}return r});let Ht=null,Wt=!1;function zt(e){Ht||(Ht=("undefined"!=typeof document?document.body:null)||{},Wt=!!Ht.style&&"WebkitAppearance"in Ht.style);let t=!0;return Ht.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(t=e in Ht.style,!t&&Wt)&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in Ht.style),t}const Kt=jt,Yt=Bt,Qt=Gt;function Jt(e){const t={};return Object.keys(e).forEach(n=>{const r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]}),t}let Xt=(()=>{class e{validateStyleProperty(e){return zt(e)}matchesElement(e,t){return Kt(e,t)}containsElement(e,t){return Yt(e,t)}query(e,t,n){return Qt(e,t,n)}computeStyle(e,t,n){return n||""}animate(e,t,n,r,i,o=[],s){return new Ot(n,r)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),$t=(()=>{class e{}return e.NOOP=new Xt,e})();const Zt="ng-enter",en="ng-leave",tn="ng-trigger",nn=".ng-trigger",rn="ng-animating",on=".ng-animating";function sn(e){if("number"==typeof e)return e;const t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:an(parseFloat(t[1]),t[2])}function an(e,t){switch(t){case"s":return 1e3*e;default:return e}}function cn(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){let r,i=0,o="";if("string"==typeof e){const n=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===n)return t.push(`The provided timing value "${e}" is invalid.`),{duration:0,delay:0,easing:""};r=an(parseFloat(n[1]),n[2]);const s=n[3];null!=s&&(i=an(parseFloat(s),n[4]));const a=n[5];a&&(o=a)}else r=e;if(!n){let n=!1,o=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),n=!0),i<0&&(t.push("Delay values below 0 are not allowed for this animation step."),n=!0),n&&t.splice(o,0,`The provided timing value "${e}" is invalid.`)}return{duration:r,delay:i,easing:o}}(e,t,n)}function un(e,t={}){return Object.keys(e).forEach(n=>{t[n]=e[n]}),t}function ln(e,t,n={}){if(t)for(let r in e)n[r]=e[r];else un(e,n);return n}function hn(e,t,n){return n?t+":"+n+";":""}function dn(e){let t="";for(let n=0;n<e.style.length;n++){const r=e.style.item(n);t+=hn(0,r,e.style.getPropertyValue(r))}for(const n in e.style)e.style.hasOwnProperty(n)&&!n.startsWith("_")&&(t+=hn(0,n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e.style[n]));e.setAttribute("style",t)}function pn(e,t,n){e.style&&(Object.keys(t).forEach(r=>{const i=Sn(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[i]),e.style[i]=t[r]}),Dt()&&dn(e))}function fn(e,t){e.style&&(Object.keys(t).forEach(t=>{const n=Sn(t);e.style[n]=""}),Dt()&&dn(e))}function mn(e){return Array.isArray(e)?1==e.length?e[0]:Tt(e):e}const gn=new RegExp("{{\\s*(.+?)\\s*}}","g");function _n(e){let t=[];if("string"==typeof e){let n;for(;n=gn.exec(e);)t.push(n[1]);gn.lastIndex=0}return t}function vn(e,t,n){const r=e.toString(),i=r.replace(gn,(e,r)=>{let i=t[r];return t.hasOwnProperty(r)||(n.push(`Please provide a value for the animation param ${r}`),i=""),i.toString()});return i==r?e:i}function yn(e){const t=[];let n=e.next();for(;!n.done;)t.push(n.value),n=e.next();return t}const En=/-+([a-z0-9])/g;function Sn(e){return e.replace(En,(...e)=>e[1].toUpperCase())}function Tn(e,t){return 0===e||0===t}function bn(e,t,n){const r=Object.keys(n);if(r.length&&t.length){let o=t[0],s=[];if(r.forEach(e=>{o.hasOwnProperty(e)||s.push(e),o[e]=n[e]}),s.length)for(var i=1;i<t.length;i++){let n=t[i];s.forEach(function(t){n[t]=Rn(e,t)})}}return t}function wn(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error(`Unable to resolve animation metadata node #${t.type}`)}}function Rn(e,t){return window.getComputedStyle(e)[t]}const In="*";function Cn(e,t){const n=[];return"string"==typeof e?e.split(/\s*,\s*/).forEach(e=>function(e,t,n){if(":"==e[0]){const r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(e,t)=>parseFloat(t)>parseFloat(e);case":decrement":return(e,t)=>parseFloat(t)<parseFloat(e);default:return t.push(`The transition alias value "${e}" is not supported`),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}const r=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==r||r.length<4)return n.push(`The provided transition expression "${e}" is not supported`),t;const i=r[1],o=r[2],s=r[3];t.push(Nn(i,s)),"<"!=o[0]||i==In&&s==In||t.push(Nn(s,i))}(e,n,t)):n.push(e),n}const An=new Set(["true","1"]),On=new Set(["false","0"]);function Nn(e,t){const n=An.has(e)||On.has(e),r=An.has(t)||On.has(t);return(i,o)=>{let s=e==In||e==i,a=t==In||t==o;return!s&&n&&"boolean"==typeof i&&(s=i?An.has(e):On.has(e)),!a&&r&&"boolean"==typeof o&&(a=o?An.has(t):On.has(t)),s&&a}}const kn=new RegExp("s*:selfs*,?","g");function Dn(e,t,n){return new Pn(e).build(t,n)}class Pn{constructor(e){this._driver=e}build(e,t){const n=new Ln(t);return this._resetContextStyleTimingState(n),wn(this,mn(e),n)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}visitTrigger(e,t){let n=t.queryCount=0,r=t.depCount=0;const i=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach(e=>{if(this._resetContextStyleTimingState(t),0==e.type){const n=e,r=n.name;r.toString().split(/\s*,\s*/).forEach(e=>{n.name=e,i.push(this.visitState(n,t))}),n.name=r}else if(1==e.type){const i=this.visitTransition(e,t);n+=i.queryCount,r+=i.depCount,o.push(i)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:e.name,states:i,transitions:o,queryCount:n,depCount:r,options:null}}visitState(e,t){const n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){const i=new Set,o=r||{};if(n.styles.forEach(e=>{if(xn(e)){const t=e;Object.keys(t).forEach(e=>{_n(t[e]).forEach(e=>{o.hasOwnProperty(e)||i.add(e)})})}}),i.size){const n=yn(i.values());t.errors.push(`state("${e.name}", ...) must define default values for all the following style substitutions: ${n.join(", ")}`)}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const n=wn(this,mn(e.animation),t);return{type:1,matchers:Cn(e.expr,t.errors),animation:n,queryCount:t.queryCount,depCount:t.depCount,options:Mn(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(e=>wn(this,e,t)),options:Mn(e.options)}}visitGroup(e,t){const n=t.currentTime;let r=0;const i=e.steps.map(e=>{t.currentTime=n;const i=wn(this,e,t);return r=Math.max(r,t.currentTime),i});return t.currentTime=r,{type:3,steps:i,options:Mn(e.options)}}visitAnimate(e,t){const n=function(e,t){let n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return Un(cn(e,t).duration,0,"");const r=e;if(r.split(/\s+/).some(e=>"{"==e.charAt(0)&&"{"==e.charAt(1))){const e=Un(0,0,"");return e.dynamic=!0,e.strValue=r,e}return n=n||cn(r,t),Un(n.duration,n.delay,n.easing)}(e.timings,t.errors);let r;t.currentAnimateTimings=n;let i=e.styles?e.styles:bt({});if(5==i.type)r=this.visitKeyframes(i,t);else{let i=e.styles,o=!1;if(!i){o=!0;const e={};n.easing&&(e.easing=n.easing),i=bt(e)}t.currentTime+=n.duration+n.delay;const s=this.visitStyle(i,t);s.isEmptyStep=o,r=s}return t.currentAnimateTimings=null,{type:4,timings:n,style:r,options:null}}visitStyle(e,t){const n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}_makeStyleAst(e,t){const n=[];Array.isArray(e.styles)?e.styles.forEach(e=>{"string"==typeof e?e==yt?n.push(e):t.errors.push(`The provided style string value ${e} is not allowed.`):n.push(e)}):n.push(e.styles);let r=!1,i=null;return n.forEach(e=>{if(xn(e)){const t=e,n=t.easing;if(n&&(i=n,delete t.easing),!r)for(let e in t)if(t[e].toString().indexOf("{{")>=0){r=!0;break}}}),{type:6,styles:n,easing:i,offset:e.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(e,t){const n=t.currentAnimateTimings;let r=t.currentTime,i=t.currentTime;n&&i>0&&(i-=n.duration+n.delay),e.styles.forEach(e=>{"string"!=typeof e&&Object.keys(e).forEach(n=>{if(!this._driver.validateStyleProperty(n))return void t.errors.push(`The provided animation property "${n}" is not a supported CSS property for animations`);const o=t.collectedStyles[t.currentQuerySelector],s=o[n];let a=!0;s&&(i!=r&&i>=s.startTime&&r<=s.endTime&&(t.errors.push(`The CSS property "${n}" that exists between the times of "${s.startTime}ms" and "${s.endTime}ms" is also being animated in a parallel animation between the times of "${i}ms" and "${r}ms"`),a=!1),i=s.startTime),a&&(o[n]={startTime:i,endTime:r}),t.options&&function(e,t,n){const r=t.params||{},i=_n(e);i.length&&i.forEach(e=>{r.hasOwnProperty(e)||n.push(`Unable to resolve the local animation param ${e} in the given list of values`)})}(e[n],t.options,t.errors)})})}visitKeyframes(e,t){const n={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),n;let r=0;const i=[];let o=!1,s=!1,a=0;const c=e.steps.map(e=>{const n=this._makeStyleAst(e,t);let c=null!=n.offset?n.offset:function(e){if("string"==typeof e)return null;let t=null;if(Array.isArray(e))e.forEach(e=>{if(xn(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}});else if(xn(e)&&e.hasOwnProperty("offset")){const n=e;t=parseFloat(n.offset),delete n.offset}return t}(n.styles),u=0;return null!=c&&(r++,u=n.offset=c),s=s||u<0||u>1,o=o||u<a,a=u,i.push(u),n});s&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),o&&t.errors.push("Please ensure that all keyframe offsets are in order");const u=e.steps.length;let l=0;r>0&&r<u?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==r&&(l=1/(u-1));const h=u-1,d=t.currentTime,p=t.currentAnimateTimings,f=p.duration;return c.forEach((e,r)=>{const o=l>0?r==h?1:l*r:i[r],s=o*f;t.currentTime=d+p.delay+s,p.duration=s,this._validateStyleAst(e,t),e.offset=o,n.styles.push(e)}),n}visitReference(e,t){return{type:8,animation:wn(this,mn(e.animation),t),options:Mn(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:Mn(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:Mn(e.options)}}visitQuery(e,t){const n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[i,o]=function(e){const t=!!e.split(/\s*,\s*/).find(e=>":self"==e);return t&&(e=e.replace(kn,"")),[e=e.replace(/@\*/g,nn).replace(/@\w+/g,e=>".ng-trigger-"+e.substr(1)).replace(/:animating/g,on),t]}(e.selector);t.currentQuerySelector=n.length?n+" "+i:i,Vt(t.collectedStyles,t.currentQuerySelector,{});const s=wn(this,mn(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:i,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:s,originalSelector:e.selector,options:Mn(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");const n="full"===e.timings?{duration:0,delay:0,easing:"full"}:cn(e.timings,t.errors,!0);return{type:12,animation:wn(this,mn(e.animation),t),timings:n,options:null}}}class Ln{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function xn(e){return!Array.isArray(e)&&"object"==typeof e}function Mn(e){var t;return e?(e=un(e)).params&&(e.params=(t=e.params)?un(t):null):e={},e}function Un(e,t,n){return{duration:e,delay:t,easing:n}}function Vn(e,t,n,r,i,o,s=null,a=!1){return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:i,delay:o,totalTime:i+o,easing:s,subTimeline:a}}class Fn{constructor(){this._map=new Map}consume(e){let t=this._map.get(e);return t?this._map.delete(e):t=[],t}append(e,t){let n=this._map.get(e);n||this._map.set(e,n=[]),n.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const Bn=new RegExp(":enter","g"),jn=new RegExp(":leave","g");function Gn(e,t,n,r,i,o={},s={},a,c,u=[]){return(new qn).buildKeyframes(e,t,n,r,i,o,s,a,c,u)}class qn{buildKeyframes(e,t,n,r,i,o,s,a,c,u=[]){c=c||new Fn;const l=new Wn(e,t,c,r,i,u,[]);l.options=a,l.currentTimeline.setStyles([o],null,l.errors,a),wn(this,n,l);const h=l.timelines.filter(e=>e.containsAnimation());if(h.length&&Object.keys(s).length){const e=h[h.length-1];e.allowOnlyTimelineStyles()||e.setStyles([s],null,l.errors,a)}return h.length?h.map(e=>e.buildKeyframes()):[Vn(t,[],[],[],0,0,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const n=t.subInstructions.consume(t.element);if(n){const r=t.createSubContext(e.options),i=t.currentTimeline.currentTime,o=this._visitSubInstructions(n,r,r.options);i!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){const n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}_visitSubInstructions(e,t,n){let r=t.currentTimeline.currentTime;const i=null!=n.duration?sn(n.duration):null,o=null!=n.delay?sn(n.delay):null;return 0!==i&&e.forEach(e=>{const n=t.appendInstructionToTimeline(e,i,o);r=Math.max(r,n.duration+n.delay)}),r}visitReference(e,t){t.updateOptions(e.options,!0),wn(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const n=t.subContextCount;let r=t;const i=e.options;if(i&&(i.params||i.delay)&&(r=t.createSubContext(i),r.transformIntoNewTimeline(),null!=i.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=Hn);const e=sn(i.delay);r.delayNextStep(e)}e.steps.length&&(e.steps.forEach(e=>wn(this,e,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>n&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const n=[];let r=t.currentTimeline.currentTime;const i=e.options&&e.options.delay?sn(e.options.delay):0;e.steps.forEach(o=>{const s=t.createSubContext(e.options);i&&s.delayNextStep(i),wn(this,o,s),r=Math.max(r,s.currentTimeline.currentTime),n.push(s.currentTimeline)}),n.forEach(e=>t.currentTimeline.mergeTimelineCollectedStyles(e)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const n=e.strValue;return cn(t.params?vn(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());const i=e.style;5==i.type?this.visitKeyframes(i,t):(t.incrementTime(n.duration),this.visitStyle(i,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();const i=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(i):n.setStyles(e.styles,i,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const n=t.currentAnimateTimings,r=t.currentTimeline.duration,i=n.duration,o=t.createSubContext().currentTimeline;o.easing=n.easing,e.styles.forEach(e=>{o.forwardTime((e.offset||0)*i),o.setStyles(e.styles,e.easing,t.errors,t.options),o.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(o),t.transformIntoNewTimeline(r+i),t.previousNode=e}visitQuery(e,t){const n=t.currentTimeline.currentTime,r=e.options||{},i=r.delay?sn(r.delay):0;i&&(6===t.previousNode.type||0==n&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Hn);let o=n;const s=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=s.length;let a=null;s.forEach((n,r)=>{t.currentQueryIndex=r;const s=t.createSubContext(e.options,n);i&&s.delayNextStep(i),n===t.element&&(a=s.currentTimeline),wn(this,e.animation,s),s.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,s.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),a&&(t.currentTimeline.mergeTimelineCollectedStyles(a),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const n=t.parentContext,r=t.currentTimeline,i=e.timings,o=Math.abs(i.duration),s=o*(t.currentQueryTotal-1);let a=o*t.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":a=s-a;break;case"full":a=n.currentStaggerTime}const c=t.currentTimeline;a&&c.delayNextStep(a);const u=c.currentTime;wn(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-u+(r.startTime-n.currentTimeline.startTime)}}const Hn={};class Wn{constructor(e,t,n,r,i,o,s,a){this._driver=e,this.element=t,this.subInstructions=n,this._enterClassName=r,this._leaveClassName=i,this.errors=o,this.timelines=s,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Hn,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=a||new zn(this._driver,t,0),s.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const n=e;let r=this.options;null!=n.duration&&(r.duration=sn(n.duration)),null!=n.delay&&(r.delay=sn(n.delay));const i=n.params;if(i){let e=r.params;e||(e=this.options.params={}),Object.keys(i).forEach(n=>{t&&e.hasOwnProperty(n)||(e[n]=vn(i[n],e,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const n=e.params={};Object.keys(t).forEach(e=>{n[e]=t[e]})}}return e}createSubContext(e=null,t,n){const r=t||this.element,i=new Wn(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,n||0));return i.previousNode=this.previousNode,i.currentAnimateTimings=this.currentAnimateTimings,i.options=this._copyOptions(),i.updateOptions(e),i.currentQueryIndex=this.currentQueryIndex,i.currentQueryTotal=this.currentQueryTotal,i.parentContext=this,this.subContextCount++,i}transformIntoNewTimeline(e){return this.previousNode=Hn,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,n){const r={duration:null!=t?t:e.duration,delay:this.currentTimeline.currentTime+(null!=n?n:0)+e.delay,easing:""},i=new Kn(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,n,r,i,o){let s=[];if(r&&s.push(this.element),e.length>0){e=(e=e.replace(Bn,"."+this._enterClassName)).replace(jn,"."+this._leaveClassName);let t=this._driver.query(this.element,e,1!=n);0!==n&&(t=n<0?t.slice(t.length+n,t.length):t.slice(0,n)),s.push(...t)}return i||0!=s.length||o.push(`\`query("${t}")\` returned zero elements. (Use \`query("${t}", { optional: true })\` if you wish to allow this.)`),s}}class zn{constructor(e,t,n,r){this._driver=e,this.element=t,this.startTime=n,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new zn(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach(e=>{this._backFill[e]=this._globalTimelineStyles[e]||yt,this._currentKeyframe[e]=yt}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,n,r){t&&(this._previousKeyframe.easing=t);const i=r&&r.params||{},o=function(e,t){const n={};let r;return e.forEach(e=>{"*"===e?(r=r||Object.keys(t),r.forEach(e=>{n[e]=yt})):ln(e,!1,n)}),n}(e,this._globalTimelineStyles);Object.keys(o).forEach(e=>{const t=vn(o[e],i,n);this._pendingStyles[e]=t,this._localTimelineStyles.hasOwnProperty(e)||(this._backFill[e]=this._globalTimelineStyles.hasOwnProperty(e)?this._globalTimelineStyles[e]:yt),this._updateStyle(e,t)})}applyStylesToKeyframe(){const e=this._pendingStyles,t=Object.keys(e);0!=t.length&&(this._pendingStyles={},t.forEach(t=>{this._currentKeyframe[t]=e[t]}),Object.keys(this._localTimelineStyles).forEach(e=>{this._currentKeyframe.hasOwnProperty(e)||(this._currentKeyframe[e]=this._localTimelineStyles[e])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(e=>{const t=this._localTimelineStyles[e];this._pendingStyles[e]=t,this._updateStyle(e,t)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){Object.keys(e._styleSummary).forEach(t=>{const n=this._styleSummary[t],r=e._styleSummary[t];(!n||r.time>n.time)&&this._updateStyle(t,r.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,n=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((i,o)=>{const s=ln(i,!0);Object.keys(s).forEach(n=>{const r=s[n];"!"==r?e.add(n):r==yt&&t.add(n)}),n||(s.offset=o/this.duration),r.push(s)});const i=e.size?yn(e.values()):[],o=t.size?yn(t.values()):[];if(n){const e=r[0],t=un(e);e.offset=0,t.offset=1,r=[e,t]}return Vn(this.element,r,i,o,this.duration,this.startTime,this.easing,!1)}}class Kn extends zn{constructor(e,t,n,r,i,o,s=!1){super(e,t,o.delay),this.element=t,this.keyframes=n,this.preStyleProps=r,this.postStyleProps=i,this._stretchStartingKeyframe=s,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:n,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const i=[],o=n+t,s=t/o,a=ln(e[0],!1);a.offset=0,i.push(a);const c=ln(e[0],!1);c.offset=Yn(s),i.push(c);const u=e.length-1;for(let r=1;r<=u;r++){let s=ln(e[r],!1);s.offset=Yn((t+s.offset*n)/o),i.push(s)}n=o,t=0,r="",e=i}return Vn(this.element,e,this.preStyleProps,this.postStyleProps,n,t,r,!0)}}function Yn(e,t=3){const n=Math.pow(10,t-1);return Math.round(e*n)/n}class Qn{}class Jn extends Qn{normalizePropertyName(e,t){return Sn(e)}normalizeStyleValue(e,t,n,r){let i="";const o=n.toString().trim();if(Xn[t]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{const t=n.match(/^[+-]?[\d\.]+([a-z]*)$/);t&&0==t[1].length&&r.push(`Please provide a CSS unit value for ${e}:${n}`)}return o+i}}const Xn=(()=>function(e){const t={};return e.forEach(e=>t[e]=!0),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function $n(e,t,n,r,i,o,s,a,c,u,l,h,d){return{type:0,element:e,triggerName:t,isRemovalTransition:i,fromState:n,fromStyles:o,toState:r,toStyles:s,timelines:a,queriedElements:c,preStyleProps:u,postStyleProps:l,totalTime:h,errors:d}}const Zn={};class er{constructor(e,t,n){this._triggerName=e,this.ast=t,this._stateStyles=n}match(e,t,n,r){return function(e,t,n,r,i){return e.some(e=>e(t,n,r,i))}(this.ast.matchers,e,t,n,r)}buildStyles(e,t,n){const r=this._stateStyles["*"],i=this._stateStyles[e],o=r?r.buildStyles(t,n):{};return i?i.buildStyles(t,n):o}build(e,t,n,r,i,o,s,a,c,u){const l=[],h=this.ast.options&&this.ast.options.params||Zn,d=this.buildStyles(n,s&&s.params||Zn,l),p=a&&a.params||Zn,f=this.buildStyles(r,p,l),m=new Set,g=new Map,_=new Map,v="void"===r,y={params:Object.assign(Object.assign({},h),p)},E=u?[]:Gn(e,t,this.ast.animation,i,o,d,f,y,c,l);let S=0;if(E.forEach(e=>{S=Math.max(e.duration+e.delay,S)}),l.length)return $n(t,this._triggerName,n,r,v,d,f,[],[],g,_,S,l);E.forEach(e=>{const n=e.element,r=Vt(g,n,{});e.preStyleProps.forEach(e=>r[e]=!0);const i=Vt(_,n,{});e.postStyleProps.forEach(e=>i[e]=!0),n!==t&&m.add(n)});const T=yn(m.values());return $n(t,this._triggerName,n,r,v,d,f,E,T,g,_,S)}}class tr{constructor(e,t){this.styles=e,this.defaultParams=t}buildStyles(e,t){const n={},r=un(this.defaultParams);return Object.keys(e).forEach(t=>{const n=e[t];null!=n&&(r[t]=n)}),this.styles.styles.forEach(e=>{if("string"!=typeof e){const i=e;Object.keys(i).forEach(e=>{let o=i[e];o.length>1&&(o=vn(o,r,t)),n[e]=o})}}),n}}class nr{constructor(e,t){this.name=e,this.ast=t,this.transitionFactories=[],this.states={},t.states.forEach(e=>{this.states[e.name]=new tr(e.style,e.options&&e.options.params||{})}),rr(this.states,"true","1"),rr(this.states,"false","0"),t.transitions.forEach(t=>{this.transitionFactories.push(new er(e,t,this.states))}),this.fallbackTransition=new er(e,{type:1,animation:{type:2,steps:[],options:null},matchers:[(e,t)=>!0],options:null,queryCount:0,depCount:0},this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,n,r){return this.transitionFactories.find(i=>i.match(e,t,n,r))||null}matchStyles(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}}function rr(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}const ir=new Fn;class or{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._normalizer=n,this._animations={},this._playersById={},this.players=[]}register(e,t){const n=[],r=Dn(this._driver,t,n);if(n.length)throw new Error(`Unable to build the animation due to the following errors: ${n.join("\n")}`);this._animations[e]=r}_buildPlayer(e,t,n){const r=e.element,i=Lt(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}create(e,t,n={}){const r=[],i=this._animations[e];let o;const s=new Map;if(i?(o=Gn(this._driver,t,i,Zt,en,{},{},n,ir,r),o.forEach(e=>{const t=Vt(s,e.element,{});e.postStyleProps.forEach(e=>t[e]=null)})):(r.push("The requested animation doesn't exist or has already been destroyed"),o=[]),r.length)throw new Error(`Unable to create the animation due to the following errors: ${r.join("\n")}`);s.forEach((e,t)=>{Object.keys(e).forEach(n=>{e[n]=this._driver.computeStyle(t,n,yt)})});const a=Pt(o.map(e=>{const t=s.get(e.element);return this._buildPlayer(e,{},t)}));return this._playersById[e]=a,a.onDestroy(()=>this.destroy(e)),this.players.push(a),a}destroy(e){const t=this._getPlayer(e);t.destroy(),delete this._playersById[e];const n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}_getPlayer(e){const t=this._playersById[e];if(!t)throw new Error(`Unable to find the timeline player referenced by ${e}`);return t}listen(e,t,n,r){const i=Ut(t,"","","");return xt(this._getPlayer(e),n,i,r),()=>{}}command(e,t,n,r){if("register"==n)return void this.register(e,r[0]);if("create"==n)return void this.create(e,t,r[0]||{});const i=this._getPlayer(e);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const sr="ng-animate-queued",ar="ng-animate-disabled",cr=".ng-animate-disabled",ur=[],lr={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},hr={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0};class dr{constructor(e,t=""){this.namespaceId=t;const n=e&&e.hasOwnProperty("value");if(this.value=null!=(r=n?e.value:e)?r:null,n){const t=un(e);delete t.value,this.options=t}else this.options={};var r;this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const e=this.options.params;Object.keys(t).forEach(n=>{null==e[n]&&(e[n]=t[n])})}}}const pr="void",fr=new dr(pr);class mr{constructor(e,t,n){this.id=e,this.hostElement=t,this._engine=n,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Tr(t,this._hostClassName)}listen(e,t,n,r){if(!this._triggers.hasOwnProperty(t))throw new Error(`Unable to listen on the animation trigger event "${n}" because the animation trigger "${t}" doesn't exist!`);if(null==n||0==n.length)throw new Error(`Unable to listen on the animation trigger "${t}" because the provided event is undefined!`);if("start"!=(i=n)&&"done"!=i)throw new Error(`The provided animation trigger event "${n}" for the animation trigger "${t}" is not supported!`);var i;const o=Vt(this._elementListeners,e,[]),s={name:t,phase:n,callback:r};o.push(s);const a=Vt(this._engine.statesByElement,e,{});return a.hasOwnProperty(t)||(Tr(e,tn),Tr(e,"ng-trigger-"+t),a[t]=fr),()=>{this._engine.afterFlush(()=>{const e=o.indexOf(s);e>=0&&o.splice(e,1),this._triggers[t]||delete a[t]})}}register(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}_getTrigger(e){const t=this._triggers[e];if(!t)throw new Error(`The provided animation trigger "${e}" has not been registered!`);return t}trigger(e,t,n,r=!0){const i=this._getTrigger(t),o=new _r(this.id,t,e);let s=this._engine.statesByElement.get(e);s||(Tr(e,tn),Tr(e,"ng-trigger-"+t),this._engine.statesByElement.set(e,s={}));let a=s[t];const c=new dr(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&a&&c.absorbOptions(a.options),s[t]=c,a||(a=fr),c.value!==pr&&a.value===c.value){if(!function(e,t){const n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(let i=0;i<n.length;i++){const r=n[i];if(!t.hasOwnProperty(r)||e[r]!==t[r])return!1}return!0}(a.params,c.params)){const t=[],n=i.matchStyles(a.value,a.params,t),r=i.matchStyles(c.value,c.params,t);t.length?this._engine.reportError(t):this._engine.afterFlush(()=>{fn(e,n),pn(e,r)})}return}const u=Vt(this._engine.playersByElement,e,[]);u.forEach(e=>{e.namespaceId==this.id&&e.triggerName==t&&e.queued&&e.destroy()});let l=i.matchTransition(a.value,c.value,e,c.params),h=!1;if(!l){if(!r)return;l=i.fallbackTransition,h=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:l,fromState:a,toState:c,player:o,isFallbackTransition:h}),h||(Tr(e,sr),o.onStart(()=>{br(e,sr)})),o.onDone(()=>{let t=this.players.indexOf(o);t>=0&&this.players.splice(t,1);const n=this._engine.playersByElement.get(e);if(n){let e=n.indexOf(o);e>=0&&n.splice(e,1)}}),this.players.push(o),u.push(o),o}deregister(e){delete this._triggers[e],this._engine.statesByElement.forEach((t,n)=>{delete t[e]}),this._elementListeners.forEach((t,n)=>{this._elementListeners.set(n,t.filter(t=>t.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(e=>e.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const n=this._engine.driver.query(e,nn,!0);n.forEach(e=>{if(e.__ng_removed)return;const n=this._engine.fetchNamespacesByElement(e);n.size?n.forEach(n=>n.triggerLeaveAnimation(e,t,!1,!0)):this.clearElementCache(e)}),this._engine.afterFlushAnimationsDone(()=>n.forEach(e=>this.clearElementCache(e)))}triggerLeaveAnimation(e,t,n,r){const i=this._engine.statesByElement.get(e);if(i){const o=[];if(Object.keys(i).forEach(t=>{if(this._triggers[t]){const n=this.trigger(e,t,pr,r);n&&o.push(n)}}),o.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&Pt(o).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),n=this._engine.statesByElement.get(e);if(t&&n){const r=new Set;t.forEach(t=>{const i=t.name;if(r.has(i))return;r.add(i);const o=this._triggers[i].fallbackTransition,s=n[i]||fr,a=new dr(pr),c=new _r(this.id,i,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:i,transition:o,fromState:s,toState:a,player:c,isFallbackTransition:!0})})}}removeNode(e,t){const n=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(n.totalAnimations){const t=n.players.length?n.playersByQueriedElement.get(e):[];if(t&&t.length)r=!0;else{let t=e;for(;t=t.parentNode;)if(n.statesByElement.get(t)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)n.markElementAsRemoved(this.id,e,!1,t);else{const r=e.__ng_removed;r&&r!==lr||(n.afterFlush(()=>this.clearElementCache(e)),n.destroyInnerAnimations(e),n._onRemovalComplete(e,t))}}insertNode(e,t){Tr(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(n=>{const r=n.player;if(r.destroyed)return;const i=n.element,o=this._elementListeners.get(i);o&&o.forEach(t=>{if(t.name==n.triggerName){const r=Ut(i,n.triggerName,n.fromState.value,n.toState.value);r._data=e,xt(n.player,t.phase,r,t.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(n)}),this._queue=[],t.sort((e,t)=>{const n=e.transition.ast.depCount,r=t.transition.ast.depCount;return 0==n||0==r?n-r:this._engine.driver.containsElement(e.element,t.element)?1:-1})}destroy(e){this.players.forEach(e=>e.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(t=>t.element===e)||t,t}}class gr{constructor(e,t,n){this.bodyNode=e,this.driver=t,this._normalizer=n,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(e,t)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(t=>{t.queued&&e.push(t)})}),e}createNamespace(e,t){const n=new mr(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}_balanceNamespaceList(e,t){const n=this._namespaceList.length-1;if(n>=0){let r=!1;for(let i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,t)){this._namespaceList.splice(i+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}register(e,t){let n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}registerTrigger(e,t,n){let r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}destroy(e,t){if(!e)return;const n=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(n.hostElement),delete this._namespaceLookup[e];const t=this._namespaceList.indexOf(n);t>=0&&this._namespaceList.splice(t,1)}),this.afterFlushAnimationsDone(()=>n.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,n=this.statesByElement.get(e);if(n){const e=Object.keys(n);for(let r=0;r<e.length;r++){const i=n[e[r]].namespaceId;if(i){const e=this._fetchNamespace(i);e&&t.add(e)}}}return t}trigger(e,t,n,r){if(vr(t)){const i=this._fetchNamespace(e);if(i)return i.trigger(t,n,r),!0}return!1}insertNode(e,t,n,r){if(!vr(t))return;const i=t.__ng_removed;if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;const e=this.collectedLeaveElements.indexOf(t);e>=0&&this.collectedLeaveElements.splice(e,1)}if(e){const r=this._fetchNamespace(e);r&&r.insertNode(t,n)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Tr(e,ar)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),br(e,ar))}removeNode(e,t,n,r){if(vr(t)){const i=e?this._fetchNamespace(e):null;if(i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){const n=this.namespacesByHostElement.get(t);n&&n.id!==e&&n.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,n,r){this.collectedLeaveElements.push(t),t.__ng_removed={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}listen(e,t,n,r,i){return vr(t)?this._fetchNamespace(e).listen(t,n,r,i):()=>{}}_buildInstruction(e,t,n,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,i)}destroyInnerAnimations(e){let t=this.driver.query(e,nn,!0);t.forEach(e=>this.destroyActiveAnimationsForElement(e)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,on,!0),t.forEach(e=>this.finishActiveQueriedAnimationOnElement(e)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(e=>{e.queued?e.markedForDestroy=!0:e.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(e=>e.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Pt(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e.__ng_removed;if(t&&t.setForRemoval){if(e.__ng_removed=lr,t.namespaceId){this.destroyInnerAnimations(e);const n=this._fetchNamespace(t.namespaceId);n&&n.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}this.driver.matchesElement(e,cr)&&this.markElementAsDisabled(e,!1),this.driver.query(e,cr,!0).forEach(e=>{this.markElementAsDisabled(e,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((e,t)=>this._balanceNamespaceList(e,t)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let n=0;n<this.collectedEnterElements.length;n++)Tr(this.collectedEnterElements[n],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const n=[];try{t=this._flushAnimations(n,e)}finally{for(let e=0;e<n.length;e++)n[e]()}}else for(let n=0;n<this.collectedLeaveElements.length;n++)this.processLeaveNode(this.collectedLeaveElements[n]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(e=>e()),this._flushFns=[],this._whenQuietFns.length){const e=this._whenQuietFns;this._whenQuietFns=[],t.length?Pt(t).onDone(()=>{e.forEach(e=>e())}):e.forEach(e=>e())}}reportError(e){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${e.join("\n")}`)}_flushAnimations(e,t){const n=new Fn,r=[],i=new Map,o=[],s=new Map,a=new Map,c=new Map,u=new Set;this.disabledNodes.forEach(e=>{u.add(e);const t=this.driver.query(e,".ng-animate-queued",!0);for(let n=0;n<t.length;n++)u.add(t[n])});const l=this.bodyNode,h=Array.from(this.statesByElement.keys()),d=Sr(h,this.collectedEnterElements),p=new Map;let f=0;d.forEach((e,t)=>{const n=Zt+f++;p.set(t,n),e.forEach(e=>Tr(e,n))});const m=[],g=new Set,_=new Set;for(let N=0;N<this.collectedLeaveElements.length;N++){const e=this.collectedLeaveElements[N],t=e.__ng_removed;t&&t.setForRemoval&&(m.push(e),g.add(e),t.hasAnimation?this.driver.query(e,".ng-star-inserted",!0).forEach(e=>g.add(e)):_.add(e))}const v=new Map,y=Sr(h,Array.from(g));y.forEach((e,t)=>{const n=en+f++;v.set(t,n),e.forEach(e=>Tr(e,n))}),e.push(()=>{d.forEach((e,t)=>{const n=p.get(t);e.forEach(e=>br(e,n))}),y.forEach((e,t)=>{const n=v.get(t);e.forEach(e=>br(e,n))}),m.forEach(e=>{this.processLeaveNode(e)})});const E=[],S=[];for(let N=this._namespaceList.length-1;N>=0;N--)this._namespaceList[N].drainQueuedTransitions(t).forEach(e=>{const t=e.player,i=e.element;if(E.push(t),this.collectedEnterElements.length){const e=i.__ng_removed;if(e&&e.setForMove)return void t.destroy()}const u=!l||!this.driver.containsElement(l,i),h=v.get(i),d=p.get(i),f=this._buildInstruction(e,n,d,h,u);if(f.errors&&f.errors.length)S.push(f);else{if(u)return t.onStart(()=>fn(i,f.fromStyles)),t.onDestroy(()=>pn(i,f.toStyles)),void r.push(t);if(e.isFallbackTransition)return t.onStart(()=>fn(i,f.fromStyles)),t.onDestroy(()=>pn(i,f.toStyles)),void r.push(t);f.timelines.forEach(e=>e.stretchStartingKeyframe=!0),n.append(i,f.timelines),o.push({instruction:f,player:t,element:i}),f.queriedElements.forEach(e=>Vt(s,e,[]).push(t)),f.preStyleProps.forEach((e,t)=>{const n=Object.keys(e);if(n.length){let e=a.get(t);e||a.set(t,e=new Set),n.forEach(t=>e.add(t))}}),f.postStyleProps.forEach((e,t)=>{const n=Object.keys(e);let r=c.get(t);r||c.set(t,r=new Set),n.forEach(e=>r.add(e))})}});if(S.length){const e=[];S.forEach(t=>{e.push(`@${t.triggerName} has failed due to:\n`),t.errors.forEach(t=>e.push(`- ${t}\n`))}),E.forEach(e=>e.destroy()),this.reportError(e)}const T=new Map,b=new Map;o.forEach(e=>{const t=e.element;n.has(t)&&(b.set(t,t),this._beforeAnimationBuild(e.player.namespaceId,e.instruction,T))}),r.forEach(e=>{const t=e.element;this._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach(e=>{Vt(T,t,[]).push(e),e.destroy()})});const w=m.filter(e=>Ir(e,a,c)),R=new Map;Er(R,this.driver,_,c,yt).forEach(e=>{Ir(e,a,c)&&w.push(e)});const I=new Map;d.forEach((e,t)=>{Er(I,this.driver,new Set(e),a,"!")}),w.forEach(e=>{const t=R.get(e),n=I.get(e);R.set(e,Object.assign(Object.assign({},t),n))});const C=[],A=[],O={};o.forEach(e=>{const{element:t,player:o,instruction:s}=e;if(n.has(t)){if(u.has(t))return o.onDestroy(()=>pn(t,s.toStyles)),o.disabled=!0,o.overrideTotalTime(s.totalTime),void r.push(o);let e=O;if(b.size>1){let n=t;const r=[];for(;n=n.parentNode;){const t=b.get(n);if(t){e=t;break}r.push(n)}r.forEach(t=>b.set(t,e))}const n=this._buildAnimation(o.namespaceId,s,T,i,I,R);if(o.setRealPlayer(n),e===O)C.push(o);else{const t=this.playersByElement.get(e);t&&t.length&&(o.parentPlayer=Pt(t)),r.push(o)}}else fn(t,s.fromStyles),o.onDestroy(()=>pn(t,s.toStyles)),A.push(o),u.has(t)&&r.push(o)}),A.forEach(e=>{const t=i.get(e.element);if(t&&t.length){const n=Pt(t);e.setRealPlayer(n)}}),r.forEach(e=>{e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()});for(let N=0;N<m.length;N++){const e=m[N],t=e.__ng_removed;if(br(e,en),t&&t.hasAnimation)continue;let n=[];if(s.size){let t=s.get(e);t&&t.length&&n.push(...t);let r=this.driver.query(e,on,!0);for(let e=0;e<r.length;e++){let t=s.get(r[e]);t&&t.length&&n.push(...t)}}const r=n.filter(e=>!e.destroyed);r.length?wr(this,e,r):this.processLeaveNode(e)}return m.length=0,C.forEach(e=>{this.players.push(e),e.onDone(()=>{e.destroy();const t=this.players.indexOf(e);this.players.splice(t,1)}),e.play()}),C}elementContainsData(e,t){let n=!1;const r=t.__ng_removed;return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,n,r,i){let o=[];if(t){const t=this.playersByQueriedElement.get(e);t&&(o=t)}else{const t=this.playersByElement.get(e);if(t){const e=!i||i==pr;t.forEach(t=>{t.queued||(e||t.triggerName==r)&&o.push(t)})}}return(n||r)&&(o=o.filter(e=>!(n&&n!=e.namespaceId||r&&r!=e.triggerName))),o}_beforeAnimationBuild(e,t,n){const r=t.element,i=t.isRemovalTransition?void 0:e,o=t.isRemovalTransition?void 0:t.triggerName;for(const s of t.timelines){const e=s.element,a=e!==r,c=Vt(n,e,[]);this._getPreviousPlayers(e,a,i,o,t.toState).forEach(e=>{const t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),c.push(e)})}fn(r,t.fromStyles)}_buildAnimation(e,t,n,r,i,o){const s=t.triggerName,a=t.element,c=[],u=new Set,l=new Set,h=t.timelines.map(t=>{const h=t.element;u.add(h);const d=h.__ng_removed;if(d&&d.removedBeforeQueried)return new Ot(t.duration,t.delay);const p=h!==a,f=function(e){const t=[];return Rr(e,t),t}((n.get(h)||ur).map(e=>e.getRealPlayer())).filter(e=>!!e.element&&e.element===h),m=i.get(h),g=o.get(h),_=Lt(0,this._normalizer,0,t.keyframes,m,g),v=this._buildPlayer(t,_,f);if(t.subTimeline&&r&&l.add(h),p){const t=new _r(e,s,h);t.setRealPlayer(v),c.push(t)}return v});c.forEach(e=>{Vt(this.playersByQueriedElement,e.element,[]).push(e),e.onDone(()=>function(e,t,n){let r;if(e instanceof Map){if(r=e.get(t),r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&e.delete(t)}}else if(r=e[t],r){if(r.length){const e=r.indexOf(n);r.splice(e,1)}0==r.length&&delete e[t]}return r}(this.playersByQueriedElement,e.element,e))}),u.forEach(e=>Tr(e,rn));const d=Pt(h);return d.onDestroy(()=>{u.forEach(e=>br(e,rn)),pn(a,t.toStyles)}),l.forEach(e=>{Vt(r,e,[]).push(d)}),d}_buildPlayer(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new Ot(e.duration,e.delay)}}class _r{constructor(e,t,n){this.namespaceId=e,this.triggerName=t,this.element=n,this._player=new Ot,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach(t=>{this._queuedCallbacks[t].forEach(n=>xt(e,t,void 0,n))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){Vt(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function vr(e){return e&&1===e.nodeType}function yr(e,t){const n=e.style.display;return e.style.display=null!=t?t:"none",n}function Er(e,t,n,r,i){const o=[];n.forEach(e=>o.push(yr(e)));const s=[];r.forEach((n,r)=>{const o={};n.forEach(e=>{const n=o[e]=t.computeStyle(r,e,i);n&&0!=n.length||(r.__ng_removed=hr,s.push(r))}),e.set(r,o)});let a=0;return n.forEach(e=>yr(e,o[a++])),s}function Sr(e,t){const n=new Map;if(e.forEach(e=>n.set(e,[])),0==t.length)return n;const r=new Set(t),i=new Map;function o(e){if(!e)return 1;let t=i.get(e);if(t)return t;const s=e.parentNode;return t=n.has(s)?s:r.has(s)?1:o(s),i.set(e,t),t}return t.forEach(e=>{const t=o(e);1!==t&&n.get(t).push(e)}),n}function Tr(e,t){if(e.classList)e.classList.add(t);else{let n=e.$$classes;n||(n=e.$$classes={}),n[t]=!0}}function br(e,t){if(e.classList)e.classList.remove(t);else{let n=e.$$classes;n&&delete n[t]}}function wr(e,t,n){Pt(n).onDone(()=>e.processLeaveNode(t))}function Rr(e,t){for(let n=0;n<e.length;n++){const r=e[n];r instanceof Nt?Rr(r.players,t):t.push(r)}}function Ir(e,t,n){const r=n.get(e);if(!r)return!1;let i=t.get(e);return i?r.forEach(e=>i.add(e)):t.set(e,r),n.delete(e),!0}class Cr{constructor(e,t,n){this.bodyNode=e,this._driver=t,this._triggerCache={},this.onRemovalComplete=(e,t)=>{},this._transitionEngine=new gr(e,t,n),this._timelineEngine=new or(e,t,n),this._transitionEngine.onRemovalComplete=(e,t)=>this.onRemovalComplete(e,t)}registerTrigger(e,t,n,r,i){const o=e+"-"+r;let s=this._triggerCache[o];if(!s){const e=[],t=Dn(this._driver,i,e);if(e.length)throw new Error(`The animation trigger "${r}" has failed to build due to the following errors:\n - ${e.join("\n - ")}`);s=function(e,t){return new nr(e,t)}(r,t),this._triggerCache[o]=s}this._transitionEngine.registerTrigger(t,r,s)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}onRemove(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,n,r){if("@"==n.charAt(0)){const[e,i]=Ft(n);this._timelineEngine.command(e,t,i,r)}else this._transitionEngine.trigger(e,t,n,r)}listen(e,t,n,r,i){if("@"==n.charAt(0)){const[e,r]=Ft(n);return this._timelineEngine.listen(e,t,r,i)}return this._transitionEngine.listen(e,t,n,r,i)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function Ar(e,t){let n=null,r=null;return Array.isArray(t)&&t.length?(n=Nr(t[0]),t.length>1&&(r=Nr(t[t.length-1]))):t&&(n=Nr(t)),n||r?new Or(e,n,r):null}let Or=(()=>{class e{constructor(t,n,r){this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;let i=e.initialStylesByElement.get(t);i||e.initialStylesByElement.set(t,i={}),this._initialStyles=i}start(){this._state<1&&(this._startStyles&&pn(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(pn(this._element,this._initialStyles),this._endStyles&&(pn(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(fn(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(fn(this._element,this._endStyles),this._endStyles=null),pn(this._element,this._initialStyles),this._state=3)}}return e.initialStylesByElement=new WeakMap,e})();function Nr(e){let t=null;const n=Object.keys(e);for(let r=0;r<n.length;r++){const i=n[r];kr(i)&&(t=t||{},t[i]=e[i])}return t}function kr(e){return"display"===e||"position"===e}const Dr="animation",Pr="animationend";class Lr{constructor(e,t,n,r,i,o,s){this._element=e,this._name=t,this._duration=n,this._delay=r,this._easing=i,this._fillMode=o,this._onDoneFn=s,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=e=>this._handleCallback(e)}apply(){!function(e,t){const n=Br(e,"").trim();n.length&&(function(e,t){let n=0;for(let r=0;r<e.length;r++)","===e.charAt(r)&&n++}(n),t=`${n}, ${t}`),Fr(e,"",t)}(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),Vr(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){xr(this._element,this._name,"paused")}resume(){xr(this._element,this._name,"running")}setPosition(e){const t=Mr(this._element,this._name);this._position=e*this._duration,Fr(this._element,"Delay",`-${this._position}ms`,t)}getPosition(){return this._position}_handleCallback(e){const t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),Vr(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(e,t){const n=Br(e,"").split(","),r=Ur(n,t);r>=0&&(n.splice(r,1),Fr(e,"",n.join(",")))}(this._element,this._name))}}function xr(e,t,n){Fr(e,"PlayState",n,Mr(e,t))}function Mr(e,t){const n=Br(e,"");return n.indexOf(",")>0?Ur(n.split(","),t):Ur([n],t)}function Ur(e,t){for(let n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function Vr(e,t,n){n?e.removeEventListener(Pr,t):e.addEventListener(Pr,t)}function Fr(e,t,n,r){const i=Dr+t;if(null!=r){const t=e.style[i];if(t.length){const e=t.split(",");e[r]=n,n=e.join(",")}}e.style[i]=n}function Br(e,t){return e.style[Dr+t]||""}class jr{constructor(e,t,n,r,i,o,s,a){this.element=e,this.keyframes=t,this.animationName=n,this._duration=r,this._delay=i,this._finalStyles=s,this._specialStyles=a,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=o||"linear",this.totalTime=r+i,this._buildStyler()}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}destroy(){this.init(),this._state>=4||(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(e=>e()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}finish(){this.init(),this._state>=3||(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(e){this._styler.setPosition(e)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new Lr(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}beforeDestroy(){this.init();const e={};if(this.hasStarted()){const t=this._state>=3;Object.keys(this._finalStyles).forEach(n=>{"offset"!=n&&(e[n]=t?this._finalStyles[n]:Rn(this.element,n))})}this.currentSnapshot=e}}class Gr extends Ot{constructor(e,t){super(),this.element=e,this._startingStyles={},this.__initialized=!1,this._styles=Jt(t)}init(){!this.__initialized&&this._startingStyles&&(this.__initialized=!0,Object.keys(this._styles).forEach(e=>{this._startingStyles[e]=this.element.style[e]}),super.init())}play(){this._startingStyles&&(this.init(),Object.keys(this._styles).forEach(e=>this.element.style.setProperty(e,this._styles[e])),super.play())}destroy(){this._startingStyles&&(Object.keys(this._startingStyles).forEach(e=>{const t=this._startingStyles[e];t?this.element.style.setProperty(e,t):this.element.style.removeProperty(e)}),this._startingStyles=null,super.destroy())}}class qr{constructor(){this._count=0}validateStyleProperty(e){return zt(e)}matchesElement(e,t){return Kt(e,t)}containsElement(e,t){return Yt(e,t)}query(e,t,n){return Qt(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}buildKeyframeElement(e,t,n){n=n.map(e=>Jt(e));let r=`@keyframes ${t} {\n`,i="";n.forEach(e=>{i=" ";const t=parseFloat(e.offset);r+=`${i}${100*t}% {\n`,i+=" ",Object.keys(e).forEach(t=>{const n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+=`${i}animation-timing-function: ${n};\n`));default:return void(r+=`${i}${t}: ${n};\n`)}}),r+=`${i}}\n`}),r+="}\n";const o=document.createElement("style");return o.textContent=r,o}animate(e,t,n,r,i,o=[],s){const a=o.filter(e=>e instanceof jr),c={};Tn(n,r)&&a.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>c[e]=t[e])});const u=function(e){let t={};return e&&(Array.isArray(e)?e:[e]).forEach(e=>{Object.keys(e).forEach(n=>{"offset"!=n&&"easing"!=n&&(t[n]=e[n])})}),t}(t=bn(e,t,c));if(0==n)return new Gr(e,u);const l="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(e,l,t);(function(e){var t;const n=null===(t=e.getRootNode)||void 0===t?void 0:t.call(e);return"undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot?n:document.head})(e).appendChild(h);const d=Ar(e,t),p=new jr(e,t,l,n,r,i,u,d);return p.onDestroy(()=>{var e;(e=h).parentNode.removeChild(e)}),p}}class Hr{constructor(e,t,n,r){this.element=e,this.keyframes=t,this.options=n,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=n.duration,this._delay=n.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(e,t,n){return e.animate(t,n)}onStart(e){this._onStartFns.push(e)}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(t=>{"offset"!=t&&(e[t]=this._finished?this._finalKeyframe[t]:Rn(this.element,t))}),this.currentSnapshot=e}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(e=>e()),t.length=0}}class Wr{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(zr().toString()),this._cssKeyframesDriver=new qr}validateStyleProperty(e){return zt(e)}matchesElement(e,t){return Kt(e,t)}containsElement(e,t){return Yt(e,t)}query(e,t,n){return Qt(e,t,n)}computeStyle(e,t,n){return window.getComputedStyle(e)[t]}overrideWebAnimationsSupport(e){this._isNativeImpl=e}animate(e,t,n,r,i,o=[],s){if(!s&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,i,o);const a={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(a.easing=i);const c={},u=o.filter(e=>e instanceof Hr);Tn(n,r)&&u.forEach(e=>{let t=e.currentSnapshot;Object.keys(t).forEach(e=>c[e]=t[e])});const l=Ar(e,t=bn(e,t=t.map(e=>ln(e,!1)),c));return new Hr(e,t,a,l)}}function zr(){return kt()&&Element.prototype.animate||{}}let Kr=(()=>{class e extends vt{constructor(e,t){super(),this._nextAnimationId=0,this._renderer=e.createRenderer(t.body,{id:"0",encapsulation:r.ifc.None,styles:[],data:{animation:[]}})}build(e){const t=this._nextAnimationId.toString();this._nextAnimationId++;const n=Array.isArray(e)?Tt(e):e;return Jr(this._renderer,null,t,"register",[n]),new Yr(t,this._renderer)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(r.FYo),r.LFG(s))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();class Yr extends class{}{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new Qr(this._id,e,t||{},this._renderer)}}class Qr{constructor(e,t,n,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",n)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return Jr(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){var e,t;return null!==(t=null===(e=this._renderer.engine.players[+this.id])||void 0===e?void 0:e.getPosition())&&void 0!==t?t:0}}function Jr(e,t,n,r,i){return e.setProperty(t,`@@${n}:${r}`,i)}const Xr="@",$r="@.disabled";let Zr=(()=>{class e{constructor(e,t,n){this.delegate=e,this.engine=t,this._zone=n,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),t.onRemovalComplete=(e,t)=>{t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}createRenderer(e,t){const n=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){let e=this._rendererCache.get(n);return e||(e=new ei("",n,this.engine),this._rendererCache.set(n,e)),e}const r=t.id,i=t.id+"-"+this._currentId;this._currentId++,this.engine.register(i,e);const o=t=>{Array.isArray(t)?t.forEach(o):this.engine.registerTrigger(r,i,e,t.name,t)};return t.data.animation.forEach(o),new ti(this,i,n,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(e,t,n){e>=0&&e<this._microtaskId?this._zone.run(()=>t(n)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(e=>{const[t,n]=e;t(n)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([t,n]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(r.FYo),r.LFG(Cr),r.LFG(r.R0b))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();class ei{constructor(e,t,n){this.namespaceId=e,this.delegate=t,this.engine=n,this.destroyNode=this.delegate.destroyNode?e=>t.destroyNode(e):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,n,r=!0){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}removeAttribute(e,t,n){this.delegate.removeAttribute(e,t,n)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,n,r){this.delegate.setStyle(e,t,n,r)}removeStyle(e,t,n){this.delegate.removeStyle(e,t,n)}setProperty(e,t,n){t.charAt(0)==Xr&&t==$r?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,n){return this.delegate.listen(e,t,n)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class ti extends ei{constructor(e,t,n,r){super(t,n,r),this.factory=e,this.namespaceId=t}setProperty(e,t,n){t.charAt(0)==Xr?"."==t.charAt(1)&&t==$r?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}listen(e,t,n){if(t.charAt(0)==Xr){const r=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e);let i=t.substr(1),o="";return i.charAt(0)!=Xr&&([i,o]=function(e){const t=e.indexOf(".");return[e.substring(0,t),e.substr(t+1)]}(i)),this.engine.listen(this.namespaceId,r,i,o,e=>{this.factory.scheduleListenerCallback(e._data||-1,n,e)})}return this.delegate.listen(e,t,n)}}let ni=(()=>{class e extends Cr{constructor(e,t,n){super(e.body,t,n)}ngOnDestroy(){this.flush()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s),r.LFG($t),r.LFG(Qn))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();const ri=new r.OlP("AnimationModuleType"),ii=[{provide:vt,useClass:Kr},{provide:Qn,useFactory:function(){return new Jn}},{provide:Cr,useClass:ni},{provide:r.FYo,useFactory:function(e,t,n){return new Zr(e,t,n)},deps:[me,Cr,r.R0b]}],oi=[{provide:$t,useFactory:function(){return"function"==typeof zr()?new Wr:new qr}},{provide:ri,useValue:"BrowserAnimations"},...ii],si=[{provide:$t,useClass:Xt},{provide:ri,useValue:"NoopAnimations"},...ii];let ai=(()=>{class e{static withConfig(t){return{ngModule:e,providers:t.disableAnimations?si:oi}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:oi,imports:[Ne]}),e})();var ci=n(9764),ui=n(5959),li=n(3895);class hi extends ui.xQ{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return t&&!t.closed&&e.next(this._value),t}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new li.N;return this._value}next(e){super.next(this._value=e)}}var di=n(6163),pi=n(8470);class fi extends xe.L{notifyNext(e,t,n,r,i){this.destination.next(t)}notifyError(e,t){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class mi extends xe.L{constructor(e,t,n){super(),this.parent=e,this.outerValue=t,this.outerIndex=n,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var gi=n(6015);function _i(e,t,n,r,i=new mi(e,n,r)){if(!i.closed)return t instanceof De.y?t.subscribe(i):(0,gi.s)(t)(i)}var vi=n(9342);const yi={};class Ei{constructor(e){this.resultSelector=e}call(e,t){return t.subscribe(new Si(e,this.resultSelector))}}class Si extends fi{constructor(e,t){super(e),this.resultSelector=t,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(yi),this.observables.push(e)}_complete(){const e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(let n=0;n<t;n++)this.add(_i(this,e[n],void 0,n))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,t,n){const r=this.values,i=this.toRespond?r[n]===yi?--this.toRespond:this.toRespond:0;r[n]=t,0===i&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))}_tryResultSelector(e){let t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}const Ti=(()=>{function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e})();var bi=n(7471);function wi(...e){return(0,bi.J)(1)((0,ke.of)(...e))}var Ri=n(653);function Ii(e){return new De.y(t=>{let n;try{n=e()}catch(r){return void t.error(r)}return(n?(0,ci.D)(n):(0,Ri.c)()).subscribe(t)})}var Ci=n(2875),Ai=n(6882);function Oi(e,t){return"function"==typeof t?n=>n.pipe(Oi((n,r)=>(0,ci.D)(e(n,r)).pipe((0,Fe.U)((e,i)=>t(n,e,r,i))))):t=>t.lift(new Ni(e))}class Ni{constructor(e){this.project=e}call(e,t){return t.subscribe(new ki(e,this.project))}}class ki extends Ai.Ds{constructor(e,t){super(e),this.project=t,this.index=0}_next(e){let t;const n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t)}_innerSub(e){const t=this.innerSubscription;t&&t.unsubscribe();const n=new Ai.IY(this),r=this.destination;r.add(n),this.innerSubscription=(0,Ai.ft)(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;e&&!e.closed||super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const Di=(()=>{function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e})();function Pi(e){return t=>0===e?(0,Ri.c)():t.lift(new Li(e))}class Li{constructor(e){if(this.total=e,this.total<0)throw new Di}call(e,t){return t.subscribe(new xi(e,this.total))}}class xi extends xe.L{constructor(e,t){super(e),this.total=t,this.count=0}_next(e){const t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}function Mi(...e){const t=e[e.length-1];return(0,di.K)(t)?(e.pop(),n=>wi(e,n,t)):t=>wi(e,t)}function Ui(e,t){let n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Vi(e,t,n))}}class Vi{constructor(e,t,n=!1){this.accumulator=e,this.seed=t,this.hasSeed=n}call(e,t){return t.subscribe(new Fi(e,this.accumulator,this.seed,this.hasSeed))}}class Fi extends xe.L{constructor(e,t,n,r){super(e),this.accumulator=t,this._seed=n,this.hasSeed=r,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const t=this.index++;let n;try{n=this.accumulator(this.seed,e,t)}catch(r){this.destination.error(r)}this.seed=n,this.destination.next(n)}}function Bi(e){return function(t){const n=new ji(e),r=t.lift(n);return n.caught=r}}class ji{constructor(e){this.selector=e}call(e,t){return t.subscribe(new Gi(e,this.selector,this.caught))}}class Gi extends Ai.Ds{constructor(e,t,n){super(e),this.selector=t,this.caught=n}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(t){return void super.error(t)}this._unsubscribeAndRecycle();const r=new Ai.IY(this);this.add(r);const i=(0,Ai.ft)(n,r);i!==r&&this.add(i)}}}function qi(e){return function(t){return 0===e?(0,Ri.c)():t.lift(new Hi(e))}}class Hi{constructor(e){if(this.total=e,this.total<0)throw new Di}call(e,t){return t.subscribe(new Wi(e,this.total))}}class Wi extends xe.L{constructor(e,t){super(e),this.total=t,this.ring=new Array,this.count=0}_next(e){const t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}_complete(){const e=this.destination;let t=this.count;if(t>0){const n=this.count>=this.total?this.total:this.count,r=this.ring;for(let i=0;i<n;i++){const i=t++%n;e.next(r[i])}}e.complete()}}function zi(e=Qi){return t=>t.lift(new Ki(e))}class Ki{constructor(e){this.errorFactory=e}call(e,t){return t.subscribe(new Yi(e,this.errorFactory))}}class Yi extends xe.L{constructor(e,t){super(e),this.errorFactory=t,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(jR){e=jR}this.destination.error(e)}}}function Qi(){return new Ti}function Ji(e=null){return t=>t.lift(new Xi(e))}class Xi{constructor(e){this.defaultValue=e}call(e,t){return t.subscribe(new $i(e,this.defaultValue))}}class $i extends xe.L{constructor(e,t){super(e),this.defaultValue=t,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var Zi=n(3392);function eo(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Me((t,n)=>e(t,n,r)):Zi.y,Pi(1),n?Ji(t):zi(()=>new Ti))}var to=n(6599),no=n(1564),ro=n(7570);class io{constructor(e){this.callback=e}call(e,t){return t.subscribe(new oo(e,this.callback))}}class oo extends xe.L{constructor(e,t){super(e),this.add(new ro.w(t))}}class so{constructor(e,t){this.id=e,this.url=t}}class ao extends so{constructor(e,t,n="imperative",r=null){super(e,t),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class co extends so{constructor(e,t,n){super(e,t),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class uo extends so{constructor(e,t,n){super(e,t),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class lo extends so{constructor(e,t,n){super(e,t),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ho extends so{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class po extends so{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fo extends so{constructor(e,t,n,r,i){super(e,t),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class mo extends so{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class go extends so{constructor(e,t,n,r){super(e,t),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _o{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class vo{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class yo{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Eo{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class So{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class To{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class bo{constructor(e,t,n){this.routerEvent=e,this.position=t,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const wo="primary";class Ro{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function Io(e){return new Ro(e)}function Co(e){const t=Error("NavigationCancelingError: "+e);return t.ngNavigationCancelingError=!0,t}function Ao(e,t,n){const r=n.path.split("/");if(r.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let o=0;o<r.length;o++){const t=r[o],n=e[o];if(t.startsWith(":"))i[t.substring(1)]=n;else if(t!==n.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function Oo(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let o=0;o<n.length;o++)if(i=n[o],!No(e[i],t[i]))return!1;return!0}function No(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((e,t)=>r[t]===e)}return e===t}function ko(e){return Array.prototype.concat.apply([],e)}function Do(e){return e.length>0?e[e.length-1]:null}function Po(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Lo(e){return(0,r.CqO)(e)?e:(0,r.QGY)(e)?(0,ci.D)(Promise.resolve(e)):(0,ke.of)(e)}const xo={exact:function e(t,n,r){if(!Ho(t.segments,n.segments))return!1;if(!Bo(t.segments,n.segments,r))return!1;if(t.numberOfChildren!==n.numberOfChildren)return!1;for(const i in n.children){if(!t.children[i])return!1;if(!e(t.children[i],n.children[i],r))return!1}return!0},subset:Vo},Mo={exact:function(e,t){return Oo(e,t)},subset:function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>No(e[n],t[n]))},ignored:()=>!0};function Uo(e,t,n){return xo[n.paths](e.root,t.root,n.matrixParams)&&Mo[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function Vo(e,t,n){return Fo(e,t,t.segments,n)}function Fo(e,t,n,r){if(e.segments.length>n.length){const i=e.segments.slice(0,n.length);return!!Ho(i,n)&&!t.hasChildren()&&!!Bo(i,n,r)}if(e.segments.length===n.length){if(!Ho(e.segments,n))return!1;if(!Bo(e.segments,n,r))return!1;for(const n in t.children){if(!e.children[n])return!1;if(!Vo(e.children[n],t.children[n],r))return!1}return!0}{const i=n.slice(0,e.segments.length),o=n.slice(e.segments.length);return!!Ho(e.segments,i)&&!!Bo(e.segments,i,r)&&!!e.children.primary&&Fo(e.children.primary,t,o,r)}}function Bo(e,t,n){return t.every((t,r)=>Mo[n](e[r].parameters,t.parameters))}class jo{constructor(e,t,n){this.root=e,this.queryParams=t,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Io(this.queryParams)),this._queryParamMap}toString(){return Ko.serialize(this)}}class Go{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Po(t,(e,t)=>e.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Yo(this)}}class qo{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=Io(this.parameters)),this._parameterMap}toString(){return ts(this)}}function Ho(e,t){return e.length===t.length&&e.every((e,n)=>e.path===t[n].path)}class Wo{}class zo{parse(e){const t=new ss(e);return new jo(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){var t;return`/${Qo(e.root,!0)}${function(e){const t=Object.keys(e).map(t=>{const n=e[t];return Array.isArray(n)?n.map(e=>`${Xo(t)}=${Xo(e)}`).join("&"):`${Xo(t)}=${Xo(n)}`}).filter(e=>!!e);return t.length?`?${t.join("&")}`:""}(e.queryParams)}${"string"==typeof e.fragment?`#${t=e.fragment,encodeURI(t)}`:""}`}}const Ko=new zo;function Yo(e){return e.segments.map(e=>ts(e)).join("/")}function Qo(e,t){if(!e.hasChildren())return Yo(e);if(t){const t=e.children.primary?Qo(e.children.primary,!1):"",n=[];return Po(e.children,(e,t)=>{t!==wo&&n.push(`${t}:${Qo(e,!1)}`)}),n.length>0?`${t}(${n.join("//")})`:t}{const t=function(e,t){let n=[];return Po(e.children,(e,r)=>{r===wo&&(n=n.concat(t(e,r)))}),Po(e.children,(e,r)=>{r!==wo&&(n=n.concat(t(e,r)))}),n}(e,(t,n)=>n===wo?[Qo(e.children.primary,!1)]:[`${n}:${Qo(t,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children.primary?`${Yo(e)}/${t[0]}`:`${Yo(e)}/(${t.join("//")})`}}function Jo(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Xo(e){return Jo(e).replace(/%3B/gi,";")}function $o(e){return Jo(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Zo(e){return decodeURIComponent(e)}function es(e){return Zo(e.replace(/\+/g,"%20"))}function ts(e){return`${$o(e.path)}${t=e.parameters,Object.keys(t).map(e=>`;${$o(e)}=${$o(t[e])}`).join("")}`;var t}const ns=/^[^\/()?;=#]+/;function rs(e){const t=e.match(ns);return t?t[0]:""}const is=/^[^=?&#]+/,os=/^[^?&#]+/;class ss{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Go([],{}):new Go([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n.primary=new Go(e,t)),n}parseSegment(){const e=rs(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new qo(Zo(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=rs(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=rs(this.remaining);e&&(n=e,this.capture(n))}e[Zo(t)]=Zo(n)}parseQueryParam(e){const t=function(e){const t=e.match(is);return t?t[0]:""}(this.remaining);if(!t)return;this.capture(t);let n="";if(this.consumeOptional("=")){const e=function(e){const t=e.match(os);return t?t[0]:""}(this.remaining);e&&(n=e,this.capture(n))}const r=es(t),i=es(n);if(e.hasOwnProperty(r)){let t=e[r];Array.isArray(t)||(t=[t],e[r]=t),t.push(i)}else e[r]=i}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=rs(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=wo);const o=this.parseChildren();t[i]=1===Object.keys(o).length?o.primary:new Go([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class as{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=cs(e,this._root);return t?t.children.map(e=>e.value):[]}firstChild(e){const t=cs(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=us(e,this._root);return t.length<2?[]:t[t.length-2].children.map(e=>e.value).filter(t=>t!==e)}pathFromRoot(e){return us(e,this._root).map(e=>e.value)}}function cs(e,t){if(e===t.value)return t;for(const n of t.children){const t=cs(e,n);if(t)return t}return null}function us(e,t){if(e===t.value)return[t];for(const n of t.children){const r=us(e,n);if(r.length)return r.unshift(t),r}return[]}class ls{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function hs(e){const t={};return e&&e.children.forEach(e=>t[e.value.outlet]=e),t}class ds extends as{constructor(e,t){super(e),this.snapshot=t,vs(this,e)}toString(){return this.snapshot.toString()}}function ps(e,t){const n=function(e,t){const n=new gs([],{},{},"",{},wo,t,null,e.root,-1,{});return new _s("",new ls(n,[]))}(e,t),r=new hi([new qo("",{})]),i=new hi({}),o=new hi({}),s=new hi({}),a=new hi(""),c=new fs(r,i,s,a,o,wo,t,n.root);return c.snapshot=n.root,new ds(new ls(c,[]),n)}class fs{constructor(e,t,n,r,i,o,s,a){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=o,this.component=s,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Fe.U)(e=>Io(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Fe.U)(e=>Io(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ms(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const e=n[r],t=n[r-1];if(e.routeConfig&&""===e.routeConfig.path)r--;else{if(t.component)break;r--}}return function(e){return e.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class gs{constructor(e,t,n,r,i,o,s,a,c,u,l){this.url=e,this.params=t,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=o,this.component=s,this.routeConfig=a,this._urlSegment=c,this._lastPathIndex=u,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=Io(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=Io(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(e=>e.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class _s extends as{constructor(e,t){super(t),this.url=e,vs(this,t)}toString(){return ys(this._root)}}function vs(e,t){t.value._routerState=e,t.children.forEach(t=>vs(e,t))}function ys(e){const t=e.children.length>0?` { ${e.children.map(ys).join(", ")} } `:"";return`${e.value}${t}`}function Es(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Oo(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Oo(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Oo(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Oo(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function Ss(e,t){return Oo(e.params,t.params)&&function(e,t){return Ho(e,t)&&e.every((e,n)=>Oo(e.parameters,t[n].parameters))}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||Ss(e.parent,t.parent))}function Ts(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function(e,t,n){return t.children.map(t=>{for(const r of n.children)if(e.shouldReuseRoute(t.value,r.value.snapshot))return Ts(e,t,r);return Ts(e,t)})}(e,t,n);return new ls(r,i)}{if(e.shouldAttach(t.value)){const n=e.retrieve(t.value);if(null!==n){const e=n.route;return bs(t,e),e}}const n=new fs(new hi((r=t.value).url),new hi(r.params),new hi(r.queryParams),new hi(r.fragment),new hi(r.data),r.outlet,r.component,r),i=t.children.map(t=>Ts(e,t));return new ls(n,i)}var r}function bs(e,t){if(e.value.routeConfig!==t.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(e.children.length!==t.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");t.value._futureSnapshot=e.value;for(let n=0;n<e.children.length;++n)bs(e.children[n],t.children[n])}function ws(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function Rs(e){return"object"==typeof e&&null!=e&&e.outlets}function Is(e,t,n,r,i){let o={};return r&&Po(r,(e,t)=>{o[t]=Array.isArray(e)?e.map(e=>`${e}`):`${e}`}),new jo(n.root===e?t:Cs(n.root,e,t),o,i)}function Cs(e,t,n){const r={};return Po(e.children,(e,i)=>{r[i]=e===t?n:Cs(e,t,n)}),new Go(e.segments,r)}class As{constructor(e,t,n){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=n,e&&n.length>0&&ws(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(Rs);if(r&&r!==Do(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Os{constructor(e,t,n){this.segmentGroup=e,this.processChildren=t,this.index=n}}function Ns(e,t,n){if(e||(e=new Go([],{})),0===e.segments.length&&e.hasChildren())return ks(e,t,n);const r=function(e,t,n){let r=0,i=t;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return o;const t=e.segments[i],s=n[r];if(Rs(s))break;const a=`${s}`,c=r<n.length-1?n[r+1]:null;if(i>0&&void 0===a)break;if(a&&c&&"object"==typeof c&&void 0===c.outlets){if(!xs(a,c,t))return o;r+=2}else{if(!xs(a,{},t))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const t=new Go(e.segments.slice(0,r.pathIndex),{});return t.children.primary=new Go(e.segments.slice(r.pathIndex),e.children),ks(t,0,i)}return r.match&&0===i.length?new Go(e.segments,{}):r.match&&!e.hasChildren()?Ds(e,t,n):r.match?ks(e,0,i):Ds(e,t,n)}function ks(e,t,n){if(0===n.length)return new Go(e.segments,{});{const r=function(e){return Rs(e[0])?e[0].outlets:{[wo]:e}}(n),i={};return Po(r,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(i[r]=Ns(e.children[r],t,n))}),Po(e.children,(e,t)=>{void 0===r[t]&&(i[t]=e)}),new Go(e.segments,i)}}function Ds(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const o=n[i];if(Rs(o)){const e=Ps(o.outlets);return new Go(r,e)}if(0===i&&ws(n[0])){r.push(new qo(e.segments[t].path,Ls(n[0]))),i++;continue}const s=Rs(o)?o.outlets.primary:`${o}`,a=i<n.length-1?n[i+1]:null;s&&a&&ws(a)?(r.push(new qo(s,Ls(a))),i+=2):(r.push(new qo(s,{})),i++)}return new Go(r,{})}function Ps(e){const t={};return Po(e,(e,n)=>{"string"==typeof e&&(e=[e]),null!==e&&(t[n]=Ds(new Go([],{}),0,e))}),t}function Ls(e){const t={};return Po(e,(e,n)=>t[n]=`${e}`),t}function xs(e,t,n){return e==n.path&&Oo(t,n.parameters)}class Ms{constructor(e,t,n,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=n,this.forwardEvent=r}activate(e){const t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),Es(this.futureState.root),this.activateChildRoutes(t,n,e)}deactivateChildRoutes(e,t,n){const r=hs(t);e.children.forEach(e=>{const t=e.value.outlet;this.deactivateRoutes(e,r[t],n),delete r[t]}),Po(r,(e,t)=>{this.deactivateRouteAndItsChildren(e,n)})}deactivateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(e,t,i.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}deactivateRouteAndItsChildren(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const n=t.getContext(e.value.outlet);if(n&&n.outlet){const t=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:t,route:e,contexts:r})}}deactivateRouteAndOutlet(e,t){const n=t.getContext(e.value.outlet),r=n&&e.value.component?n.children:t,i=hs(e);for(const o of Object.keys(i))this.deactivateRouteAndItsChildren(i[o],r);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated(),n.attachRef=null,n.resolver=null,n.route=null)}activateChildRoutes(e,t,n){const r=hs(t);e.children.forEach(e=>{this.activateRoutes(e,r[e.value.outlet],n),this.forwardEvent(new To(e.value.snapshot))}),e.children.length&&this.forwardEvent(new Eo(e.value.snapshot))}activateRoutes(e,t,n){const r=e.value,i=t?t.value:null;if(Es(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,i.children)}else this.activateChildRoutes(e,t,n);else if(r.component){const t=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const e=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),t.children.onOutletReAttached(e.contexts),t.attachRef=e.componentRef,t.route=e.route.value,t.outlet&&t.outlet.attach(e.componentRef,e.route.value),Us(e.route)}else{const n=function(e){for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig;if(e&&e.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;t.attachRef=null,t.route=r,t.resolver=i,t.outlet&&t.outlet.activateWith(r,i),this.activateChildRoutes(e,null,t.children)}}else this.activateChildRoutes(e,null,n)}}function Us(e){Es(e.value),e.children.forEach(Us)}class Vs{constructor(e,t){this.routes=e,this.module=t}}function Fs(e){return"function"==typeof e}function Bs(e){return e instanceof jo}const js=Symbol("INITIAL_VALUE");function Gs(){return Oi(e=>function(...e){let t,n;return(0,di.K)(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&(0,pi.k)(e[0])&&(e=e[0]),(0,vi.n)(e,n).lift(new Ei(t))}(e.map(e=>e.pipe(Pi(1),Mi(js)))).pipe(Ui((e,t)=>{let n=!1;return t.reduce((e,r,i)=>{if(e!==js)return e;if(r===js&&(n=!0),!n){if(!1===r)return r;if(i===t.length-1||Bs(r))return r}return e},e)},js),Me(e=>e!==js),(0,Fe.U)(e=>Bs(e)?e:!0===e),Pi(1)))}let qs=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Xpm({type:e,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&r._UZ(0,"router-outlet")},directives:function(){return[Ua]},encapsulation:2}),e})();function Hs(e,t=""){for(let n=0;n<e.length;n++){const r=e[n];Ws(r,zs(t,r))}}function Ws(e,t){e.children&&Hs(e.children,t)}function zs(e,t){return t?e||t.path?e&&!t.path?`${e}/`:!e&&t.path?t.path:`${e}/${t.path}`:"":e}function Ks(e){const t=e.children&&e.children.map(Ks),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&n.outlet!==wo&&(n.component=qs),n}function Ys(e){return e.outlet||wo}function Qs(e,t){const n=e.filter(e=>Ys(e)===t);return n.push(...e.filter(e=>Ys(e)!==t)),n}const Js={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Xs(e,t,n){var r;if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?Object.assign({},Js):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const i=(t.matcher||Ao)(n,e,t);if(!i)return Object.assign({},Js);const o={};Po(i.posParams,(e,t)=>{o[t]=e.path});const s=i.consumed.length>0?Object.assign(Object.assign({},o),i.consumed[i.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:s,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function $s(e,t,n,r,i="corrected"){if(n.length>0&&function(e,t,n){return n.some(n=>Zs(e,t,n)&&Ys(n)!==wo)}(e,n,r)){const i=new Go(t,function(e,t,n,r){const i={};i.primary=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const o of n)if(""===o.path&&Ys(o)!==wo){const n=new Go([],{});n._sourceSegment=e,n._segmentIndexShift=t.length,i[Ys(o)]=n}return i}(e,t,r,new Go(n,e.children)));return i._sourceSegment=e,i._segmentIndexShift=t.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some(n=>Zs(e,t,n))}(e,n,r)){const o=new Go(e.segments,function(e,t,n,r,i,o){const s={};for(const a of r)if(Zs(e,n,a)&&!i[Ys(a)]){const n=new Go([],{});n._sourceSegment=e,n._segmentIndexShift="legacy"===o?e.segments.length:t.length,s[Ys(a)]=n}return Object.assign(Object.assign({},i),s)}(e,t,n,r,e.children,i));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}const o=new Go(e.segments,e.children);return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}function Zs(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function ea(e,t,n,r){return!!(Ys(e)===r||r!==wo&&Zs(t,n,e))&&("**"===e.path||Xs(t,e,n).matched)}function ta(e,t,n){return 0===t.length&&!e.children[n]}class na{constructor(e){this.segmentGroup=e||null}}class ra{constructor(e){this.urlTree=e}}function ia(e){return new De.y(t=>t.error(new na(e)))}function oa(e){return new De.y(t=>t.error(new ra(e)))}function sa(e){return new De.y(t=>t.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e}'`)))}class aa{constructor(e,t,n,i,o){this.configLoader=t,this.urlSerializer=n,this.urlTree=i,this.config=o,this.allowRedirects=!0,this.ngModule=e.get(r.h0i)}apply(){const e=$s(this.urlTree.root,[],[],this.config).segmentGroup,t=new Go(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,wo).pipe((0,Fe.U)(e=>this.createUrlTree(ca(e),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Bi(e=>{if(e instanceof ra)return this.allowRedirects=!1,this.match(e.urlTree);if(e instanceof na)throw this.noMatchError(e);throw e}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,wo).pipe((0,Fe.U)(t=>this.createUrlTree(ca(t),e.queryParams,e.fragment))).pipe(Bi(e=>{if(e instanceof na)throw this.noMatchError(e);throw e}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,n){const r=e.segments.length>0?new Go([],{[wo]:e}):e;return new jo(r,t,n)}expandSegmentGroup(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe((0,Fe.U)(e=>new Go([],e))):this.expandSegment(e,n,t,n.segments,r,!0)}expandChildren(e,t,n){const r=[];for(const i of Object.keys(n.children))"primary"===i?r.unshift(i):r.push(i);return(0,ci.D)(r).pipe(Le(r=>{const i=n.children[r],o=Qs(t,r);return this.expandSegmentGroup(e,o,i,r).pipe((0,Fe.U)(e=>({segment:e,outlet:r})))}),Ui((e,t)=>(e[t.outlet]=t.segment,e),{}),function(e,t){const n=arguments.length>=2;return r=>r.pipe(e?Me((t,n)=>e(t,n,r)):Zi.y,qi(1),n?Ji(t):zi(()=>new Ti))}())}expandSegment(e,t,n,r,i,o){return(0,ci.D)(n).pipe(Le(s=>this.expandSegmentAgainstRoute(e,t,n,s,r,i,o).pipe(Bi(e=>{if(e instanceof na)return(0,ke.of)(null);throw e}))),eo(e=>!!e),Bi((e,n)=>{if(e instanceof Ti||"EmptyError"===e.name){if(ta(t,r,i))return(0,ke.of)(new Go([],{}));throw new na(t)}throw e}))}expandSegmentAgainstRoute(e,t,n,r,i,o,s){return ea(r,t,i,o)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i,o):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,o):ia(t):ia(t)}expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,o){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?oa(i):this.lineralizeSegments(n,i).pipe((0,Pe.zg)(n=>{const i=new Go(n,{});return this.expandSegment(e,i,t,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,o){const{matched:s,consumedSegments:a,lastChild:c,positionalParamSegments:u}=Xs(t,r,i);if(!s)return ia(t);const l=this.applyRedirectCommands(a,r.redirectTo,u);return r.redirectTo.startsWith("/")?oa(l):this.lineralizeSegments(r,l).pipe((0,Pe.zg)(r=>this.expandSegment(e,t,n,r.concat(i.slice(c)),o,!1)))}matchSegmentAgainstRoute(e,t,n,r,i){if("**"===n.path)return n.loadChildren?(n._loadedConfig?(0,ke.of)(n._loadedConfig):this.configLoader.load(e.injector,n)).pipe((0,Fe.U)(e=>(n._loadedConfig=e,new Go(r,{})))):(0,ke.of)(new Go(r,{}));const{matched:o,consumedSegments:s,lastChild:a}=Xs(t,n,r);if(!o)return ia(t);const c=r.slice(a);return this.getChildConfig(e,n,r).pipe((0,Pe.zg)(e=>{const r=e.module,o=e.routes,{segmentGroup:a,slicedSegments:u}=$s(t,s,c,o),l=new Go(a.segments,a.children);if(0===u.length&&l.hasChildren())return this.expandChildren(r,o,l).pipe((0,Fe.U)(e=>new Go(s,e)));if(0===o.length&&0===u.length)return(0,ke.of)(new Go(s,{}));const h=Ys(n)===i;return this.expandSegment(r,l,o,u,h?wo:i,!0).pipe((0,Fe.U)(e=>new Go(s.concat(e.segments),e.children)))}))}getChildConfig(e,t,n){return t.children?(0,ke.of)(new Vs(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?(0,ke.of)(t._loadedConfig):this.runCanLoadGuards(e.injector,t,n).pipe((0,Pe.zg)(n=>n?this.configLoader.load(e.injector,t).pipe((0,Fe.U)(e=>(t._loadedConfig=e,e))):function(e){return new De.y(t=>t.error(Co(`Cannot load children because the guard of the route "path: '${e.path}'" returned false`)))}(t))):(0,ke.of)(new Vs([],e))}runCanLoadGuards(e,t,n){const r=t.canLoad;if(!r||0===r.length)return(0,ke.of)(!0);const i=r.map(r=>{const i=e.get(r);let o;if(function(e){return e&&Fs(e.canLoad)}(i))o=i.canLoad(t,n);else{if(!Fs(i))throw new Error("Invalid CanLoad guard");o=i(t,n)}return Lo(o)});return(0,ke.of)(i).pipe(Gs(),(0,to.b)(e=>{if(!Bs(e))return;const t=Co(`Redirecting to "${this.urlSerializer.serialize(e)}"`);throw t.url=e,t}),(0,Fe.U)(e=>!0===e))}lineralizeSegments(e,t){let n=[],r=t.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return(0,ke.of)(n);if(r.numberOfChildren>1||!r.children.primary)return sa(e.redirectTo);r=r.children.primary}}applyRedirectCommands(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}applyRedirectCreatreUrlTree(e,t,n,r){const i=this.createSegmentGroup(e,t.root,n,r);return new jo(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const n={};return Po(e,(e,r)=>{if("string"==typeof e&&e.startsWith(":")){const i=e.substring(1);n[r]=t[i]}else n[r]=e}),n}createSegmentGroup(e,t,n,r){const i=this.createSegments(e,t.segments,n,r);let o={};return Po(t.children,(t,i)=>{o[i]=this.createSegmentGroup(e,t,n,r)}),new Go(i,o)}createSegments(e,t,n,r){return t.map(t=>t.path.startsWith(":")?this.findPosParam(e,t,r):this.findOrReturn(t,n))}findPosParam(e,t,n){const r=n[t.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return r}findOrReturn(e,t){let n=0;for(const r of t){if(r.path===e.path)return t.splice(n),r;n++}return e}}function ca(e){const t={};for(const n of Object.keys(e.children)){const r=ca(e.children[n]);(r.segments.length>0||r.hasChildren())&&(t[n]=r)}return function(e){if(1===e.numberOfChildren&&e.children.primary){const t=e.children.primary;return new Go(e.segments.concat(t.segments),t.children)}return e}(new Go(e.segments,t))}class ua{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class la{constructor(e,t){this.component=e,this.route=t}}function ha(e,t,n){const r=e._root;return pa(r,t?t._root:null,n,[r.value])}function da(e,t,n){const r=function(e){if(!e)return null;for(let t=e.parent;t;t=t.parent){const e=t.routeConfig;if(e&&e._loadedConfig)return e._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function pa(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=hs(t);return e.children.forEach(e=>{!function(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=e.value,s=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const c=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Ho(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Ho(e.url,t.url)||!Oo(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Ss(e,t)||!Oo(e.queryParams,t.queryParams);case"paramsChange":default:return!Ss(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new ua(r)):(o.data=s.data,o._resolvedData=s._resolvedData),pa(e,t,o.component?a?a.children:null:n,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new la(a.outlet.component,s))}else s&&fa(t,a,i),i.canActivateChecks.push(new ua(r)),pa(e,null,o.component?a?a.children:null:n,r,i)}(e,o[e.value.outlet],n,r.concat([e.value]),i),delete o[e.value.outlet]}),Po(o,(e,t)=>fa(e,n.getContext(t),i)),i}function fa(e,t,n){const r=hs(e),i=e.value;Po(r,(e,r)=>{fa(e,i.component?t?t.children.getContext(r):null:t,n)}),n.canDeactivateChecks.push(new la(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}class ma{}function ga(e){return new De.y(t=>t.error(e))}class _a{constructor(e,t,n,r,i,o){this.rootComponentType=e,this.config=t,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=o}recognize(){const e=$s(this.urlTree.root,[],[],this.config.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,wo);if(null===t)return null;const n=new gs([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},wo,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new ls(n,t),i=new _s(this.url,r);return this.inheritParamsAndData(i._root),i}inheritParamsAndData(e){const t=e.value,n=ms(t,this.paramsInheritanceStrategy);t.params=Object.freeze(n.params),t.data=Object.freeze(n.data),e.children.forEach(e=>this.inheritParamsAndData(e))}processSegmentGroup(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}processChildren(e,t){const n=[];for(const i of Object.keys(t.children)){const r=t.children[i],o=Qs(e,i),s=this.processSegmentGroup(o,r,i);if(null===s)return null;n.push(...s)}const r=ya(n);return r.sort((e,t)=>e.value.outlet===wo?-1:t.value.outlet===wo?1:e.value.outlet.localeCompare(t.value.outlet)),r}processSegment(e,t,n,r){for(const i of e){const e=this.processSegmentAgainstRoute(i,t,n,r);if(null!==e)return e}return ta(t,n,r)?[]:null}processSegmentAgainstRoute(e,t,n,r){if(e.redirectTo||!ea(e,t,n,r))return null;let i,o=[],s=[];if("**"===e.path){const r=n.length>0?Do(n).parameters:{};i=new gs(n,r,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Ta(e),Ys(e),e.component,e,Ea(t),Sa(t)+n.length,ba(e))}else{const r=Xs(t,e,n);if(!r.matched)return null;o=r.consumedSegments,s=n.slice(r.lastChild),i=new gs(o,r.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,Ta(e),Ys(e),e.component,e,Ea(t),Sa(t)+o.length,ba(e))}const a=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),{segmentGroup:c,slicedSegments:u}=$s(t,o,s,a.filter(e=>void 0===e.redirectTo),this.relativeLinkResolution);if(0===u.length&&c.hasChildren()){const e=this.processChildren(a,c);return null===e?null:[new ls(i,e)]}if(0===a.length&&0===u.length)return[new ls(i,[])];const l=Ys(e)===r,h=this.processSegment(a,c,u,l?wo:r);return null===h?null:[new ls(i,h)]}}function va(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function ya(e){const t=[],n=new Set;for(const r of e){if(!va(r)){t.push(r);continue}const e=t.find(e=>r.value.routeConfig===e.value.routeConfig);void 0!==e?(e.children.push(...r.children),n.add(e)):t.push(r)}for(const r of n){const e=ya(r.children);t.push(new ls(r.value,e))}return t.filter(e=>!n.has(e))}function Ea(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function Sa(e){let t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift?t._segmentIndexShift:0;return n-1}function Ta(e){return e.data||{}}function ba(e){return e.resolve||{}}function wa(e){return Oi(t=>{const n=e(t);return n?(0,ci.D)(n).pipe((0,Fe.U)(()=>t)):(0,ke.of)(t)})}class Ra extends class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const Ia=new r.OlP("ROUTES");class Ca{constructor(e,t,n,r){this.loader=e,this.compiler=t,this.onLoadStartListener=n,this.onLoadEndListener=r}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const n=this.loadModuleFactory(t.loadChildren).pipe((0,Fe.U)(n=>{this.onLoadEndListener&&this.onLoadEndListener(t);const i=n.create(e);return new Vs(ko(i.injector.get(Ia,void 0,r.XFs.Self|r.XFs.Optional)).map(Ks),i)}),Bi(e=>{throw t._loader$=void 0,e}));return t._loader$=new Ci.c(n,()=>new ui.xQ).pipe((0,no.x)()),t._loader$}loadModuleFactory(e){return"string"==typeof e?(0,ci.D)(this.loader.load(e)):Lo(e()).pipe((0,Pe.zg)(e=>e instanceof r.YKP?(0,ke.of)(e):(0,ci.D)(this.compiler.compileModuleAsync(e))))}}class Aa{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Oa,this.attachRef=null}}class Oa{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new Aa,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}class Na{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function ka(e){throw e}function Da(e,t,n){return t.parse("/")}function Pa(e,t){return(0,ke.of)(null)}const La={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},xa={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ma=(()=>{class e{constructor(e,t,n,i,o,s,a,c){this.rootComponentType=e,this.urlSerializer=t,this.rootContexts=n,this.location=i,this.config=c,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new ui.xQ,this.errorHandler=ka,this.malformedUriErrorHandler=Da,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Pa,afterPreactivation:Pa},this.urlHandlingStrategy=new Na,this.routeReuseStrategy=new Ra,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=o.get(r.h0i),this.console=o.get(r.c2e);const u=o.get(r.R0b);this.isNgZoneEnabled=u instanceof r.R0b&&r.R0b.isInAngularZone(),this.resetConfig(c),this.currentUrlTree=new jo(new Go([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new Ca(s,a,e=>this.triggerEvent(new _o(e)),e=>this.triggerEvent(new vo(e))),this.routerState=ps(this.currentUrlTree,this.rootComponentType),this.transitions=new hi({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}setupNavigations(e){const t=this.events;return e.pipe(Me(e=>0!==e.id),(0,Fe.U)(e=>Object.assign(Object.assign({},e),{extractedUrl:this.urlHandlingStrategy.extract(e.rawUrl)})),Oi(e=>{let n=!1,r=!1;return(0,ke.of)(e).pipe((0,to.b)(e=>{this.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Oi(e=>{const n=!this.navigated||e.extractedUrl.toString()!==this.browserUrlTree.toString();if(("reload"===this.onSameUrlNavigation||n)&&this.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return(0,ke.of)(e).pipe(Oi(e=>{const n=this.transitions.getValue();return t.next(new ao(e.id,this.serializeUrl(e.extractedUrl),e.source,e.restoredState)),n!==this.transitions.getValue()?Ri.E:Promise.resolve(e)}),function(e,t,n,r){return Oi(i=>function(e,t,n,r,i){return new aa(e,t,n,r,i).apply()}(e,t,n,i.extractedUrl,r).pipe((0,Fe.U)(e=>Object.assign(Object.assign({},i),{urlAfterRedirects:e}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),(0,to.b)(e=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:e.urlAfterRedirects})}),function(e,t,n,r,i){return(0,Pe.zg)(o=>function(e,t,n,r,i="emptyOnly",o="legacy"){try{const s=new _a(e,t,n,r,i,o).recognize();return null===s?ga(new ma):(0,ke.of)(s)}catch(jR){return ga(jR)}}(e,t,o.urlAfterRedirects,n(o.urlAfterRedirects),r,i).pipe((0,Fe.U)(e=>Object.assign(Object.assign({},o),{targetSnapshot:e}))))}(this.rootComponentType,this.config,e=>this.serializeUrl(e),this.paramsInheritanceStrategy,this.relativeLinkResolution),(0,to.b)(e=>{"eager"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(e.urlAfterRedirects,e),this.browserUrlTree=e.urlAfterRedirects);const n=new ho(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.next(n)}));if(n&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:o,extras:s}=e,a=new ao(n,this.serializeUrl(r),i,o);t.next(a);const c=ps(r,this.rootComponentType).snapshot;return(0,ke.of)(Object.assign(Object.assign({},e),{targetSnapshot:c,urlAfterRedirects:r,extras:Object.assign(Object.assign({},s),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=e.rawUrl,this.browserUrlTree=e.urlAfterRedirects,e.resolve(null),Ri.E}),wa(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:o,replaceUrl:s}}=e;return this.hooks.beforePreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!o,replaceUrl:!!s})}),(0,to.b)(e=>{const t=new po(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),(0,Fe.U)(e=>Object.assign(Object.assign({},e),{guards:ha(e.targetSnapshot,e.currentSnapshot,this.rootContexts)})),function(e,t){return(0,Pe.zg)(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:s}}=n;return 0===s.length&&0===o.length?(0,ke.of)(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return(0,ci.D)(e).pipe((0,Pe.zg)(e=>function(e,t,n,r,i){const o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;if(!o||0===o.length)return(0,ke.of)(!0);const s=o.map(o=>{const s=da(o,t,i);let a;if(function(e){return e&&Fs(e.canDeactivate)}(s))a=Lo(s.canDeactivate(e,t,n,r));else{if(!Fs(s))throw new Error("Invalid CanDeactivate guard");a=Lo(s(e,t,n,r))}return a.pipe(eo())});return(0,ke.of)(s).pipe(Gs())}(e.component,e.route,n,t,r)),eo(e=>!0!==e,!0))}(s,r,i,e).pipe((0,Pe.zg)(n=>n&&"boolean"==typeof n?function(e,t,n,r){return(0,ci.D)(t).pipe(Le(t=>wi(function(e,t){return null!==e&&t&&t(new yo(e)),(0,ke.of)(!0)}(t.route.parent,r),function(e,t){return null!==e&&t&&t(new So(e)),(0,ke.of)(!0)}(t.route,r),function(e,t,n){const r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map(e=>function(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)).filter(e=>null!==e).map(t=>Ii(()=>{const i=t.guards.map(i=>{const o=da(i,t.node,n);let s;if(function(e){return e&&Fs(e.canActivateChild)}(o))s=Lo(o.canActivateChild(r,e));else{if(!Fs(o))throw new Error("Invalid CanActivateChild guard");s=Lo(o(r,e))}return s.pipe(eo())});return(0,ke.of)(i).pipe(Gs())}));return(0,ke.of)(i).pipe(Gs())}(e,t.path,n),function(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return(0,ke.of)(!0);const i=r.map(r=>Ii(()=>{const i=da(r,t,n);let o;if(function(e){return e&&Fs(e.canActivate)}(i))o=Lo(i.canActivate(t,e));else{if(!Fs(i))throw new Error("Invalid CanActivate guard");o=Lo(i(t,e))}return o.pipe(eo())}));return(0,ke.of)(i).pipe(Gs())}(e,t.route,n))),eo(e=>!0!==e,!0))}(r,o,e,t):(0,ke.of)(n)),(0,Fe.U)(e=>Object.assign(Object.assign({},n),{guardsResult:e})))})}(this.ngModule.injector,e=>this.triggerEvent(e)),(0,to.b)(e=>{if(Bs(e.guardsResult)){const t=Co(`Redirecting to "${this.serializeUrl(e.guardsResult)}"`);throw t.url=e.guardsResult,t}const t=new fo(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);this.triggerEvent(t)}),Me(e=>!!e.guardsResult||(this.cancelNavigationTransition(e,""),!1)),wa(e=>{if(e.guards.canActivateChecks.length)return(0,ke.of)(e).pipe((0,to.b)(e=>{const t=new mo(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}),Oi(e=>{let t=!1;return(0,ke.of)(e).pipe((n=this.paramsInheritanceStrategy,r=this.ngModule.injector,(0,Pe.zg)(e=>{const{targetSnapshot:t,guards:{canActivateChecks:i}}=e;if(!i.length)return(0,ke.of)(e);let o=0;return(0,ci.D)(i).pipe(Le(e=>function(e,t,n,r){return function(e,t,n,r){const i=Object.keys(e);if(0===i.length)return(0,ke.of)({});const o={};return(0,ci.D)(i).pipe((0,Pe.zg)(i=>function(e,t,n,r){const i=da(e,t,r);return Lo(i.resolve?i.resolve(t,n):i(t,n))}(e[i],t,n,r).pipe((0,to.b)(e=>{o[i]=e}))),qi(1),(0,Pe.zg)(()=>Object.keys(o).length===i.length?(0,ke.of)(o):Ri.E))}(e._resolve,e,t,r).pipe((0,Fe.U)(t=>(e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),ms(e,n).resolve),null)))}(e.route,t,n,r)),(0,to.b)(()=>o++),qi(1),(0,Pe.zg)(t=>o===i.length?(0,ke.of)(e):Ri.E))})),(0,to.b)({next:()=>t=!0,complete:()=>{t||this.cancelNavigationTransition(e,"At least one route resolver didn't emit any value.")}}));var n,r}),(0,to.b)(e=>{const t=new go(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);this.triggerEvent(t)}))}),wa(e=>{const{targetSnapshot:t,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:o,replaceUrl:s}}=e;return this.hooks.afterPreactivation(t,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!o,replaceUrl:!!s})}),(0,Fe.U)(e=>{const t=function(e,t,n){const r=Ts(e,t._root,n?n._root:void 0);return new ds(r,t)}(this.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:t})}),(0,to.b)(e=>{this.currentUrlTree=e.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.rawUrl),this.routerState=e.targetRouterState,"deferred"===this.urlUpdateStrategy&&(e.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,e),this.browserUrlTree=e.urlAfterRedirects)}),(o=this.rootContexts,s=this.routeReuseStrategy,a=e=>this.triggerEvent(e),(0,Fe.U)(e=>(new Ms(s,e.targetRouterState,e.currentRouterState,a).activate(o),e))),(0,to.b)({next(){n=!0},complete(){n=!0}}),(i=()=>{n||r||this.cancelNavigationTransition(e,`Navigation ID ${e.id} is not equal to the current navigation id ${this.navigationId}`),this.currentNavigation=null},e=>e.lift(new io(i))),Bi(n=>{if(r=!0,(i=n)&&i.ngNavigationCancelingError){const r=Bs(n.url);r||(this.navigated=!0,this.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));const i=new uo(e.id,this.serializeUrl(e.extractedUrl),n.message);t.next(i),r?setTimeout(()=>{const t=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree);this.scheduleNavigation(t,"imperative",null,{skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy},{resolve:e.resolve,reject:e.reject,promise:e.promise})},0):e.resolve(!1)}else{this.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);const r=new lo(e.id,this.serializeUrl(e.extractedUrl),n);t.next(r);try{e.resolve(this.errorHandler(n))}catch(d_){e.reject(d_)}}var i;return Ri.E}));var i,o,s,a}))}resetRootComponentType(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}getTransition(){const e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}setTransition(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(e=>{const t=this.extractLocationChangeInfoFromEvent(e);this.shouldScheduleNavigation(this.lastLocationChangeInfo,t)&&setTimeout(()=>{const{source:e,state:n,urlTree:r}=t,i={replaceUrl:!0};if(n){const e=Object.assign({},n);delete e.navigationId,delete e.\u0275routerPageId,0!==Object.keys(e).length&&(i.state=e)}this.scheduleNavigation(r,e,n,i)},0),this.lastLocationChangeInfo=t}))}extractLocationChangeInfoFromEvent(e){var t;return{source:"popstate"===e.type?"popstate":"hashchange",urlTree:this.parseUrl(e.url),state:(null===(t=e.state)||void 0===t?void 0:t.navigationId)?e.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(e,t){if(!e)return!0;const n=t.urlTree.toString()===e.urlTree.toString();return!(t.transitionId===e.transitionId&&n&&("hashchange"===t.source&&"popstate"===e.source||"popstate"===t.source&&"hashchange"===e.source))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(e){this.events.next(e)}resetConfig(e){Hs(e),this.config=e.map(Ks),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(e,t={}){const{relativeTo:n,queryParams:r,fragment:i,queryParamsHandling:o,preserveFragment:s}=t,a=n||this.routerState.root,c=s?this.currentUrlTree.fragment:i;let u=null;switch(o){case"merge":u=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=r||null}return null!==u&&(u=this.removeEmptyProps(u)),function(e,t,n,r,i){if(0===n.length)return Is(t.root,t.root,t,r,i);const o=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new As(!0,0,e);let t=0,n=!1;const r=e.reduce((e,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const t={};return Po(r.outlets,(e,n)=>{t[n]="string"==typeof e?e.split("/"):e}),[...e,{outlets:t}]}if(r.segmentPath)return[...e,r.segmentPath]}return"string"!=typeof r?[...e,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))}),e):[...e,r]},[]);return new As(n,t,r)}(n);if(o.toRoot())return Is(t.root,new Go([],{}),t,r,i);const s=function(e,t,n){if(e.isAbsolute)return new Os(t.root,!0,0);if(-1===n.snapshot._lastPathIndex){const e=n.snapshot._urlSegment;return new Os(e,e===t.root,0)}const r=ws(e.commands[0])?0:1;return function(e,t,n){let r=e,i=t,o=n;for(;o>i;){if(o-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new Os(r,!1,i-o)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(o,t,e),a=s.processChildren?ks(s.segmentGroup,s.index,o.commands):Ns(s.segmentGroup,s.index,o.commands);return Is(s.segmentGroup,a,t,r,i)}(a,this.currentUrlTree,e,u,null!=c?c:null)}navigateByUrl(e,t={skipLocationChange:!1}){const n=Bs(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);let i=null;return"computed"===this.canceledNavigationResolution&&(0===this.currentPageId||t.skipLocationChange||t.replaceUrl)&&(i=this.location.getState()),this.scheduleNavigation(r,"imperative",i,t)}navigate(e,t={skipLocationChange:!1}){return function(e){for(let t=0;t<e.length;t++){const n=e[t];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${t}`)}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){let t;try{t=this.urlSerializer.parse(e)}catch(jR){t=this.malformedUriErrorHandler(jR,this.urlSerializer,e)}return t}isActive(e,t){let n;if(n=!0===t?Object.assign({},La):!1===t?Object.assign({},xa):t,Bs(e))return Uo(this.currentUrlTree,e,n);const r=this.parseUrl(e);return Uo(this.currentUrlTree,r,n)}removeEmptyProps(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return null!=r&&(t[n]=r),t},{})}processNavigations(){this.navigations.subscribe(e=>{this.navigated=!0,this.lastSuccessfulId=e.id,this.currentPageId=e.targetPageId,this.events.next(new co(e.id,this.serializeUrl(e.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,e.resolve(!0)},e=>{this.console.warn("Unhandled Navigation Error: ")})}scheduleNavigation(e,t,n,r,i){if(this.disposed)return Promise.resolve(!1);const o=this.getTransition(),s="imperative"!==t&&"imperative"===(null==o?void 0:o.source),a=(this.lastSuccessfulId===o.id||this.currentNavigation?o.rawUrl:o.urlAfterRedirects).toString()===e.toString();if(s&&a)return Promise.resolve(!0);let c,u,l;i?(c=i.resolve,u=i.reject,l=i.promise):l=new Promise((e,t)=>{c=e,u=t});const h=++this.navigationId;let d;return d="computed"===this.canceledNavigationResolution?n&&n.\u0275routerPageId?n.\u0275routerPageId:this.currentPageId+1:0,this.setTransition({id:h,targetPageId:d,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:c,reject:u,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(e=>Promise.reject(e))}setBrowserUrl(e,t){const n=this.urlSerializer.serialize(e),r=Object.assign(Object.assign({},t.extras.state),this.generateNgRouterState(t.id,t.targetPageId));this.location.isCurrentPathEqualTo(n)||t.extras.replaceUrl?this.location.replaceState(n,"",r):this.location.go(n,"",r)}resetStateAndUrl(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(e,t){"computed"===this.canceledNavigationResolution?"popstate"!==e.source&&"eager"!==this.urlUpdateStrategy||this.location.historyGo(this.currentPageId-e.targetPageId):this.resetUrlToCurrentUrlTree();const n=new uo(e.id,this.serializeUrl(e.extractedUrl),t);this.triggerEvent(n),e.resolve(!1)}generateNgRouterState(e,t){return"computed"===this.canceledNavigationResolution?{navigationId:e,"\u0275routerPageId":t}:{navigationId:e}}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(r.DyG),r.LFG(Wo),r.LFG(Oa),r.LFG(S),r.LFG(r.zs3),r.LFG(r.v3s),r.LFG(r.Sil),r.LFG(void 0))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),Ua=(()=>{class e{constructor(e,t,n,i,o){this.parentContexts=e,this.location=t,this.resolver=n,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new r.vpe,this.deactivateEvents=new r.vpe,this.name=i||wo,e.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const e=this.activated;return this.activated=null,this._activatedRoute=null,e}attach(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}deactivate(){if(this.activated){const e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;const n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new Va(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(Oa),r.Y36(r.s_b),r.Y36(r._Vd),r.$8M("name"),r.Y36(r.sBO))},e.\u0275dir=r.lG2({type:e,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),e})();class Va{constructor(e,t,n){this.route=e,this.childContexts=t,this.parent=n}get(e,t){return e===fs?this.route:e===Oa?this.childContexts:this.parent.get(e,t)}}class Fa{}class Ba{preload(e,t){return(0,ke.of)(null)}}let ja=(()=>{class e{constructor(e,t,n,r,i){this.router=e,this.injector=r,this.preloadingStrategy=i,this.loader=new Ca(t,n,t=>e.triggerEvent(new _o(t)),t=>e.triggerEvent(new vo(t)))}setUpPreloading(){this.subscription=this.router.events.pipe(Me(e=>e instanceof co),Le(()=>this.preload())).subscribe(()=>{})}preload(){const e=this.injector.get(r.h0i);return this.processRoutes(e,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(e,t){const n=[];for(const r of t)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const e=r._loadedConfig;n.push(this.processRoutes(e.module,e.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(e,r)):r.children&&n.push(this.processRoutes(e,r.children));return(0,ci.D)(n).pipe((0,bi.J)(),(0,Fe.U)(e=>{}))}preloadConfig(e,t){return this.preloadingStrategy.preload(t,()=>(t._loadedConfig?(0,ke.of)(t._loadedConfig):this.loader.load(e.injector,t)).pipe((0,Pe.zg)(e=>(t._loadedConfig=e,this.processRoutes(e.module,e.routes)))))}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(Ma),r.LFG(r.v3s),r.LFG(r.Sil),r.LFG(r.zs3),r.LFG(Fa))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})(),Ga=(()=>{class e{constructor(e,t,n={}){this.router=e,this.viewportScroller=t,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(e=>{e instanceof ao?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=e.navigationTrigger,this.restoredId=e.restoredState?e.restoredState.navigationId:0):e instanceof co&&(this.lastId=e.id,this.scheduleScrollEvent(e,this.router.parseUrl(e.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(e=>{e instanceof bo&&(e.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(e.position):e.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(e.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(e,t){this.router.triggerEvent(new bo(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(Ma),r.LFG(Y),r.LFG(void 0))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();const qa=new r.OlP("ROUTER_CONFIGURATION"),Ha=new r.OlP("ROUTER_FORROOT_GUARD"),Wa=[S,{provide:Wo,useClass:zo},{provide:Ma,useFactory:function(e,t,n,r,i,o,s,a={},c,u){const l=new Ma(null,e,t,n,r,i,o,ko(s));return c&&(l.urlHandlingStrategy=c),u&&(l.routeReuseStrategy=u),function(e,t){e.errorHandler&&(t.errorHandler=e.errorHandler),e.malformedUriErrorHandler&&(t.malformedUriErrorHandler=e.malformedUriErrorHandler),e.onSameUrlNavigation&&(t.onSameUrlNavigation=e.onSameUrlNavigation),e.paramsInheritanceStrategy&&(t.paramsInheritanceStrategy=e.paramsInheritanceStrategy),e.relativeLinkResolution&&(t.relativeLinkResolution=e.relativeLinkResolution),e.urlUpdateStrategy&&(t.urlUpdateStrategy=e.urlUpdateStrategy)}(a,l),a.enableTracing&&l.events.subscribe(e=>{var t,n;null===(t=console.group)||void 0===t||t.call(console,`Router Event: ${e.constructor.name}`),console.log(e.toString()),console.log(e),null===(n=console.groupEnd)||void 0===n||n.call(console)}),l},deps:[Wo,Oa,S,r.zs3,r.v3s,r.Sil,Ia,qa,[class{},new r.FiY],[class{},new r.FiY]]},Oa,{provide:fs,useFactory:function(e){return e.routerState.root},deps:[Ma]},{provide:r.v3s,useClass:r.EAV},ja,Ba,class{preload(e,t){return t().pipe(Bi(()=>(0,ke.of)(null)))}},{provide:qa,useValue:{enableTracing:!1}}];function za(){return new r.PXZ("Router",Ma)}let Ka=(()=>{class e{constructor(e,t){}static forRoot(t,n){return{ngModule:e,providers:[Wa,Xa(t),{provide:Ha,useFactory:Ja,deps:[[Ma,new r.FiY,new r.tp0]]},{provide:qa,useValue:n||{}},{provide:g,useFactory:Qa,deps:[a,[new r.tBr(v),new r.FiY],qa]},{provide:Ga,useFactory:Ya,deps:[Ma,Y,qa]},{provide:Fa,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:Ba},{provide:r.PXZ,multi:!0,useFactory:za},[$a,{provide:r.ip1,multi:!0,useFactory:Za,deps:[$a]},{provide:tc,useFactory:ec,deps:[$a]},{provide:r.tb,multi:!0,useExisting:tc}]]}}static forChild(t){return{ngModule:e,providers:[Xa(t)]}}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(Ha,8),r.LFG(Ma,8))},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({}),e})();function Ya(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new Ga(e,t,n)}function Qa(e,t,n={}){return n.useHash?new E(e,t):new y(e,t)}function Ja(e){return"guarded"}function Xa(e){return[{provide:r.deG,multi:!0,useValue:e},{provide:Ia,multi:!0,useValue:e}]}let $a=(()=>{class e{constructor(e){this.injector=e,this.initNavigation=!1,this.resultOfPreactivationDone=new ui.xQ}appInitializer(){return this.injector.get(u,Promise.resolve(null)).then(()=>{let e=null;const t=new Promise(t=>e=t),n=this.injector.get(Ma),r=this.injector.get(qa);return"disabled"===r.initialNavigation?(n.setUpLocationChangeListener(),e(!0)):"enabled"===r.initialNavigation||"enabledBlocking"===r.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?(0,ke.of)(null):(this.initNavigation=!0,e(!0),this.resultOfPreactivationDone),n.initialNavigation()):e(!0),t})}bootstrapListener(e){const t=this.injector.get(qa),n=this.injector.get(ja),i=this.injector.get(Ga),o=this.injector.get(Ma),s=this.injector.get(r.z2F);e===s.components[0]&&("enabledNonBlocking"!==t.initialNavigation&&void 0!==t.initialNavigation||o.initialNavigation(),n.setUpPreloading(),i.init(),o.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(r.zs3))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();function Za(e){return e.appInitializer.bind(e)}function ec(e){return e.bootstrapListener.bind(e)}const tc=new r.OlP("Router Initializer");function nc(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(u){return void n(u)}a.done?t(c):Promise.resolve(c).then(r,i)}function rc(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){nc(o,r,i,s,a,"next",e)}function a(e){nc(o,r,i,s,a,"throw",e)}s(void 0)})}}var ic=n(2056);function oc(...e){if(1===e.length){const t=e[0];if((0,pi.k)(t))return sc(t,null);if((0,ic.K)(t)&&Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);return sc(e.map(e=>t[e]),e)}}if("function"==typeof e[e.length-1]){const t=e.pop();return sc(e=1===e.length&&(0,pi.k)(e[0])?e[0]:e,null).pipe((0,Fe.U)(e=>t(...e)))}return sc(e,null)}function sc(e,t){return new De.y(n=>{const r=e.length;if(0===r)return void n.complete();const i=new Array(r);let o=0,s=0;for(let a=0;a<r;a++){const c=(0,ci.D)(e[a]);let u=!1;n.add(c.subscribe({next:e=>{u||(u=!0,s++),i[a]=e},error:e=>n.error(e),complete:()=>{o++,o!==r&&u||(s===r&&n.next(t?t.reduce((e,t,n)=>(e[t]=i[n],e),{}):i),n.complete())}}))}})}var ac=n(4762),cc=n(2544),uc=n.n(cc);class lc{constructor(e){this.microphoneAudioTrack=e,this._microphoneAudioTrack=this.microphoneAudioTrack}stop(){this._microphoneAudioTrack.stop(),this._microphoneAudioTrack.close()}microphoneMute(){this._microphoneAudioTrack.setEnabled(!1)}microphoneUnMute(){this._microphoneAudioTrack.setEnabled(!0)}setVolume(e){this._microphoneAudioTrack.setVolume(e)}}class hc{constructor(e,t,n,r,i){this.client=e,this.config=t,this.channelName=n,this.token=r,this.uid=i}WithMediaStream(e){return this.localAudioTrack=uc().createCustomAudioTrack({mediaStreamTrack:e}),this}WithMicrophone(e){return this.requestInWait=uc().createMicrophoneAudioTrack({microphoneId:e}),this}Apply(){return(0,ac.mG)(this,void 0,void 0,function*(){let e;yield this.client.join(this.config.AppID,this.channelName,this.token,this.uid),e=this.requestInWait?yield this.requestInWait:this.localAudioTrack?this.localAudioTrack:yield uc().createMicrophoneAudioTrack(),yield this.client.publish([e]);let t=new lc(e);return new Promise((e,n)=>{e(t),n()})})}}class dc{constructor(e){this.track=e,this._microphoneAudioTrack=this.track[0],this._cameraVideoTrack=this.track[1]}stop(){this._cameraVideoTrack.stop(),this._cameraVideoTrack.close(),this._microphoneAudioTrack.stop(),this._microphoneAudioTrack.close()}playVideo(e,t){this._cameraVideoTrack.play(e,t)}microphoneMute(){this._microphoneAudioTrack.setEnabled(!1)}microphoneUnMute(){this._microphoneAudioTrack.setEnabled(!0)}cameraOff(){this._cameraVideoTrack.setEnabled(!1)}cameraOn(){this._cameraVideoTrack.setEnabled(!0)}setVolume(e){this._microphoneAudioTrack.setVolume(e)}}class pc{constructor(e,t,n,i,o){this.client=e,this.config=t,this.channelName=n,this.token=i,this.uid=o,this.tracks=new Array,this._onLocalUserJoinedEvent=new r.vpe}Apply(){return(0,ac.mG)(this,void 0,void 0,function*(){let e;yield this.client.join(this.config.AppID,this.channelName,this.token,this.uid),e=this.requestInWait?yield this.requestInWait:this.tracks.length>0?this.tracks:yield uc().createMicrophoneAndCameraTracks(),yield this.client.publish(e);let t=new dc(e);return this._onLocalUserJoinedEvent.emit({track:t}),new Promise((e,n)=>{e(t),n()})})}WithMediaStream(e,t){return this.tracks.push(uc().createCustomAudioTrack({mediaStreamTrack:t})),this.tracks.push(uc().createCustomVideoTrack({mediaStreamTrack:e})),this}WithCameraAndMicrophone(e,t){return this.requestInWait=uc().createMicrophoneAndCameraTracks({microphoneId:e},{cameraId:t}),this}registerUserJoinedEvent(e){this._onLocalUserJoinedEvent=e}}class fc{constructor(e){this.cameraVideoTrack=e,this._cameraVideoTrack=this.cameraVideoTrack}stop(){this._cameraVideoTrack.stop(),this._cameraVideoTrack.close()}playVideo(e,t){this._cameraVideoTrack.play(e,t)}cameraOff(){this._cameraVideoTrack.setEnabled(!1)}cameraOn(){this._cameraVideoTrack.setEnabled(!0)}}class mc{constructor(e,t,n,r,i){this.client=e,this.config=t,this.channelName=n,this.token=r,this.uid=i}WithMediaStream(e){return this.localVideoTrack=uc().createCustomVideoTrack({mediaStreamTrack:e}),this}WithCamera(e){return this.requestInWait=uc().createCameraVideoTrack({cameraId:e}),this}Apply(){return(0,ac.mG)(this,void 0,void 0,function*(){let e;yield this.client.join(this.config.AppID,this.channelName,this.token,this.uid),e=this.requestInWait?yield this.requestInWait:this.localVideoTrack?this.localVideoTrack:yield uc().createCameraVideoTrack(),yield this.client.publish(e);let t=new fc(e);return new Promise((e,n)=>{e(t),n()})})}}let gc=(()=>{class e{constructor(e){var t,n,i;this.config=e,this._onRemoteUserStateEvent=new r.vpe,this._onRemoteUserJoinedEvent=new r.vpe,this._onRemoteUserLeftEvent=new r.vpe,this._onRemoteVolumeIndicatorEvent=new r.vpe,this._onLocalUserJoinedEvent=new r.vpe,this._onLocalUserLeftEvent=new r.vpe,this._onLocalNetworkQualityChangeEvent=new r.vpe,this.agoraClient=uc().createClient({codec:e.Video?null===(t=e.Video)||void 0===t?void 0:t.codec:"h264",mode:e.Video?null===(n=e.Video)||void 0===n?void 0:n.mode:"rtc",role:e.Video?null===(i=e.Video)||void 0===i?void 0:i.role:"audience"}),this.agoraClient.on("user-published",(e,t)=>(0,ac.mG)(this,void 0,void 0,function*(){yield this.agoraClient.subscribe(e,t),this._onRemoteUserStateEvent.emit({mediaType:t,connectionState:"CONNECTED",user:{uid:e.uid,hasVideo:e.hasVideo,hasAudio:e.hasAudio,audioTrack:{setVolume:t=>{var n;return null===(n=e.audioTrack)||void 0===n?void 0:n.setVolume(t)},getVolumeLevel:()=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.getVolumeLevel()},play:()=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.play()},getMediaStream:()=>{var t;return new MediaStream([null===(t=e.audioTrack)||void 0===t?void 0:t.getMediaStreamTrack()])}},videoTrack:{play:t=>{var n;return null===(n=e.videoTrack)||void 0===n?void 0:n.play(t)},getMediaStream:()=>{var t;return new MediaStream([null===(t=e.videoTrack)||void 0===t?void 0:t.getMediaStreamTrack()])}}}})})),this.agoraClient.on("user-unpublished",e=>{this._onRemoteUserStateEvent.emit({connectionState:"DISCONNECTED",user:{uid:e.uid,hasVideo:e.hasVideo,hasAudio:e.hasAudio,audioTrack:{setVolume:t=>{var n;return null===(n=e.audioTrack)||void 0===n?void 0:n.setVolume(t)},getVolumeLevel:()=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.getVolumeLevel()},play:()=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.play()},getMediaStream:()=>{var t;return new MediaStream([null===(t=e.audioTrack)||void 0===t?void 0:t.getMediaStreamTrack()])}},videoTrack:{play:t=>{var n;return null===(n=e.videoTrack)||void 0===n?void 0:n.play(t)},getMediaStream:()=>{var t;return new MediaStream([null===(t=e.videoTrack)||void 0===t?void 0:t.getMediaStreamTrack()])}}}})}),this.agoraClient.on("user-joined",e=>{this._onRemoteUserJoinedEvent.emit({uid:e.uid,hasVideo:e.hasVideo,hasAudio:e.hasAudio,audioTrack:{setVolume:t=>{var n;return null===(n=e.audioTrack)||void 0===n?void 0:n.setVolume(t)},getVolumeLevel:()=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.getVolumeLevel()},play:()=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.play()},getMediaStream:()=>{var t;return new MediaStream([null===(t=e.audioTrack)||void 0===t?void 0:t.getMediaStreamTrack()])}},videoTrack:{play:t=>{var n;return null===(n=e.videoTrack)||void 0===n?void 0:n.play(t)},getMediaStream:()=>{var t;return new MediaStream([null===(t=e.videoTrack)||void 0===t?void 0:t.getMediaStreamTrack()])}}})}),this.agoraClient.on("user-left",(e,t)=>{this._onRemoteUserLeftEvent.emit({user:{uid:e.uid,hasVideo:e.hasVideo,hasAudio:e.hasAudio,audioTrack:{setVolume:t=>{var n;return null===(n=e.audioTrack)||void 0===n?void 0:n.setVolume(t)},getVolumeLevel:()=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.getVolumeLevel()},play:()=>{var t;return null===(t=e.audioTrack)||void 0===t?void 0:t.play()},getMediaStream:()=>{var t;return new MediaStream([null===(t=e.audioTrack)||void 0===t?void 0:t.getMediaStreamTrack()])}},videoTrack:{play:t=>{var n;return null===(n=e.videoTrack)||void 0===n?void 0:n.play(t)},getMediaStream:()=>{var t;return new MediaStream([null===(t=e.videoTrack)||void 0===t?void 0:t.getMediaStreamTrack()])}}},reason:t})}),this.agoraClient.enableAudioVolumeIndicator(),this.agoraClient.on("volume-indicator",e=>{this._onRemoteVolumeIndicatorEvent.emit(e)}),this.agoraClient.on("network-quality",e=>{this._onLocalNetworkQualityChangeEvent.emit({download:e.downlinkNetworkQuality,upload:e.uplinkNetworkQuality})})}join(e,t,n){let r=new pc(this.agoraClient,this.config,e,t,n);return r.registerUserJoinedEvent(this._onLocalUserJoinedEvent),r}joinVideo(e,t,n){return new mc(this.agoraClient,this.config,e,t,n)}joinAudio(e,t,n){return new hc(this.agoraClient,this.config,e,t,n)}leave(){return(0,ac.mG)(this,void 0,void 0,function*(){yield this.agoraClient.leave(),this._onLocalUserLeftEvent.emit()})}getCameras(){return uc().getCameras()}getMicrophones(){return uc().getMicrophones()}getDevices(){return uc().getDevices()}onRemoteUsersStatusChange(){return this._onRemoteUserStateEvent.asObservable()}onRemoteUserJoined(){return this._onRemoteUserJoinedEvent.asObservable()}onRemoteUserLeft(){return this._onRemoteUserLeftEvent.asObservable()}onRemoteVolumeIndicator(){return this._onRemoteVolumeIndicatorEvent.asObservable()}onLocalUserJoined(){return this._onLocalUserJoinedEvent.asObservable()}onLocalUserLeft(){return this._onLocalUserLeftEvent.asObservable()}onLocalNetworkQualityChange(){return this._onLocalNetworkQualityChangeEvent.asObservable()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG("config"))},e.\u0275prov=(0,r.Yz7)({factory:function(){return new e((0,r.LFG)("config"))},token:e,providedIn:"root"}),e})(),_c=(()=>{class e{static forRoot(t){return{ngModule:e,providers:[gc,{provide:"config",useValue:t}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[]]}),e})();var vc=function(e){return e[e.audio=0]="audio",e[e.video=1]="video",e[e.all=2]="all",e}({});let yc=(()=>{class e{constructor(e){this.agoraService=e,this.mediaDevicesInfos=[],this.selectedAudioOutputId=new hi(""),this.selectedVideoInputId=new hi(""),this.selectedAudioInputId=new hi("")}set audioInputId(e){this.selectedAudioInputId.next(e)}set audioOutputId(e){this.selectedAudioOutputId.next(e)}set videoInputId(e){this.selectedVideoInputId.next(e)}getMediaSources(e){var t=this;return rc(function*(){try{t.mediaDevicesInfos=yield t.agoraService.getDevices()}catch(n){console.error(n)}finally{return t.mediaDevicesInfos.filter(t=>t.kind===e)}})()}setSinkID(e,t){return rc(function*(){try{yield e.setSinkId(t)}catch(n){console.error(n)}})()}getMediaStream(e,t,n,r,i){var o=this;return rc(function*(){const s={audio:!1,video:!1};e!==vc.audio&&e!==vc.all||(s.audio=!0,i&&(s.audio={deviceId:i})),e!==vc.video&&e!==vc.all||(s.video=!0,(n&&t||r)&&(s.video={width:t,height:n,deviceId:r}));try{o.lastStream=yield navigator.mediaDevices.getUserMedia(s)}catch(a){console.error(a)}finally{return o.lastStream}})()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(gc))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Ec=n(1225);class Sc{constructor(e,t){this.count=e,this.source=t}call(e,t){return t.subscribe(new Tc(e,this.count,this.source))}}class Tc extends xe.L{constructor(e,t,n){super(e),this.count=t,this.source=n}error(e){if(!this.isStopped){const{source:t,count:n}=this;if(0===n)return super.error(e);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}}}const bc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,wc=function(e){return"string"==typeof e&&bc.test(e)};var Rc,Ic=new Uint8Array(16);function Cc(){if(!Rc&&!(Rc="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Rc(Ic)}for(var Ac=[],Oc=0;Oc<256;++Oc)Ac.push((Oc+256).toString(16).substr(1));const Nc=function(e,t,n){var r=(e=e||{}).random||(e.rng||Cc)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Ac[e[t+0]]+Ac[e[t+1]]+Ac[e[t+2]]+Ac[e[t+3]]+"-"+Ac[e[t+4]]+Ac[e[t+5]]+"-"+Ac[e[t+6]]+Ac[e[t+7]]+"-"+Ac[e[t+8]]+Ac[e[t+9]]+"-"+Ac[e[t+10]]+Ac[e[t+11]]+Ac[e[t+12]]+Ac[e[t+13]]+Ac[e[t+14]]+Ac[e[t+15]]).toLowerCase();if(!wc(n))throw TypeError("Stringified UUID is invalid");return n}(r)};let kc=(()=>{class e{constructor(e){this.httpClinet=e,this.token=new ui.xQ}getToken(e){this.httpClinet.get("https://ngx-agora-sdk-ng.herokuapp.com/access_token",{params:{channel:e}}).pipe(function(e=-1){return t=>t.lift(new Sc(e,t))}(3),Pi(1),Bi(this.handleError)).subscribe(e=>{this.token.next(e.token)})}getChannel(e){const t=e.split("@");return!wc(t[0])||isNaN(parseInt(t[2],10))||isNaN(parseInt(t[3],10))?{error:"Your Link is not Valid!"}:Date.now()>1e3*(+t[2]+ +t[3])?{error:"Your Link is Expired!"}:{channel:t[1]}}getLink(e){return`${Nc()}@${e}@8640@${Math.floor(Date.now()/1e3)}`}handleError(e){return e.error instanceof ErrorEvent?console.error("An error occurred:",e.error.message):console.error(`Backend returned code ${e.status}, body was: ${e.error}`),(0,Ec._)("Something bad happened; please try again later.")}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(it))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Dc={prefix:"fas",iconName:"microphone-alt",icon:[352,512,[],"f3c9","M336 192h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16zM176 352c53.02 0 96-42.98 96-96h-85.33c-5.89 0-10.67-3.58-10.67-8v-16c0-4.42 4.78-8 10.67-8H272v-32h-85.33c-5.89 0-10.67-3.58-10.67-8v-16c0-4.42 4.78-8 10.67-8H272v-32h-85.33c-5.89 0-10.67-3.58-10.67-8v-16c0-4.42 4.78-8 10.67-8H272c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96z"]},Pc={prefix:"fas",iconName:"microphone-alt-slash",icon:[640,512,[],"f539","M633.82 458.1L476.26 336.33C488.74 312.21 496 284.98 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67h-43.67l-41.4-32H416v-32h-85.33c-5.89 0-10.67-3.58-10.67-8v-16c0-4.42 4.78-8 10.67-8H416v-32h-85.33c-5.89 0-10.67-3.58-10.67-8v-16c0-4.42 4.78-8 10.67-8H416c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.78c11.71-1.62 23.1-4.28 33.96-8.08l-50.4-38.96c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z"]},Lc={prefix:"fas",iconName:"phone-alt",icon:[512,512,[],"f879","M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"]};function xc(e){return(xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Uc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){Mc(e,t,n[t])})}return e}function Vc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(c){i=!0,o=c}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Fc={},Bc={};try{"undefined"!=typeof window&&(Fc=window),"undefined"!=typeof document&&(Bc=document),"undefined"!=typeof MutationObserver&&MutationObserver,"undefined"!=typeof performance&&performance}catch(jR){}var jc=(Fc.navigator||{}).userAgent,Gc=void 0===jc?"":jc,qc=Fc,Hc=Bc,Wc=!!Hc.documentElement&&!!Hc.head&&"function"==typeof Hc.addEventListener&&"function"==typeof Hc.createElement,zc=(~Gc.indexOf("MSIE")||Gc.indexOf("Trident/"),"svg-inline--fa"),Kc=[1,2,3,4,5,6,7,8,9,10],Yc=Kc.concat([11,12,13,14,15,16,17,18,19,20]),Qc={GROUP:"group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},Jc=(["xs","sm","lg","fw","ul","li","border","pull-left","pull-right","spin","pulse","rotate-90","rotate-180","rotate-270","flip-horizontal","flip-vertical","flip-both","stack","stack-1x","stack-2x","inverse","layers","layers-text","layers-counter",Qc.GROUP,Qc.SWAP_OPACITY,Qc.PRIMARY,Qc.SECONDARY].concat(Kc.map(function(e){return"".concat(e,"x")})).concat(Yc.map(function(e){return"w-".concat(e)})),qc.FontAwesomeConfig||{});Hc&&"function"==typeof Hc.querySelector&&[["data-family-prefix","familyPrefix"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(e){var t=Vc(e,2),n=t[1],r=function(e){return""===e||"false"!==e&&("true"===e||e)}(function(e){var t=Hc.querySelector("script["+e+"]");if(t)return t.getAttribute(e)}(t[0]));null!=r&&(Jc[n]=r)});var Xc=Uc({},{familyPrefix:"fa",replacementClass:zc,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0},Jc);Xc.autoReplaceSvg||(Xc.observeMutations=!1);var $c=Uc({},Xc);qc.FontAwesomeConfig=$c;var Zc=qc||{};Zc.___FONT_AWESOME___||(Zc.___FONT_AWESOME___={}),Zc.___FONT_AWESOME___.styles||(Zc.___FONT_AWESOME___.styles={}),Zc.___FONT_AWESOME___.hooks||(Zc.___FONT_AWESOME___.hooks={}),Zc.___FONT_AWESOME___.shims||(Zc.___FONT_AWESOME___.shims=[]);var eu=Zc.___FONT_AWESOME___,tu=[];Wc&&((Hc.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Hc.readyState)||Hc.addEventListener("DOMContentLoaded",function e(){Hc.removeEventListener("DOMContentLoaded",e),tu.map(function(e){return e()})}));var nu,ru="pending",iu="settled",ou="fulfilled",su="rejected",au=function(){},cu="undefined"!=typeof global&&void 0!==global.process&&"function"==typeof global.process.emit,uu="undefined"==typeof setImmediate?setTimeout:setImmediate,lu=[];function hu(){for(var e=0;e<lu.length;e++)lu[e][0](lu[e][1]);lu=[],nu=!1}function du(e,t){lu.push([e,t]),nu||(nu=!0,uu(hu,0))}function pu(e){var t=e.owner,n=t._state,r=t._data,i=e[n],o=e.then;if("function"==typeof i){n=ou;try{r=i(r)}catch(jR){_u(o,jR)}}fu(o,r)||(n===ou&&mu(o,r),n===su&&_u(o,r))}function fu(e,t){var n;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"===xc(t))){var r=t.then;if("function"==typeof r)return r.call(t,function(r){n||(n=!0,t===r?gu(e,r):mu(e,r))},function(t){n||(n=!0,_u(e,t))}),!0}}catch(jR){return n||_u(e,jR),!0}return!1}function mu(e,t){e!==t&&fu(e,t)||gu(e,t)}function gu(e,t){e._state===ru&&(e._state=iu,e._data=t,du(yu,e))}function _u(e,t){e._state===ru&&(e._state=iu,e._data=t,du(Eu,e))}function vu(e){e._then=e._then.forEach(pu)}function yu(e){e._state=ou,vu(e)}function Eu(e){e._state=su,vu(e),!e._handled&&cu&&global.process.emit("unhandledRejection",e._data,e)}function Su(e){global.process.emit("rejectionHandled",e)}function Tu(e){if("function"!=typeof e)throw new TypeError("Promise resolver "+e+" is not a function");if(this instanceof Tu==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._then=[],function(e,t){function n(e){_u(t,e)}try{e(function(e){mu(t,e)},n)}catch(jR){n(jR)}}(e,this)}Tu.prototype={constructor:Tu,_state:ru,_then:null,_data:void 0,_handled:!1,then:function(e,t){var n={owner:this,then:new this.constructor(au),fulfilled:e,rejected:t};return!t&&!e||this._handled||(this._handled=!0,this._state===su&&cu&&du(Su,this)),this._state===ou||this._state===su?du(pu,n):this._then.push(n),n.then},catch:function(e){return this.then(null,e)}},Tu.all=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.all().");return new Tu(function(t,n){var r=[],i=0;function o(e){return i++,function(n){r[e]=n,--i||t(r)}}for(var s,a=0;a<e.length;a++)(s=e[a])&&"function"==typeof s.then?s.then(o(a),n):r[a]=s;i||t(r)})},Tu.race=function(e){if(!Array.isArray(e))throw new TypeError("You must pass an array to Promise.race().");return new Tu(function(t,n){for(var r,i=0;i<e.length;i++)(r=e[i])&&"function"==typeof r.then?r.then(t,n):t(r)})},Tu.resolve=function(e){return e&&"object"===xc(e)&&e.constructor===Tu?e:new Tu(function(t){t(e)})},Tu.reject=function(e){return new Tu(function(t,n){n(e)})};var bu={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function wu(){for(var e=12,t="";e-- >0;)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[62*Math.random()|0];return t}function Ru(e){return"".concat(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Iu(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,": ").concat(e[n],";")},"")}function Cu(e){return e.size!==bu.size||e.x!==bu.x||e.y!==bu.y||e.rotate!==bu.rotate||e.flipX||e.flipY}function Au(e){var t=e.transform,n=e.iconWidth,r={transform:"translate(".concat(e.containerWidth/2," 256)")},i="translate(".concat(32*t.x,", ").concat(32*t.y,") "),o="scale(".concat(t.size/16*(t.flipX?-1:1),", ").concat(t.size/16*(t.flipY?-1:1),") "),s="rotate(".concat(t.rotate," 0 0)");return{outer:r,inner:{transform:"".concat(i," ").concat(o," ").concat(s)},path:{transform:"translate(".concat(n/2*-1," -256)")}}}var Ou={x:0,y:0,width:"100%",height:"100%"};function Nu(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e.attributes&&(e.attributes.fill||t)&&(e.attributes.fill="black"),e}function ku(e){var t=e.icons,n=t.main,r=t.mask,i=e.prefix,o=e.iconName,s=e.transform,a=e.symbol,c=e.title,u=e.maskId,l=e.titleId,h=e.extra,d=e.watchable,p=void 0!==d&&d,f=r.found?r:n,m=f.width,g=f.height,_="fak"===i,v=_?"":"fa-w-".concat(Math.ceil(m/g*16)),y=[$c.replacementClass,o?"".concat($c.familyPrefix,"-").concat(o):"",v].filter(function(e){return-1===h.classes.indexOf(e)}).filter(function(e){return""!==e||!!e}).concat(h.classes).join(" "),E={children:[],attributes:Uc({},h.attributes,{"data-prefix":i,"data-icon":o,class:y,role:h.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(m," ").concat(g)})},S=_&&!~h.classes.indexOf("fa-fw")?{width:"".concat(m/g*16*.0625,"em")}:{};p&&(E.attributes["data-fa-i2svg"]=""),c&&E.children.push({tag:"title",attributes:{id:E.attributes["aria-labelledby"]||"title-".concat(l||wu())},children:[c]});var T=Uc({},E,{prefix:i,iconName:o,main:n,mask:r,maskId:u,transform:s,symbol:a,styles:Uc({},S,h.styles)}),b=r.found&&n.found?function(e){var t,n=e.children,r=e.attributes,i=e.main,o=e.mask,s=e.maskId,a=i.icon,c=o.icon,u=Au({transform:e.transform,containerWidth:o.width,iconWidth:i.width}),l={tag:"rect",attributes:Uc({},Ou,{fill:"white"})},h=a.children?{children:a.children.map(Nu)}:{},d={tag:"g",attributes:Uc({},u.inner),children:[Nu(Uc({tag:a.tag,attributes:Uc({},a.attributes,u.path)},h))]},p={tag:"g",attributes:Uc({},u.outer),children:[d]},f="mask-".concat(s||wu()),m="clip-".concat(s||wu()),g={tag:"mask",attributes:Uc({},Ou,{id:f,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[l,p]},_={tag:"defs",children:[{tag:"clipPath",attributes:{id:m},children:(t=c,"g"===t.tag?t.children:[t])},g]};return n.push(_,{tag:"rect",attributes:Uc({fill:"currentColor","clip-path":"url(#".concat(m,")"),mask:"url(#".concat(f,")")},Ou)}),{children:n,attributes:r}}(T):function(e){var t=e.children,n=e.attributes,r=e.main,i=e.transform,o=Iu(e.styles);if(o.length>0&&(n.style=o),Cu(i)){var s=Au({transform:i,containerWidth:r.width,iconWidth:r.width});t.push({tag:"g",attributes:Uc({},s.outer),children:[{tag:"g",attributes:Uc({},s.inner),children:[{tag:r.icon.tag,children:r.icon.children,attributes:Uc({},r.icon.attributes,s.path)}]}]})}else t.push(r.icon);return{children:t,attributes:n}}(T),w=b.attributes;return T.children=b.children,T.attributes=w,a?function(e){var t=e.iconName,n=e.children,r=e.symbol;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:Uc({},e.attributes,{id:!0===r?"".concat(e.prefix,"-").concat($c.familyPrefix,"-").concat(t):r}),children:n}]}]}(T):function(e){var t=e.children,n=e.main,r=e.mask,i=e.attributes,o=e.styles,s=e.transform;if(Cu(s)&&n.found&&!r.found){var a={x:n.width/n.height/2,y:.5};i.style=Iu(Uc({},o,{"transform-origin":"".concat(a.x+s.x/16,"em ").concat(a.y+s.y/16,"em")}))}return[{tag:"svg",attributes:i,children:t}]}(T)}var Du=function(e,t,n,r){var i,o,s,a=Object.keys(e),c=a.length,u=void 0!==r?function(e,t){return function(n,r,i,o){return e.call(t,n,r,i,o)}}(t,r):t;for(void 0===n?(i=1,s=e[a[0]]):(i=0,s=n);i<c;i++)s=u(s,e[o=a[i]],o,e);return s};function Pu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHooks,i=void 0!==r&&r,o=Object.keys(t).reduce(function(e,n){var r=t[n];return r.icon?e[r.iconName]=r.icon:e[n]=r,e},{});"function"!=typeof eu.hooks.addPack||i?eu.styles[e]=Uc({},eu.styles[e]||{},o):eu.hooks.addPack(e,o),"fas"===e&&Pu("fa",t)}var Lu=eu.styles,xu=eu.shims,Mu=function(){var e=function(e){return Du(Lu,function(t,n,r){return t[r]=Du(n,e,{}),t},{})};e(function(e,t,n){return t[3]&&(e[t[3]]=n),e}),e(function(e,t,n){var r=t[2];return e[n]=n,r.forEach(function(t){e[t]=n}),e});var t="far"in Lu;Du(xu,function(e,n){var r=n[1];return"far"!==r||t||(r="fas"),e[n[0]]={prefix:r,iconName:n[2]},e},{})};function Uu(e,t,n){if(e&&e[t]&&e[t][n])return{prefix:t,iconName:n,icon:e[t][n]}}function Vu(e){var t=e.tag,n=e.attributes,r=void 0===n?{}:n,i=e.children,o=void 0===i?[]:i;return"string"==typeof e?Ru(e):"<".concat(t," ").concat(function(e){return Object.keys(e||{}).reduce(function(t,n){return t+"".concat(n,'="').concat(Ru(e[n]),'" ')},"").trim()}(r),">").concat(o.map(Vu).join(""),"</").concat(t,">")}function Fu(e){this.name="MissingIcon",this.message=e||"Icon unavailable",this.stack=(new Error).stack}Mu(),(Fu.prototype=Object.create(Error.prototype)).constructor=Fu;var Bu={fill:"currentColor"},ju={attributeType:"XML",repeatCount:"indefinite",dur:"2s"},Gu=(Uc({},Bu,{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"}),Uc({},ju,{attributeName:"opacity"}));function qu(e){var t=e[0],n=e[1],r=Vc(e.slice(4),1)[0];return{found:!0,width:t,height:n,icon:Array.isArray(r)?{tag:"g",attributes:{class:"".concat($c.familyPrefix,"-").concat(Qc.GROUP)},children:[{tag:"path",attributes:{class:"".concat($c.familyPrefix,"-").concat(Qc.SECONDARY),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat($c.familyPrefix,"-").concat(Qc.PRIMARY),fill:"currentColor",d:r[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:r}}}}function Hu(){$c.autoAddCss&&!Qu&&(function(e){if(e&&Wc){var t=Hc.createElement("style");t.setAttribute("type","text/css"),t.innerHTML=e;for(var n=Hc.head.childNodes,r=null,i=n.length-1;i>-1;i--){var o=n[i],s=(o.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(s)>-1&&(r=o)}Hc.head.insertBefore(t,r)}}(function(){var e="fa",t=zc,n=$c.familyPrefix,r=$c.replacementClass,i='svg:not(:root).svg-inline--fa {\n  overflow: visible;\n}\n\n.svg-inline--fa {\n  display: inline-block;\n  font-size: inherit;\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.225em;\n}\n.svg-inline--fa.fa-w-1 {\n  width: 0.0625em;\n}\n.svg-inline--fa.fa-w-2 {\n  width: 0.125em;\n}\n.svg-inline--fa.fa-w-3 {\n  width: 0.1875em;\n}\n.svg-inline--fa.fa-w-4 {\n  width: 0.25em;\n}\n.svg-inline--fa.fa-w-5 {\n  width: 0.3125em;\n}\n.svg-inline--fa.fa-w-6 {\n  width: 0.375em;\n}\n.svg-inline--fa.fa-w-7 {\n  width: 0.4375em;\n}\n.svg-inline--fa.fa-w-8 {\n  width: 0.5em;\n}\n.svg-inline--fa.fa-w-9 {\n  width: 0.5625em;\n}\n.svg-inline--fa.fa-w-10 {\n  width: 0.625em;\n}\n.svg-inline--fa.fa-w-11 {\n  width: 0.6875em;\n}\n.svg-inline--fa.fa-w-12 {\n  width: 0.75em;\n}\n.svg-inline--fa.fa-w-13 {\n  width: 0.8125em;\n}\n.svg-inline--fa.fa-w-14 {\n  width: 0.875em;\n}\n.svg-inline--fa.fa-w-15 {\n  width: 0.9375em;\n}\n.svg-inline--fa.fa-w-16 {\n  width: 1em;\n}\n.svg-inline--fa.fa-w-17 {\n  width: 1.0625em;\n}\n.svg-inline--fa.fa-w-18 {\n  width: 1.125em;\n}\n.svg-inline--fa.fa-w-19 {\n  width: 1.1875em;\n}\n.svg-inline--fa.fa-w-20 {\n  width: 1.25em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: 0.3em;\n  width: auto;\n}\n.svg-inline--fa.fa-border {\n  height: 1.5em;\n}\n.svg-inline--fa.fa-li {\n  width: 2em;\n}\n.svg-inline--fa.fa-fw {\n  width: 1.25em;\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: #ff253a;\n  border-radius: 1em;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  color: #fff;\n  height: 1.5em;\n  line-height: 1;\n  max-width: 5em;\n  min-width: 1.5em;\n  overflow: hidden;\n  padding: 0.25em;\n  right: 0;\n  text-overflow: ellipsis;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: 0;\n  right: 0;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: 0;\n  left: 0;\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  right: 0;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: 0;\n  right: auto;\n  top: 0;\n  -webkit-transform: scale(0.25);\n          transform: scale(0.25);\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-lg {\n  font-size: 1.3333333333em;\n  line-height: 0.75em;\n  vertical-align: -0.0667em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: 2.5em;\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: -2em;\n  position: absolute;\n  text-align: center;\n  width: 2em;\n  line-height: inherit;\n}\n\n.fa-border {\n  border: solid 0.08em #eee;\n  border-radius: 0.1em;\n  padding: 0.2em 0.25em 0.15em;\n}\n\n.fa-pull-left {\n  float: left;\n}\n\n.fa-pull-right {\n  float: right;\n}\n\n.fa.fa-pull-left,\n.fas.fa-pull-left,\n.far.fa-pull-left,\n.fal.fa-pull-left,\n.fab.fa-pull-left {\n  margin-right: 0.3em;\n}\n.fa.fa-pull-right,\n.fas.fa-pull-right,\n.far.fa-pull-right,\n.fal.fa-pull-right,\n.fab.fa-pull-right {\n  margin-left: 0.3em;\n}\n\n.fa-spin {\n  -webkit-animation: fa-spin 2s infinite linear;\n          animation: fa-spin 2s infinite linear;\n}\n\n.fa-pulse {\n  -webkit-animation: fa-spin 1s infinite steps(8);\n          animation: fa-spin 1s infinite steps(8);\n}\n\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {\n  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n:root .fa-rotate-90,\n:root .fa-rotate-180,\n:root .fa-rotate-270,\n:root .fa-flip-horizontal,\n:root .fa-flip-vertical,\n:root .fa-flip-both {\n  -webkit-filter: none;\n          filter: none;\n}\n\n.fa-stack {\n  display: inline-block;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: #fff;\n}\n\n.sr-only {\n  border: 0;\n  clip: rect(0, 0, 0, 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n.sr-only-focusable:active, .sr-only-focusable:focus {\n  clip: auto;\n  height: auto;\n  margin: 0;\n  overflow: visible;\n  position: static;\n  width: auto;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: 0.4;\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: 1;\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse {\n  color: #fff;\n}';if(n!==e||r!==t){var o=new RegExp("\\.".concat(e,"\\-"),"g"),s=new RegExp("\\--".concat(e,"\\-"),"g"),a=new RegExp("\\.".concat(t),"g");i=i.replace(o,".".concat(n,"-")).replace(s,"--".concat(n,"-")).replace(a,".".concat(r))}return i}()),Qu=!0)}function Wu(e,t){return Object.defineProperty(e,"abstract",{get:t}),Object.defineProperty(e,"html",{get:function(){return e.abstract.map(function(e){return Vu(e)})}}),Object.defineProperty(e,"node",{get:function(){if(Wc){var t=Hc.createElement("div");return t.innerHTML=e.html,t.children}}}),e}function zu(e){var t=e.prefix,n=void 0===t?"fa":t,r=e.iconName;if(r)return Uu(Yu.definitions,n,r)||Uu(eu.styles,n,r)}Uc({},Bu,{cx:"256",cy:"364",r:"28"}),Uc({},ju,{attributeName:"r",values:"28;14;28;28;14;28;"}),Uc({},Gu,{values:"1;0;1;1;0;1;"}),Uc({},Bu,{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),Uc({},Gu,{values:"1;0;0;0;0;1;"}),Uc({},Bu,{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),Uc({},Gu,{values:"0;0;1;1;0;0;"});var Ku,Yu=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.definitions={}}var t;return(t=[{key:"add",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(t){e.definitions[t]=Uc({},e.definitions[t]||{},i[t]),Pu(t,i[t]),Mu()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(e,t){var n=t.prefix&&t.iconName&&t.icon?{0:t}:t;return Object.keys(n).map(function(t){var r=n[t],i=r.prefix,o=r.iconName,s=r.icon;e[i]||(e[i]={}),e[i][o]=s}),e}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}()),Qu=!1,Ju=(Ku=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.transform,r=void 0===n?bu:n,i=t.symbol,o=void 0!==i&&i,s=t.mask,a=void 0===s?null:s,c=t.maskId,u=void 0===c?null:c,l=t.title,h=void 0===l?null:l,d=t.titleId,p=void 0===d?null:d,f=t.classes,m=void 0===f?[]:f,g=t.attributes,_=void 0===g?{}:g,v=t.styles,y=void 0===v?{}:v;if(e){var E=e.prefix,S=e.iconName,T=e.icon;return Wu(Uc({type:"icon"},e),function(){return Hu(),$c.autoA11y&&(h?_["aria-labelledby"]="".concat($c.replacementClass,"-title-").concat(p||wu()):(_["aria-hidden"]="true",_.focusable="false")),ku({icons:{main:qu(T),mask:a?qu(a.icon):{found:!1,width:null,height:null,icon:{}}},prefix:E,iconName:S,transform:Uc({},bu,r),symbol:o,title:h,maskId:u,titleId:p,extra:{attributes:_,styles:y,classes:m}})})}},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(e||{}).icon?e:zu(e||{}),r=t.mask;return r&&(r=(r||{}).icon?r:zu(r||{})),Ku(n,Uc({},t,{mask:r}))});const Xu=["*"];let $u=(()=>{class e{constructor(){this.defaultPrefix="fas",this.fallbackIcon=null,this.globalLibrary=!1}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=(0,r.Yz7)({factory:function(){return new e},token:e,providedIn:"root"}),e})(),Zu=(()=>{class e{constructor(){this.definitions={}}addIcons(...e){for(const t of e)t.prefix in this.definitions||(this.definitions[t.prefix]={}),this.definitions[t.prefix][t.iconName]=t}addIconPacks(...e){for(const t of e){const e=Object.keys(t).map(e=>t[e]);this.addIcons(...e)}}getIconDefinition(e,t){return e in this.definitions&&t in this.definitions[e]?this.definitions[e][t]:null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=(0,r.Yz7)({factory:function(){return new e},token:e,providedIn:"root"}),e})();const el=e=>{const t={"fa-spin":e.spin,"fa-pulse":e.pulse,"fa-fw":e.fixedWidth,"fa-border":e.border,"fa-inverse":e.inverse,"fa-layers-counter":e.counter,"fa-flip-horizontal":"horizontal"===e.flip||"both"===e.flip,"fa-flip-vertical":"vertical"===e.flip||"both"===e.flip,[`fa-${e.size}`]:null!==e.size,[`fa-rotate-${e.rotate}`]:null!==e.rotate,[`fa-pull-${e.pull}`]:null!==e.pull,[`fa-stack-${e.stackItemSize}`]:null!=e.stackItemSize};return Object.keys(t).map(e=>t[e]?e:null).filter(e=>e)};let tl=(()=>{class e{constructor(){this.stackItemSize="1x"}ngOnChanges(e){if("size"in e)throw new Error('fa-icon is not allowed to customize size when used inside fa-stack. Set size on the enclosing fa-stack instead: <fa-stack size="4x">...</fa-stack>.')}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=r.lG2({type:e,selectors:[["fa-icon","stackItemSize",""],["fa-duotone-icon","stackItemSize",""]],inputs:{stackItemSize:"stackItemSize",size:"size"},features:[r.TTD]}),e})(),nl=(()=>{class e{constructor(e,t){this.renderer=e,this.elementRef=t}ngOnInit(){this.renderer.addClass(this.elementRef.nativeElement,"fa-stack")}ngOnChanges(e){"size"in e&&(null!=e.size.currentValue&&this.renderer.addClass(this.elementRef.nativeElement,`fa-${e.size.currentValue}`),null!=e.size.previousValue&&this.renderer.removeClass(this.elementRef.nativeElement,`fa-${e.size.previousValue}`))}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.Qsj),r.Y36(r.SBq))},e.\u0275cmp=r.Xpm({type:e,selectors:[["fa-stack"]],inputs:{size:"size"},features:[r.TTD],ngContentSelectors:Xu,decls:1,vars:0,template:function(e,t){1&e&&(r.F$t(),r.Hsn(0))},encapsulation:2}),e})(),rl=(()=>{class e{constructor(e,t,n,r,i){this.sanitizer=e,this.config=t,this.iconLibrary=n,this.stackItem=r,this.classes=[],null!=i&&null==r&&console.error('FontAwesome: fa-icon and fa-duotone-icon elements must specify stackItemSize attribute when wrapped into fa-stack. Example: <fa-icon stackItemSize="2x"></fa-icon>.')}ngOnChanges(e){if(null==this.icon&&null==this.config.fallbackIcon)return(()=>{throw new Error("Property `icon` is required for `fa-icon`/`fa-duotone-icon` components.")})();let t=null;if(t=null==this.icon?this.config.fallbackIcon:this.icon,e){const e=this.findIconDefinition(t);if(null!=e){const t=this.buildParams();this.renderIcon(e,t)}}}render(){this.ngOnChanges({})}findIconDefinition(e){const t=(r=this.config.defaultPrefix,(e=>void 0!==e.prefix&&void 0!==e.iconName)(n=e)?n:Array.isArray(n)&&2===n.length?{prefix:n[0],iconName:n[1]}:"string"==typeof n?{prefix:r,iconName:n}:void 0);var n,r;if("icon"in t)return t;const i=this.iconLibrary.getIconDefinition(t.prefix,t.iconName);if(null!=i)return i;const o=zu(t);if(null!=o){const e="Global icon library is deprecated. Consult https://github.com/FortAwesome/angular-fontawesome/blob/master/UPGRADING.md for the migration instructions.";if("unset"===this.config.globalLibrary)console.error("FontAwesome: "+e);else if(!this.config.globalLibrary)throw new Error(e);return o}return(e=>{throw new Error(`Could not find icon with iconName=${e.iconName} and prefix=${e.prefix} in the icon library.`)})(t),null}buildParams(){const e={flip:this.flip,spin:this.spin,pulse:this.pulse,border:this.border,inverse:this.inverse,size:this.size||null,pull:this.pull||null,rotate:this.rotate||null,fixedWidth:"boolean"==typeof this.fixedWidth?this.fixedWidth:this.config.fixedWidth,stackItemSize:null!=this.stackItem?this.stackItem.stackItemSize:null},t="string"==typeof this.transform?function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e?e.toLowerCase().split(" ").reduce(function(e,t){var n=t.toLowerCase().split("-"),r=n[0],i=n.slice(1).join("-");if(r&&"h"===i)return e.flipX=!0,e;if(r&&"v"===i)return e.flipY=!0,e;if(i=parseFloat(i),isNaN(i))return e;switch(r){case"grow":e.size=e.size+i;break;case"shrink":e.size=e.size-i;break;case"left":e.x=e.x-i;break;case"right":e.x=e.x+i;break;case"up":e.y=e.y-i;break;case"down":e.y=e.y+i;break;case"rotate":e.rotate=e.rotate+i}return e},t):t}(this.transform):this.transform;return{title:this.title,transform:t,classes:[...el(e),...this.classes],mask:null!=this.mask?this.findIconDefinition(this.mask):null,styles:null!=this.styles?this.styles:{},symbol:this.symbol,attributes:{role:this.a11yRole}}}renderIcon(e,t){const n=Ju(e,t);this.renderedIconHTML=this.sanitizer.bypassSecurityTrustHtml(n.html.join("\n"))}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(Re),r.Y36($u),r.Y36(Zu),r.Y36(tl,8),r.Y36(nl,8))},e.\u0275cmp=r.Xpm({type:e,selectors:[["fa-icon"]],hostAttrs:[1,"ng-fa-icon"],hostVars:2,hostBindings:function(e,t){2&e&&(r.Ikx("innerHTML",t.renderedIconHTML,r.oJD),r.uIk("title",t.title))},inputs:{classes:"classes",icon:"icon",title:"title",spin:"spin",pulse:"pulse",mask:"mask",styles:"styles",flip:"flip",size:"size",pull:"pull",border:"border",inverse:"inverse",symbol:"symbol",rotate:"rotate",fixedWidth:"fixedWidth",transform:"transform",a11yRole:"a11yRole"},features:[r.TTD],decls:0,vars:0,template:function(e,t){},encapsulation:2}),e})(),il=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({}),e})();const ol=function(){return{}};let sl=(()=>{class e{constructor(){this.activeColor="red",this.type="normal",this.activeIconStyle={stroke:"white",color:"white"},this.inactiveIconStyle={stroke:"white",color:"white"},this.onClick=new r.vpe,this.isActive=!1,this.buttonStyle={active:{backgroundColor:this.activeColor}}}ngOnInit(){}click(){"toggle"===this.type&&(this.isActive=!this.isActive),this.onClick.emit(this.isActive)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-round-tranparent-icon-button"]],inputs:{activeColor:"activeColor",type:"type",activeIcon:"activeIcon",activeIconStyle:"activeIconStyle",inactiveIcon:"inactiveIcon",inactiveIconStyle:"inactiveIconStyle",isActive:"isActive"},outputs:{onClick:"onClick"},decls:3,vars:4,consts:[[3,"click"],[1,"container",3,"ngStyle"],[3,"icon","styles"]],template:function(e,t){1&e&&(r.TgZ(0,"a",0),r.NdJ("click",function(){return t.click()}),r.TgZ(1,"div",1),r._UZ(2,"fa-icon",2),r.qZA(),r.qZA()),2&e&&(r.xp6(1),r.Q6J("ngStyle",t.isActive?t.buttonStyle.active:r.DdM(3,ol)),r.xp6(1),r.Q6J("icon",t.isActive?t.activeIcon:t.inactiveIcon)("styles",t.isActive?t.activeIconStyle:t.inactiveIconStyle))},directives:[B,rl],styles:[".container[_ngcontent-%COMP%]{display:flex;border:2px solid #fff;width:3.5rem;height:3.5rem;border-radius:50%;background-color:initial;overflow:hidden;justify-content:center;align-items:center;transition:all .5s;cursor:pointer}.container[_ngcontent-%COMP%]:hover{background-color:#ffffffa6}a[_ngcontent-%COMP%]{cursor:pointer}"]}),e})();const al=function(){return{stroke:"red",color:"red"}};let cl=(()=>{class e{constructor(){this.hangUpIcon=Lc,this.micIcon=Dc,this.micOffIcon=Pc,this.micMuted=new r.vpe,this.hangedUp=new r.vpe}ngOnInit(){}onMicMute(e){this.micMuted.emit(e)}onHangUp(){this.hangedUp.emit()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-meeting-controls"]],outputs:{micMuted:"micMuted",hangedUp:"hangedUp"},decls:3,vars:5,consts:[[1,"controls-container"],["type","toggle",3,"activeIcon","inactiveIcon","onClick"],["type","normal",1,"call",3,"inactiveIcon","inactiveIconStyle","onClick"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"app-round-tranparent-icon-button",1),r.NdJ("onClick",function(e){return t.onMicMute(e)}),r.qZA(),r.TgZ(2,"app-round-tranparent-icon-button",2),r.NdJ("onClick",function(){return t.onHangUp()}),r.qZA(),r.qZA()),2&e&&(r.xp6(1),r.Q6J("activeIcon",t.micOffIcon)("inactiveIcon",t.micIcon),r.xp6(1),r.Q6J("inactiveIcon",t.hangUpIcon)("inactiveIconStyle",r.DdM(4,al)))},directives:[sl],styles:[".controls-container[_ngcontent-%COMP%]{padding-top:1rem;background-color:#aaaaab;display:flex;justify-content:center}.controls-container[_ngcontent-%COMP%]   .call[_ngcontent-%COMP%]{margin-left:50px}"]}),e})();const ul=["localVideo"];let ll=(()=>{class e{constructor(e,t,n,r,i){this.activatedRoute=e,this.agoraService=t,this.mediaService=n,this.tokenService=r,this.router=i,this.link="",this.channel="",this.subscriptions=[],this.userList=[],this.audioInId="",this.videoInId="",this.audioOutId="",this.token=""}ngOnInit(){oc([this.activatedRoute.queryParams.pipe(Pi(1)),this.mediaService.selectedAudioInputId.pipe(Pi(1)),this.mediaService.selectedAudioOutputId.pipe(Pi(1)),this.mediaService.selectedVideoInputId.pipe(Pi(1))]).pipe(Pi(1)).subscribe(([e,t,n,r])=>{if(this.link=e.link,this.channel=e.channel,this.link){const e=this.tokenService.getChannel(this.link);if(e.error)return alert(e.error),void this.router.navigate(["/.."]);this.channel=e.channel}this.tokenService.getToken(this.channel),this.audioInId=t,this.videoInId=r,this.audioOutId=n});const e=this.tokenService.token.pipe(Pi(1)).subscribe(e=>{this.token=e,this.joinAudio()});this.subscriptions.push(e);const t=this.agoraService.onRemoteUserLeft().subscribe(e=>{var t;this.agoraService.leave(),null===(t=this.mediaTrack)||void 0===t||t.stop(),this.router.navigate(["/.."])});this.subscriptions.push(t);const n=this.agoraService.onRemoteUsersStatusChange().subscribe(e=>{var t;switch(e.connectionState){case"CONNECTED":this.userList.find(t=>{var n;return(null===(n=t.user)||void 0===n?void 0:n.uid)===e.user.uid})||this.userList.push({type:"remote",user:e.user});break;case"DISCONNECTED":case"DISCONNECTING":case"RECONNECTING":const n=this.userList.findIndex(t=>{var n;return(null===(n=t.user)||void 0===n?void 0:n.uid)===e.user.uid});n>=0&&(this.userList[n]={type:"remote",user:e.user},this.pinnedUser&&(null===(t=this.pinnedUser.user)||void 0===t?void 0:t.uid)&&this.pinnedUser.user.uid===e.user.uid&&(this.pinnedUser={type:"remote",user:e.user}))}});this.subscriptions.push(n);const r=this.agoraService.onLocalUserJoined().subscribe(e=>{this.userList.push({type:"local",mediaTrack:e.track})});this.subscriptions.push(r)}ngOnDestroy(){for(const e of this.subscriptions)e.unsubscribe()}joinAudio(){var e=this;return rc(function*(){console.log(e.token),e.mediaTrack=yield e.agoraService.joinAudio(e.channel,e.token).Apply()})()}onLocalMic(e){var t,n;console.log("VALUE: ",e),e?null===(n=this.mediaTrack)||void 0===n||n.microphoneMute():null===(t=this.mediaTrack)||void 0===t||t.microphoneUnMute()}onLocalLeave(){var e;this.agoraService.leave(),null===(e=this.mediaTrack)||void 0===e||e.stop(),this.router.navigate(["/.."])}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(fs),r.Y36(gc),r.Y36(yc),r.Y36(kc),r.Y36(Ma))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-meeting-page"]],viewQuery:function(e,t){if(1&e&&r.Gf(ul,7),2&e){let e;r.iGM(e=r.CRH())&&(t.localVideo=e.first)}},decls:5,vars:0,consts:[[1,"page"],[1,"image-container"],["src","../../../assets/images/logoFereg.png","height","100%","width","100%",1,"images"],[1,"controls-container"],[3,"micMuted","hangedUp"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r._UZ(2,"img",2),r.qZA(),r.TgZ(3,"div",3),r.TgZ(4,"app-meeting-controls",4),r.NdJ("micMuted",function(e){return t.onLocalMic(e)})("hangedUp",function(){return t.onLocalLeave()}),r.qZA(),r.qZA(),r.qZA())},directives:[cl],styles:[".page[_ngcontent-%COMP%]{max-width:100%;min-height:100%;display:grid;grid-template-rows:80% 20%}"]}),e})(),hl=(()=>{class e{constructor(e,t){this._renderer=e,this._elementRef=t,this.onChange=e=>{},this.onTouched=()=>{}}setProperty(e,t){this._renderer.setProperty(this._elementRef.nativeElement,e,t)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.Qsj),r.Y36(r.SBq))},e.\u0275dir=r.lG2({type:e}),e})(),dl=(()=>{class e extends hl{}return e.\u0275fac=function(){let t;return function(n){return(t||(t=r.n5z(e)))(n||e)}}(),e.\u0275dir=r.lG2({type:e,features:[r.qOj]}),e})();const pl=new r.OlP("NgValueAccessor"),fl={provide:pl,useExisting:(0,r.Gpc)(()=>gl),multi:!0},ml=new r.OlP("CompositionEventMode");let gl=(()=>{class e extends hl{constructor(e,t,n){super(e,t),this._compositionMode=n,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const e=o()?o().getUserAgent():"";return/android (\d+)/.test(e.toLowerCase())}())}writeValue(e){this.setProperty("value",null==e?"":e)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.Qsj),r.Y36(r.SBq),r.Y36(ml,8))},e.\u0275dir=r.lG2({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(e,t){1&e&&r.NdJ("input",function(e){return t._handleInput(e.target.value)})("blur",function(){return t.onTouched()})("compositionstart",function(){return t._compositionStart()})("compositionend",function(e){return t._compositionEnd(e.target.value)})},features:[r._Bn([fl]),r.qOj]}),e})();const _l=new r.OlP("NgValidators"),vl=new r.OlP("NgAsyncValidators");function yl(e){return null!=e}function El(e){const t=(0,r.QGY)(e)?(0,ci.D)(e):e;return(0,r.CqO)(t),t}function Sl(e){let t={};return e.forEach(e=>{t=null!=e?Object.assign(Object.assign({},t),e):t}),0===Object.keys(t).length?null:t}function Tl(e,t){return t.map(t=>t(e))}function bl(e){return e.map(e=>function(e){return!e.validate}(e)?e:t=>e.validate(t))}function wl(e){return null!=e?function(e){if(!e)return null;const t=e.filter(yl);return 0==t.length?null:function(e){return Sl(Tl(e,t))}}(bl(e)):null}function Rl(e){return null!=e?function(e){if(!e)return null;const t=e.filter(yl);return 0==t.length?null:function(e){return oc(Tl(e,t).map(El)).pipe((0,Fe.U)(Sl))}}(bl(e)):null}function Il(e,t){return null===e?[t]:Array.isArray(e)?[...e,t]:[e,t]}function Cl(e){return e._rawValidators}function Al(e){return e._rawAsyncValidators}let Ol=(()=>{class e{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=wl(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Rl(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,t){return!!this.control&&this.control.hasError(e,t)}getError(e,t){return this.control?this.control.getError(e,t):null}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=r.lG2({type:e}),e})(),Nl=(()=>{class e extends Ol{get formDirective(){return null}get path(){return null}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=r.n5z(e)))(n||e)}}(),e.\u0275dir=r.lG2({type:e,features:[r.qOj]}),e})();class kl extends Ol{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}let Dl=(()=>{class e extends class{constructor(e){this._cd=e}is(e){var t,n;return!!(null===(n=null===(t=this._cd)||void 0===t?void 0:t.control)||void 0===n?void 0:n[e])}}{constructor(e){super(e)}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(kl,2))},e.\u0275dir=r.lG2({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(e,t){2&e&&r.ekj("ng-untouched",t.is("untouched"))("ng-touched",t.is("touched"))("ng-pristine",t.is("pristine"))("ng-dirty",t.is("dirty"))("ng-valid",t.is("valid"))("ng-invalid",t.is("invalid"))("ng-pending",t.is("pending"))},features:[r.qOj]}),e})();function Pl(e,t){Ml(e,t),t.valueAccessor.writeValue(e.value),function(e,t){t.valueAccessor.registerOnChange(n=>{e._pendingValue=n,e._pendingChange=!0,e._pendingDirty=!0,"change"===e.updateOn&&Vl(e,t)})}(e,t),function(e,t){const n=(e,n)=>{t.valueAccessor.writeValue(e),n&&t.viewToModelUpdate(e)};e.registerOnChange(n),t._registerOnDestroy(()=>{e._unregisterOnChange(n)})}(e,t),function(e,t){t.valueAccessor.registerOnTouched(()=>{e._pendingTouched=!0,"blur"===e.updateOn&&e._pendingChange&&Vl(e,t),"submit"!==e.updateOn&&e.markAsTouched()})}(e,t),function(e,t){if(t.valueAccessor.setDisabledState){const n=e=>{t.valueAccessor.setDisabledState(e)};e.registerOnDisabledChange(n),t._registerOnDestroy(()=>{e._unregisterOnDisabledChange(n)})}}(e,t)}function Ll(e,t,n=!0){const r=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(r),t.valueAccessor.registerOnTouched(r)),Ul(e,t),e&&(t._invokeOnDestroyCallbacks(),e._registerOnCollectionChange(()=>{}))}function xl(e,t){e.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Ml(e,t){const n=Cl(e);null!==t.validator?e.setValidators(Il(n,t.validator)):"function"==typeof n&&e.setValidators([n]);const r=Al(e);null!==t.asyncValidator?e.setAsyncValidators(Il(r,t.asyncValidator)):"function"==typeof r&&e.setAsyncValidators([r]);const i=()=>e.updateValueAndValidity();xl(t._rawValidators,i),xl(t._rawAsyncValidators,i)}function Ul(e,t){let n=!1;if(null!==e){if(null!==t.validator){const r=Cl(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.validator);i.length!==r.length&&(n=!0,e.setValidators(i))}}if(null!==t.asyncValidator){const r=Al(e);if(Array.isArray(r)&&r.length>0){const i=r.filter(e=>e!==t.asyncValidator);i.length!==r.length&&(n=!0,e.setAsyncValidators(i))}}}const r=()=>{};return xl(t._rawValidators,r),xl(t._rawAsyncValidators,r),n}function Vl(e,t){e._pendingDirty&&e.markAsDirty(),e.setValue(e._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1}function Fl(e,t){Ml(e,t)}function Bl(e,t){e._syncPendingControls(),t.forEach(e=>{const t=e.control;"submit"===t.updateOn&&t._pendingChange&&(e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1)})}function jl(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}const Gl="VALID",ql="INVALID",Hl="PENDING",Wl="DISABLED";function zl(e){return(Jl(e)?e.validators:e)||null}function Kl(e){return Array.isArray(e)?wl(e):e||null}function Yl(e,t){return(Jl(t)?t.asyncValidators:e)||null}function Ql(e){return Array.isArray(e)?Rl(e):e||null}function Jl(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e}class Xl{constructor(e,t){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=t,this._composedValidatorFn=Kl(this._rawValidators),this._composedAsyncValidatorFn=Ql(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Gl}get invalid(){return this.status===ql}get pending(){return this.status==Hl}get disabled(){return this.status===Wl}get enabled(){return this.status!==Wl}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=Kl(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=Ql(e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(e=>{e.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(e=>{e.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Hl,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Wl,this.errors=null,this._forEachChild(t=>{t.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!0))}enable(e={}){const t=this._parentMarkedDirty(e.onlySelf);this.status=Gl,this._forEachChild(t=>{t.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(e=>e(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==Gl&&this.status!==Hl||this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Wl:Gl}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Hl,this._hasOwnPendingAsyncValidator=!0;const t=El(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(t=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(t,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(!1!==t.emitEvent)}get(e){return function(e,t,n){if(null==t)return null;if(Array.isArray(t)||(t=t.split(".")),Array.isArray(t)&&0===t.length)return null;let r=e;return t.forEach(e=>{r=r instanceof Zl?r.controls.hasOwnProperty(e)?r.controls[e]:null:r instanceof eh&&r.at(e)||null}),r}(this,e)}getError(e,t){const n=t?this.get(t):this;return n&&n.errors?n.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new r.vpe,this.statusChanges=new r.vpe}_calculateStatus(){return this._allControlsDisabled()?Wl:this.errors?ql:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Hl)?Hl:this._anyControlsHaveStatus(ql)?ql:Gl}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Jl(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class $l extends Xl{constructor(e=null,t,n){super(zl(t),Yl(n,t)),this._onChange=[],this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==t.emitModelToViewChange&&this._onChange.forEach(e=>e(this.value,!1!==t.emitViewToModelChange)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=null,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){jl(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){jl(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class Zl extends Xl{constructor(e,t,n){super(zl(t),Yl(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,n={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){this._checkAllValuesPresent(e),Object.keys(e).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(Object.keys(e).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(e[n],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,n)=>(e[n]=t instanceof $l?t.value:t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(e,t)=>!!t._syncPendingControls()||e);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[e])throw new Error(`Cannot find form control with name: ${e}.`)}_forEachChild(e){Object.keys(this.controls).forEach(t=>{const n=this.controls[t];n&&e(n,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const t of Object.keys(this.controls)){const n=this.controls[t];if(this.contains(t)&&e(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,t,n)=>((t.enabled||this.disabled)&&(e[n]=t.value),e))}_reduceChildren(e,t){let n=e;return this._forEachChild((e,r)=>{n=t(n,e,r)}),n}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class eh extends Xl{constructor(e,t,n){super(zl(t),Yl(n,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,t={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}insert(e,t,n={}){this.controls.splice(e,0,t),this._registerControl(t),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:t.emitEvent})}setControl(e,t,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),t&&(this.controls.splice(e,0,t),this._registerControl(t)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,t={}){this._checkAllValuesPresent(e),e.forEach((e,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){null!=e&&(e.forEach((e,n)=>{this.at(n)&&this.at(n).patchValue(e,{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e=[],t={}){this._forEachChild((n,r)=>{n.reset(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this.controls.map(e=>e instanceof $l?e.value:e.getRawValue())}clear(e={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((e,t)=>!!t._syncPendingControls()||e,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_throwIfControlMissing(e){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(e))throw new Error(`Cannot find form control at index ${e}`)}_forEachChild(e){this.controls.forEach((t,n)=>{e(t,n)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(t=>t.enabled&&e(t))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_checkAllValuesPresent(e){this._forEachChild((t,n)=>{if(void 0===e[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const th={provide:Nl,useExisting:(0,r.Gpc)(()=>rh)},nh=(()=>Promise.resolve(null))();let rh=(()=>{class e extends Nl{constructor(e,t){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new r.vpe,this.form=new Zl({},wl(e),Rl(t))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){nh.then(()=>{const t=this._findContainer(e.path);e.control=t.registerControl(e.name,e.control),Pl(e.control,e),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){nh.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name),jl(this._directives,e)})}addFormGroup(e){nh.then(()=>{const t=this._findContainer(e.path),n=new Zl({});Fl(n,e),t.registerControl(e.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){nh.then(()=>{const t=this._findContainer(e.path);t&&t.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,t){nh.then(()=>{this.form.get(e.path).setValue(t)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submitted=!0,Bl(this.form,this._directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(_l,10),r.Y36(vl,10))},e.\u0275dir=r.lG2({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(e,t){1&e&&r.NdJ("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[r._Bn([th]),r.qOj]}),e})(),ih=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({}),e})();const oh=new r.OlP("NgModelWithFormControlWarning"),sh={provide:Nl,useExisting:(0,r.Gpc)(()=>ah)};let ah=(()=>{class e extends Nl{constructor(e,t){super(),this.validators=e,this.asyncValidators=t,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new r.vpe,this._setValidators(e),this._setAsyncValidators(t)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Ul(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){const t=this.form.get(e.path);return Pl(t,e),t.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),t}getControl(e){return this.form.get(e.path)}removeControl(e){Ll(e.control||null,e,!1),jl(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,t){this.form.get(e.path).setValue(t)}onSubmit(e){return this.submitted=!0,Bl(this.form,this.directives),this.ngSubmit.emit(e),!1}onReset(){this.resetForm()}resetForm(e){this.form.reset(e),this.submitted=!1}_updateDomValue(){this.directives.forEach(e=>{const t=e.control,n=this.form.get(e.path);t!==n&&(Ll(t||null,e),n instanceof $l&&(Pl(n,e),e.control=n))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){const t=this.form.get(e.path);Fl(t,e),t.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){const t=this.form.get(e.path);t&&function(e,t){return Ul(e,t)}(t,e)&&t.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Ml(this.form,this),this._oldForm&&Ul(this._oldForm,this)}_checkFormPresent(){}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(_l,10),r.Y36(vl,10))},e.\u0275dir=r.lG2({type:e,selectors:[["","formGroup",""]],hostBindings:function(e,t){1&e&&r.NdJ("submit",function(e){return t.onSubmit(e)})("reset",function(){return t.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[r._Bn([sh]),r.qOj,r.TTD]}),e})();const ch={provide:kl,useExisting:(0,r.Gpc)(()=>uh)};let uh=(()=>{class e extends kl{constructor(e,t,n,i,o){super(),this._ngModelWarningConfig=o,this._added=!1,this.update=new r.vpe,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(t),this._setAsyncValidators(n),this.valueAccessor=function(e,t){if(!t)return null;let n,r,i;return Array.isArray(t),t.forEach(e=>{e.constructor===gl?n=e:Object.getPrototypeOf(e.constructor)===dl?r=e:i=e}),i||r||n||null}(0,i)}set isDisabled(e){}ngOnChanges(e){this._added||this._setUpControl(),function(e,t){if(!e.hasOwnProperty("model"))return!1;const n=e.model;return!!n.isFirstChange()||!Object.is(t,n.currentValue)}(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return e=null==this.name?this.name:this.name.toString(),[...this._parent.path,e];var e}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(Nl,13),r.Y36(_l,10),r.Y36(vl,10),r.Y36(pl,10),r.Y36(oh,8))},e.\u0275dir=r.lG2({type:e,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[r._Bn([ch]),r.qOj,r.TTD]}),e._ngModelWarningSentOnce=!1,e})(),lh=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[ih]]}),e})(),hh=(()=>{class e{static withConfig(t){return{ngModule:e,providers:[{provide:oh,useValue:t.warnOnNgModelWithFormControl}]}}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[lh]}),e})(),dh=(()=>{class e{group(e,t=null){const n=this._reduceControls(e);let r,i=null,o=null;return null!=t&&(function(e){return void 0!==e.asyncValidators||void 0!==e.validators||void 0!==e.updateOn}(t)?(i=null!=t.validators?t.validators:null,o=null!=t.asyncValidators?t.asyncValidators:null,r=null!=t.updateOn?t.updateOn:void 0):(i=null!=t.validator?t.validator:null,o=null!=t.asyncValidator?t.asyncValidator:null)),new Zl(n,{asyncValidators:o,updateOn:r,validators:i})}control(e,t,n){return new $l(e,t,n)}array(e,t,n){const r=e.map(e=>this._createControl(e));return new eh(r,t,n)}_reduceControls(e){const t={};return Object.keys(e).forEach(n=>{t[n]=this._createControl(e[n])}),t}_createControl(e){return e instanceof $l||e instanceof Zl||e instanceof eh?e:Array.isArray(e)?this.control(e[0],e.length>1?e[1]:null,e.length>2?e[2]:null):this.control(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=(0,r.Yz7)({factory:function(){return new e},token:e,providedIn:hh}),e})();var ph=n(8569);function fh(){return e=>e.lift(new mh)}class mh{call(e,t){return t.subscribe(new gh(e))}}class gh extends xe.L{constructor(e){super(e),this.hasPrev=!1}_next(e){let t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)}}function _h(e,t){return n=>n.lift(new vh(e,t))}class vh{constructor(e,t){this.compare=e,this.keySelector=t}call(e,t){return t.subscribe(new yh(e,this.compare,this.keySelector))}}class yh extends xe.L{constructor(e,t,n){super(e),this.keySelector=n,this.hasKey=!1,"function"==typeof t&&(this.compare=t)}compare(e,t){return e===t}_next(e){let t;try{const{keySelector:n}=this;t=n?n(e):e}catch(r){return this.destination.error(r)}let n=!1;if(this.hasKey)try{const{compare:e}=this;n=e(this.key,t)}catch(r){return this.destination.error(r)}else this.hasKey=!0;n||(this.key=t,this.destination.next(e))}}var Eh=n(9971),Sh=n(2346),Th=n(1858),bh=n(1062),wh=n(250),Rh=n(308),Ih=function(e,t){return(Ih=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function Ch(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var Ah,Oh="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Nh=Nh||{},kh=Oh||self;function Dh(){}function Ph(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Lh(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var xh="closure_uid_"+(1e9*Math.random()>>>0),Mh=0;function Uh(e,t,n){return e.call.apply(e.bind,arguments)}function Vh(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Fh(e,t,n){return(Fh=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Uh:Vh).apply(null,arguments)}function Bh(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function jh(){return Date.now()}function Gh(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Pb=function(e,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return t.prototype[n].apply(e,i)}}function qh(){this.j=this.j,this.i=this.i}qh.prototype.j=!1,qh.prototype.ka=function(){!this.j&&(this.j=!0,this.H(),0)&&function(e){Object.prototype.hasOwnProperty.call(e,xh)&&e[xh]||(e[xh]=++Mh)}(this)},qh.prototype.H=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var Hh=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},Wh=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function zh(e){return Array.prototype.concat.apply([],arguments)}function Kh(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function Yh(e){return/^[\s\xa0]*$/.test(e)}var Qh,Jh=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Xh(e,t){return-1!=e.indexOf(t)}function $h(e,t){return e<t?-1:e>t?1:0}e:{var Zh=kh.navigator;if(Zh){var ed=Zh.userAgent;if(ed){Qh=ed;break e}}Qh=""}function td(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function nd(e){var t={};for(var n in e)t[n]=e[n];return t}var rd="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function id(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var o=0;o<rd.length;o++)n=rd[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function od(e){return od[" "](e),e}od[" "]=Dh;var sd,ad,cd=Xh(Qh,"Opera"),ud=Xh(Qh,"Trident")||Xh(Qh,"MSIE"),ld=Xh(Qh,"Edge"),hd=ld||ud,dd=Xh(Qh,"Gecko")&&!(Xh(Qh.toLowerCase(),"webkit")&&!Xh(Qh,"Edge"))&&!(Xh(Qh,"Trident")||Xh(Qh,"MSIE"))&&!Xh(Qh,"Edge"),pd=Xh(Qh.toLowerCase(),"webkit")&&!Xh(Qh,"Edge");function fd(){var e=kh.document;return e?e.documentMode:void 0}e:{var md="",gd=(ad=Qh,dd?/rv:([^\);]+)(\)|;)/.exec(ad):ld?/Edge\/([\d\.]+)/.exec(ad):ud?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ad):pd?/WebKit\/(\S+)/.exec(ad):cd?/(?:Version)[ \/]?(\S+)/.exec(ad):void 0);if(gd&&(md=gd?gd[1]:""),ud){var _d=fd();if(null!=_d&&_d>parseFloat(md)){sd=String(_d);break e}}sd=md}var vd={};function yd(e){return function(e,t){var n=vd;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t()}(e,function(){for(var t=0,n=Jh(String(sd)).split("."),r=Jh(String(e)).split("."),i=Math.max(n.length,r.length),o=0;0==t&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;t=$h(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||$h(0==s[2].length,0==a[2].length)||$h(s[2],a[2]),s=s[3],a=a[3]}while(0==t)}return 0<=t})}var Ed=kh.document&&ud&&(fd()||parseInt(sd,10))||void 0,Sd=!ud||9<=Number(Ed),Td=ud&&!yd("9"),bd=function(){if(!kh.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{kh.addEventListener("test",Dh,t),kh.removeEventListener("test",Dh,t)}catch(n){}return e}();function wd(e,t){this.type=e,this.a=this.target=t,this.defaultPrevented=!1}function Rd(e,t){if(wd.call(this,e?e.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.a=t,t=e.relatedTarget){if(dd){e:{try{od(t.nodeName);var i=!0;break e}catch(o){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Id[e.pointerType]||"",this.c=e,e.defaultPrevented&&this.b()}}wd.prototype.b=function(){this.defaultPrevented=!0},Gh(Rd,wd);var Id={2:"touch",3:"pen",4:"mouse"};Rd.prototype.b=function(){Rd.X.b.call(this);var e=this.c;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,Td)try{(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)&&(e.keyCode=-1)}catch(t){}};var Cd="closure_listenable_"+(1e6*Math.random()|0),Ad=0;function Od(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.da=i,this.key=++Ad,this.Y=this.Z=!1}function Nd(e){e.Y=!0,e.listener=null,e.proxy=null,e.src=null,e.da=null}function kd(e){this.src=e,this.a={},this.b=0}function Dd(e,t){var n=t.type;if(n in e.a){var r,i=e.a[n],o=Hh(i,t);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Nd(t),0==e.a[n].length&&(delete e.a[n],e.b--))}}function Pd(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.Y&&o.listener==t&&o.capture==!!n&&o.da==r)return i}return-1}kd.prototype.add=function(e,t,n,r,i){var o=e.toString();(e=this.a[o])||(e=this.a[o]=[],this.b++);var s=Pd(e,t,r,i);return-1<s?(t=e[s],n||(t.Z=!1)):((t=new Od(t,this.src,o,!!r,i)).Z=n,e.push(t)),t};var Ld="closure_lm_"+(1e6*Math.random()|0),xd={};function Md(e,t,n,r,i){if(r&&r.once)return Vd(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)Md(e,t[o],n,r,i);return null}return n=zd(n),e&&e[Cd]?e.wa(t,n,Lh(r)?!!r.capture:!!r,i):Ud(e,t,n,!1,r,i)}function Ud(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var s=Lh(i)?!!i.capture:!!i;if(s&&!Sd)return null;var a=Hd(e);if(a||(e[Ld]=a=new kd(e)),(n=a.add(t,n,r,s,o)).proxy)return n;if(r=function(){var e=qd,t=Sd?function(n){return e.call(t.src,t.listener,n)}:function(n){if(!(n=e.call(t.src,t.listener,n)))return n};return t}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)bd||(i=s),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(jd(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Vd(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)Vd(e,t[o],n,r,i);return null}return n=zd(n),e&&e[Cd]?e.xa(t,n,Lh(r)?!!r.capture:!!r,i):Ud(e,t,n,!0,r,i)}function Fd(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)Fd(e,t[o],n,r,i);else r=Lh(r)?!!r.capture:!!r,n=zd(n),e&&e[Cd]?(e=e.c,(t=String(t).toString())in e.a&&-1<(n=Pd(o=e.a[t],n,r,i))&&(Nd(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete e.a[t],e.b--))):e&&(e=Hd(e))&&(t=e.a[t.toString()],e=-1,t&&(e=Pd(t,n,r,i)),(n=-1<e?t[e]:null)&&Bd(n))}function Bd(e){if("number"!=typeof e&&e&&!e.Y){var t=e.src;if(t&&t[Cd])Dd(t.c,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(jd(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Hd(t))?(Dd(n,e),0==n.b&&(n.src=null,t[Ld]=null)):Nd(e)}}}function jd(e){return e in xd?xd[e]:xd[e]="on"+e}function Gd(e,t){var n=e.listener,r=e.da||e.src;return e.Z&&Bd(e),n.call(r,t)}function qd(e,t){if(e.Y)return!0;if(!Sd){if(!t)e:{t=["window","event"];for(var n=kh,r=0;r<t.length;r++)if(null==(n=n[t[r]])){t=null;break e}t=n}return Gd(e,t=new Rd(t,this))}return Gd(e,new Rd(t,this))}function Hd(e){return(e=e[Ld])instanceof kd?e:null}var Wd="__closure_events_fn_"+(1e9*Math.random()>>>0);function zd(e){return"function"==typeof e?e:(e[Wd]||(e[Wd]=function(t){return e.handleEvent(t)}),e[Wd])}function Kd(){qh.call(this),this.c=new kd(this),this.J=this,this.D=null}function Yd(e,t){var n,r=e.D;if(r)for(n=[];r;r=r.D)n.push(r);if(e=e.J,r=t.type||t,"string"==typeof t)t=new wd(t,e);else if(t instanceof wd)t.target=t.target||e;else{var i=t;id(t=new wd(r,e),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.a=n[o];i=Qd(s,r,!0,t)&&i}if(i=Qd(s=t.a=e,r,!0,t)&&i,i=Qd(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)i=Qd(s=t.a=n[o],r,!1,t)&&i}function Qd(e,t,n,r){if(!(t=e.c.a[String(t)]))return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,c=s.da||s.src;s.Z&&Dd(e.c,s),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}Gh(Kd,qh),Kd.prototype[Cd]=!0,(Ah=Kd.prototype).addEventListener=function(e,t,n,r){Md(this,e,t,n,r)},Ah.removeEventListener=function(e,t,n,r){Fd(this,e,t,n,r)},Ah.H=function(){if(Kd.X.H.call(this),this.c){var e,t=this.c;for(e in t.a){for(var n=t.a[e],r=0;r<n.length;r++)Nd(n[r]);delete t.a[e],t.b--}}this.D=null},Ah.wa=function(e,t,n,r){return this.c.add(String(e),t,!1,n,r)},Ah.xa=function(e,t,n,r){return this.c.add(String(e),t,!0,n,r)};var Jd=kh.JSON.stringify;function Xd(){this.b=this.a=null}var $d,Zd=new(function(){function e(e,t){this.c=e,this.f=t,this.b=0,this.a=null}return e.prototype.get=function(){var e;return 0<this.b?(this.b--,this.a=(e=this.a).next,e.next=null):e=this.c(),e},e}())(function(){return new tp},function(e){e.reset()});function ep(){var e=op,t=null;return e.a&&(t=e.a,e.a=e.a.next,e.a||(e.b=null),t.next=null),t}function tp(){this.next=this.b=this.a=null}function np(e){kh.setTimeout(function(){throw e},0)}function rp(e,t){$d||function(){var e=kh.Promise.resolve(void 0);$d=function(){e.then(sp)}}(),ip||($d(),ip=!0),op.add(e,t)}Xd.prototype.add=function(e,t){var n=Zd.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n},tp.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null},tp.prototype.reset=function(){this.next=this.b=this.a=null};var ip=!1,op=new Xd;function sp(){for(var e;e=ep();){try{e.a.call(e.b)}catch(n){np(n)}var t=Zd;t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}ip=!1}function ap(e,t){Kd.call(this),this.b=e||1,this.a=t||kh,this.f=Fh(this.eb,this),this.g=jh()}function cp(e){e.aa=!1,e.M&&(e.a.clearTimeout(e.M),e.M=null)}function up(e,t,n){if("function"==typeof e)n&&(e=Fh(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Fh(e.handleEvent,e)}return 2147483647<Number(t)?-1:kh.setTimeout(e,t||0)}function lp(e){e.a=up(function(){e.a=null,e.c&&(e.c=!1,lp(e))},e.h);var t=e.b;e.b=null,e.g.apply(null,t)}Gh(ap,Kd),(Ah=ap.prototype).aa=!1,Ah.M=null,Ah.eb=function(){if(this.aa){var e=jh()-this.g;0<e&&e<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-e):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Yd(this,"tick"),this.aa&&(cp(this),this.start()))}},Ah.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=jh())},Ah.H=function(){ap.X.H.call(this),cp(this),delete this.a};var hp=function(e){function t(t,n){var r=e.call(this)||this;return r.g=t,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(e,t){function n(){this.constructor=e}Ih(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.f=function(e){this.b=arguments,this.a?this.c=!0:lp(this)},t.prototype.H=function(){e.prototype.H.call(this),this.a&&(kh.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},t}(qh);function dp(e){qh.call(this),this.b=e,this.a={}}Gh(dp,qh);var pp=[];function fp(e,t,n,r){Array.isArray(n)||(n&&(pp[0]=n.toString()),n=pp);for(var i=0;i<n.length;i++){var o=Md(t,n[i],r||e.handleEvent,!1,e.b||e);if(!o)break;e.a[o.key]=o}}function mp(e){td(e.a,function(e,t){this.a.hasOwnProperty(t)&&Bd(e)},e),e.a={}}function gp(){this.a=!0}function _p(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.a)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Jd(n)}catch(a){return t}}(e,n)+(r?" "+r:"")})}dp.prototype.H=function(){dp.X.H.call(this),mp(this)},dp.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},gp.prototype.info=function(){};var vp={},yp=null;function Ep(){return yp=yp||new Kd}function Sp(e){wd.call(this,vp.Ga,e)}function Tp(e){var t=Ep();Yd(t,new Sp(t,e))}function bp(e,t){wd.call(this,vp.STAT_EVENT,e),this.stat=t}function wp(e){var t=Ep();Yd(t,new bp(t,e))}function Rp(e){wd.call(this,vp.Ha,e)}function Ip(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return kh.setTimeout(function(){e()},t)}vp.Ga="serverreachability",Gh(Sp,wd),vp.STAT_EVENT="statevent",Gh(bp,wd),vp.Ha="timingevent",Gh(Rp,wd);var Cp={NO_ERROR:0,fb:1,sb:2,rb:3,mb:4,qb:5,tb:6,Ea:7,TIMEOUT:8,wb:9},Ap={kb:"complete",Gb:"success",Fa:"error",Ea:"abort",yb:"ready",zb:"readystatechange",TIMEOUT:"timeout",ub:"incrementaldata",xb:"progress",nb:"downloadprogress",Ob:"uploadprogress"};function Op(){}function Np(){}Op.prototype.b=null;var kp,Dp={OPEN:"a",jb:"b",Fa:"c",vb:"d"};function Pp(){wd.call(this,"d")}function Lp(){wd.call(this,"c")}function xp(){}function Mp(e,t,n,r){this.g=e,this.c=t,this.f=n,this.S=r||1,this.J=new dp(this),this.P=Up,this.R=new ap(e=hd?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.G=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}Gh(Pp,wd),Gh(Lp,wd),Gh(xp,Op),xp.prototype.a=function(){return new XMLHttpRequest},xp.prototype.c=function(){return{}},kp=new xp;var Up=45e3,Vp={},Fp={};function Bp(e,t,n){e.G=1,e.i=uf(nf(t)),e.j=n,e.I=!0,jp(e,null)}function jp(e,t){e.u=jh(),Hp(e),e.l=nf(e.i);var n=e.l,r=e.S;Array.isArray(r)||(r=[String(r)]),Tf(n.b,"t",r),e.D=0,e.a=gm(e.g,e.g.C?t:null),0<e.O&&(e.F=new hp(Fh(e.Da,e,e.a),e.O)),fp(e.J,e.a,"readystatechange",e.bb),t=e.B?nd(e.B):{},e.j?(e.m||(e.m="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.a.ba(e.l,e.m,e.j,t)):(e.m="GET",e.a.ba(e.l,e.m,null,t)),Tp(1),function(e,t,n,r,i,o){e.info(function(){if(e.a)if(o)for(var s="",a=o.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");s=2<=h.length&&"type"==h[1]?s+(l+"=")+u+"&":s+(l+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+s})}(e.c,e.m,e.l,e.f,e.S,e.j)}function Gp(e,t,n){for(var r=!0;!e.A&&e.D<n.length;){var i=qp(e,n);if(i==Fp){4==t&&(e.h=4,wp(14),r=!1),_p(e.c,e.f,null,"[Incomplete Response]");break}if(i==Vp){e.h=4,wp(15),_p(e.c,e.f,n,"[Invalid Chunk]"),r=!1;break}_p(e.c,e.f,i,null),Qp(e,i)}4==t&&0==n.length&&(e.h=1,wp(16),r=!1),e.b=e.b&&r,r?0<n.length&&!e.V&&(e.V=!0,(t=e.g).a==e&&t.U&&!t.F&&(t.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),cm(t),t.F=!0,wp(11))):(_p(e.c,e.f,n,"[Invalid Chunked Response]"),Yp(e),Kp(e))}function qp(e,t){var n=e.D,r=t.indexOf("\n",n);return-1==r?Fp:(n=Number(t.substring(n,r)),isNaN(n)?Vp:(r+=1)+n>t.length?Fp:(t=t.substr(r,n),e.D=r+n,t))}function Hp(e){e.T=jh()+e.P,Wp(e,e.P)}function Wp(e,t){if(null!=e.o)throw Error("WatchDog timer not null");e.o=Ip(Fh(e.$a,e),t)}function zp(e){e.o&&(kh.clearTimeout(e.o),e.o=null)}function Kp(e){0==e.g.v||e.A||hm(e.g,e)}function Yp(e){zp(e);var t=e.F;t&&"function"==typeof t.ka&&t.ka(),e.F=null,cp(e.R),mp(e.J),e.a&&(t=e.a,e.a=null,t.abort(),t.ka())}function Qp(e,t){try{var n=e.g;if(0!=n.v&&(n.a==e||Of(n.b,e)))if(n.I=e.N,!e.C&&Of(n.b,e)&&3==n.v){try{var r=n.la.a.parse(t)}catch(_R){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.j){if(n.a){if(!(n.a.u+3e3<e.u))break e;lm(n),Zf(n)}am(n),wp(18)}}else n.pa=i[1],0<n.pa-n.P&&37500>i[2]&&n.G&&0==n.o&&!n.m&&(n.m=Ip(Fh(n.Xa,n),6e3));if(1>=Af(n.b)&&n.fa){try{n.fa()}catch(_R){}n.fa=void 0}}else pm(n,11)}else if((e.C||n.a==e)&&lm(n),!Yh(t))for(t=r=n.la.a.parse(t),r=0;r<t.length;r++)if(n.P=(i=t[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ha=i[2];var o=i[3];null!=o&&(n.ia=o,n.c.info("VER="+n.ia));var s=i[4];null!=s&&(n.qa=s,n.c.info("SVER="+n.qa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var c=1.5*a;n.D=c,n.c.info("backChannelRequestTimeoutMs_="+c)}c=n;var u=e.a;if(u){var l=u.a?u.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=c.b;!h.a&&(Xh(l,"spdy")||Xh(l,"quic")||Xh(l,"h2"))&&(h.f=h.g,h.a=new Set,h.b&&(Nf(h,h.b),h.b=null))}if(c.A){var d=u.a?u.a.getResponseHeader("X-HTTP-Session-Id"):null;d&&(c.oa=d,cf(c.B,c.A,d))}}n.v=3,n.f&&n.f.ua(),n.U&&(n.N=jh()-e.u,n.c.info("Handshake RTT: "+n.N+"ms"));var p=e;if((c=n).ma=mm(c,c.C?c.ha:null,c.ga),p.C){kf(c.b,p);var f=p,m=c.D;m&&f.setTimeout(m),f.o&&(zp(f),Hp(f)),c.a=p}else sm(c);0<n.g.length&&nm(n)}else"stop"!=i[0]&&"close"!=i[0]||pm(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?pm(n,7):$f(n):"noop"!=i[0]&&n.f&&n.f.ta(i),n.o=0);Tp(4)}catch(_R){}}function Jp(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Ph(e)||"string"==typeof e)Wh(e,t,void 0);else{if(e.L&&"function"==typeof e.L)var n=e.L();else if(e.K&&"function"==typeof e.K)n=void 0;else if(Ph(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;i=(r=function(e){if(e.K&&"function"==typeof e.K)return e.K();if("string"==typeof e)return e.split("");if(Ph(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Xp(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Xp)for(n=e.L(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function $p(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];Zp(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){var i={};for(n=t=0;t<e.a.length;)Zp(i,r=e.a[t])||(e.a[n++]=r,i[r]=1),t++;e.a.length=n}}function Zp(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(Ah=Mp.prototype).setTimeout=function(e){this.P=e},Ah.bb=function(e){e=e.target;var t=this.F;t&&3==Yf(e)?t.f():this.Da(e)},Ah.Da=function(e){try{if(e==this.a)e:{var t=Yf(this.a),n=this.a.va(),r=this.a.W();if(!(3>t||3==t&&!hd&&!this.a.$())){this.A||4!=t||7==n||Tp(8==n||0>=r?3:2),zp(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(e,t,n,r,i,o,s){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+o+" "+s})}(this.c,this.m,this.l,this.f,this.S,t,i),this.b){if(this.U&&!this.C){t:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Yh(s)){var c=s;break t}}c=null}if(!c){this.b=!1,this.h=3,wp(12),Yp(this),Kp(this);break e}_p(this.c,this.f,c,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Qp(this,c)}this.I?(Gp(this,t,o),hd&&this.b&&3==t&&(fp(this.J,this.R,"tick",this.ab),this.R.start())):(_p(this.c,this.f,o,null),Qp(this,o)),4==t&&Yp(this),this.b&&!this.A&&(4==t?hm(this.g,this):(this.b=!1,Hp(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,wp(12)):(this.h=0,wp(13)),Yp(this),Kp(this)}}}catch(u){}},Ah.ab=function(){if(this.a){var e=Yf(this.a),t=this.a.$();this.D<t.length&&(zp(this),Gp(this,e,t),this.b&&4!=e&&Hp(this))}},Ah.cancel=function(){this.A=!0,Yp(this)},Ah.$a=function(){this.o=null;var e=jh();0<=e-this.T?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.c,this.l),2!=this.G&&(Tp(3),wp(17)),Yp(this),this.h=2,Kp(this)):Wp(this,this.T-e)},(Ah=Xp.prototype).K=function(){$p(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e},Ah.L=function(){return $p(this),this.a.concat()},Ah.get=function(e,t){return Zp(this.b,e)?this.b[e]:t},Ah.set=function(e,t){Zp(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t},Ah.forEach=function(e,t){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};var ef=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function tf(e,t){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,e instanceof tf){this.a=void 0!==t?t:e.a,rf(this,e.f),this.j=e.j,of(this,e.c),sf(this,e.h),this.g=e.g,t=e.b;var n=new vf;n.c=t.c,t.a&&(n.a=new Xp(t.a),n.b=t.b),af(this,n),this.i=e.i}else e&&(n=String(e).match(ef))?(this.a=!!t,rf(this,n[1]||"",!0),this.j=lf(n[2]||""),of(this,n[3]||"",!0),sf(this,n[4]),this.g=lf(n[5]||"",!0),af(this,n[6]||"",!0),this.i=lf(n[7]||"")):(this.a=!!t,this.b=new vf(null,this.a))}function nf(e){return new tf(e)}function rf(e,t,n){e.f=n?lf(t,!0):t,e.f&&(e.f=e.f.replace(/:$/,""))}function of(e,t,n){e.c=n?lf(t,!0):t}function sf(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.h=t}else e.h=null}function af(e,t,n){t instanceof vf?(e.b=t,function(e,t){t&&!e.f&&(yf(e),e.c=null,e.a.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(Ef(this,t),Tf(this,n,e))},e)),e.f=t}(e.b,e.a)):(n||(t=hf(t,gf)),e.b=new vf(t,e.a))}function cf(e,t,n){e.b.set(t,n)}function uf(e){return cf(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^jh()).toString(36)),e}function lf(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function hf(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,df),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function df(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}tf.prototype.toString=function(){var e=[],t=this.f;t&&e.push(hf(t,pf,!0),":");var n=this.c;return(n||"file"==t)&&(e.push("//"),(t=this.j)&&e.push(hf(t,pf,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&e.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&e.push("/"),e.push(hf(n,"/"==n.charAt(0)?mf:ff,!0))),(n=this.b.toString())&&e.push("?",n),(n=this.i)&&e.push("#",hf(n,_f)),e.join("")};var pf=/[#\/\?@]/g,ff=/[#\?:]/g,mf=/[#\?]/g,gf=/[#\?@]/g,_f=/#/g;function vf(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function yf(e){e.a||(e.a=new Xp,e.b=0,e.c&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.c,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function Ef(e,t){yf(e),t=bf(e,t),Zp(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,Zp((e=e.a).b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&$p(e)))}function Sf(e,t){return yf(e),t=bf(e,t),Zp(e.a.b,t)}function Tf(e,t,n){Ef(e,t),0<n.length&&(e.c=null,e.a.set(bf(e,t),Kh(n)),e.b+=n.length)}function bf(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}(Ah=vf.prototype).add=function(e,t){yf(this),this.c=null,e=bf(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this},Ah.forEach=function(e,t){yf(this),this.a.forEach(function(n,r){Wh(n,function(n){e.call(t,n,r,this)},this)},this)},Ah.L=function(){yf(this);for(var e=this.a.K(),t=this.a.L(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n},Ah.K=function(e){yf(this);var t=[];if("string"==typeof e)Sf(this,e)&&(t=zh(t,this.a.get(bf(this,e))));else{e=this.a.K();for(var n=0;n<e.length;n++)t=zh(t,e[n])}return t},Ah.set=function(e,t){return yf(this),this.c=null,Sf(this,e=bf(this,e))&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this},Ah.get=function(e,t){return e&&0<(e=this.K(e)).length?String(e[0]):t},Ah.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.L(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),e.push(s)}}return this.c=e.join("&")};var wf=function(){return function(e,t){this.b=e,this.a=t}}();function Rf(e){this.g=e||If,e=kh.PerformanceNavigationTiming?0<(e=kh.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(kh.ja&&kh.ja.za&&kh.ja.za()&&kh.ja.za().Qb),this.f=e?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var If=10;function Cf(e){return!!e.b||!!e.a&&e.a.size>=e.f}function Af(e){return e.b?1:e.a?e.a.size:0}function Of(e,t){return e.b?e.b==t:!!e.a&&e.a.has(t)}function Nf(e,t){e.a?e.a.add(t):e.b=t}function kf(e,t){e.b&&e.b==t?e.b=null:e.a&&e.a.has(t)&&e.a.delete(t)}function Df(e){var t,n;if(null!=e.b)return e.c.concat(e.b.s);if(null!=e.a&&0!==e.a.size){var r=e.c;try{for(var i=Ch(e.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){t={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}return Kh(e.c)}function Pf(){}function Lf(){this.a=new Pf}function xf(e,t,n){var r=n||"";try{Jp(e,function(e,n){var i=e;Lh(e)&&(i=Jd(e)),t.push(r+n+"="+encodeURIComponent(i))})}catch(jR){throw t.push(r+"type="+encodeURIComponent("_badmap")),jR}}function Mf(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(o){}}Rf.prototype.cancel=function(){var e,t;if(this.c=Df(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=Ch(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){e={error:i}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},Pf.prototype.stringify=function(e){return kh.JSON.stringify(e,void 0)},Pf.prototype.parse=function(e){return kh.JSON.parse(e,void 0)};var Uf=kh.JSON.parse;function Vf(e){Kd.call(this),this.headers=new Xp,this.l=e||null,this.b=!1,this.u=this.a=null,this.C="",this.h=0,this.f="",this.g=this.B=this.m=this.A=!1,this.s=0,this.o=null,this.I=Ff,this.F=this.G=!1}Gh(Vf,Kd);var Ff="",Bf=/^https?$/i,jf=["POST","PUT"];function Gf(e){return"content-type"==e.toLowerCase()}function qf(e,t){e.b=!1,e.a&&(e.g=!0,e.a.abort(),e.g=!1),e.f=t,e.h=5,Hf(e),zf(e)}function Hf(e){e.A||(e.A=!0,Yd(e,"complete"),Yd(e,"error"))}function Wf(e){if(e.b&&void 0!==Nh&&(!e.u[1]||4!=Yf(e)||2!=e.W()))if(e.m&&4==Yf(e))up(e.Aa,0,e);else if(Yd(e,"readystatechange"),4==Yf(e)){e.b=!1;try{var t,n=e.W();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var o=String(e.C).match(ef)[1]||null;if(!o&&kh.self&&kh.self.location){var s=kh.self.location.protocol;o=s.substr(0,s.length-1)}i=!Bf.test(o?o.toLowerCase():"")}t=i}if(t)Yd(e,"complete"),Yd(e,"success");else{e.h=6;try{var a=2<Yf(e)?e.a.statusText:""}catch(n){a=""}e.f=a+" ["+e.W()+"]",Hf(e)}}finally{zf(e)}}}function zf(e,t){if(e.a){Kf(e);var n=e.a,r=e.u[0]?Dh:null;e.a=null,e.u=null,t||Yd(e,"ready");try{n.onreadystatechange=r}catch(jR){}}}function Kf(e){e.a&&e.F&&(e.a.ontimeout=null),e.o&&(kh.clearTimeout(e.o),e.o=null)}function Yf(e){return e.a?e.a.readyState:0}function Qf(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){var t="";return td(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):cf(e,t,n))}function Jf(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Xf(e){this.qa=0,this.g=[],this.c=new gp,this.ha=this.ma=this.B=this.ga=this.a=this.oa=this.A=this.V=this.i=this.O=this.l=null,this.Pa=this.R=0,this.Ma=Jf("failFast",!1,e),this.G=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.pa=this.P=-1,this.T=this.o=this.u=0,this.Ia=Jf("baseRetryDelayMs",5e3,e),this.Sa=Jf("retryDelaySeedMs",1e4,e),this.Na=Jf("forwardChannelMaxRetries",2,e),this.na=Jf("forwardChannelRequestTimeoutMs",2e4,e),this.Oa=e&&e.xmlHttpFactory||void 0,this.D=void 0,this.C=e&&e.supportsCrossDomainXhr||!1,this.J="",this.b=new Rf(e&&e.concurrentRequestLimit),this.la=new Lf,this.ea=e&&e.fastHandshake||!1,this.Ja=e&&e.b||!1,e&&e.f&&(this.c.a=!1),e&&e.forceLongPolling&&(this.S=!1),this.U=!this.ea&&this.S&&e&&e.detectBufferingProxy||!1,this.fa=void 0,this.N=0,this.F=!1,this.s=null,(this.La=e&&e.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function $f(e){if(em(e),3==e.v){var t=e.R++,n=nf(e.B);cf(n,"SID",e.J),cf(n,"RID",t),cf(n,"TYPE","terminate"),im(e,n),(t=new Mp(e,e.c,t,void 0)).G=2,t.i=uf(nf(n)),n=!1,kh.navigator&&kh.navigator.sendBeacon&&(n=kh.navigator.sendBeacon(t.i.toString(),"")),!n&&kh.Image&&((new Image).src=t.i,n=!0),n||(t.a=gm(t.g,null),t.a.ba(t.i)),t.u=jh(),Hp(t)}fm(e)}function Zf(e){e.a&&(cm(e),e.a.cancel(),e.a=null)}function em(e){Zf(e),e.j&&(kh.clearTimeout(e.j),e.j=null),lm(e),e.b.cancel(),e.h&&("number"==typeof e.h&&kh.clearTimeout(e.h),e.h=null)}function tm(e,t){e.g.push(new wf(e.Pa++,t)),3==e.v&&nm(e)}function nm(e){Cf(e.b)||e.h||(e.h=!0,rp(e.Ca,e),e.u=0)}function rm(e,t){var n;n=t?t.f:e.R++;var r=nf(e.B);cf(r,"SID",e.J),cf(r,"RID",n),cf(r,"AID",e.P),im(e,r),e.i&&e.l&&Qf(r,e.i,e.l),n=new Mp(e,e.c,n,e.u+1),null===e.i&&(n.B=e.l),t&&(e.g=t.s.concat(e.g)),t=om(e,n,1e3),n.setTimeout(Math.round(.5*e.na)+Math.round(.5*e.na*Math.random())),Nf(e.b,n),Bp(n,r,t)}function im(e,t){e.f&&Jp({},function(e,n){cf(t,n,e)})}function om(e,t,n){n=Math.min(e.g.length,n);var r=e.f?Fh(e.f.Ka,e.f,e):null;e:for(var i=e.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,c=0;c<n;c++){var u=i[c].b,l=i[c].a;if(0>(u-=o))o=Math.max(0,i[c].b-100),a=!1;else try{xf(l,s,"req"+u+"_")}catch($m){r&&r(l)}}if(a){r=s.join("&");break e}}return e=e.g.splice(0,n),t.s=e,r}function sm(e){e.a||e.j||(e.T=1,rp(e.Ba,e),e.o=0)}function am(e){return!(e.a||e.j||3<=e.o||(e.T++,e.j=Ip(Fh(e.Ba,e),dm(e,e.o)),e.o++,0))}function cm(e){null!=e.s&&(kh.clearTimeout(e.s),e.s=null)}function um(e){e.a=new Mp(e,e.c,"rpc",e.T),null===e.i&&(e.a.B=e.l),e.a.O=0;var t=nf(e.ma);cf(t,"RID","rpc"),cf(t,"SID",e.J),cf(t,"CI",e.G?"0":"1"),cf(t,"AID",e.P),im(e,t),cf(t,"TYPE","xmlhttp"),e.i&&e.l&&Qf(t,e.i,e.l),e.D&&e.a.setTimeout(e.D);var n=e.a;e=e.ha,n.G=1,n.i=uf(nf(t)),n.j=null,n.I=!0,jp(n,e)}function lm(e){null!=e.m&&(kh.clearTimeout(e.m),e.m=null)}function hm(e,t){var n=null;if(e.a==t){lm(e),cm(e),e.a=null;var r=2}else{if(!Of(e.b,t))return;n=t.s,kf(e.b,t),r=1}if(e.I=t.N,0!=e.v)if(t.b)if(1==r){n=t.j?t.j.length:0,t=jh()-t.u;var i=e.u;Yd(r=Ep(),new Rp(r,n,t,i)),nm(e)}else sm(e);else if(3==(i=t.h)||0==i&&0<e.I||!(1==r&&function(e,t){return!(Af(e.b)>=e.b.f-(e.h?1:0)||(e.h?(e.g=t.s.concat(e.g),0):1==e.v||2==e.v||e.u>=(e.Ma?0:e.Na)||(e.h=Ip(Fh(e.Ca,e,t),dm(e,e.u)),e.u++,0)))}(e,t)||2==r&&am(e)))switch(n&&0<n.length&&(t=e.b,t.c=t.c.concat(n)),i){case 1:pm(e,5);break;case 4:pm(e,10);break;case 3:pm(e,6);break;default:pm(e,2)}}function dm(e,t){var n=e.Ia+Math.floor(Math.random()*e.Sa);return e.f||(n*=2),n*t}function pm(e,t){if(e.c.info("Error code "+t),2==t){var n=null;e.f&&(n=null);var r=Fh(e.cb,e);n||(n=new tf("//www.google.com/images/cleardot.gif"),kh.location&&"http"==kh.location.protocol||rf(n,"https"),uf(n)),function(e,t){var n=new gp;if(kh.Image){var r=new Image;r.onload=Bh(Mf,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Bh(Mf,n,r,"TestLoadImage: error",!1,t),r.onabort=Bh(Mf,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Bh(Mf,n,r,"TestLoadImage: timeout",!1,t),kh.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)}else wp(2);e.v=0,e.f&&e.f.sa(t),fm(e),em(e)}function fm(e){e.v=0,e.I=-1,e.f&&(0==Df(e.b).length&&0==e.g.length||(e.b.c.length=0,Kh(e.g),e.g.length=0),e.f.ra())}function mm(e,t,n){var r=function(e){return e instanceof tf?nf(e):new tf(e,void 0)}(n);if(""!=r.c)t&&of(r,t+"."+r.c),sf(r,r.h);else{var i=kh.location;r=function(e,t,n,r){var i=new tf(null,void 0);return e&&rf(i,e),t&&of(i,t),n&&sf(i,n),r&&(i.g=r),i}(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.V&&td(e.V,function(e,t){cf(r,t,e)}),n=e.oa,(t=e.A)&&n&&cf(r,t,n),cf(r,"VER",e.ia),im(e,r),r}function gm(e,t){if(t&&!e.C)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Vf(e.Oa)).G=e.C,t}function _m(){}function vm(){if(ud&&!(10<=Number(Ed)))throw Error("Environmental error: no available transport.")}function ym(e,t){Kd.call(this),this.a=new Xf(t),this.g=e,this.b=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.a.l=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.a&&(e?e["X-WebChannel-Client-Profile"]=t.a:e={"X-WebChannel-Client-Profile":t.a}),this.a.O=e,(e=t&&t.httpHeadersOverwriteParam)&&!Yh(e)&&(this.a.i=e),this.o=t&&t.supportsCrossDomainXhr||!1,this.m=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Yh(t)&&(this.a.A=t,null!==(e=this.b)&&t in e&&t in(e=this.b)&&delete e[t]),this.f=new Tm(this)}function Em(e){Pp.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.c=e)?(e=this.c,this.data=null!==t&&e in t?t[e]:void 0):this.data=t}else this.data=e}function Sm(){Lp.call(this),this.status=1}function Tm(e){this.a=e}function bm(e){this.f=e}function wm(e){Kd.call(this),this.u=e,this.h=void 0,this.readyState=Rm,this.status=0,this.responseType=this.responseText=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.s="GET",this.o="",this.a=!1,this.m=this.f=this.g=null}(Ah=Vf.prototype).ba=function(e,t,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.C+"; newUri="+e);t=t?t.toUpperCase():"GET",this.C=e,this.f="",this.h=0,this.A=!1,this.b=!0,this.a=this.l?this.l.a():kp.a(),this.u=function(e){return e.b||(e.b=e.c())}(this.l?this.l:kp),this.a.onreadystatechange=Fh(this.Aa,this);try{this.B=!0,this.a.open(t,String(e),!0),this.B=!1}catch(o){return void qf(this,o)}e=n||"";var i=new Xp(this.headers);r&&Jp(r,function(e,t){i.set(t,e)}),r=function(e){e:{for(var t=Gf,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.L()),n=kh.FormData&&e instanceof kh.FormData,!(0<=Hh(jf,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(e,t){this.a.setRequestHeader(t,e)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.G&&(this.a.withCredentials=this.G);try{Kf(this),0<this.s&&((this.F=function(e){return ud&&yd(9)&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.a))?(this.a.timeout=this.s,this.a.ontimeout=Fh(this.ya,this)):this.o=up(this.ya,this.s,this)),this.m=!0,this.a.send(e),this.m=!1}catch(o){qf(this,o)}},Ah.ya=function(){void 0!==Nh&&this.a&&(this.f="Timed out after "+this.s+"ms, aborting",this.h=8,Yd(this,"timeout"),this.abort(8))},Ah.abort=function(e){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=e||7,Yd(this,"complete"),Yd(this,"abort"),zf(this))},Ah.H=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),zf(this,!0)),Vf.X.H.call(this)},Ah.Aa=function(){this.j||(this.B||this.m||this.g?Wf(this):this.Za())},Ah.Za=function(){Wf(this)},Ah.W=function(){try{return 2<Yf(this)?this.a.status:-1}catch(ad){return-1}},Ah.$=function(){try{return this.a?this.a.responseText:""}catch(ad){return""}},Ah.Qa=function(e){if(this.a){var t=this.a.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Uf(t)}},Ah.va=function(){return this.h},Ah.Ra=function(){return"string"==typeof this.f?this.f:String(this.f)},(Ah=Xf.prototype).ia=8,Ah.v=1,Ah.Ca=function(e){if(this.h)if(this.h=null,1==this.v){if(!e){this.R=Math.floor(1e5*Math.random()),e=this.R++;var t,n=new Mp(this,this.c,e,void 0),r=this.l;if(this.O&&(r?id(r=nd(r),this.O):r=this.O),null===this.i&&(n.B=r),this.ea)e:{for(var i=t=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(t+=o)){t=i;break e}if(4096===t||i===this.g.length-1){t=i+1;break e}}t=1e3}else t=1e3;t=om(this,n,t),cf(i=nf(this.B),"RID",e),cf(i,"CVER",22),this.A&&cf(i,"X-HTTP-Session-Id",this.A),im(this,i),this.i&&r&&Qf(i,this.i,r),Nf(this.b,n),this.Ja&&cf(i,"TYPE","init"),this.ea?(cf(i,"$req",t),cf(i,"SID","null"),n.U=!0,Bp(n,i,null)):Bp(n,i,t),this.v=2}}else 3==this.v&&(e?rm(this,e):0==this.g.length||Cf(this.b)||rm(this))},Ah.Ba=function(){if(this.j=null,um(this),this.U&&!(this.F||null==this.a||0>=this.N)){var e=2*this.N;this.c.info("BP detection timer enabled: "+e),this.s=Ip(Fh(this.Ya,this),e)}},Ah.Ya=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.F=!0,wp(10),Zf(this),um(this))},Ah.Xa=function(){null!=this.m&&(this.m=null,Zf(this),am(this),wp(19))},Ah.cb=function(e){e?(this.c.info("Successfully pinged google.com"),wp(2)):(this.c.info("Failed to ping google.com"),wp(1))},(Ah=_m.prototype).ua=function(){},Ah.ta=function(){},Ah.sa=function(){},Ah.ra=function(){},Ah.Ka=function(){},vm.prototype.a=function(e,t){return new ym(e,t)},Gh(ym,Kd),ym.prototype.h=function(){this.a.f=this.f,this.o&&(this.a.C=!0);var e=this.a,t=this.g,n=this.b||void 0;wp(0),e.ga=t,e.V=n||{},e.G=e.S,e.B=mm(e,null,e.ga),nm(e)},ym.prototype.close=function(){$f(this.a)},ym.prototype.l=function(e){if("string"==typeof e){var t={};t.__data__=e,tm(this.a,t)}else this.m?((t={}).__data__=Jd(e),tm(this.a,t)):tm(this.a,e)},ym.prototype.H=function(){this.a.f=null,delete this.f,$f(this.a),delete this.a,ym.X.H.call(this)},Gh(Em,Pp),Gh(Sm,Lp),Gh(Tm,_m),Tm.prototype.ua=function(){Yd(this.a,"a")},Tm.prototype.ta=function(e){Yd(this.a,new Em(e))},Tm.prototype.sa=function(e){Yd(this.a,new Sm(e))},Tm.prototype.ra=function(){Yd(this.a,"b")},Gh(bm,Op),bm.prototype.a=function(){return new wm(this.f)},bm.prototype.c=function(e){return function(){return e}}({}),Gh(wm,Kd);var Rm=0;function Im(e){e.f.read().then(e.Ta.bind(e)).catch(e.ca.bind(e))}function Cm(e){e.readyState=4,e.g=null,e.f=null,e.m=null,Am(e)}function Am(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Ah=wm.prototype).open=function(e,t){if(this.readyState!=Rm)throw this.abort(),Error("Error reopening a connection");this.s=e,this.o=t,this.readyState=1,Am(this)},Ah.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var t={headers:this.l,method:this.s,credentials:this.h,cache:void 0};e&&(t.body=e),this.u.fetch(new Request(this.o,t)).then(this.Wa.bind(this),this.ca.bind(this))},Ah.abort=function(){this.responseText="",this.l=new Headers,this.status=0,this.f&&this.f.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Cm(this)),this.readyState=Rm},Ah.Wa=function(e){this.a&&(this.g=e,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=e.headers,this.readyState=2,Am(this)),this.a&&(this.readyState=3,Am(this),this.a&&("arraybuffer"===this.responseType?e.arrayBuffer().then(this.Ua.bind(this),this.ca.bind(this)):void 0!==kh.ReadableStream&&"body"in e?(this.responseText="",this.f=e.body.getReader(),this.m=new TextDecoder,Im(this)):e.text().then(this.Va.bind(this),this.ca.bind(this)))))},Ah.Ta=function(e){if(this.a){var t=this.m.decode(e.value?e.value:new Uint8Array(0),{stream:!e.done});t&&(this.responseText+=t),e.done?Cm(this):Am(this),3==this.readyState&&Im(this)}},Ah.Va=function(e){this.a&&(this.responseText=e,Cm(this))},Ah.Ua=function(){this.a&&Cm(this)},Ah.ca=function(){this.a&&Cm(this)},Ah.setRequestHeader=function(e,t){this.l.append(e,t)},Ah.getResponseHeader=function(e){return this.b&&this.b.get(e.toLowerCase())||""},Ah.getAllResponseHeaders=function(){if(!this.b)return"";for(var e=[],t=this.b.entries(),n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(wm.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(e){this.h=e?"include":"same-origin"}}),vm.prototype.createWebChannel=vm.prototype.a,ym.prototype.send=ym.prototype.l,ym.prototype.open=ym.prototype.h,ym.prototype.close=ym.prototype.close,Cp.NO_ERROR=0,Cp.TIMEOUT=8,Cp.HTTP_ERROR=6,Ap.COMPLETE="complete",Np.EventType=Dp,Dp.OPEN="a",Dp.CLOSE="b",Dp.ERROR="c",Dp.MESSAGE="d",Kd.prototype.listen=Kd.prototype.wa,Vf.prototype.listenOnce=Vf.prototype.xa,Vf.prototype.getLastError=Vf.prototype.Ra,Vf.prototype.getLastErrorCode=Vf.prototype.va,Vf.prototype.getStatus=Vf.prototype.W,Vf.prototype.getResponseJson=Vf.prototype.Qa,Vf.prototype.getResponseText=Vf.prototype.$,Vf.prototype.send=Vf.prototype.ba;var Om=Cp,Nm=Ap,km=vp,Dm=bm,Pm=Np,Lm=Vf,xm=function(){function e(e,t){var n=this;this.previousValue=e,t&&(t.sequenceNumberHandler=function(e){return n.t(e)},this.i=function(e){return t.writeSequenceNumber(e)})}return e.prototype.t=function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue},e.prototype.next=function(){var e=++this.previousValue;return this.i&&this.i(e),e},e}();xm.o=-1;var Mm={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Um=function(e){function t(t,n){var r=this;return(r=e.call(this,n)||this).code=t,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,ac.ZT)(t,e),t}(Error),Vm=new Rh.Yd("@firebase/firestore");function Fm(){return Vm.logLevel}function Bm(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Vm.logLevel<=Rh.in.DEBUG){var r=t.map(qm);Vm.debug.apply(Vm,(0,ac.ev)(["Firestore (8.6.8): "+e],r))}}function jm(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Vm.logLevel<=Rh.in.ERROR){var r=t.map(qm);Vm.error.apply(Vm,(0,ac.ev)(["Firestore (8.6.8): "+e],r))}}function Gm(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Vm.logLevel<=Rh.in.WARN){var r=t.map(qm);Vm.warn.apply(Vm,(0,ac.ev)(["Firestore (8.6.8): "+e],r))}}function qm(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(jR){return e}}function Hm(e){void 0===e&&(e="Unexpected state");var t="FIRESTORE (8.6.8) INTERNAL ASSERTION FAILED: "+e;throw jm(t),new Error(t)}function Wm(e,t){e||Hm()}function zm(e,t){return e}function Km(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var Ym=function(){function e(){}return e.u=function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=Km(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n},e}();function Qm(e,t){return e<t?-1:e>t?1:0}function Jm(e,t,n){return e.length===t.length&&e.every(function(e,r){return n(e,t[r])})}function Xm(e){return e+"\0"}var $m=function(){function e(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Um(Mm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Um(Mm.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new Um(Mm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Um(Mm.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(e){return this.seconds===e.seconds?Qm(this.nanoseconds,e.nanoseconds):Qm(this.seconds,e.seconds)},e.prototype.isEqual=function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e}(),Zm=function(){function e(e){this.timestamp=e}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new $m(0,0))},e.prototype.compareTo=function(e){return this.timestamp._compareTo(e.timestamp)},e.prototype.isEqual=function(e){return this.timestamp.isEqual(e.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e}();function eg(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tg(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ng(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var rg=function(){function e(e,t,n){void 0===t?t=0:t>e.length&&Hm(),void 0===n?n=e.length-t:n>e.length-t&&Hm(),this.segments=e,this.offset=t,this.len=n}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return 0===e.comparator(this,t)},e.prototype.child=function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(e){n.push(e)}):n.push(t),this.construct(n)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(e){return this.segments[this.offset+e]},e.prototype.isEmpty=function(){return 0===this.length},e.prototype.isPrefixOf=function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},e.prototype.isImmediateParentOf=function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0},e.prototype.forEach=function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),o=t.get(r);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0},e}(),ig=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,ac.ZT)(t,e),t.prototype.construct=function(e,n,r){return new t(e,n,r)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=[],i=0,o=e;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Um(Mm.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(e){return e.length>0}))}return new t(r)},t.emptyPath=function(){return new t([])},t}(rg),og=/^[_a-zA-Z][_a-zA-Z0-9]*$/,sg=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,ac.ZT)(t,e),t.prototype.construct=function(e,n,r){return new t(e,n,r)},t.isValidIdentifier=function(e){return og.test(e)},t.prototype.canonicalString=function(){return this.toArray().map(function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(e)||(e="`"+e+"`"),e}).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(e){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Um(Mm.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<e.length;){var a=e[i];if("\\"===a){if(i+1===e.length)throw new Um(Mm.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new Um(Mm.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Um(Mm.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new t(n)},t.emptyPath=function(){return new t([])},t}(rg),ag=function(){function e(e){this.fields=e,e.sort(sg.comparator)}return e.prototype.covers=function(e){for(var t=0,n=this.fields;t<n.length;t++)if(n[t].isPrefixOf(e))return!0;return!1},e.prototype.isEqual=function(e){return Jm(this.fields,e.fields,function(e,t){return e.isEqual(t)})},e}(),cg=function(){function e(e){this.binaryString=e}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e(function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(t))},e.prototype.toBase64=function(){return btoa(this.binaryString)},e.prototype.toUint8Array=function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(e){return Qm(this.binaryString,e.binaryString)},e.prototype.isEqual=function(e){return this.binaryString===e.binaryString},e}();cg.EMPTY_BYTE_STRING=new cg("");var ug=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function lg(e){if(Wm(!!e),"string"==typeof e){var t=0,n=ug.exec(e);if(Wm(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:hg(e.seconds),nanos:hg(e.nanos)}}function hg(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function dg(e){return"string"==typeof e?cg.fromBase64String(e):cg.fromUint8Array(e)}function pg(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function fg(e){var t=e.mapValue.fields.__previous_value__;return pg(t)?fg(t):t}function mg(e){var t=lg(e.mapValue.fields.__local_write_time__.timestampValue);return new $m(t.seconds,t.nanos)}function gg(e){return null==e}function _g(e){return 0===e&&1/e==-1/0}function vg(e){return"number"==typeof e&&Number.isInteger(e)&&!_g(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var yg=function(){function e(e){this.path=e}return e.fromPath=function(t){return new e(ig.fromString(t))},e.fromName=function(t){return new e(ig.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e},e.prototype.isEqual=function(e){return null!==e&&0===ig.comparator(this.path,e.path)},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(e,t){return ig.comparator(e.path,t.path)},e.isDocumentKey=function(e){return e.length%2==0},e.fromSegments=function(t){return new e(new ig(t.slice()))},e}();function Eg(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?pg(e)?4:10:Hm()}function Sg(e,t){var n=Eg(e);if(n!==Eg(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return mg(e).isEqual(mg(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=lg(e.timestampValue),r=lg(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return dg(e.bytesValue).isEqual(dg(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return hg(e.geoPointValue.latitude)===hg(t.geoPointValue.latitude)&&hg(e.geoPointValue.longitude)===hg(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return hg(e.integerValue)===hg(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=hg(e.doubleValue),r=hg(t.doubleValue);return n===r?_g(n)===_g(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Jm(e.arrayValue.values||[],t.arrayValue.values||[],Sg);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(eg(n)!==eg(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Sg(n[i],r[i])))return!1;return!0}(e,t);default:return Hm()}}function Tg(e,t){return void 0!==(e.values||[]).find(function(e){return Sg(e,t)})}function bg(e,t){var n=Eg(e),r=Eg(t);if(n!==r)return Qm(n,r);switch(n){case 0:return 0;case 1:return Qm(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=hg(e.integerValue||e.doubleValue),r=hg(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return wg(e.timestampValue,t.timestampValue);case 4:return wg(mg(e),mg(t));case 5:return Qm(e.stringValue,t.stringValue);case 6:return function(e,t){var n=dg(e),r=dg(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Qm(n[i],r[i]);if(0!==o)return o}return Qm(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=Qm(hg(e.latitude),hg(t.latitude));return 0!==n?n:Qm(hg(e.longitude),hg(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var o=bg(n[i],r[i]);if(o)return o}return Qm(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Qm(r[s],o[s]);if(0!==a)return a;var c=bg(n[r[s]],i[o[s]]);if(0!==c)return c}return Qm(r.length,o.length)}(e.mapValue,t.mapValue);default:throw Hm()}}function wg(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Qm(e,t);var n=lg(e),r=lg(t),i=Qm(n.seconds,r.seconds);return 0!==i?i:Qm(n.nanos,r.nanos)}function Rg(e){return Ig(e)}function Ig(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=lg(e);return"time("+t.seconds+","+t.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?dg(e.bytesValue).toBase64():"referenceValue"in e?yg.fromName(e.referenceValue).toString():"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(e){for(var t="[",n=!0,r=0,i=e.values||[];r<i.length;r++)n?n=!1:t+=",",t+=Ig(i[r]);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var t="{",n=!0,r=0,i=Object.keys(e.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:t+=",",t+=o+":"+Ig(e.fields[o])}return t+"}"}(e.mapValue):Hm();var t}function Cg(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function Ag(e){return!!e&&"integerValue"in e}function Og(e){return!!e&&"arrayValue"in e}function Ng(e){return!!e&&"nullValue"in e}function kg(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Dg(e){return!!e&&"mapValue"in e}function Pg(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue)return{timestampValue:Object.assign({},lg(e.timestampValue))};if(e.mapValue){var t={mapValue:{fields:{}}};return tg(e.mapValue.fields,function(e,n){return t.mapValue.fields[e]=Pg(n)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Pg(e.arrayValue.values[r]);return n}return Object.assign({},e)}var Lg=function(){function e(e){this.value=e}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Dg(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null},e.prototype.set=function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pg(t)},e.prototype.setAll=function(e){var t=this,n=sg.emptyPath(),r={},i=[];e.forEach(function(e,o){if(!n.isImmediateParentOf(o)){var s=t.getFieldsMap(n);t.applyChanges(s,r,i),r={},i=[],n=o.popLast()}e?r[o.lastSegment()]=Pg(e):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},e.prototype.delete=function(e){var t=this.field(e.popLast());Dg(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]},e.prototype.isEqual=function(e){return Sg(this.value,e.value)},e.prototype.getFieldsMap=function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Dg(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields},e.prototype.applyChanges=function(e,t,n){tg(t,function(t,n){return e[t]=n});for(var r=0,i=n;r<i.length;r++)delete e[i[r]]},e.prototype.clone=function(){return new e(Pg(this.value))},e}();function xg(e){var t=[];return tg(e.fields,function(e,n){var r=new sg([e]);if(Dg(n)){var i=xg(n.mapValue).fields;if(0===i.length)t.push(r);else for(var o=0,s=i;o<s.length;o++)t.push(r.child(s[o]))}else t.push(r)}),new ag(t)}var Mg=function(){function e(e,t,n,r,i){this.key=e,this.documentType=t,this.version=n,this.data=r,this.documentState=i}return e.newInvalidDocument=function(t){return new e(t,0,Zm.min(),Lg.empty(),0)},e.newFoundDocument=function(t,n,r){return new e(t,1,n,r,0)},e.newNoDocument=function(t,n){return new e(t,2,n,Lg.empty(),0)},e.newUnknownDocument=function(t,n){return new e(t,3,n,Lg.empty(),2)},e.prototype.convertToFoundDocument=function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this},e.prototype.convertToNoDocument=function(e){return this.version=e,this.documentType=2,this.data=Lg.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(e){return this.version=e,this.documentType=3,this.data=Lg.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return 0!==this.documentType},e.prototype.isFoundDocument=function(){return 1===this.documentType},e.prototype.isNoDocument=function(){return 2===this.documentType},e.prototype.isUnknownDocument=function(){return 3===this.documentType},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e}(),Ug=function(e,t,n,r,i,o,s){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Vg(e,t,n,r,i,o,s){return void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ug(e,t,n,r,i,o,s)}function Fg(e){var t=zm(e);if(null===t.h){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(function(e){return function(e){return e.field.canonicalString()+e.op.toString()+Rg(e.value)}(e)}).join(","),n+="|ob:",n+=t.orderBy.map(function(e){return function(e){return e.field.canonicalString()+e.dir}(e)}).join(","),gg(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=$g(t.startAt)),t.endAt&&(n+="|ub:",n+=$g(t.endAt)),t.h=n}return t.h}function Bg(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!e_(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if((i=e.filters[r]).op!==(o=t.filters[r]).op||!i.field.isEqual(o.field)||!Sg(i.value,o.value))return!1;var i,o;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!n_(e.startAt,t.startAt)&&n_(e.endAt,t.endAt)}function jg(e){return yg.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var Gg=function(e){function t(t,n,r){var i=this;return(i=e.call(this)||this).field=t,i.op=n,i.value=r,i}return(0,ac.ZT)(t,e),t.create=function(e,n,r){return e.isKeyField()?"in"===n||"not-in"===n?this.l(e,n,r):new qg(e,n,r):"array-contains"===n?new Kg(e,r):"in"===n?new Yg(e,r):"not-in"===n?new Qg(e,r):"array-contains-any"===n?new Jg(e,r):new t(e,n,r)},t.l=function(e,t,n){return"in"===t?new Hg(e,n):new Wg(e,n)},t.prototype.matches=function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.m(bg(t,this.value)):null!==t&&Eg(this.value)===Eg(t)&&this.m(bg(t,this.value))},t.prototype.m=function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Hm()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),qg=function(e){function t(t,n,r){var i=this;return(i=e.call(this,t,n,r)||this).key=yg.fromName(r.referenceValue),i}return(0,ac.ZT)(t,e),t.prototype.matches=function(e){var t=yg.comparator(e.key,this.key);return this.m(t)},t}(Gg),Hg=function(e){function t(t,n){var r=this;return(r=e.call(this,t,"in",n)||this).keys=zg(0,n),r}return(0,ac.ZT)(t,e),t.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},t}(Gg),Wg=function(e){function t(t,n){var r=this;return(r=e.call(this,t,"not-in",n)||this).keys=zg(0,n),r}return(0,ac.ZT)(t,e),t.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},t}(Gg);function zg(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(e){return yg.fromName(e.referenceValue)})}var Kg=function(e){function t(t,n){return e.call(this,t,"array-contains",n)||this}return(0,ac.ZT)(t,e),t.prototype.matches=function(e){var t=e.data.field(this.field);return Og(t)&&Tg(t.arrayValue,this.value)},t}(Gg),Yg=function(e){function t(t,n){return e.call(this,t,"in",n)||this}return(0,ac.ZT)(t,e),t.prototype.matches=function(e){var t=e.data.field(this.field);return null!==t&&Tg(this.value.arrayValue,t)},t}(Gg),Qg=function(e){function t(t,n){return e.call(this,t,"not-in",n)||this}return(0,ac.ZT)(t,e),t.prototype.matches=function(e){if(Tg(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Tg(this.value.arrayValue,t)},t}(Gg),Jg=function(e){function t(t,n){return e.call(this,t,"array-contains-any",n)||this}return(0,ac.ZT)(t,e),t.prototype.matches=function(e){var t=this,n=e.data.field(this.field);return!(!Og(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(e){return Tg(t.value.arrayValue,e)})},t}(Gg),Xg=function(e,t){this.position=e,this.before=t};function $g(e){return(e.before?"b":"a")+":"+e.position.map(function(e){return Rg(e)}).join(",")}var Zg=function(e,t){void 0===t&&(t="asc"),this.field=e,this.dir=t};function e_(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function t_(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var o=t[i],s=e.position[i];if(r=o.field.isKeyField()?yg.comparator(yg.fromName(s.referenceValue),n.key):bg(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function n_(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Sg(e.position[n],t.position[n]))return!1;return!0}var r_=function(e,t,n,r,i,o,s,a){void 0===t&&(t=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function i_(e,t,n,r,i,o,s,a){return new r_(e,t,n,r,i,o,s,a)}function o_(e){return new r_(e)}function s_(e){return!gg(e.limit)&&"F"===e.limitType}function a_(e){return!gg(e.limit)&&"L"===e.limitType}function c_(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function u_(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(r.g())return r.field}return null}function l_(e){return null!==e.collectionGroup}function h_(e){var t=zm(e);if(null===t.p){t.p=[];var n=u_(t),r=c_(t);if(null!==n&&null===r)n.isKeyField()||t.p.push(new Zg(n)),t.p.push(new Zg(sg.keyField(),"asc"));else{for(var i=!1,o=0,s=t.explicitOrderBy;o<s.length;o++){var a=s[o];t.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var c=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new Zg(sg.keyField(),c))}}}return t.p}function d_(e){var t=zm(e);if(!t.T)if("F"===t.limitType)t.T=Vg(t.path,t.collectionGroup,h_(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=h_(t);r<i.length;r++){var o=i[r];n.push(new Zg(o.field,"desc"===o.dir?"asc":"desc"))}var s=t.endAt?new Xg(t.endAt.position,!t.endAt.before):null,a=t.startAt?new Xg(t.startAt.position,!t.startAt.before):null;t.T=Vg(t.path,t.collectionGroup,n,t.filters,t.limit,s,a)}return t.T}function p_(e,t,n){return new r_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function f_(e,t){return Bg(d_(e),d_(t))&&e.limitType===t.limitType}function m_(e){return Fg(d_(e))+"|lt:"+e.limitType}function g_(e){return"Query(target="+function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: ["+e.filters.map(function(e){return(t=e).field.canonicalString()+" "+t.op+" "+Rg(t.value);var t}).join(", ")+"]"),gg(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: ["+e.orderBy.map(function(e){return function(e){return e.field.canonicalString()+" ("+e.dir+")"}(e)}).join(", ")+"]"),e.startAt&&(t+=", startAt: "+$g(e.startAt)),e.endAt&&(t+=", endAt: "+$g(e.endAt)),"Target("+t+")"}(d_(e))+"; limitType="+e.limitType+")"}function __(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):yg.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(var n=0,r=e.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}return!0}(e,t)&&function(e,t){for(var n=0,r=e.filters;n<r.length;n++)if(!r[n].matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!t_(e.startAt,h_(e),t)||e.endAt&&t_(e.endAt,h_(e),t))}(e,t)}function v_(e){return function(t,n){for(var r=!1,i=0,o=h_(e);i<o.length;i++){var s=o[i],a=y_(s,t,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function y_(e,t,n){var r=e.field.isKeyField()?yg.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?bg(r,i):Hm()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Hm()}}function E_(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_g(t)?"-0":t}}function S_(e){return{integerValue:""+e}}function T_(e,t){return vg(t)?S_(t):E_(e,t)}var b_=function(){this._=void 0};function w_(e,t,n){return e instanceof C_?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof A_?O_(e,t):e instanceof N_?k_(e,t):function(e,t){var n=I_(e,t),r=P_(n)+P_(e.A);return Ag(n)&&Ag(e.A)?S_(r):E_(e.R,r)}(e,t)}function R_(e,t,n){return e instanceof A_?O_(e,t):e instanceof N_?k_(e,t):n}function I_(e,t){return e instanceof D_?Ag(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var C_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,ac.ZT)(t,e),t}(b_),A_=function(e){function t(t){var n=this;return(n=e.call(this)||this).elements=t,n}return(0,ac.ZT)(t,e),t}(b_);function O_(e,t){for(var n=L_(t),r=function(e){n.some(function(t){return Sg(t,e)})||n.push(e)},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var N_=function(e){function t(t){var n=this;return(n=e.call(this)||this).elements=t,n}return(0,ac.ZT)(t,e),t}(b_);function k_(e,t){for(var n=L_(t),r=function(e){n=n.filter(function(t){return!Sg(t,e)})},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var D_=function(e){function t(t,n){var r=this;return(r=e.call(this)||this).R=t,r.A=n,r}return(0,ac.ZT)(t,e),t}(b_);function P_(e){return hg(e.integerValue||e.doubleValue)}function L_(e){return Og(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var x_=function(e,t){this.field=e,this.transform=t},M_=function(e,t){this.version=e,this.transformResults=t},U_=function(){function e(e,t){this.updateTime=e,this.exists=t}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)},e}();function V_(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var F_=function(){};function B_(e,t,n){e instanceof W_?function(e,t,n){var r=e.value.clone(),i=Y_(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof z_?function(e,t,n){if(V_(e.precondition,t)){var r=Y_(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(K_(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function j_(e,t,n){e instanceof W_?function(e,t,n){if(V_(e.precondition,t)){var r=e.value.clone(),i=Q_(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(H_(t),r).setHasLocalMutations()}}(e,t,n):e instanceof z_?function(e,t,n){if(V_(e.precondition,t)){var r=Q_(e.fieldTransforms,n,t),i=t.data;i.setAll(K_(e)),i.setAll(r),t.convertToFoundDocument(H_(t),i).setHasLocalMutations()}}(e,t,n):function(e,t){V_(e.precondition,t)&&t.convertToNoDocument(Zm.min())}(e,t)}function G_(e,t){for(var n=null,r=0,i=e.fieldTransforms;r<i.length;r++){var o=i[r],s=t.data.field(o.field),a=I_(o.transform,s||null);null!=a&&(null==n&&(n=Lg.empty()),n.set(o.field,a))}return n||null}function q_(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Jm(e,t,function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof A_&&t instanceof A_||e instanceof N_&&t instanceof N_?Jm(e.elements,t.elements,Sg):e instanceof D_&&t instanceof D_?Sg(e.A,t.A):e instanceof C_&&t instanceof C_}(e.transform,t.transform)}(e,t)})}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function H_(e){return e.isFoundDocument()?e.version:Zm.min()}var W_=function(e){function t(t,n,r,i){void 0===i&&(i=[]);var o=this;return(o=e.call(this)||this).key=t,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,ac.ZT)(t,e),t}(F_),z_=function(e){function t(t,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=e.call(this)||this).key=t,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,ac.ZT)(t,e),t}(F_);function K_(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function Y_(e,t,n){var r=new Map;Wm(e.length===n.length);for(var i=0;i<n.length;i++){var o=e[i],s=o.transform,a=t.data.field(o.field);r.set(o.field,R_(s,a,n[i]))}return r}function Q_(e,t,n){for(var r=new Map,i=0,o=e;i<o.length;i++){var s=o[i],a=s.transform,c=n.data.field(s.field);r.set(s.field,w_(a,c,t))}return r}var J_,X_,$_=function(e){function t(t,n){var r=this;return(r=e.call(this)||this).key=t,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,ac.ZT)(t,e),t}(F_),Z_=function(e){function t(t,n){var r=this;return(r=e.call(this)||this).key=t,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,ac.ZT)(t,e),t}(F_),ev=function(e){this.count=e};function tv(e){switch(e){case Mm.OK:return Hm();case Mm.CANCELLED:case Mm.UNKNOWN:case Mm.DEADLINE_EXCEEDED:case Mm.RESOURCE_EXHAUSTED:case Mm.INTERNAL:case Mm.UNAVAILABLE:case Mm.UNAUTHENTICATED:return!1;case Mm.INVALID_ARGUMENT:case Mm.NOT_FOUND:case Mm.ALREADY_EXISTS:case Mm.PERMISSION_DENIED:case Mm.FAILED_PRECONDITION:case Mm.ABORTED:case Mm.OUT_OF_RANGE:case Mm.UNIMPLEMENTED:case Mm.DATA_LOSS:return!0;default:return Hm()}}function nv(e){if(void 0===e)return jm("GRPC error has no .code"),Mm.UNKNOWN;switch(e){case J_.OK:return Mm.OK;case J_.CANCELLED:return Mm.CANCELLED;case J_.UNKNOWN:return Mm.UNKNOWN;case J_.DEADLINE_EXCEEDED:return Mm.DEADLINE_EXCEEDED;case J_.RESOURCE_EXHAUSTED:return Mm.RESOURCE_EXHAUSTED;case J_.INTERNAL:return Mm.INTERNAL;case J_.UNAVAILABLE:return Mm.UNAVAILABLE;case J_.UNAUTHENTICATED:return Mm.UNAUTHENTICATED;case J_.INVALID_ARGUMENT:return Mm.INVALID_ARGUMENT;case J_.NOT_FOUND:return Mm.NOT_FOUND;case J_.ALREADY_EXISTS:return Mm.ALREADY_EXISTS;case J_.PERMISSION_DENIED:return Mm.PERMISSION_DENIED;case J_.FAILED_PRECONDITION:return Mm.FAILED_PRECONDITION;case J_.ABORTED:return Mm.ABORTED;case J_.OUT_OF_RANGE:return Mm.OUT_OF_RANGE;case J_.UNIMPLEMENTED:return Mm.UNIMPLEMENTED;case J_.DATA_LOSS:return Mm.DATA_LOSS;default:return Hm()}}(X_=J_||(J_={}))[X_.OK=0]="OK",X_[X_.CANCELLED=1]="CANCELLED",X_[X_.UNKNOWN=2]="UNKNOWN",X_[X_.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",X_[X_.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",X_[X_.NOT_FOUND=5]="NOT_FOUND",X_[X_.ALREADY_EXISTS=6]="ALREADY_EXISTS",X_[X_.PERMISSION_DENIED=7]="PERMISSION_DENIED",X_[X_.UNAUTHENTICATED=16]="UNAUTHENTICATED",X_[X_.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",X_[X_.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",X_[X_.ABORTED=10]="ABORTED",X_[X_.OUT_OF_RANGE=11]="OUT_OF_RANGE",X_[X_.UNIMPLEMENTED=12]="UNIMPLEMENTED",X_[X_.INTERNAL=13]="INTERNAL",X_[X_.UNAVAILABLE=14]="UNAVAILABLE",X_[X_.DATA_LOSS=15]="DATA_LOSS";var rv=function(){function e(e,t){this.comparator=e,this.root=t||ov.EMPTY}return e.prototype.insert=function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,ov.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ov.BLACK,null,null))},e.prototype.get=function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null},e.prototype.indexOf=function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(e){return this.root.inorderTraversal(e)},e.prototype.forEach=function(e){this.inorderTraversal(function(t,n){return e(t,n),!1})},e.prototype.toString=function(){var e=[];return this.inorderTraversal(function(t,n){return e.push(t+":"+n),!1}),"{"+e.join(", ")+"}"},e.prototype.reverseTraversal=function(e){return this.root.reverseTraversal(e)},e.prototype.getIterator=function(){return new iv(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(e){return new iv(this.root,e,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new iv(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(e){return new iv(this.root,e,this.comparator,!0)},e}(),iv=function(){function e(e,t,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!e.isEmpty();)if(i=t?n(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}return e.prototype.getNext=function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}},e}(),ov=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=o?o:e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e},e.prototype.moveRedLeft=function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e},e.prototype.moveRedRight=function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth=function(){var e=this.check();return Math.pow(2,e)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Hm();if(this.right.isRed())throw Hm();var e=this.left.check();if(e!==this.right.check())throw Hm();return e+(this.isRed()?0:1)},e}();ov.EMPTY=null,ov.RED=!0,ov.BLACK=!1,ov.EMPTY=new(function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw Hm()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw Hm()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw Hm()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw Hm()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw Hm()},enumerable:!1,configurable:!0}),e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new ov(e,t)},e.prototype.remove=function(e,t){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e}());var sv=function(){function e(e){this.comparator=e,this.data=new rv(this.comparator)}return e.prototype.has=function(e){return null!==this.data.get(e)},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(e){return this.data.indexOf(e)},e.prototype.forEach=function(e){this.data.inorderTraversal(function(t,n){return e(t),!1})},e.prototype.forEachInRange=function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}},e.prototype.forEachWhile=function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return},e.prototype.firstAfterOrEqual=function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null},e.prototype.getIterator=function(){return new av(this.data.getIterator())},e.prototype.getIteratorFrom=function(e){return new av(this.data.getIteratorFrom(e))},e.prototype.add=function(e){return this.copy(this.data.remove(e).insert(e,!0))},e.prototype.delete=function(e){return this.has(e)?this.copy(this.data.remove(e)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach(function(e){t=t.add(e)}),t},e.prototype.isEqual=function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},e.prototype.toArray=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},e.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},e.prototype.copy=function(t){var n=new e(this.comparator);return n.data=t,n},e}(),av=function(){function e(e){this.iter=e}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e}(),cv=new rv(yg.comparator);function uv(){return cv}var lv=new rv(yg.comparator);function hv(){return lv}var dv=new rv(yg.comparator);function pv(){return dv}var fv=new sv(yg.comparator);function mv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=fv,r=0,i=e;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var gv=new sv(Qm);function _v(){return gv}var vv=function(){function e(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return e.createSynthesizedRemoteEventForCurrentChange=function(t,n){var r=new Map;return r.set(t,yv.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(Zm.min(),r,_v(),uv(),mv())},e}(),yv=function(){function e(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return e.createSynthesizedTargetChangeForCurrentChange=function(t,n){return new e(cg.EMPTY_BYTE_STRING,n,mv(),mv(),mv())},e}(),Ev=function(e,t,n,r){this.v=e,this.removedTargetIds=t,this.key=n,this.P=r},Sv=function(e,t){this.targetId=e,this.V=t},Tv=function(e,t,n,r){void 0===n&&(n=cg.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},bv=function(){function e(){this.S=0,this.D=Iv(),this.C=cg.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),e.prototype.O=function(e){e.approximateByteSize()>0&&(this.F=!0,this.C=e)},e.prototype.M=function(){var e=mv(),t=mv(),n=mv();return this.D.forEach(function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Hm()}}),new yv(this.C,this.N,e,t,n)},e.prototype.L=function(){this.F=!1,this.D=Iv()},e.prototype.B=function(e,t){this.F=!0,this.D=this.D.insert(e,t)},e.prototype.q=function(e){this.F=!0,this.D=this.D.remove(e)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.F=!0,this.N=!0},e}(),wv=function(){function e(e){this.W=e,this.G=new Map,this.H=uv(),this.J=Rv(),this.Y=new sv(Qm)}return e.prototype.X=function(e){for(var t=0,n=e.v;t<n.length;t++){var r=n[t];e.P&&e.P.isFoundDocument()?this.Z(r,e.P):this.tt(r,e.key,e.P)}for(var i=0,o=e.removedTargetIds;i<o.length;i++)this.tt(r=o[i],e.key,e.P)},e.prototype.et=function(e){var t=this;this.forEachTarget(e,function(n){var r=t.nt(n);switch(e.state){case 0:t.st(n)&&r.O(e.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(e.resumeToken);break;case 2:r.K(),r.k||t.removeTarget(n);break;case 3:t.st(n)&&(r.j(),r.O(e.resumeToken));break;case 4:t.st(n)&&(t.it(n),r.O(e.resumeToken));break;default:Hm()}})},e.prototype.forEachTarget=function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.G.forEach(function(e,r){n.st(r)&&t(r)})},e.prototype.rt=function(e){var t=e.targetId,n=e.V.count,r=this.ot(t);if(r){var i=r.target;if(jg(i))if(0===n){var o=new yg(i.path);this.tt(t,o,Mg.newNoDocument(o,Zm.min()))}else Wm(1===n);else this.ct(t)!==n&&(this.it(t),this.Y=this.Y.add(t))}},e.prototype.ut=function(e){var t=this,n=new Map;this.G.forEach(function(r,i){var o=t.ot(i);if(o){if(r.current&&jg(o.target)){var s=new yg(o.target.path);null!==t.H.get(s)||t.at(i,s)||t.tt(i,s,Mg.newNoDocument(s,e))}r.$&&(n.set(i,r.M()),r.L())}});var r=mv();this.J.forEach(function(e,n){var i=!0;n.forEachWhile(function(e){var n=t.ot(e);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(e))});var i=new vv(e,n,this.Y,this.H,r);return this.H=uv(),this.J=Rv(),this.Y=new sv(Qm),i},e.prototype.Z=function(e,t){if(this.st(e)){var n=this.at(e,t.key)?2:0;this.nt(e).B(t.key,n),this.H=this.H.insert(t.key,t),this.J=this.J.insert(t.key,this.ht(t.key).add(e))}},e.prototype.tt=function(e,t,n){if(this.st(e)){var r=this.nt(e);this.at(e,t)?r.B(t,1):r.q(t),this.J=this.J.insert(t,this.ht(t).delete(e)),n&&(this.H=this.H.insert(t,n))}},e.prototype.removeTarget=function(e){this.G.delete(e)},e.prototype.ct=function(e){var t=this.nt(e).M();return this.W.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size},e.prototype.U=function(e){this.nt(e).U()},e.prototype.nt=function(e){var t=this.G.get(e);return t||(t=new bv,this.G.set(e,t)),t},e.prototype.ht=function(e){var t=this.J.get(e);return t||(t=new sv(Qm),this.J=this.J.insert(e,t)),t},e.prototype.st=function(e){var t=null!==this.ot(e);return t||Bm("WatchChangeAggregator","Detected inactive target",e),t},e.prototype.ot=function(e){var t=this.G.get(e);return t&&t.k?null:this.W.lt(e)},e.prototype.it=function(e){var t=this;this.G.set(e,new bv),this.W.getRemoteKeysForTarget(e).forEach(function(n){t.tt(e,n,null)})},e.prototype.at=function(e,t){return this.W.getRemoteKeysForTarget(e).has(t)},e}();function Rv(){return new rv(yg.comparator)}function Iv(){return new rv(yg.comparator)}var Cv={asc:"ASCENDING",desc:"DESCENDING"},Av={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ov=function(e,t){this.databaseId=e,this.I=t};function Nv(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function kv(e,t){return e.I?t.toBase64():t.toUint8Array()}function Dv(e,t){return Nv(e,t.toTimestamp())}function Pv(e){return Wm(!!e),Zm.fromTimestamp(function(e){var t=lg(e);return new $m(t.seconds,t.nanos)}(e))}function Lv(e,t){return function(e){return new ig(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function xv(e){var t=ig.fromString(e);return Wm(oy(t)),t}function Mv(e,t){return Lv(e.databaseId,t.path)}function Uv(e,t){var n=xv(t);if(n.get(1)!==e.databaseId.projectId)throw new Um(Mm.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Um(Mm.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new yg(jv(n))}function Vv(e,t){return Lv(e.databaseId,t)}function Fv(e){var t=xv(e);return 4===t.length?ig.emptyPath():jv(t)}function Bv(e){return new ig(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function jv(e){return Wm(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Gv(e,t,n){return{name:Mv(e,t),fields:n.value.mapValue.fields}}function qv(e,t,n){var r=Uv(e,t.name),i=Pv(t.updateTime),o=new Lg({mapValue:{fields:t.fields}}),s=Mg.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Hv(e,t){var n;if(t instanceof W_)n={update:Gv(e,t.key,t.value)};else if(t instanceof $_)n={delete:Mv(e,t.key)};else if(t instanceof z_)n={update:Gv(e,t.key,t.data),updateMask:iy(t.fieldMask)};else{if(!(t instanceof Z_))return Hm();n={verify:Mv(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(e){return function(e,t){var n=t.transform;if(n instanceof C_)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof A_)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof N_)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof D_)return{fieldPath:t.field.canonicalString(),increment:n.A};throw Hm()}(0,e)})),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Dv(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Hm()}(e,t.precondition)),n}function Wv(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?U_.updateTime(Pv(e.updateTime)):void 0!==e.exists?U_.exists(e.exists):U_.none()}(t.currentDocument):U_.none(),r=t.updateTransforms?t.updateTransforms.map(function(t){return function(e,t){var n=null;"setToServerValue"in t?(Wm("REQUEST_TIME"===t.setToServerValue),n=new C_):"appendMissingElements"in t?n=new A_(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new N_(t.removeAllFromArray.values||[]):"increment"in t?n=new D_(e,t.increment):Hm();var r=sg.fromServerFormat(t.fieldPath);return new x_(r,n)}(e,t)}):[];if(t.update){var i=Uv(e,t.update.name),o=new Lg({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=function(e){return new ag((e.fieldPaths||[]).map(function(e){return sg.fromServerFormat(e)}))}(t.updateMask);return new z_(i,o,s,n,r)}return new W_(i,o,n,r)}if(t.delete){var a=Uv(e,t.delete);return new $_(a,n)}if(t.verify){var c=Uv(e,t.verify);return new Z_(c,n)}return Hm()}function zv(e,t){return{documents:[Vv(e,t.path)]}}function Kv(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Vv(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Vv(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map(function(e){return function(e){if("=="===e.op){if(kg(e.value))return{unaryFilter:{field:ey(e.field),op:"IS_NAN"}};if(Ng(e.value))return{unaryFilter:{field:ey(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(kg(e.value))return{unaryFilter:{field:ey(e.field),op:"IS_NOT_NAN"}};if(Ng(e.value))return{unaryFilter:{field:ey(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ey(e.field),op:Zv(e.op),value:e.value}}}(e)});return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var o=function(e){if(0!==e.length)return e.map(function(e){return function(e){return{field:ey(e.field),direction:$v(e.dir)}}(e)})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(e,t){return e.I||gg(t)?t:{value:t}}(e,t.limit);return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=Jv(t.startAt)),t.endAt&&(n.structuredQuery.endAt=Jv(t.endAt)),n}function Yv(e){var t=Fv(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Wm(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:t=t.child(o.collectionId)}var s=[];n.where&&(s=Qv(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(e){return function(e){return new Zg(ty(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)}));var c=null;n.limit&&(c=function(e){var t;return gg(t="object"==typeof e?e.value:e)?null:t}(n.limit));var u=null;n.startAt&&(u=Xv(n.startAt));var l=null;return n.endAt&&(l=Xv(n.endAt)),i_(t,i,a,s,c,"F",u,l)}function Qv(e){return e?void 0!==e.unaryFilter?[ry(e)]:void 0!==e.fieldFilter?[ny(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(function(e){return Qv(e)}).reduce(function(e,t){return e.concat(t)}):Hm():[]}function Jv(e){return{before:e.before,values:e.position}}function Xv(e){return new Xg(e.values||[],!!e.before)}function $v(e){return Cv[e]}function Zv(e){return Av[e]}function ey(e){return{fieldPath:e.canonicalString()}}function ty(e){return sg.fromServerFormat(e.fieldPath)}function ny(e){return Gg.create(ty(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Hm()}}(e.fieldFilter.op),e.fieldFilter.value)}function ry(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ty(e.unaryFilter.field);return Gg.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ty(e.unaryFilter.field);return Gg.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ty(e.unaryFilter.field);return Gg.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ty(e.unaryFilter.field);return Gg.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Hm()}}function iy(e){var t=[];return e.fields.forEach(function(e){return t.push(e.canonicalString())}),{fieldPaths:t}}function oy(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function sy(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=cy(t)),t=ay(e.get(n),t);return cy(t)}function ay(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var o=e.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function cy(e){return e+"\x01\x01"}function uy(e){var t=e.length;if(Wm(t>=2),2===t)return Wm("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),ig.emptyPath();for(var n=t-2,r=[],i="",o=0;o<t;){var s=e.indexOf("\x01",o);switch((s<0||s>n)&&Hm(),e.charAt(s+1)){case"\x01":var a=e.substring(o,s),c=void 0;0===i.length?c=a:(c=i+=a,i=""),r.push(c);break;case"\x10":i+=e.substring(o,s),i+="\0";break;case"\x11":i+=e.substring(o,s+1);break;default:Hm()}o=s+2}return new ig(r)}var ly=function(e,t){this.seconds=e,this.nanoseconds=t},hy=function(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n};hy.store="owner",hy.key="owner";var dy=function(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n};dy.store="mutationQueues",dy.keyPath="userId";var py=function(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};py.store="mutations",py.keyPath="batchId",py.userMutationsIndex="userMutationsIndex",py.userMutationsKeyPath=["userId","batchId"];var fy=function(){function e(){}return e.prefixForUser=function(e){return[e]},e.prefixForPath=function(e,t){return[e,sy(t)]},e.key=function(e,t,n){return[e,sy(t),n]},e}();fy.store="documentMutations",fy.PLACEHOLDER=new fy;var my=function(e,t){this.path=e,this.readTime=t},gy=function(e,t){this.path=e,this.version=t},_y=function(e,t,n,r,i,o){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};_y.store="remoteDocuments",_y.readTimeIndex="readTimeIndex",_y.readTimeIndexPath="readTime",_y.collectionReadTimeIndex="collectionReadTimeIndex",_y.collectionReadTimeIndexPath=["parentPath","readTime"];var vy=function(e){this.byteSize=e};vy.store="remoteDocumentGlobal",vy.key="remoteDocumentGlobalKey";var yy=function(e,t,n,r,i,o,s){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};yy.store="targets",yy.keyPath="targetId",yy.queryTargetsIndexName="queryTargetsIndex",yy.queryTargetsKeyPath=["canonicalId","targetId"];var Ey=function(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n};Ey.store="targetDocuments",Ey.keyPath=["targetId","path"],Ey.documentTargetsIndex="documentTargetsIndex",Ey.documentTargetsKeyPath=["path","targetId"];var Sy=function(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Sy.key="targetGlobalKey",Sy.store="targetGlobal";var Ty=function(e,t){this.collectionId=e,this.parent=t};Ty.store="collectionParents",Ty.keyPath=["collectionId","parent"];var by=function(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r};by.store="clientMetadata",by.keyPath="clientId";var wy=function(e,t,n){this.bundleId=e,this.createTime=t,this.version=n};wy.store="bundles",wy.keyPath="bundleId";var Ry=function(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n};Ry.store="namedQueries",Ry.keyPath="name";var Iy=(0,ac.ev)((0,ac.ev)([],(0,ac.ev)((0,ac.ev)([],(0,ac.ev)((0,ac.ev)([],(0,ac.ev)((0,ac.ev)([],[dy.store,py.store,fy.store,_y.store,yy.store,hy.store,Sy.store,Ey.store]),[by.store])),[vy.store])),[Ty.store])),[wy.store,Ry.store]),Cy="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ay=function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(e){this.onCommittedListeners.push(e)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(e){return e()})},e}(),Oy=function(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})},Ny=function(){function e(e){var t=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(function(e){t.isDone=!0,t.result=e,t.nextCallback&&t.nextCallback(e)},function(e){t.isDone=!0,t.error=e,t.catchCallback&&t.catchCallback(e)})}return e.prototype.catch=function(e){return this.next(void 0,e)},e.prototype.next=function(t,n){var r=this;return this.callbackAttached&&Hm(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}})},e.prototype.toPromise=function(){var e=this;return new Promise(function(t,n){e.next(t,n)})},e.prototype.wrapUserFunction=function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}},e.prototype.wrapSuccess=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)},e.prototype.wrapFailure=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)},e.resolve=function(t){return new e(function(e,n){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.waitFor=function(t){return new e(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(e){return n(e)})}),o=!0,i===r&&e()})},e.or=function(t){for(var n=e.resolve(!1),r=function(t){n=n.next(function(n){return n?e.resolve(n):t()})},i=0,o=t;i<o.length;i++)r(o[i]);return n},e.forEach=function(e,t){var n=this,r=[];return e.forEach(function(e,i){r.push(t.call(n,e,i))}),this.waitFor(r)},e}(),ky=function(){function e(e,t){var n=this;this.action=e,this.transaction=t,this.aborted=!1,this.ft=new Oy,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){t.error?n.ft.reject(new Ly(e,t.error)):n.ft.resolve()},this.transaction.onerror=function(t){var r=Fy(t.target.error);n.ft.reject(new Ly(e,r))}}return e.open=function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Ly(n,t)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(e){e&&this.ft.reject(e),this.aborted||(Bm("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(e){var t=this.transaction.objectStore(e);return new My(t)},e}(),Dy=function(){function e(t,n,r){this.name=t,this.version=n,this.wt=r,12.2===e._t((0,wh.z$)())&&jm("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(e){return Bm("SimpleDb","Removing database:",e),Uy(window.indexedDB.deleteDatabase(e)).toPromise()},e.yt=function(){if("undefined"==typeof indexedDB)return!1;if(e.gt())return!0;var t=(0,wh.z$)(),n=e._t(t),r=0<n&&n<10,i=e.Et(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.gt=function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Tt)},e.It=function(e,t){return e.store(t)},e._t=function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)},e.Et=function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)},e.prototype.At=function(e){return(0,ac.mG)(this,void 0,void 0,function(){var t,n=this;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Bm("SimpleDb","Opening database:",this.name),t=this,[4,new Promise(function(t,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(e){t(e.target.result)},i.onblocked=function(){r(new Ly(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var n=t.target.error;r("VersionError"===n.name?new Um(Mm.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Ly(e,n))},i.onupgradeneeded=function(e){Bm("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion),n.wt.Rt(e.target.result,i.transaction,e.oldVersion,n.version).next(function(){Bm("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:t.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(e){return n.bt(e)}),this.db)]}})})},e.prototype.vt=function(e){this.bt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},e.prototype.runTransaction=function(e,t,n,r){return(0,ac.mG)(this,void 0,void 0,function(){var i,o,s,a,c;return(0,ac.Jh)(this,function(u){switch(u.label){case 0:i="readonly"===t,o=0,s=function(){var t,s,c,u,l;return(0,ac.Jh)(this,function(h){switch(h.label){case 0:++o,h.label=1;case 1:return h.trys.push([1,4,,5]),[4,a.At(e)];case 2:return a.db=h.sent(),t=ky.open(a.db,e,i?"readonly":"readwrite",n),s=r(t).catch(function(e){return t.abort(e),Ny.reject(e)}).toPromise(),c={},s.catch(function(){}),[4,t.dt];case 3:return[2,(c.value=(h.sent(),s),c)];case 4:return Bm("SimpleDb","Transaction failed with error:",(u=h.sent()).message,"Retrying:",l="FirebaseError"!==u.name&&o<3),a.close(),l?[3,5]:[2,{value:Promise.reject(u)}];case 5:return[2]}})},a=this,u.label=1;case 1:return[5,s()];case 2:if("object"==typeof(c=u.sent()))return[2,c.value];u.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),Py=function(){function e(e){this.Pt=e,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(e){this.Pt=e},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(e){this.St=e},e.prototype.delete=function(){return Uy(this.Pt.delete())},e}(),Ly=function(e){function t(t,n){var r=this;return(r=e.call(this,Mm.UNAVAILABLE,"IndexedDB transaction '"+t+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,ac.ZT)(t,e),t}(Um);function xy(e){return"IndexedDbTransactionError"===e.name}var My=function(){function e(e){this.store=e}return e.prototype.put=function(e,t){var n;return void 0!==t?(Bm("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Bm("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Uy(n)},e.prototype.add=function(e){return Bm("SimpleDb","ADD",this.store.name,e,e),Uy(this.store.add(e))},e.prototype.get=function(e){var t=this;return Uy(this.store.get(e)).next(function(n){return void 0===n&&(n=null),Bm("SimpleDb","GET",t.store.name,e,n),n})},e.prototype.delete=function(e){return Bm("SimpleDb","DELETE",this.store.name,e),Uy(this.store.delete(e))},e.prototype.count=function(){return Bm("SimpleDb","COUNT",this.store.name),Uy(this.store.count())},e.prototype.Nt=function(e,t){var n=this.cursor(this.options(e,t)),r=[];return this.xt(n,function(e,t){r.push(t)}).next(function(){return r})},e.prototype.Ft=function(e,t){Bm("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(e,t,n){return n.delete()})},e.prototype.$t=function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.xt(r,t)},e.prototype.Ot=function(e){var t=this.cursor({});return new Ny(function(n,r){t.onerror=function(e){var t=Fy(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next(function(e){e?r.continue():n()}):n()}})},e.prototype.xt=function(e,t){var n=[];return new Ny(function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var o=new Py(i),s=t(i.primaryKey,i.value,o);if(s instanceof Ny){var a=s.catch(function(e){return o.done(),Ny.reject(e)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return Ny.waitFor(n)})},e.prototype.options=function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}},e.prototype.cursor=function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.kt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)},e}();function Uy(e){return new Ny(function(t,n){e.onsuccess=function(e){t(e.target.result)},e.onerror=function(e){var t=Fy(e.target.error);n(t)}})}var Vy=!1;function Fy(e){var t=Dy._t((0,wh.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new Um("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Vy||(Vy=!0,setTimeout(function(){throw r},0)),r}}return e}var By=function(e){function t(t,n){var r=this;return(r=e.call(this)||this).Mt=t,r.currentSequenceNumber=n,r}return(0,ac.ZT)(t,e),t}(Ay);function jy(e,t){var n=zm(e);return Dy.It(n.Mt,t)}var Gy=function(){function e(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}return e.prototype.applyToRemoteDocument=function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&B_(i,e,n[r])}},e.prototype.applyToLocalView=function(e){for(var t=0,n=this.baseMutations;t<n.length;t++)(o=n[t]).key.isEqual(e.key)&&j_(o,e,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(e.key)&&j_(o,e,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(e){var t=this;this.mutations.forEach(function(n){var r=e.get(n.key),i=r;t.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Zm.min())})},e.prototype.keys=function(){return this.mutations.reduce(function(e,t){return e.add(t.key)},mv())},e.prototype.isEqual=function(e){return this.batchId===e.batchId&&Jm(this.mutations,e.mutations,function(e,t){return q_(e,t)})&&Jm(this.baseMutations,e.baseMutations,function(e,t){return q_(e,t)})},e}(),qy=function(){function e(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}return e.from=function(t,n,r){Wm(t.mutations.length===r.length);for(var i=pv(),o=t.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new e(t,n,r,i)},e}(),Hy=function(){function e(e,t,n,r,i,o,s){void 0===i&&(i=Zm.min()),void 0===o&&(o=Zm.min()),void 0===s&&(s=cg.EMPTY_BYTE_STRING),this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e}(),Wy=function(e){this.Lt=e};function zy(e,t){if(t.document)return qv(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=yg.fromSegments(t.noDocument.path),r=Xy(t.noDocument.readTime),i=Mg.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var o=yg.fromSegments(t.unknownDocument.path);return r=Xy(t.unknownDocument.version),Mg.newUnknownDocument(o,r)}return Hm()}function Ky(e,t,n){var r=Yy(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var o=function(e,t){return{name:Mv(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Nv(e,t.version.toTimestamp())}}(e.Lt,t),s=t.hasCommittedMutations;return new _y(null,null,o,s,r,i)}if(t.isNoDocument()){var a=t.key.path.toArray(),c=Jy(t.version);return s=t.hasCommittedMutations,new _y(null,new my(a,c),null,s,r,i)}if(t.isUnknownDocument()){var u=t.key.path.toArray(),l=Jy(t.version);return new _y(new gy(u,l),null,null,!0,r,i)}return Hm()}function Yy(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Qy(e){var t=new $m(e[0],e[1]);return Zm.fromTimestamp(t)}function Jy(e){var t=e.toTimestamp();return new ly(t.seconds,t.nanoseconds)}function Xy(e){var t=new $m(e.seconds,e.nanoseconds);return Zm.fromTimestamp(t)}function $y(e,t){for(var n=(t.baseMutations||[]).map(function(t){return Wv(e.Lt,t)}),r=0;r<t.mutations.length-1;++r)r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform&&(t.mutations[r].updateTransforms=t.mutations[r+1].transform.fieldTransforms,t.mutations.splice(r+1,1),++r);var i=t.mutations.map(function(t){return Wv(e.Lt,t)}),o=$m.fromMillis(t.localWriteTimeMs);return new Gy(t.batchId,o,n,i)}function Zy(e){var t,n,r=Xy(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?Xy(e.lastLimboFreeSnapshotVersion):Zm.min();return void 0!==e.query.documents?(Wm(1===(n=e.query).documents.length),t=d_(o_(Fv(n.documents[0])))):t=function(e){return d_(Yv(e))}(e.query),new Hy(t,e.targetId,0,e.lastListenSequenceNumber,r,i,cg.fromBase64String(e.resumeToken))}function eE(e,t){var n,r=Jy(t.snapshotVersion),i=Jy(t.lastLimboFreeSnapshotVersion);n=jg(t.target)?zv(e.Lt,t.target):Kv(e.Lt,t.target);var o=t.resumeToken.toBase64();return new yy(t.targetId,Fg(t.target),r,o,t.sequenceNumber,i,n)}function tE(e){var t=Yv({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?p_(t,t.limit,"L"):t}var nE=function(){function e(){}return e.prototype.getBundleMetadata=function(e,t){return rE(e).get(t).next(function(e){if(e)return{id:(t=e).bundleId,createTime:Xy(t.createTime),version:t.version};var t})},e.prototype.saveBundleMetadata=function(e,t){return rE(e).put({bundleId:(n=t).id,createTime:Jy(Pv(n.createTime)),version:n.version});var n},e.prototype.getNamedQuery=function(e,t){return iE(e).get(t).next(function(e){if(e)return{name:(t=e).name,query:tE(t.bundledQuery),readTime:Xy(t.readTime)};var t})},e.prototype.saveNamedQuery=function(e,t){return iE(e).put(function(e){return{name:e.name,readTime:Jy(Pv(e.readTime)),bundledQuery:e.bundledQuery}}(t))},e}();function rE(e){return jy(e,wy.store)}function iE(e){return jy(e,Ry.store)}var oE=function(){function e(){this.Bt=new sE}return e.prototype.addToCollectionParentIndex=function(e,t){return this.Bt.add(t),Ny.resolve()},e.prototype.getCollectionParents=function(e,t){return Ny.resolve(this.Bt.getEntries(t))},e}(),sE=function(){function e(){this.index={}}return e.prototype.add=function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new sv(ig.comparator),i=!r.has(n);return this.index[t]=r.add(n),i},e.prototype.has=function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)},e.prototype.getEntries=function(e){return(this.index[e]||new sv(ig.comparator)).toArray()},e}(),aE=function(){function e(){this.qt=new sE}return e.prototype.addToCollectionParentIndex=function(e,t){var n=this;if(!this.qt.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(function(){n.qt.add(t)});var o={collectionId:r,parent:sy(i)};return cE(e).put(o)}return Ny.resolve()},e.prototype.getCollectionParents=function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[Xm(t),""],!1,!0);return cE(e).Nt(r).next(function(e){for(var r=0,i=e;r<i.length;r++){var o=i[r];if(o.collectionId!==t)break;n.push(uy(o.parent))}return n})},e}();function cE(e){return jy(e,Ty.store)}var uE={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lE=function(){function e(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e}();function hE(e,t,n){var r=e.store(py.store),i=e.store(fy.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,c=r.$t({range:s},function(e,t,n){return a++,n.delete()});o.push(c.next(function(){Wm(1===a)}));for(var u=[],l=0,h=n.mutations;l<h.length;l++){var d=h[l],p=fy.key(t,d.key.path,n.batchId);o.push(i.delete(p)),u.push(d.key)}return Ny.waitFor(o).next(function(){return u})}function dE(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Hm();t=e.noDocument}return JSON.stringify(t).length}lE.DEFAULT_COLLECTION_PERCENTILE=10,lE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lE.DEFAULT=new lE(41943040,lE.DEFAULT_COLLECTION_PERCENTILE,lE.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lE.DISABLED=new lE(-1,0,0);var pE=function(){function e(e,t,n,r){this.userId=e,this.R=t,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return e.Kt=function(t,n,r,i){return Wm(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)},e.prototype.checkEmpty=function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mE(e).$t({index:py.userMutationsIndex,range:n},function(e,n,r){t=!1,r.done()}).next(function(){return t})},e.prototype.addMutationBatch=function(e,t,n,r){var i=this,o=gE(e),s=mE(e);return s.add({}).next(function(a){Wm("number"==typeof a);for(var c=new Gy(a,t,n,r),u=function(e,t,n){var r=n.baseMutations.map(function(t){return Hv(e.Lt,t)}),i=n.mutations.map(function(t){return Hv(e.Lt,t)});return new py(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,c),l=[],h=new sv(function(e,t){return Qm(e.canonicalString(),t.canonicalString())}),d=0,p=r;d<p.length;d++){var f=p[d],m=fy.key(i.userId,f.key.path,a);h=h.add(f.key.path.popLast()),l.push(s.put(u)),l.push(o.put(m,fy.PLACEHOLDER))}return h.forEach(function(t){l.push(i.Ut.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(function(){i.Qt[a]=c.keys()}),Ny.waitFor(l).next(function(){return c})})},e.prototype.lookupMutationBatch=function(e,t){var n=this;return mE(e).get(t).next(function(e){return e?(Wm(e.userId===n.userId),$y(n.R,e)):null})},e.prototype.jt=function(e,t){var n=this;return this.Qt[t]?Ny.resolve(this.Qt[t]):this.lookupMutationBatch(e,t).next(function(e){if(e){var r=e.keys();return n.Qt[t]=r,r}return null})},e.prototype.getNextMutationBatchAfterBatchId=function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return mE(e).$t({index:py.userMutationsIndex,range:i},function(e,t,i){t.userId===n.userId&&(Wm(t.batchId>=r),o=$y(n.R,t)),i.done()}).next(function(){return o})},e.prototype.getHighestUnacknowledgedBatchId=function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return mE(e).$t({index:py.userMutationsIndex,range:t,reverse:!0},function(e,t,r){n=t.batchId,r.done()}).next(function(){return n})},e.prototype.getAllMutationBatches=function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return mE(e).Nt(py.userMutationsIndex,n).next(function(e){return e.map(function(e){return $y(t.R,e)})})},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var n=this,r=fy.prefixForPath(this.userId,t.path),i=IDBKeyRange.lowerBound(r),o=[];return gE(e).$t({range:i},function(r,i,s){var a=r[0],c=r[2],u=uy(r[1]);if(a===n.userId&&t.path.isEqual(u))return mE(e).get(c).next(function(e){if(!e)throw Hm();Wm(e.userId===n.userId),o.push($y(n.R,e))});s.done()}).next(function(){return o})},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var n=this,r=new sv(Qm),i=[];return t.forEach(function(t){var o=fy.prefixForPath(n.userId,t.path),s=IDBKeyRange.lowerBound(o),a=gE(e).$t({range:s},function(e,i,o){var s=e[0],a=e[2],c=uy(e[1]);s===n.userId&&t.path.isEqual(c)?r=r.add(a):o.done()});i.push(a)}),Ny.waitFor(i).next(function(){return n.Wt(e,r)})},e.prototype.getAllMutationBatchesAffectingQuery=function(e,t){var n=this,r=t.path,i=r.length+1,o=fy.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new sv(Qm);return gE(e).$t({range:s},function(e,t,o){var s=e[0],c=e[2],u=uy(e[1]);s===n.userId&&r.isPrefixOf(u)?u.length===i&&(a=a.add(c)):o.done()}).next(function(){return n.Wt(e,a)})},e.prototype.Wt=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(mE(e).get(t).next(function(e){if(null===e)throw Hm();Wm(e.userId===n.userId),r.push($y(n.R,e))}))}),Ny.waitFor(i).next(function(){return r})},e.prototype.removeMutationBatch=function(e,t){var n=this;return hE(e.Mt,this.userId,t).next(function(r){return e.addOnCommittedListener(function(){n.Gt(t.batchId)}),Ny.forEach(r,function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)})})},e.prototype.Gt=function(e){delete this.Qt[e]},e.prototype.performConsistencyCheck=function(e){var t=this;return this.checkEmpty(e).next(function(n){if(!n)return Ny.resolve();var r=IDBKeyRange.lowerBound(fy.prefixForUser(t.userId)),i=[];return gE(e).$t({range:r},function(e,n,r){if(e[0]===t.userId){var o=uy(e[1]);i.push(o)}else r.done()}).next(function(){Wm(0===i.length)})})},e.prototype.containsKey=function(e,t){return fE(e,this.userId,t)},e.prototype.zt=function(e){var t=this;return _E(e).get(this.userId).next(function(e){return e||new dy(t.userId,-1,"")})},e}();function fE(e,t,n){var r=fy.prefixForPath(t,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return gE(e).$t({range:o,kt:!0},function(e,n,r){e[0]===t&&e[1]===i&&(s=!0),r.done()}).next(function(){return s})}function mE(e){return jy(e,py.store)}function gE(e){return jy(e,fy.store)}function _E(e){return jy(e,dy.store)}var vE=function(){function e(e){this.Ht=e}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e}(),yE=function(){function e(e,t){this.referenceDelegate=e,this.R=t}return e.prototype.allocateTargetId=function(e){var t=this;return this.Xt(e).next(function(n){var r=new vE(n.highestTargetId);return n.highestTargetId=r.next(),t.Zt(e,n).next(function(){return n.highestTargetId})})},e.prototype.getLastRemoteSnapshotVersion=function(e){return this.Xt(e).next(function(e){return Zm.fromTimestamp(new $m(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))})},e.prototype.getHighestSequenceNumber=function(e){return this.Xt(e).next(function(e){return e.highestListenSequenceNumber})},e.prototype.setTargetsMetadata=function(e,t,n){var r=this;return this.Xt(e).next(function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.Zt(e,i)})},e.prototype.addTargetData=function(e,t){var n=this;return this.te(e,t).next(function(){return n.Xt(e).next(function(r){return r.targetCount+=1,n.ee(t,r),n.Zt(e,r)})})},e.prototype.updateTargetData=function(e,t){return this.te(e,t)},e.prototype.removeTargetData=function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next(function(){return EE(e).delete(t.targetId)}).next(function(){return n.Xt(e)}).next(function(t){return Wm(t.targetCount>0),t.targetCount-=1,n.Zt(e,t)})},e.prototype.removeTargets=function(e,t,n){var r=this,i=0,o=[];return EE(e).$t(function(s,a){var c=Zy(a);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,o.push(r.removeTargetData(e,c)))}).next(function(){return Ny.waitFor(o)}).next(function(){return i})},e.prototype.forEachTarget=function(e,t){return EE(e).$t(function(e,n){var r=Zy(n);t(r)})},e.prototype.Xt=function(e){return SE(e).get(Sy.key).next(function(e){return Wm(null!==e),e})},e.prototype.Zt=function(e,t){return SE(e).put(Sy.key,t)},e.prototype.te=function(e,t){return EE(e).put(eE(this.R,t))},e.prototype.ee=function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n},e.prototype.getTargetCount=function(e){return this.Xt(e).next(function(e){return e.targetCount})},e.prototype.getTargetData=function(e,t){var n=Fg(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return EE(e).$t({range:r,index:yy.queryTargetsIndexName},function(e,n,r){var o=Zy(n);Bg(t,o.target)&&(i=o,r.done())}).next(function(){return i})},e.prototype.addMatchingKeys=function(e,t,n){var r=this,i=[],o=TE(e);return t.forEach(function(t){var s=sy(t.path);i.push(o.put(new Ey(n,s))),i.push(r.referenceDelegate.addReference(e,n,t))}),Ny.waitFor(i)},e.prototype.removeMatchingKeys=function(e,t,n){var r=this,i=TE(e);return Ny.forEach(t,function(t){var o=sy(t.path);return Ny.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(e,n,t)])})},e.prototype.removeMatchingKeysForTargetId=function(e,t){var n=TE(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)},e.prototype.getMatchingKeysForTargetId=function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=TE(e),i=mv();return r.$t({range:n,kt:!0},function(e,t,n){var r=uy(e[1]),o=new yg(r);i=i.add(o)}).next(function(){return i})},e.prototype.containsKey=function(e,t){var n=sy(t.path),r=IDBKeyRange.bound([n],[Xm(n)],!1,!0),i=0;return TE(e).$t({index:Ey.documentTargetsIndex,kt:!0,range:r},function(e,t,n){0!==e[0]&&(i++,n.done())}).next(function(){return i>0})},e.prototype.lt=function(e,t){return EE(e).get(t).next(function(e){return e?Zy(e):null})},e}();function EE(e){return jy(e,yy.store)}function SE(e){return jy(e,Sy.store)}function TE(e){return jy(e,Ey.store)}function bE(e){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){if(e.code!==Mm.FAILED_PRECONDITION||e.message!==Cy)throw e;return Bm("LocalStore","Unexpectedly lost primary lease"),[2]})})}function wE(e,t){var n=e[1],r=t[1],i=Qm(e[0],t[0]);return 0===i?Qm(n,r):i}var RE=function(){function e(e){this.ne=e,this.buffer=new sv(wE),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(e){var t=[e,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();wE(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e}(),IE=function(){function e(e,t){this.garbageCollector=e,this.asyncQueue=t,this.oe=!1,this.ce=null}return e.prototype.start=function(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(e)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),e.prototype.ue=function(e){var t=this,n=this.oe?3e5:6e4;Bm("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return(0,ac.mG)(t,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,e.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return xy(t=n.sent())?(Bm("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t),[3,6]):[3,4];case 4:return[4,bE(t)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(e)];case 8:return n.sent(),[2]}})})})},e}(),CE=function(){function e(e,t){this.ae=e,this.params=t}return e.prototype.calculateTargetCount=function(e,t){return this.ae.he(e).next(function(e){return Math.floor(t/100*e)})},e.prototype.nthSequenceNumber=function(e,t){var n=this;if(0===t)return Ny.resolve(xm.o);var r=new RE(t);return this.ae.forEachTarget(e,function(e){return r.re(e.sequenceNumber)}).next(function(){return n.ae.le(e,function(e){return r.re(e)})}).next(function(){return r.maxValue})},e.prototype.removeTargets=function(e,t,n){return this.ae.removeTargets(e,t,n)},e.prototype.removeOrphanedDocuments=function(e,t){return this.ae.removeOrphanedDocuments(e,t)},e.prototype.collect=function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Bm("LruGarbageCollector","Garbage collection skipped; disabled"),Ny.resolve(uE)):this.getCacheSize(e).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Bm("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),uE):n.fe(e,t)})},e.prototype.getCacheSize=function(e){return this.ae.getCacheSize(e)},e.prototype.fe=function(e,t){var n,r,i,o,s,a,c,u=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(function(t){return t>u.params.maximumSequenceNumbersToCollect?(Bm("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+u.params.maximumSequenceNumbersToCollect+" from "+t),r=u.params.maximumSequenceNumbersToCollect):r=t,o=Date.now(),u.nthSequenceNumber(e,r)}).next(function(r){return n=r,s=Date.now(),u.removeTargets(e,n,t)}).next(function(t){return i=t,a=Date.now(),u.removeOrphanedDocuments(e,n)}).next(function(e){return c=Date.now(),Fm()<=Rh.in.DEBUG&&Bm("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-l)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+e+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-l)+"ms"),Ny.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})})},e}(),AE=function(){function e(e,t){this.db=e,this.garbageCollector=function(e,t){return new CE(e,t)}(this,t)}return e.prototype.he=function(e){var t=this.de(e);return this.db.getTargetCache().getTargetCount(e).next(function(e){return t.next(function(t){return e+t})})},e.prototype.de=function(e){var t=0;return this.le(e,function(e){t++}).next(function(){return t})},e.prototype.forEachTarget=function(e,t){return this.db.getTargetCache().forEachTarget(e,t)},e.prototype.le=function(e,t){return this.we(e,function(e,n){return t(n)})},e.prototype.addReference=function(e,t,n){return OE(e,n)},e.prototype.removeReference=function(e,t,n){return OE(e,n)},e.prototype.removeTargets=function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)},e.prototype.markPotentiallyOrphaned=function(e,t){return OE(e,t)},e.prototype._e=function(e,t){return function(e,t){var n=!1;return _E(e).Ot(function(r){return fE(e,r,t).next(function(e){return e&&(n=!0),Ny.resolve(!e)})}).next(function(){return n})}(e,t)},e.prototype.removeOrphanedDocuments=function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(e,function(s,a){if(a<=t){var c=n._e(e,s).next(function(t){if(!t)return o++,r.getEntry(e,s).next(function(){return r.removeEntry(s),TE(e).delete([0,sy(s.path)])})});i.push(c)}}).next(function(){return Ny.waitFor(i)}).next(function(){return r.apply(e)}).next(function(){return o})},e.prototype.removeTarget=function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)},e.prototype.updateLimboDocument=function(e,t){return OE(e,t)},e.prototype.we=function(e,t){var n,r=TE(e),i=xm.o;return r.$t({index:Ey.documentTargetsIndex},function(e,r){var o=r.path,s=r.sequenceNumber;0===e[0]?(i!==xm.o&&t(new yg(uy(n)),i),i=s,n=o):i=xm.o}).next(function(){i!==xm.o&&t(new yg(uy(n)),i)})},e.prototype.getCacheSize=function(e){return this.db.getRemoteDocumentCache().getSize(e)},e}();function OE(e,t){return TE(e).put(function(e,t){return new Ey(0,sy(e.path),t)}(t,e.currentSequenceNumber))}var NE=function(){function e(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}return e.prototype.get=function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],e))return s}},e.prototype.has=function(e){return void 0!==this.get(e)},e.prototype.set=function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]},e.prototype.delete=function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1},e.prototype.forEach=function(e){tg(this.inner,function(t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];e(o[0],o[1])}})},e.prototype.isEmpty=function(){return ng(this.inner)},e}(),kE=function(){function e(){this.changes=new NE(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),this.changesApplied=!1}return e.prototype.getReadTime=function(e){var t=this.changes.get(e);return t?t.readTime:Zm.min()},e.prototype.addEntry=function(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})},e.prototype.removeEntry=function(e,t){void 0===t&&(t=null),this.assertNotApplied(),this.changes.set(e,{document:Mg.newInvalidDocument(e),readTime:t})},e.prototype.getEntry=function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Ny.resolve(n.document):this.getFromCache(e,t)},e.prototype.getEntries=function(e,t){return this.getAllFromCache(e,t)},e.prototype.apply=function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)},e.prototype.assertNotApplied=function(){},e}(),DE=function(){function e(e,t){this.R=e,this.Ut=t}return e.prototype.addEntry=function(e,t,n){return xE(e).put(ME(t),n)},e.prototype.removeEntry=function(e,t){var n=xE(e),r=ME(t);return n.delete(r)},e.prototype.updateMetadata=function(e,t){var n=this;return this.getMetadata(e).next(function(r){return r.byteSize+=t,n.me(e,r)})},e.prototype.getEntry=function(e,t){var n=this;return xE(e).get(ME(t)).next(function(e){return n.ye(t,e)})},e.prototype.ge=function(e,t){var n=this;return xE(e).get(ME(t)).next(function(e){return{document:n.ye(t,e),size:dE(e)}})},e.prototype.getEntries=function(e,t){var n=this,r=uv();return this.pe(e,t,function(e,t){var i=n.ye(e,t);r=r.insert(e,i)}).next(function(){return r})},e.prototype.Ee=function(e,t){var n=this,r=uv(),i=new rv(yg.comparator);return this.pe(e,t,function(e,t){var o=n.ye(e,t);r=r.insert(e,o),i=i.insert(e,dE(t))}).next(function(){return{documents:r,Te:i}})},e.prototype.pe=function(e,t,n){if(t.isEmpty())return Ny.resolve();var r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator(),o=i.getNext();return xE(e).$t({range:r},function(e,t,r){for(var s=yg.fromSegments(e);o&&yg.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,t),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},e.prototype.getDocumentsMatchingQuery=function(e,t,n){var r=this,i=uv(),o=t.path.length+1,s={};if(n.isEqual(Zm.min())){var a=t.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var c=t.path.toArray(),u=Yy(n);s.range=IDBKeyRange.lowerBound([c,u],!0),s.index=_y.collectionReadTimeIndex}return xE(e).$t(s,function(e,n,s){if(e.length===o){var a=zy(r.R,n);t.path.isPrefixOf(a.key.path)?__(t,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},e.prototype.newChangeBuffer=function(e){return new PE(this,!!e&&e.trackRemovals)},e.prototype.getSize=function(e){return this.getMetadata(e).next(function(e){return e.byteSize})},e.prototype.getMetadata=function(e){return LE(e).get(vy.key).next(function(e){return Wm(!!e),e})},e.prototype.me=function(e,t){return LE(e).put(vy.key,t)},e.prototype.ye=function(e,t){if(t){var n=zy(this.R,t);if(!n.isNoDocument()||!n.version.isEqual(Zm.min()))return n}return Mg.newInvalidDocument(e)},e}(),PE=function(e){function t(t,n){var r=this;return(r=e.call(this)||this).Ie=t,r.trackRemovals=n,r.Ae=new NE(function(e){return e.toString()},function(e,t){return e.isEqual(t)}),r}return(0,ac.ZT)(t,e),t.prototype.applyChanges=function(e){var t=this,n=[],r=0,i=new sv(function(e,t){return Qm(e.canonicalString(),t.canonicalString())});return this.changes.forEach(function(o,s){var a=t.Ae.get(o);if(s.document.isValidDocument()){var c=Ky(t.Ie.R,s.document,t.getReadTime(o));i=i.add(o.path.popLast());var u=dE(c);r+=u-a,n.push(t.Ie.addEntry(e,o,c))}else if(r-=a,t.trackRemovals){var l=Ky(t.Ie.R,Mg.newNoDocument(o,Zm.min()),t.getReadTime(o));n.push(t.Ie.addEntry(e,o,l))}else n.push(t.Ie.removeEntry(e,o))}),i.forEach(function(r){n.push(t.Ie.Ut.addToCollectionParentIndex(e,r))}),n.push(this.Ie.updateMetadata(e,r)),Ny.waitFor(n)},t.prototype.getFromCache=function(e,t){var n=this;return this.Ie.ge(e,t).next(function(e){return n.Ae.set(t,e.size),e.document})},t.prototype.getAllFromCache=function(e,t){var n=this;return this.Ie.Ee(e,t).next(function(e){var t=e.documents;return e.Te.forEach(function(e,t){n.Ae.set(e,t)}),t})},t}(kE);function LE(e){return jy(e,vy.store)}function xE(e){return jy(e,_y.store)}function ME(e){return e.path.toArray()}var UE=function(){function e(e){this.R=e}return e.prototype.Rt=function(e,t,n,r){var i=this;Wm(n<r&&n>=0&&r<=11);var o=new ky("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(hy.store)}(e),function(e){e.createObjectStore(dy.store,{keyPath:dy.keyPath}),e.createObjectStore(py.store,{keyPath:py.keyPath,autoIncrement:!0}).createIndex(py.userMutationsIndex,py.userMutationsKeyPath,{unique:!0}),e.createObjectStore(fy.store)}(e),VE(e),function(e){e.createObjectStore(_y.store)}(e));var s=Ny.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Ey.store),e.deleteObjectStore(yy.store),e.deleteObjectStore(Sy.store)}(e),VE(e)),s=s.next(function(){return function(e){var t=e.store(Sy.store),n=new Sy(0,0,Zm.min().toTimestamp(),0);return t.put(Sy.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(e,t){return t.store(py.store).Nt().next(function(n){e.deleteObjectStore(py.store),e.createObjectStore(py.store,{keyPath:py.keyPath,autoIncrement:!0}).createIndex(py.userMutationsIndex,py.userMutationsKeyPath,{unique:!0});var r=t.store(py.store),i=n.map(function(e){return r.put(e)});return Ny.waitFor(i)})}(e,o)})),s=s.next(function(){!function(e){e.createObjectStore(by.store,{keyPath:by.keyPath})}(e)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(e){e.createObjectStore(vy.store)}(e),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(e,o)})),n<9&&r>=9&&(s=s.next(function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){var t=e.objectStore(_y.store);t.createIndex(_y.readTimeIndex,_y.readTimeIndexPath,{unique:!1}),t.createIndex(_y.collectionReadTimeIndex,_y.collectionReadTimeIndexPath,{unique:!1})}(t)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(e){e.createObjectStore(wy.store,{keyPath:wy.keyPath})}(e),function(e){e.createObjectStore(Ry.store,{keyPath:Ry.keyPath})}(e)})),s},e.prototype.be=function(e){var t=0;return e.store(_y.store).$t(function(e,n){t+=dE(n)}).next(function(){var n=new vy(t);return e.store(vy.store).put(vy.key,n)})},e.prototype.Re=function(e){var t=this,n=e.store(dy.store),r=e.store(py.store);return n.Nt().next(function(n){return Ny.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(py.userMutationsIndex,i).next(function(r){return Ny.forEach(r,function(r){Wm(r.userId===n.userId);var i=$y(t.R,r);return hE(e,n.userId,i).next(function(){})})})})})},e.prototype.ve=function(e){var t=e.store(Ey.store),n=e.store(_y.store);return e.store(Sy.store).get(Sy.key).next(function(e){var r=[];return n.$t(function(n,i){var o=new ig(n),s=function(e){return[0,sy(e)]}(o);r.push(t.get(s).next(function(n){return n?Ny.resolve():function(n){return t.put(new Ey(0,sy(n),e.highestListenSequenceNumber))}(o)}))}).next(function(){return Ny.waitFor(r)})})},e.prototype.Pe=function(e,t){e.createObjectStore(Ty.store,{keyPath:Ty.keyPath});var n=t.store(Ty.store),r=new sE,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:sy(i)})}};return t.store(_y.store).$t({kt:!0},function(e,t){var n=new ig(e);return i(n.popLast())}).next(function(){return t.store(fy.store).$t({kt:!0},function(e,t){var n=uy(e[1]);return i(n.popLast())})})},e.prototype.Ve=function(e){var t=this,n=e.store(yy.store);return n.$t(function(e,r){var i=Zy(r),o=eE(t.R,i);return n.put(o)})},e}();function VE(e){e.createObjectStore(Ey.store,{keyPath:Ey.keyPath}).createIndex(Ey.documentTargetsIndex,Ey.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(yy.store,{keyPath:yy.keyPath}).createIndex(yy.queryTargetsIndexName,yy.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Sy.store)}var FE="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",BE=function(){function e(t,n,r,i,o,s,a,c,u,l){if(this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=u,this.Ce=l,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(e){return Promise.resolve()},!e.yt())throw new Um(Mm.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new AE(this,i),this.Le=n+"main",this.R=new Wy(c),this.Be=new Dy(this.Le,11,new UE(this.R)),this.qe=new yE(this.referenceDelegate,this.R),this.Ut=new aE,this.Ue=function(e,t){return new DE(e,t)}(this.R,this.Ut),this.Qe=new nE,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===l&&jm("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var e=this;return this.je().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Um(Mm.FAILED_PRECONDITION,FE);return e.We(),e.Ge(),e.ze(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.qe.getHighestSequenceNumber(t)})}).then(function(t){e.Ne=new xm(t,e.De)}).then(function(){e.xe=!0}).catch(function(t){return e.Be&&e.Be.close(),Promise.reject(t)})},e.prototype.He=function(e){var t=this;return this.Me=function(n){return(0,ac.mG)(t,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){return this.started?[2,e(n)]:[2]})})},e(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(e){var t=this;this.Be.vt(function(n){return(0,ac.mG)(t,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return null===n.newVersion?[4,e()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},e.prototype.setNetworkEnabled=function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Se.enqueueAndForget(function(){return(0,ac.mG)(t,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){switch(e.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})}))},e.prototype.je=function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(t){return GE(t).put(new by(e.clientId,Date.now(),e.networkEnabled,e.inForeground)).next(function(){if(e.isPrimary)return e.Je(t).next(function(t){t||(e.isPrimary=!1,e.Se.enqueueRetryable(function(){return e.Me(!1)}))})}).next(function(){return e.Ye(t)}).next(function(n){return e.isPrimary&&!n?e.Xe(t).next(function(){return!1}):!!n&&e.Ze(t).next(function(){return!0})})}).catch(function(t){if(xy(t))return Bm("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return Bm("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){e.isPrimary!==t&&e.Se.enqueueRetryable(function(){return e.Me(t)}),e.isPrimary=t})},e.prototype.Je=function(e){var t=this;return jE(e).get(hy.key).next(function(e){return Ny.resolve(t.tn(e))})},e.prototype.en=function(e){return GE(e).delete(this.clientId)},e.prototype.nn=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e,t,n,r=this;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(e){var t=jy(e,by.store);return t.Nt().next(function(e){var n=r.rn(e,18e5),i=e.filter(function(e){return-1===n.indexOf(e)});return Ny.forEach(i,function(e){return t.delete(e.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(e=i.sent(),this.Ke)for(t=0,n=e;t<n.length;t++)this.Ke.removeItem(this.on(n[t].clientId));i.label=2;case 2:return[2]}})})},e.prototype.ze=function(){var e=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return e.je().then(function(){return e.nn()}).then(function(){return e.ze()})})},e.prototype.tn=function(e){return!!e&&e.ownerId===this.clientId},e.prototype.Ye=function(e){var t=this;return this.Ce?Ny.resolve(!0):jE(e).get(hy.key).next(function(n){if(null!==n&&t.sn(n.leaseTimestampMs,5e3)&&!t.cn(n.ownerId)){if(t.tn(n)&&t.networkEnabled)return!0;if(!t.tn(n)){if(!n.allowTabSynchronization)throw new Um(Mm.FAILED_PRECONDITION,FE);return!1}}return!(!t.networkEnabled||!t.inForeground)||GE(e).Nt().next(function(e){return void 0===t.rn(e,5e3).find(function(e){return!(t.clientId===e.clientId||!(!t.networkEnabled&&e.networkEnabled||!t.inForeground&&e.inForeground&&t.networkEnabled===e.networkEnabled))})})}).next(function(e){return t.isPrimary!==e&&Bm("IndexedDbPersistence","Client "+(e?"is":"is not")+" eligible for a primary lease."),e})},e.prototype.shutdown=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e=this;return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[hy.store,by.store],function(t){var n=new By(t,xm.o);return e.Xe(n).next(function(){return e.en(n)})})];case 1:return t.sent(),this.Be.close(),this.ln(),[2]}})})},e.prototype.rn=function(e,t){var n=this;return e.filter(function(e){return n.sn(e.updateTimeMs,t)&&!n.cn(e.clientId)})},e.prototype.fn=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return GE(t).Nt().next(function(t){return e.rn(t,18e5).map(function(e){return e.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(e){return pE.Kt(e,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Qe},e.prototype.runTransaction=function(e,t,n){var r,i=this;return Bm("IndexedDbPersistence","Starting transaction:",e),this.Be.runTransaction(e,"readonly"===t?"readonly":"readwrite",Iy,function(o){return r=new By(o,i.Ne?i.Ne.next():xm.o),"readwrite-primary"===t?i.Je(r).next(function(e){return!!e||i.Ye(r)}).next(function(t){if(!t)throw jm("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Um(Mm.FAILED_PRECONDITION,Cy);return n(r)}).next(function(e){return i.Ze(r).next(function(){return e})}):i.dn(r).next(function(){return n(r)})}).then(function(e){return r.raiseOnCommittedEvent(),e})},e.prototype.dn=function(e){var t=this;return jE(e).get(hy.key).next(function(e){if(null!==e&&t.sn(e.leaseTimestampMs,5e3)&&!t.cn(e.ownerId)&&!t.tn(e)&&!(t.Ce||t.allowTabSynchronization&&e.allowTabSynchronization))throw new Um(Mm.FAILED_PRECONDITION,FE)})},e.prototype.Ze=function(e){var t=new hy(this.clientId,this.allowTabSynchronization,Date.now());return jE(e).put(hy.key,t)},e.yt=function(){return Dy.yt()},e.prototype.Xe=function(e){var t=this,n=jE(e);return n.get(hy.key).next(function(e){return t.tn(e)?(Bm("IndexedDbPersistence","Releasing primary lease."),n.delete(hy.key)):Ny.resolve()})},e.prototype.sn=function(e,t){var n=Date.now();return!(e<n-t||e>n&&(jm("Detected an update time that is in the future: "+e+" > "+n),1))},e.prototype.We=function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){e.Se.enqueueAndForget(function(){return e.inForeground="visible"===e.document.visibilityState,e.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},e.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},e.prototype.Ge=function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Fe=function(){t.un(),t.Se.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},e.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},e.prototype.cn=function(e){var t;try{var n=null!==(null===(t=this.Ke)||void 0===t?void 0:t.getItem(this.on(e)));return Bm("IndexedDbPersistence","Client '"+e+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(e){return jm("IndexedDbPersistence","Failed to get zombied client id.",e),!1}},e.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(e){jm("Failed to set zombie client id.",e)}},e.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(e){}},e.prototype.on=function(e){return"firestore_zombie_"+this.persistenceKey+"_"+e},e}();function jE(e){return jy(e,hy.store)}function GE(e){return jy(e,by.store)}function qE(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var HE=function(e,t){this.progress=e,this.wn=t},WE=function(){function e(e,t,n){this.Ue=e,this._n=t,this.Ut=n}return e.prototype.mn=function(e,t){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(e,t).next(function(r){return n.yn(e,t,r)})},e.prototype.yn=function(e,t,n){return this.Ue.getEntry(e,t).next(function(e){for(var t=0,r=n;t<r.length;t++)r[t].applyToLocalView(e);return e})},e.prototype.gn=function(e,t){e.forEach(function(e,n){for(var r=0,i=t;r<i.length;r++)i[r].applyToLocalView(n)})},e.prototype.pn=function(e,t){var n=this;return this.Ue.getEntries(e,t).next(function(t){return n.En(e,t).next(function(){return t})})},e.prototype.En=function(e,t){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(e,t).next(function(e){return n.gn(t,e)})},e.prototype.getDocumentsMatchingQuery=function(e,t,n){return function(e){return yg.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Tn(e,t.path):l_(t)?this.In(e,t,n):this.An(e,t,n)},e.prototype.Tn=function(e,t){return this.mn(e,new yg(t)).next(function(e){var t=hv();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})},e.prototype.In=function(e,t,n){var r=this,i=t.collectionGroup,o=hv();return this.Ut.getCollectionParents(e,i).next(function(s){return Ny.forEach(s,function(s){var a=function(e,t){return new r_(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(i));return r.An(e,a,n).next(function(e){e.forEach(function(e,t){o=o.insert(e,t)})})}).next(function(){return o})})},e.prototype.An=function(e,t,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(e,t,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(e,t)}).next(function(t){return o.Rn(e,i=t,r).next(function(e){r=e;for(var t=0,n=i;t<n.length;t++)for(var o=n[t],s=0,a=o.mutations;s<a.length;s++){var c=a[s],u=c.key,l=r.get(u);null==l&&(l=Mg.newInvalidDocument(u),r=r.insert(u,l)),j_(c,l,o.localWriteTime),l.isFoundDocument()||(r=r.remove(u))}})}).next(function(){return r.forEach(function(e,n){__(t,n)||(r=r.remove(e))}),r})},e.prototype.Rn=function(e,t,n){for(var r=mv(),i=0,o=t;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var c=a[s];c instanceof z_&&null===n.get(c.key)&&(r=r.add(c.key))}var u=n;return this.Ue.getEntries(e,r).next(function(e){return e.forEach(function(e,t){t.isFoundDocument()&&(u=u.insert(e,t))}),u})},e}(),zE=function(){function e(e,t,n,r){this.targetId=e,this.fromCache=t,this.bn=n,this.vn=r}return e.Pn=function(t,n){for(var r=mv(),i=mv(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new e(t,n.fromCache,r,i)},e}(),KE=function(){function e(){}return e.prototype.Vn=function(e){this.Sn=e},e.prototype.getDocumentsMatchingQuery=function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(Zm.min())?this.Dn(e,t):this.Sn.pn(e,r).next(function(o){var s=i.Cn(t,o);return(s_(t)||a_(t))&&i.Nn(t.limitType,s,r,n)?i.Dn(e,t):(Fm()<=Rh.in.DEBUG&&Bm("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),g_(t)),i.Sn.getDocumentsMatchingQuery(e,t,n).next(function(e){return s.forEach(function(t){e=e.insert(t.key,t)}),e}))})},e.prototype.Cn=function(e,t){var n=new sv(v_(e));return t.forEach(function(t,r){__(e,r)&&(n=n.add(r))}),n},e.prototype.Nn=function(e,t,n,r){if(n.size!==t.size)return!0;var i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},e.prototype.Dn=function(e,t){return Fm()<=Rh.in.DEBUG&&Bm("QueryEngine","Using full collection scan to execute query:",g_(t)),this.Sn.getDocumentsMatchingQuery(e,t,Zm.min())},e}(),YE=function(){function e(e,t,n,r){this.persistence=e,this.xn=t,this.R=r,this.Fn=new rv(Qm),this.kn=new NE(function(e){return Fg(e)},Bg),this.$n=Zm.min(),this._n=e.getMutationQueue(n),this.On=e.getRemoteDocumentCache(),this.qe=e.getTargetCache(),this.Mn=new WE(this.On,this._n,this.persistence.getIndexManager()),this.Qe=e.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return e.collect(n,t.Fn)})},e}();function QE(e,t,n,r){return new YE(e,t,n,r)}function JE(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,ac.Jh)(this,function(s){switch(s.label){case 0:return n=zm(e),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(e){var o;return n._n.getAllMutationBatches(e).next(function(s){return o=s,r=n.persistence.getMutationQueue(t),i=new WE(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(e)}).next(function(t){for(var n=[],r=[],s=mv(),a=0,c=o;a<c.length;a++){var u=c[a];n.push(u.batchId);for(var l=0,h=u.mutations;l<h.length;l++)s=s.add(h[l].key)}for(var d=0,p=t;d<p.length;d++){var f=p[d];r.push(f.batchId);for(var m=0,g=f.mutations;m<g.length;m++)s=s.add(g[m].key)}return i.pn(e,s).next(function(e){return{Ln:e,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function XE(e,t){var n=zm(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(e){var r=t.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,o=i.keys(),s=Ny.resolve();return o.forEach(function(e){s=s.next(function(){return r.getEntry(t,e)}).next(function(t){var o=n.docVersions.get(e);Wm(null!==o),t.version.compareTo(o)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))})}),s.next(function(){return e._n.removeMutationBatch(t,i)})}(n,e,t,i).next(function(){return i.apply(e)}).next(function(){return n._n.performConsistencyCheck(e)}).next(function(){return n.Mn.pn(e,r)})})}function $E(e){var t=zm(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.qe.getLastRemoteSnapshotVersion(e)})}function ZE(e,t){var n=zm(e),r=t.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(e){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];t.targetChanges.forEach(function(t,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(e,t.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(e,t.addedDocuments,o)}));var c=t.resumeToken;if(c.approximateByteSize()>0){var u=a.withResumeToken(c,r).withSequenceNumber(e.currentSequenceNumber);i=i.insert(o,u),function(e,t,n){return Wm(t.resumeToken.approximateByteSize()>0),0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,u,t)&&s.push(n.qe.updateTargetData(e,u))}}});var a=uv();if(t.documentUpdates.forEach(function(r,i){t.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),s.push(eS(e,o,t.documentUpdates,r,void 0).next(function(e){a=e})),!r.isEqual(Zm.min())){var c=n.qe.getLastRemoteSnapshotVersion(e).next(function(t){return n.qe.setTargetsMetadata(e,e.currentSequenceNumber,r)});s.push(c)}return Ny.waitFor(s).next(function(){return o.apply(e)}).next(function(){return n.Mn.En(e,a)}).next(function(){return a})}).then(function(e){return n.Fn=i,e})}function eS(e,t,n,r,i){var o=mv();return n.forEach(function(e){return o=o.add(e)}),t.getEntries(e,o).next(function(e){var o=uv();return n.forEach(function(n,s){var a=e.get(n),c=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Zm.min())?(t.removeEntry(n,c),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s,c),o=o.insert(n,s)):Bm("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function tS(e,t){var n=zm(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(e){return void 0===t&&(t=-1),n._n.getNextMutationBatchAfterBatchId(e,t)})}function nS(e,t){var n=zm(e);return n.persistence.runTransaction("Allocate target","readwrite",function(e){var r;return n.qe.getTargetData(e,t).next(function(i){return i?Ny.resolve(r=i):n.qe.allocateTargetId(e).next(function(i){return r=new Hy(t,i,0,e.currentSequenceNumber),n.qe.addTargetData(e,r).next(function(){return r})})})}).then(function(e){var r=n.Fn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(e.targetId,e),n.kn.set(t,e.targetId)),e})}function rS(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,ac.Jh)(this,function(a){switch(a.label){case 0:r=zm(e),i=r.Fn.get(t),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(e){return r.persistence.referenceDelegate.removeTarget(e,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!xy(s=a.sent()))throw s;return Bm("LocalStore","Failed to update sequence numbers for target "+t+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(t),r.kn.delete(i.target),[2]}})})}function iS(e,t,n){var r=zm(e),i=Zm.min(),o=mv();return r.persistence.runTransaction("Execute query","readonly",function(e){return function(e,t,n){var r=zm(e),i=r.kn.get(n);return void 0!==i?Ny.resolve(r.Fn.get(i)):r.qe.getTargetData(t,n)}(r,e,d_(t)).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(e,t.targetId).next(function(e){o=e})}).next(function(){return r.xn.getDocumentsMatchingQuery(e,t,n?i:Zm.min(),n?o:mv())}).next(function(e){return{documents:e,Bn:o}})})}function oS(e,t){var n=zm(e),r=zm(n.qe),i=n.Fn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(e){return r.lt(e,t).next(function(e){return e?e.target:null})})}function sS(e){var t=zm(e);return t.persistence.runTransaction("Get new document changes","readonly",function(e){return function(e,t,n){var r=zm(e),i=uv(),o=Yy(n),s=xE(t),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:_y.readTimeIndex,range:a},function(e,t){var n=zy(r.R,t);i=i.insert(n.key,n),o=t.readTime}).next(function(){return{wn:i,readTime:Qy(o)}})}(t.On,e,t.$n)}).then(function(e){var n=e.wn;return t.$n=e.readTime,n})}function aS(e){return(0,ac.mG)(this,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){return[2,(t=zm(e)).persistence.runTransaction("Synchronize last document change read time","readonly",function(e){return function(e){var t=xE(e),n=Zm.min();return t.$t({index:_y.readTimeIndex,reverse:!0},function(e,t,r){t.readTime&&(n=Qy(t.readTime)),r.done()}).next(function(){return n})}(e)}).then(function(e){t.$n=e})]})})}function cS(e,t,n,r){return(0,ac.mG)(this,void 0,void 0,function(){var i,o,s,a,c,u,l,h,d,p;return(0,ac.Jh)(this,function(f){switch(f.label){case 0:for(i=zm(e),o=mv(),s=uv(),a=pv(),c=0,u=n;c<u.length;c++)h=t.qn((l=u[c]).metadata.name),l.document&&(o=o.add(h)),s=s.insert(h,t.Un(l)),a=a.insert(h,t.Qn(l.metadata.readTime));return d=i.On.newChangeBuffer({trackRemovals:!0}),[4,nS(i,function(e){return d_(o_(ig.fromString("__bundle__/docs/"+e)))}(r))];case 1:return p=f.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(e){return eS(e,d,s,Zm.min(),a).next(function(t){return d.apply(e),t}).next(function(t){return i.qe.removeMatchingKeysForTargetId(e,p.targetId).next(function(){return i.qe.addMatchingKeys(e,o,p.targetId)}).next(function(){return i.Mn.En(e,t)}).next(function(){return t})})})]}})})}function uS(e,t,n){return void 0===n&&(n=mv()),(0,ac.mG)(this,void 0,void 0,function(){var r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return[4,nS(e,d_(tE(t.bundledQuery)))];case 1:return r=o.sent(),[2,(i=zm(e)).persistence.runTransaction("Save named query","readwrite",function(e){var o=Pv(t.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(e,t);var s=r.withResumeToken(cg.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(e,s).next(function(){return i.qe.removeMatchingKeysForTargetId(e,r.targetId)}).next(function(){return i.qe.addMatchingKeys(e,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(e,t)})})]}})})}var lS=function(){function e(e){this.R=e,this.Kn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(e,t){return Ny.resolve(this.Kn.get(t))},e.prototype.saveBundleMetadata=function(e,t){var n;return this.Kn.set(t.id,{id:(n=t).id,version:n.version,createTime:Pv(n.createTime)}),Ny.resolve()},e.prototype.getNamedQuery=function(e,t){return Ny.resolve(this.jn.get(t))},e.prototype.saveNamedQuery=function(e,t){return this.jn.set(t.name,function(e){return{name:e.name,query:tE(e.bundledQuery),readTime:Pv(e.readTime)}}(t)),Ny.resolve()},e}(),hS=function(){function e(){this.Wn=new sv(dS.Gn),this.zn=new sv(dS.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(e,t){var n=new dS(e,t);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},e.prototype.Jn=function(e,t){var n=this;e.forEach(function(e){return n.addReference(e,t)})},e.prototype.removeReference=function(e,t){this.Yn(new dS(e,t))},e.prototype.Xn=function(e,t){var n=this;e.forEach(function(e){return n.removeReference(e,t)})},e.prototype.Zn=function(e){var t=this,n=new yg(new ig([])),r=new dS(n,e),i=new dS(n,e+1),o=[];return this.zn.forEachInRange([r,i],function(e){t.Yn(e),o.push(e.key)}),o},e.prototype.ts=function(){var e=this;this.Wn.forEach(function(t){return e.Yn(t)})},e.prototype.Yn=function(e){this.Wn=this.Wn.delete(e),this.zn=this.zn.delete(e)},e.prototype.es=function(e){var t=new yg(new ig([])),n=new dS(t,e),r=new dS(t,e+1),i=mv();return this.zn.forEachInRange([n,r],function(e){i=i.add(e.key)}),i},e.prototype.containsKey=function(e){var t=new dS(e,0),n=this.Wn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)},e}(),dS=function(){function e(e,t){this.key=e,this.ns=t}return e.Gn=function(e,t){return yg.comparator(e.key,t.key)||Qm(e.ns,t.ns)},e.Hn=function(e,t){return Qm(e.ns,t.ns)||yg.comparator(e.key,t.key)},e}(),pS=function(){function e(e,t){this.Ut=e,this.referenceDelegate=t,this._n=[],this.ss=1,this.rs=new sv(dS.Gn)}return e.prototype.checkEmpty=function(e){return Ny.resolve(0===this._n.length)},e.prototype.addMutationBatch=function(e,t,n,r){var i=this.ss;this.ss++;var o=new Gy(i,t,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var c=a[s];this.rs=this.rs.add(new dS(c.key,i)),this.Ut.addToCollectionParentIndex(e,c.key.path.popLast())}return Ny.resolve(o)},e.prototype.lookupMutationBatch=function(e,t){return Ny.resolve(this.os(t))},e.prototype.getNextMutationBatchAfterBatchId=function(e,t){var n=this.cs(t+1),r=n<0?0:n;return Ny.resolve(this._n.length>r?this._n[r]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return Ny.resolve(0===this._n.length?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(e){return Ny.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(e,t){var n=this,r=new dS(t,0),i=new dS(t,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(e){var t=n.os(e.ns);o.push(t)}),Ny.resolve(o)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(e,t){var n=this,r=new sv(Qm);return t.forEach(function(e){var t=new dS(e,0),i=new dS(e,Number.POSITIVE_INFINITY);n.rs.forEachInRange([t,i],function(e){r=r.add(e.ns)})}),Ny.resolve(this.us(r))},e.prototype.getAllMutationBatchesAffectingQuery=function(e,t){var n=t.path,r=n.length+1,i=n;yg.isDocumentKey(i)||(i=i.child(""));var o=new dS(new yg(i),0),s=new sv(Qm);return this.rs.forEachWhile(function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(s=s.add(e.ns)),!0)},o),Ny.resolve(this.us(s))},e.prototype.us=function(e){var t=this,n=[];return e.forEach(function(e){var r=t.os(e);null!==r&&n.push(r)}),n},e.prototype.removeMutationBatch=function(e,t){var n=this;Wm(0===this.hs(t.batchId,"removed")),this._n.shift();var r=this.rs;return Ny.forEach(t.mutations,function(i){var o=new dS(i.key,t.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(function(){n.rs=r})},e.prototype.Gt=function(e){},e.prototype.containsKey=function(e,t){var n=new dS(t,0),r=this.rs.firstAfterOrEqual(n);return Ny.resolve(t.isEqual(r&&r.key))},e.prototype.performConsistencyCheck=function(e){return Ny.resolve()},e.prototype.hs=function(e,t){return this.cs(e)},e.prototype.cs=function(e){return 0===this._n.length?0:e-this._n[0].batchId},e.prototype.os=function(e){var t=this.cs(e);return t<0||t>=this._n.length?null:this._n[t]},e}(),fS=function(){function e(e,t){this.Ut=e,this.ls=t,this.docs=new rv(yg.comparator),this.size=0}return e.prototype.addEntry=function(e,t,n){var r=t.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(e,r.path.popLast())},e.prototype.removeEntry=function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)},e.prototype.getEntry=function(e,t){var n=this.docs.get(t);return Ny.resolve(n?n.document.clone():Mg.newInvalidDocument(t))},e.prototype.getEntries=function(e,t){var n=this,r=uv();return t.forEach(function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.clone():Mg.newInvalidDocument(e))}),Ny.resolve(r)},e.prototype.getDocumentsMatchingQuery=function(e,t,n){for(var r=uv(),i=new yg(t.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,c=a.document,u=a.readTime;if(!t.path.isPrefixOf(s.key.path))break;u.compareTo(n)<=0||__(t,c)&&(r=r.insert(c.key,c.clone()))}return Ny.resolve(r)},e.prototype.fs=function(e,t){return Ny.forEach(this.docs,function(e){return t(e)})},e.prototype.newChangeBuffer=function(e){return new mS(this)},e.prototype.getSize=function(e){return Ny.resolve(this.size)},e}(),mS=function(e){function t(t){var n=this;return(n=e.call(this)||this).Ie=t,n}return(0,ac.ZT)(t,e),t.prototype.applyChanges=function(e){var t=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(t.Ie.addEntry(e,i.document,t.getReadTime(r))):t.Ie.removeEntry(r)}),Ny.waitFor(n)},t.prototype.getFromCache=function(e,t){return this.Ie.getEntry(e,t)},t.prototype.getAllFromCache=function(e,t){return this.Ie.getEntries(e,t)},t}(kE),gS=function(){function e(e){this.persistence=e,this.ds=new NE(function(e){return Fg(e)},Bg),this.lastRemoteSnapshotVersion=Zm.min(),this.highestTargetId=0,this.ws=0,this._s=new hS,this.targetCount=0,this.ys=vE.Jt()}return e.prototype.forEachTarget=function(e,t){return this.ds.forEach(function(e,n){return t(n)}),Ny.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(e){return Ny.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(e){return Ny.resolve(this.ws)},e.prototype.allocateTargetId=function(e){return this.highestTargetId=this.ys.next(),Ny.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ws&&(this.ws=t),Ny.resolve()},e.prototype.te=function(e){this.ds.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.ys=new vE(t),this.highestTargetId=t),e.sequenceNumber>this.ws&&(this.ws=e.sequenceNumber)},e.prototype.addTargetData=function(e,t){return this.te(t),this.targetCount+=1,Ny.resolve()},e.prototype.updateTargetData=function(e,t){return this.te(t),Ny.resolve()},e.prototype.removeTargetData=function(e,t){return this.ds.delete(t.target),this._s.Zn(t.targetId),this.targetCount-=1,Ny.resolve()},e.prototype.removeTargets=function(e,t,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),Ny.waitFor(o).next(function(){return i})},e.prototype.getTargetCount=function(e){return Ny.resolve(this.targetCount)},e.prototype.getTargetData=function(e,t){var n=this.ds.get(t)||null;return Ny.resolve(n)},e.prototype.addMatchingKeys=function(e,t,n){return this._s.Jn(t,n),Ny.resolve()},e.prototype.removeMatchingKeys=function(e,t,n){this._s.Xn(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(function(t){i.push(r.markPotentiallyOrphaned(e,t))}),Ny.waitFor(i)},e.prototype.removeMatchingKeysForTargetId=function(e,t){return this._s.Zn(t),Ny.resolve()},e.prototype.getMatchingKeysForTargetId=function(e,t){var n=this._s.es(t);return Ny.resolve(n)},e.prototype.containsKey=function(e,t){return Ny.resolve(this._s.containsKey(t))},e}(),_S=function(){function e(e,t){var n=this;this.gs={},this.Ne=new xm(0),this.xe=!1,this.xe=!0,this.referenceDelegate=e(this),this.qe=new gS(this),this.Ut=new oE,this.Ue=function(e,t){return new fS(e,function(e){return n.referenceDelegate.ps(e)})}(this.Ut),this.R=new Wy(t),this.Qe=new lS(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(e){var t=this.gs[e.toKey()];return t||(t=new pS(this.Ut,this.referenceDelegate),this.gs[e.toKey()]=t),t},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Qe},e.prototype.runTransaction=function(e,t,n){var r=this;Bm("MemoryPersistence","Starting transaction:",e);var i=new vS(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(e){return r.referenceDelegate.Ts(i).next(function(){return e})}).toPromise().then(function(e){return i.raiseOnCommittedEvent(),e})},e.prototype.Is=function(e,t){return Ny.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(e,t)}}))},e}(),vS=function(e){function t(t){var n=this;return(n=e.call(this)||this).currentSequenceNumber=t,n}return(0,ac.ZT)(t,e),t}(Ay),yS=function(){function e(e){this.persistence=e,this.As=new hS,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Hm()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(e,t,n){return this.As.addReference(n,t),this.vs.delete(n.toString()),Ny.resolve()},e.prototype.removeReference=function(e,t,n){return this.As.removeReference(n,t),this.vs.add(n.toString()),Ny.resolve()},e.prototype.markPotentiallyOrphaned=function(e,t){return this.vs.add(t.toString()),Ny.resolve()},e.prototype.removeTarget=function(e,t){var n=this;this.As.Zn(t.targetId).forEach(function(e){return n.vs.add(e.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(function(e){e.forEach(function(e){return n.vs.add(e.toString())})}).next(function(){return r.removeTargetData(e,t)})},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ny.forEach(this.vs,function(r){var i=yg.fromPath(r);return t.Ps(e,i).next(function(e){e||n.removeEntry(i)})}).next(function(){return t.Rs=null,n.apply(e)})},e.prototype.updateLimboDocument=function(e,t){var n=this;return this.Ps(e,t).next(function(e){e?n.vs.delete(t.toString()):n.vs.add(t.toString())})},e.prototype.ps=function(e){return 0},e.prototype.Ps=function(e,t){var n=this;return Ny.or([function(){return Ny.resolve(n.As.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Is(e,t)}])},e}(),ES=function(){function e(e){this.uid=e}return e.prototype.isAuthenticated=function(){return null!=this.uid},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(e){return e.uid===this.uid},e}();function SS(e,t){return"firestore_clients_"+e+"_"+t}function TS(e,t,n){var r="firestore_mutations_"+e+"_"+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function bS(e,t){return"firestore_targets_"+e+"_"+t}ES.UNAUTHENTICATED=new ES(null),ES.GOOGLE_CREDENTIALS=new ES("google-credentials-uid"),ES.FIRST_PARTY=new ES("first-party-uid");var wS=function(){function e(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}return e.Vs=function(t,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Um(o.error.code,o.error.message)),s?new e(t,n,o.state,i):(jm("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},e.prototype.Ss=function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)},e}(),RS=function(){function e(e,t,n){this.targetId=e,this.state=t,this.error=n}return e.Vs=function(t,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Um(i.error.code,i.error.message)),o?new e(t,i.state,r):(jm("SharedClientState","Failed to parse target state for ID '"+t+"': "+n),null)},e.prototype.Ss=function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)},e}(),IS=function(){function e(e,t){this.clientId=e,this.activeTargetIds=t}return e.Vs=function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=_v(),s=0;i&&s<r.activeTargetIds.length;++s)i=vg(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new e(t,o):(jm("SharedClientState","Failed to parse client data for instance '"+t+"': "+n),null)},e}(),CS=function(){function e(e,t){this.clientId=e,this.onlineState=t}return e.Vs=function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(jm("SharedClientState","Failed to parse online state: "+t),null)},e}(),AS=function(){function e(){this.activeTargetIds=_v()}return e.prototype.Ds=function(e){this.activeTargetIds=this.activeTargetIds.add(e)},e.prototype.Cs=function(e){this.activeTargetIds=this.activeTargetIds.delete(e)},e.prototype.Ss=function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)},e}(),OS=function(){function e(e,t,n,r,i){this.window=e,this.Se=t,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new rv(Qm),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=SS(this.persistenceKey,this.Ns),this.Ms=function(e){return"firestore_sequence_number_"+e}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new AS),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(e){return"firestore_online_state_"+e}(this.persistenceKey),this.Qs=function(e){return"firestore_bundle_loaded_"+e}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(e){return!(!e||!e.localStorage)},e.prototype.start=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e,t,n,r,i,o,s,a,c,u,l=this;return(0,ac.Jh)(this,function(h){switch(h.label){case 0:return[4,this.syncEngine.fn()];case 1:for(e=h.sent(),t=0,n=e;t<n.length;t++)(r=n[t])!==this.Ns&&(i=this.getItem(SS(this.persistenceKey,r)))&&(o=IS.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),c=0,u=this.$s;c<u.length;c++)this.Fs(u[c]);return this.$s=[],this.window.addEventListener("pagehide",function(){return l.shutdown()}),this.started=!0,[2]}})})},e.prototype.writeSequenceNumber=function(e){this.setItem(this.Ms,JSON.stringify(e))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},e.prototype.isActiveQueryTarget=function(e){var t=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(e)&&(t=!0)}),t},e.prototype.addPendingMutation=function(e){this.zs(e,"pending")},e.prototype.updateMutationState=function(e,t,n){this.zs(e,t,n),this.Hs(e)},e.prototype.addLocalQueryTarget=function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(bS(this.persistenceKey,e));if(n){var r=RS.Vs(e,n);r&&(t=r.state)}}return this.Js.Ds(e),this.Ks(),t},e.prototype.removeLocalQueryTarget=function(e){this.Js.Cs(e),this.Ks()},e.prototype.isLocalQueryTarget=function(e){return this.Js.activeTargetIds.has(e)},e.prototype.clearQueryState=function(e){this.removeItem(bS(this.persistenceKey,e))},e.prototype.updateQueryState=function(e,t,n){this.Ys(e,t,n)},e.prototype.handleUserChange=function(e,t,n){var r=this;t.forEach(function(e){r.Hs(e)}),this.currentUser=e,n.forEach(function(e){r.addPendingMutation(e)})},e.prototype.setOnlineState=function(e){this.Xs(e)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},e.prototype.getItem=function(e){var t=this.storage.getItem(e);return Bm("SharedClientState","READ",e,t),t},e.prototype.setItem=function(e,t){Bm("SharedClientState","SET",e,t),this.storage.setItem(e,t)},e.prototype.removeItem=function(e){Bm("SharedClientState","REMOVE",e),this.storage.removeItem(e)},e.prototype.Fs=function(e){var t=this,n=e;if(n.storageArea===this.storage){if(Bm("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void jm("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return(0,ac.mG)(t,void 0,void 0,function(){var e,t,r,i,o,s;return(0,ac.Jh)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return e=this.ti(n.key),[2,this.ei(e,null)];if(t=this.ni(n.key,n.newValue))return[2,this.ei(t.clientId,t)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(e){var t=xm.o;if(null!=e)try{var n=JSON.parse(e);Wm("number"==typeof n),t=n}catch(e){jm("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue))!==xm.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Ks=function(){this.setItem(this.Os,this.Js.Ss())},e.prototype.zs=function(e,t,n){var r=new wS(this.currentUser,e,t,n),i=TS(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Ss())},e.prototype.Hs=function(e){var t=TS(this.persistenceKey,this.currentUser,e);this.removeItem(t)},e.prototype.Xs=function(e){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:e}))},e.prototype.Ys=function(e,t,n){var r=bS(this.persistenceKey,e),i=new RS(e,t,n);this.setItem(r,i.Ss())},e.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},e.prototype.ti=function(e){var t=this.Ls.exec(e);return t?t[1]:null},e.prototype.ni=function(e,t){var n=this.ti(e);return IS.Vs(n,t)},e.prototype.si=function(e,t){var n=this.Bs.exec(e),r=Number(n[1]);return wS.Vs(new ES(void 0!==n[2]?n[2]:null),r,t)},e.prototype.ri=function(e,t){var n=this.qs.exec(e),r=Number(n[1]);return RS.Vs(r,t)},e.prototype.js=function(e){return CS.Vs(e)},e.prototype.ii=function(e){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(e.batchId,e.state,e.error)]:(Bm("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},e.prototype.oi=function(e){return this.syncEngine.ai(e.targetId,e.state,e.error)},e.prototype.ei=function(e,t){var n=this,r=t?this.ks.insert(e,t):this.ks.remove(e),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(e){i.has(e)||s.push(e)}),i.forEach(function(e){o.has(e)||a.push(e)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},e.prototype.Ws=function(e){this.ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)},e.prototype.Gs=function(e){var t=_v();return e.forEach(function(e,n){t=t.unionWith(n.activeTargetIds)}),t},e}(),NS=function(){function e(){this.li=new AS,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(e){},e.prototype.updateMutationState=function(e,t,n){},e.prototype.addLocalQueryTarget=function(e){return this.li.Ds(e),this.fi[e]||"not-current"},e.prototype.updateQueryState=function(e,t,n){this.fi[e]=t},e.prototype.removeLocalQueryTarget=function(e){this.li.Cs(e)},e.prototype.isLocalQueryTarget=function(e){return this.li.activeTargetIds.has(e)},e.prototype.clearQueryState=function(e){delete this.fi[e]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(e){return this.li.activeTargetIds.has(e)},e.prototype.start=function(){return this.li=new AS,Promise.resolve()},e.prototype.handleUserChange=function(e,t,n){},e.prototype.setOnlineState=function(e){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(e){},e.prototype.notifyBundleLoaded=function(){},e}(),kS=function(){function e(){}return e.prototype.di=function(e){},e.prototype.shutdown=function(){},e}(),DS=function(){function e(){var e=this;this.wi=function(){return e._i()},this.mi=function(){return e.yi()},this.gi=[],this.pi()}return e.prototype.di=function(e){this.gi.push(e)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){Bm("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var e=0,t=this.gi;e<t.length;e++)(0,t[e])(0)},e.prototype.yi=function(){Bm("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var e=0,t=this.gi;e<t.length;e++)(0,t[e])(1)},e.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},e}(),PS={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},LS=function(){function e(e){this.Ei=e.Ei,this.Ti=e.Ti}return e.prototype.Ii=function(e){this.Ai=e},e.prototype.Ri=function(e){this.bi=e},e.prototype.onMessage=function(e){this.vi=e},e.prototype.close=function(){this.Ti()},e.prototype.send=function(e){this.Ei(e)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(e){this.bi(e)},e.prototype.Si=function(e){this.vi(e)},e}(),xS=function(e){function t(t){var n=this;return(n=e.call(this,t)||this).forceLongPolling=t.forceLongPolling,n.autoDetectLongPolling=t.autoDetectLongPolling,n.useFetchStreams=t.useFetchStreams,n}return(0,ac.ZT)(t,e),t.prototype.ki=function(e,t,n,r){return new Promise(function(i,o){var s=new Lm;s.listenOnce(Nm.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Om.NO_ERROR:var t=s.getResponseJson();Bm("Connection","XHR received:",JSON.stringify(t)),i(t);break;case Om.TIMEOUT:Bm("Connection",'RPC "'+e+'" timed out'),o(new Um(Mm.DEADLINE_EXCEEDED,"Request time out"));break;case Om.HTTP_ERROR:var n=s.getStatus();if(Bm("Connection",'RPC "'+e+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(Mm).indexOf(t)>=0?t:Mm.UNKNOWN}(r.status);o(new Um(a,r.message))}else o(new Um(Mm.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Um(Mm.UNAVAILABLE,"Connection failed."));break;default:Hm()}}finally{Bm("Connection",'RPC "'+e+'" completed.')}});var a=JSON.stringify(r);s.send(t,"POST",a,n,15)})},t.prototype.Oi=function(e,t){var n=[this.Di,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=new vm,i=Ep(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Dm({})),this.Fi(o.initMessageHeaders,t),(0,wh.uI)()||(0,wh.b$)()||(0,wh.d)()||(0,wh.w1)()||(0,wh.Mn)()||(0,wh.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Bm("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),c=!1,u=!1,l=new LS({Ei:function(e){u?Bm("Connection","Not sending because WebChannel is closed:",e):(c||(Bm("Connection","Opening WebChannel transport."),a.open(),c=!0),Bm("Connection","WebChannel sending:",e),a.send(e))},Ti:function(){return a.close()}}),h=function(e,t,n){e.listen(t,function(e){try{n(e)}catch(e){setTimeout(function(){throw e},0)}})};return h(a,Pm.EventType.OPEN,function(){u||Bm("Connection","WebChannel transport opened.")}),h(a,Pm.EventType.CLOSE,function(){u||(u=!0,Bm("Connection","WebChannel transport closed"),l.Vi())}),h(a,Pm.EventType.ERROR,function(e){u||(u=!0,Gm("Connection","WebChannel transport errored:",e),l.Vi(new Um(Mm.UNAVAILABLE,"The operation could not be completed")))}),h(a,Pm.EventType.MESSAGE,function(e){var t;if(!u){var n=e.data[0];Wm(!!n);var r=n.error||(null===(t=n[0])||void 0===t?void 0:t.error);if(r){Bm("Connection","WebChannel received error:",r);var i=r.status,o=function(e){var t=J_[e];if(void 0!==t)return nv(t)}(i),s=r.message;void 0===o&&(o=Mm.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),u=!0,l.Vi(new Um(o,s)),a.close()}else Bm("Connection","WebChannel received:",n),l.Si(n)}}),h(i,km.STAT_EVENT,function(e){10===e.stat?Bm("Connection","Detected buffering proxy"):11===e.stat&&Bm("Connection","Detected no buffering proxy")}),setTimeout(function(){l.Pi()},0),l},t}(function(){function e(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.Di=(e.ssl?"https":"http")+"://"+e.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(e,t,n,r){var i=this.xi(e,t);Bm("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(e,i,o,n).then(function(e){return Bm("RestConnection","Received: ",e),e},function(t){throw Gm("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},e.prototype.$i=function(e,t,n,r){return this.Ni(e,t,n,r)},e.prototype.Fi=function(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/8.6.8",e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(var n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])},e.prototype.xi=function(e,t){return this.Di+"/v1/"+t+":"+PS[e]},e}());function MS(){return"undefined"!=typeof window?window:null}function US(){return"undefined"!=typeof document?document:null}function VS(e){return new Ov(e,!0)}var FS=function(){function e(e,t,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=e,this.timerId=t,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Ki=function(){this.qi=this.Bi},e.prototype.ji=function(e){var t=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Bm("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return t.Qi=Date.now(),e()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e}(),BS=function(){function e(e,t,n,r,i,o){this.Se=e,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new FS(e,t)}return e.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},e.prototype.er=function(){return 2===this.state},e.prototype.start=function(){3!==this.state?this.auth():this.nr()},e.prototype.stop=function(){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){switch(e.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var e=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return e.rr()}))},e.prototype.cr=function(e){this.ur(),this.stream.send(e)},e.prototype.rr=function(){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){return this.er()?[2,this.close(0)]:[2]})})},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(e,t){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==e?this.Zi.reset():t&&t.code===Mm.RESOURCE_EXHAUSTED?(jm(t.toString()),jm("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):t&&t.code===Mm.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Ri(t)];case 1:return n.sent(),[2]}})})},e.prototype.ar=function(){},e.prototype.auth=function(){var e=this;this.state=1;var t=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(t){e.Yi===n&&e.lr(t)},function(n){t(function(){var t=new Um(Mm.UNKNOWN,"Fetching auth token failed: "+n.message);return e.dr(t)})})},e.prototype.lr=function(e){var t=this,n=this.hr(this.Yi);this.stream=this.wr(e),this.stream.Ii(function(){n(function(){return t.state=2,t.listener.Ii()})}),this.stream.Ri(function(e){n(function(){return t.dr(e)})}),this.stream.onMessage(function(e){n(function(){return t.onMessage(e)})})},e.prototype.nr=function(){var e=this;this.state=4,this.Zi.ji(function(){return(0,ac.mG)(e,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){return this.state=0,this.start(),[2]})})})},e.prototype.dr=function(e){return Bm("PersistentStream","close with error: "+e),this.stream=null,this.close(3,e)},e.prototype.hr=function(e){var t=this;return function(n){t.Se.enqueueAndForget(function(){return t.Yi===e?n():(Bm("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},e}(),jS=function(e){function t(t,n,r,i,o){var s=this;return(s=e.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,ac.ZT)(t,e),t.prototype.wr=function(e){return this.Hi.Oi("Listen",e)},t.prototype.onMessage=function(e){this.Zi.reset();var t=function(e,t){var n;if("targetChange"in t){var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Hm()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=function(e,t){return e.I?(Wm(void 0===t||"string"==typeof t),cg.fromBase64String(t||"")):(Wm(void 0===t||t instanceof Uint8Array),cg.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),s=(a=t.targetChange.cause)&&function(e){var t=void 0===e.code?Mm.UNKNOWN:nv(e.code);return new Um(t,e.message||"")}(a);n=new Tv(r,i,o,s||null)}else if("documentChange"in t){i=Uv(e,(r=t.documentChange).document.name),o=Pv(r.document.updateTime);var a=new Lg({mapValue:{fields:r.document.fields}}),c=(s=Mg.newFoundDocument(i,o,a),r.targetIds||[]);n=new Ev(c,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in t)i=Uv(e,(r=t.documentDelete).document),o=r.readTime?Pv(r.readTime):Zm.min(),a=Mg.newNoDocument(i,o),n=new Ev([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in t)i=Uv(e,(r=t.documentRemove).document),n=new Ev([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in t))return Hm();var u=t.filter;i=new ev(r=u.count||0),n=new Sv(o=u.targetId,i)}return n}(this.R,e),n=function(e){if(!("targetChange"in e))return Zm.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?Zm.min():t.readTime?Pv(t.readTime):Zm.min()}(e);return this.listener._r(t,n)},t.prototype.mr=function(e){var t={};t.database=Bv(this.R),t.addTarget=function(e,t){var n,r=t.target;return(n=jg(r)?{documents:zv(e,r)}:{query:Kv(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=kv(e,t.resumeToken):t.snapshotVersion.compareTo(Zm.min())>0&&(n.readTime=Nv(e,t.snapshotVersion.toTimestamp())),n}(this.R,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Hm()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(0,e);n&&(t.labels=n),this.cr(t)},t.prototype.yr=function(e){var t={};t.database=Bv(this.R),t.removeTarget=e,this.cr(t)},t}(BS),GS=function(e){function t(t,n,r,i,o){var s=this;return(s=e.call(this,t,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,ac.ZT)(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(e){return this.Hi.Oi("Write",e)},t.prototype.onMessage=function(e){if(Wm(!!e.streamToken),this.lastStreamToken=e.streamToken,this.gr){this.Zi.reset();var t=function(e,t){return e&&e.length>0?(Wm(void 0!==t),e.map(function(e){return function(e,t){var n=Pv(e.updateTime?e.updateTime:t);return n.isEqual(Zm.min())&&(n=Pv(t)),new M_(n,e.transformResults||[])}(e,t)})):[]}(e.writeResults,e.commitTime),n=Pv(e.commitTime);return this.listener.Tr(n,t)}return Wm(!e.writeResults||0===e.writeResults.length),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var e={};e.database=Bv(this.R),this.cr(e)},t.prototype.Er=function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map(function(e){return Hv(t.R,e)})};this.cr(n)},t}(BS),qS=function(e){function t(t,n,r){var i=this;return(i=e.call(this)||this).credentials=t,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,ac.ZT)(t,e),t.prototype.br=function(){if(this.Rr)throw new Um(Mm.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(e,t,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(e,t,n,i)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===Mm.UNAUTHENTICATED&&r.credentials.invalidateToken(),e):new Um(Mm.UNKNOWN,e.toString())})},t.prototype.$i=function(e,t,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(e,t,n,i)}).catch(function(e){throw"FirebaseError"===e.name?(e.code===Mm.UNAUTHENTICATED&&r.credentials.invalidateToken(),e):new Um(Mm.UNKNOWN,e.toString())})},t.prototype.terminate=function(){this.Rr=!0},t}(function(){}),HS=function(){function e(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var e=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return e.Pr=null,e.Cr("Backend didn't respond within 10 seconds."),e.Dr("Offline"),Promise.resolve()}))},e.prototype.Nr=function(e){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+e.toString()),this.Dr("Offline")))},e.prototype.set=function(e){this.Fr(),this.vr=0,"Online"===e&&(this.Vr=!1),this.Dr(e)},e.prototype.Dr=function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))},e.prototype.Cr=function(e){var t="Could not reach Cloud Firestore backend. "+e+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(jm(t),this.Vr=!1):Bm("OnlineStateTracker",t)},e.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},e}(),WS=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(e){n.enqueueAndForget(function(){return(0,ac.mG)(o,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){switch(e.label){case 0:return eT(this)?(Bm("RemoteStore","Restarting streams for network reachability change."),[4,function(e){return(0,ac.mG)(this,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return(t=zm(e)).Or.add(4),[4,KS(t)];case 1:return n.sent(),t.Br.set("Unknown"),t.Or.delete(4),[4,zS(t)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})}),this.Br=new HS(n,r)};function zS(e){return(0,ac.mG)(this,void 0,void 0,function(){var t,n;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:if(!eT(e))return[3,4];t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function KS(e){return(0,ac.mG)(this,void 0,void 0,function(){var t,n;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function YS(e,t){var n=zm(e);n.$r.has(t.targetId)||(n.$r.set(t.targetId,t),ZS(n)?$S(n):mT(n).er()&&JS(n,t))}function QS(e,t){var n=zm(e),r=mT(n);n.$r.delete(t),r.er()&&XS(n,t),0===n.$r.size&&(r.er()?r.ir():eT(n)&&n.Br.set("Unknown"))}function JS(e,t){e.qr.U(t.targetId),mT(e).mr(t)}function XS(e,t){e.qr.U(t),mT(e).yr(t)}function $S(e){e.qr=new wv({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),mT(e).start(),e.Br.Sr()}function ZS(e){return eT(e)&&!mT(e).tr()&&e.$r.size>0}function eT(e){return 0===zm(e).Or.size}function tT(e){e.qr=void 0}function nT(e){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){return e.$r.forEach(function(t,n){JS(e,t)}),[2]})})}function rT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(n){return tT(e),ZS(e)?(e.Br.Nr(t),$S(e)):e.Br.set("Unknown"),[2]})})}function iT(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i,o;return(0,ac.Jh)(this,function(s){switch(s.label){case 0:if(e.Br.set("Online"),!(t instanceof Tv&&2===t.state&&t.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o;return(0,ac.Jh)(this,function(s){switch(s.label){case 0:n=t.cause,r=0,i=t.targetIds,s.label=1;case 1:return r<i.length?e.$r.has(o=i[r])?[4,e.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),e.$r.delete(o),e.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(e,t)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Bm("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),[4,oT(e,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof Ev?e.qr.X(t):t instanceof Sv?e.qr.rt(t):e.qr.et(t),n.isEqual(Zm.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,$E(e.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(e,t){var n=e.qr.ut(t);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.$r.get(r);i&&e.$r.set(r,i.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach(function(t){var n=e.$r.get(t);if(n){e.$r.set(t,n.withResumeToken(cg.EMPTY_BYTE_STRING,n.snapshotVersion)),XS(e,t);var r=new Hy(n.target,t,1,n.sequenceNumber);JS(e,r)}}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Bm("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,oT(e,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function oT(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r=this;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:if(!xy(t))throw t;return e.Or.add(1),[4,KS(e)];case 1:return i.sent(),e.Br.set("Offline"),n||(n=function(){return $E(e.localStore)}),e.asyncQueue.enqueueRetryable(function(){return(0,ac.mG)(r,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return Bm("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return t.sent(),e.Or.delete(1),[4,zS(e)];case 2:return t.sent(),[2]}})})}),[2]}})})}function sT(e,t){return t().catch(function(n){return oT(e,n,t)})}function aT(e){return(0,ac.mG)(this,void 0,void 0,function(){var t,n,r,i,o;return(0,ac.Jh)(this,function(s){switch(s.label){case 0:t=zm(e),n=gT(t),r=t.kr.length>0?t.kr[t.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(e){return eT(e)&&e.kr.length<10}(t))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,tS(t.localStore,r)];case 3:return null===(i=s.sent())?(0===t.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(e,t){e.kr.push(t);var n=gT(e);n.er()&&n.pr&&n.Er(t.mutations)}(t,i),[3,6]);case 4:return o=s.sent(),[4,oT(t,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return cT(t)&&uT(t),[2]}})})}function cT(e){return eT(e)&&!gT(e).tr()&&e.kr.length>0}function uT(e){gT(e).start()}function lT(e){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){return gT(e).Ar(),[2]})})}function hT(e){return(0,ac.mG)(this,void 0,void 0,function(){var t,n,r;return(0,ac.Jh)(this,function(i){for(t=gT(e),n=0,r=e.kr;n<r.length;n++)t.Er(r[n].mutations);return[2]})})}function dT(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return r=e.kr.shift(),i=qy.from(r,t,n),[4,sT(e,function(){return e.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,aT(e)];case 2:return o.sent(),[2]}})})}function pT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return t&&gT(e).pr?[4,function(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return tv(r=t.code)&&r!==Mm.ABORTED?(n=e.kr.shift(),gT(e).sr(),[4,sT(e,function(){return e.remoteSyncer.rejectFailedWrite(n.batchId,t)})]):[3,3];case 1:return i.sent(),[4,aT(e)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return cT(e)&&uT(e),[2]}})})}function fT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return n=zm(e),t?(n.Or.delete(2),[4,zS(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return t?[3,4]:(n.Or.add(2),[4,KS(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function mT(e){var t=this;return e.Ur||(e.Ur=function(e,t,n){var r=zm(e);return r.br(),new jS(t,r.Hi,r.credentials,r.R,n)}(e.datastore,e.asyncQueue,{Ii:nT.bind(null,e),Ri:rT.bind(null,e),_r:iT.bind(null,e)}),e.Mr.push(function(n){return(0,ac.mG)(t,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return n?(e.Ur.sr(),ZS(e)?$S(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:t.sent(),tT(e),t.label=3;case 3:return[2]}})})})),e.Ur}function gT(e){var t=this;return e.Qr||(e.Qr=function(e,t,n){var r=zm(e);return r.br(),new GS(t,r.Hi,r.credentials,r.R,n)}(e.datastore,e.asyncQueue,{Ii:lT.bind(null,e),Ri:pT.bind(null,e),Ir:hT.bind(null,e),Tr:dT.bind(null,e)}),e.Mr.push(function(n){return(0,ac.mG)(t,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return n?(e.Qr.sr(),[4,aT(e)]):[3,2];case 1:return t.sent(),[3,4];case 2:return[4,e.Qr.stop()];case 3:t.sent(),e.kr.length>0&&(Bm("RemoteStore","Stopping write stream with "+e.kr.length+" pending writes"),e.kr=[]),t.label=4;case 4:return[2]}})})})),e.Qr}var _T=function(){function e(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Oy,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(e){})}return e.createAndSchedule=function(t,n,r,i,o){var s=new e(t,n,Date.now()+r,i,o);return s.start(r),s},e.prototype.start=function(e){var t=this;this.timerHandle=setTimeout(function(){return t.handleDelayElapsed()},e)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Um(Mm.CANCELLED,"Operation cancelled"+(e?": "+e:""))))},e.prototype.handleDelayElapsed=function(){var e=this;this.asyncQueue.enqueueAndForget(function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then(function(t){return e.deferred.resolve(t)})):Promise.resolve()})},e.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e}();function vT(e,t){if(jm("AsyncQueue",t+": "+e),xy(e))return new Um(Mm.UNAVAILABLE,t+": "+e);throw e}var yT=function(){function e(e){this.comparator=e?function(t,n){return e(t,n)||yg.comparator(t.key,n.key)}:function(e,t){return yg.comparator(e.key,t.key)},this.keyedMap=hv(),this.sortedSet=new rv(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(e){return null!=this.keyedMap.get(e)},e.prototype.get=function(e){return this.keyedMap.get(e)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(e){this.sortedSet.inorderTraversal(function(t,n){return e(t),!1})},e.prototype.add=function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))},e.prototype.delete=function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this},e.prototype.isEqual=function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},e.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},e.prototype.copy=function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r},e}(),ET=function(){function e(){this.Kr=new rv(yg.comparator)}return e.prototype.track=function(e){var t=e.doc.key,n=this.Kr.get(t);n?0!==e.type&&3===n.type?this.Kr=this.Kr.insert(t,e):3===e.type&&1!==n.type?this.Kr=this.Kr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Kr=this.Kr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Kr=this.Kr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Kr=this.Kr.remove(t):1===e.type&&2===n.type?this.Kr=this.Kr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Kr=this.Kr.insert(t,{type:2,doc:e.doc}):Hm():this.Kr=this.Kr.insert(t,e)},e.prototype.jr=function(){var e=[];return this.Kr.inorderTraversal(function(t,n){e.push(n)}),e},e}(),ST=function(){function e(e,t,n,r,i,o,s,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return e.fromInitialDocuments=function(t,n,r,i){var o=[];return n.forEach(function(e){o.push({type:0,doc:e})}),new e(t,n,yT.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&f_(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0},e}(),TT=function(){this.Wr=void 0,this.listeners=[]},bT=function(){this.queries=new NE(function(e){return m_(e)},f_),this.onlineState="Unknown",this.Gr=new Set};function wT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,c;return(0,ac.Jh)(this,function(u){switch(u.label){case 0:if(n=zm(e),i=!1,(o=n.queries.get(r=t.query))||(i=!0,o=new TT),!i)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=u.sent(),[3,4];case 3:return a=u.sent(),c=vT(a,"Initialization of query '"+g_(t.query)+"' failed"),[2,void t.onError(c)];case 4:return n.queries.set(r,o),o.listeners.push(t),t.zr(n.onlineState),o.Wr&&t.Hr(o.Wr)&&AT(n),[2]}})})}function RT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,ac.Jh)(this,function(a){return n=zm(e),i=!1,(o=n.queries.get(r=t.query))&&(s=o.listeners.indexOf(t))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function IT(e,t){for(var n=zm(e),r=!1,i=0,o=t;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var c=0,u=a.listeners;c<u.length;c++)u[c].Hr(s)&&(r=!0);a.Wr=s}}r&&AT(n)}function CT(e,t,n){var r=zm(e),i=r.queries.get(t);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(t)}function AT(e){e.Gr.forEach(function(e){e.next()})}var OT=function(){function e(e,t,n){this.query=e,this.Jr=t,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return e.prototype.Hr=function(e){if(!this.options.includeMetadataChanges){for(var t=[],n=0,r=e.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&t.push(i)}e=new ST(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(e)&&(this.Jr.next(e),o=!0):this.eo(e,this.onlineState)&&(this.no(e),o=!0),this.Xr=e,o},e.prototype.onError=function(e){this.Jr.error(e)},e.prototype.zr=function(e){this.onlineState=e;var t=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,e)&&(this.no(this.Xr),t=!0),t},e.prototype.eo=function(e,t){return!e.fromCache||!(this.options.so&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)},e.prototype.Zr=function(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges},e.prototype.no=function(e){e=ST.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.Yr=!0,this.Jr.next(e)},e}(),NT=function(){function e(e,t){this.payload=e,this.byteLength=t}return e.prototype.io=function(){return"metadata"in this.payload},e}(),kT=function(){function e(e){this.R=e}return e.prototype.qn=function(e){return Uv(this.R,e)},e.prototype.Un=function(e){return e.metadata.exists?qv(this.R,e.document,!1):Mg.newNoDocument(this.qn(e.metadata.name),this.Qn(e.metadata.readTime))},e.prototype.Qn=function(e){return Pv(e)},e}();!function(){function e(e,t,n){this.ro=e,this.localStore=t,this.R=n,this.queries=[],this.documents=[],this.progress=function(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(e)}e.prototype.oo=function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null},e.prototype.co=function(e){for(var t=new Map,n=new kT(this.R),r=0,i=e;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,c=o.metadata.queries;a<c.length;a++){var u=c[a],l=(t.get(u)||mv()).add(s);t.set(u,l)}}return t},e.prototype.complete=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e,t,n,r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return[4,cS(this.localStore,new kT(this.R),this.documents,this.ro.id)];case 1:e=o.sent(),t=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,uS(this.localStore,i=r[n],t.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new HE(Object.assign({},this.progress),e))]}})})}}();var DT=function(e){this.key=e},PT=function(e){this.key=e},LT=function(){function e(e,t){this.query=e,this.uo=t,this.ao=null,this.current=!1,this.ho=mv(),this.mutatedKeys=mv(),this.lo=v_(e),this.fo=new yT(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(e,t){var n=this,r=t?t.mo:new ET,i=t?t.fo:this.fo,o=t?t.mutatedKeys:this.mutatedKeys,s=i,a=!1,c=s_(this.query)&&i.size===this.query.limit?i.last():null,u=a_(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(function(e,t){var l=i.get(e),h=__(n.query,t)?t:null,d=!!l&&n.mutatedKeys.has(l.key),p=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;l&&h?l.data.isEqual(h.data)?d!==p&&(r.track({type:3,doc:h}),f=!0):n.yo(l,h)||(r.track({type:2,doc:h}),f=!0,(c&&n.lo(h,c)>0||u&&n.lo(h,u)<0)&&(a=!0)):!l&&h?(r.track({type:0,doc:h}),f=!0):l&&!h&&(r.track({type:1,doc:l}),f=!0,(c||u)&&(a=!0)),f&&(h?(s=s.add(h),o=p?o.add(e):o.delete(e)):(s=s.delete(e),o=o.delete(e)))}),s_(this.query)||a_(this.query))for(;s.size>this.query.limit;){var l=s_(this.query)?s.last():s.first();s=s.delete(l.key),o=o.delete(l.key),r.track({type:1,doc:l})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},e.prototype.yo=function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations},e.prototype.applyChanges=function(e,t,n){var r=this,i=this.fo;this.fo=e.fo,this.mutatedKeys=e.mutatedKeys;var o=e.mo.jr();o.sort(function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Hm()}};return n(e)-n(t)}(e.type,t.type)||r.lo(e.doc,t.doc)}),this.po(n);var s=t?this.Eo():[],a=0===this.ho.size&&this.current?1:0,c=a!==this.ao;return this.ao=a,0!==o.length||c?{snapshot:new ST(this.query,e.fo,i,o,e.mutatedKeys,0===a,c,!1),To:s}:{To:s}},e.prototype.zr=function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({fo:this.fo,mo:new ET,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(e){return!this.uo.has(e)&&!!this.fo.has(e)&&!this.fo.get(e).hasLocalMutations},e.prototype.po=function(e){var t=this;e&&(e.addedDocuments.forEach(function(e){return t.uo=t.uo.add(e)}),e.modifiedDocuments.forEach(function(e){}),e.removedDocuments.forEach(function(e){return t.uo=t.uo.delete(e)}),this.current=e.current)},e.prototype.Eo=function(){var e=this;if(!this.current)return[];var t=this.ho;this.ho=mv(),this.fo.forEach(function(t){e.Io(t.key)&&(e.ho=e.ho.add(t.key))});var n=[];return t.forEach(function(t){e.ho.has(t)||n.push(new PT(t))}),this.ho.forEach(function(e){t.has(e)||n.push(new DT(e))}),n},e.prototype.Ao=function(e){this.uo=e.Bn,this.ho=mv();var t=this._o(e.documents);return this.applyChanges(t,!0)},e.prototype.Ro=function(){return ST.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},e}(),xT=function(e,t,n){this.query=e,this.targetId=t,this.view=n},MT=function(e){this.key=e,this.bo=!1},UT=function(){function e(e,t,n,r,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new NE(function(e){return m_(e)},f_),this.Vo=new Map,this.So=new Set,this.Do=new rv(yg.comparator),this.Co=new Map,this.No=new hS,this.xo={},this.Fo=new Map,this.ko=vE.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),e}();function VT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,ac.Jh)(this,function(a){switch(a.label){case 0:return n=pb(e),(i=n.Po.get(t))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,nS(n.localStore,d_(t))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,FT(n,t,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&YS(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function FT(e,t,n,r){return(0,ac.mG)(this,void 0,void 0,function(){var i,o,s,a,c,u;return(0,ac.Jh)(this,function(l){switch(l.label){case 0:return e.Oo=function(t,n,r){return function(e,t,n,r){return(0,ac.mG)(this,void 0,void 0,function(){var i,o,s;return(0,ac.Jh)(this,function(a){switch(a.label){case 0:return(i=t.view._o(n)).Nn?[4,iS(e.localStore,t.query,!1).then(function(e){return t.view._o(e.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(t.targetId),s=t.view.applyChanges(i,e.isPrimaryClient,o),[2,($T(e,t.targetId,s.To),s.snapshot)]}})})}(e,t,n,r)},[4,iS(e.localStore,t,!0)];case 1:return i=l.sent(),o=new LT(t,i.Bn),s=o._o(i.documents),a=yv.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=o.applyChanges(s,e.isPrimaryClient,a),$T(e,n,c.To),u=new xT(t,n,o),[2,(e.Po.set(t,u),e.Vo.has(n)?e.Vo.get(n).push(t):e.Vo.set(n,[t]),c.snapshot)]}})})}function BT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return n=zm(e),r=n.Po.get(t),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(e){return!f_(e,t)})),void n.Po.delete(t))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,rS(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),QS(n.remoteStore,r.targetId),JT(n,r.targetId)}).catch(bE)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return JT(n,r.targetId),[4,rS(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function jT(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,ac.Jh)(this,function(a){switch(a.label){case 0:r=fb(e),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(e,t){var n,r=zm(e),i=$m.now(),o=t.reduce(function(e,t){return e.add(t.key)},mv());return r.persistence.runTransaction("Locally write mutations","readwrite",function(e){return r.Mn.pn(e,o).next(function(o){n=o;for(var s=[],a=0,c=t;a<c.length;a++){var u=c[a],l=G_(u,n.get(u.key));null!=l&&s.push(new z_(u.key,l,xg(l.value.mapValue),U_.exists(!0)))}return r._n.addMutationBatch(e,i,s,t)})}).then(function(e){return e.applyToLocalDocumentSet(n),{batchId:e.batchId,changes:n}})}(r.localStore,t)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(e,t,n){var r=e.xo[e.currentUser.toKey()];r||(r=new rv(Qm)),r=r.insert(t,n),e.xo[e.currentUser.toKey()]=r}(r,i.batchId,n),[4,tb(r,i.changes)];case 3:return a.sent(),[4,aT(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=vT(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function GT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:n=zm(e),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,ZE(n.localStore,t)];case 2:return r=i.sent(),t.targetChanges.forEach(function(e,t){var r=n.Co.get(t);r&&(Wm(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.bo=!0:e.modifiedDocuments.size>0?Wm(r.bo):e.removedDocuments.size>0&&(Wm(r.bo),r.bo=!1))}),[4,tb(n,r,t)];case 3:return i.sent(),[3,6];case 4:return[4,bE(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function qT(e,t,n){var r=zm(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(e,n){var r=n.view.zr(t);r.snapshot&&i.push(r.snapshot)}),function(e,t){var n=zm(e);n.onlineState=t;var r=!1;n.queries.forEach(function(e,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(t)&&(r=!0)}),r&&AT(n)}(r.eventManager,t),i.length&&r.vo._r(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function HT(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i,o,s,a,c;return(0,ac.Jh)(this,function(u){switch(u.label){case 0:return(r=zm(e)).sharedClientState.updateQueryState(t,"rejected",n),i=r.Co.get(t),(o=i&&i.key)?(s=(s=new rv(yg.comparator)).insert(o,Mg.newNoDocument(o,Zm.min())),a=mv().add(o),c=new vv(Zm.min(),new Map,new sv(Qm),s,a),[4,GT(r,c)]):[3,2];case 1:return u.sent(),r.Do=r.Do.remove(o),r.Co.delete(t),eb(r),[3,4];case 2:return[4,rS(r.localStore,t,!1).then(function(){return JT(r,t,n)}).catch(bE)];case 3:u.sent(),u.label=4;case 4:return[2]}})})}function WT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:n=zm(e),r=t.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,XE(n.localStore,t)];case 2:return i=o.sent(),QT(n,r,null),YT(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,tb(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,bE(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function zT(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:r=zm(e),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(e,t){var n=zm(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var r;return n._n.lookupMutationBatch(e,t).next(function(t){return Wm(null!==t),r=t.keys(),n._n.removeMutationBatch(e,t)}).next(function(){return n._n.performConsistencyCheck(e)}).next(function(){return n.Mn.pn(e,r)})})}(r.localStore,t)];case 2:return i=o.sent(),QT(r,t,n),YT(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),[4,tb(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,bE(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function KT(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o,s;return(0,ac.Jh)(this,function(a){switch(a.label){case 0:eT((n=zm(e)).remoteStore)||Bm("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(e){var t=zm(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(e){return t._n.getHighestUnacknowledgedBatchId(e)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void t.resolve()]:((i=n.Fo.get(r)||[]).push(t),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=vT(o,"Initialization of waitForPendingWrites() operation failed"),t.reject(s),[3,4];case 4:return[2]}})})}function YT(e,t){(e.Fo.get(t)||[]).forEach(function(e){e.resolve()}),e.Fo.delete(t)}function QT(e,t,n){var r=zm(e),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(t);o&&(n?o.reject(n):o.resolve(),i=i.remove(t)),r.xo[r.currentUser.toKey()]=i}}function JT(e,t,n){void 0===n&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(t){e.No.containsKey(t)||XT(e,t)})}function XT(e,t){e.So.delete(t.path.canonicalString());var n=e.Do.get(t);null!==n&&(QS(e.remoteStore,n),e.Do=e.Do.remove(t),e.Co.delete(n),eb(e))}function $T(e,t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof DT?(e.No.addReference(o.key,t),ZT(e,o)):o instanceof PT?(Bm("SyncEngine","Document no longer in limbo: "+o.key),e.No.removeReference(o.key,t),e.No.containsKey(o.key)||XT(e,o.key)):Hm()}}function ZT(e,t){var n=t.key,r=n.path.canonicalString();e.Do.get(n)||e.So.has(r)||(Bm("SyncEngine","New document in limbo: "+n),e.So.add(r),eb(e))}function eb(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var n=new yg(ig.fromString(t)),r=e.ko.next();e.Co.set(r,new MT(n)),e.Do=e.Do.insert(n,r),YS(e.remoteStore,new Hy(d_(o_(n.path)),r,2,xm.o))}}function tb(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i,o,s;return(0,ac.Jh)(this,function(a){switch(a.label){case 0:return r=zm(e),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(e,a){s.push(r.Oo(a,t,n).then(function(e){if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);var t=zE.Pn(a.targetId,e);o.push(t)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,c,u;return(0,ac.Jh)(this,function(l){switch(l.label){case 0:n=zm(e),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(e){return Ny.forEach(t,function(t){return Ny.forEach(t.bn,function(r){return n.persistence.referenceDelegate.addReference(e,t.targetId,r)}).next(function(){return Ny.forEach(t.vn,function(r){return n.persistence.referenceDelegate.removeReference(e,t.targetId,r)})})})})];case 2:return l.sent(),[3,4];case 3:if(!xy(r=l.sent()))throw r;return Bm("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=t;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(c=n.Fn.get(a),u=c.withLastLimboFreeSnapshotVersion(c.snapshotVersion),n.Fn=n.Fn.insert(a,u));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function nb(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return(n=zm(e)).currentUser.isEqual(t)?[3,3]:(Bm("SyncEngine","User change. New user:",t.toKey()),[4,JE(n.localStore,t)]);case 1:return r=i.sent(),n.currentUser=t,function(e,t){e.Fo.forEach(function(e){e.forEach(function(e){e.reject(new Um(Mm.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Fo.clear()}(n),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),[4,tb(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function rb(e,t){var n=zm(e),r=n.Co.get(t);if(r&&r.bo)return mv().add(r.key);var i=mv(),o=n.Vo.get(t);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var c=n.Po.get(a[s]);i=i.unionWith(c.view.wo)}return i}function ib(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return[4,iS((n=zm(e)).localStore,t.query,!0)];case 1:return r=o.sent(),i=t.view.Ao(r),[2,(n.isPrimaryClient&&$T(n,t.targetId,i.To),i)]}})})}function ob(e){return(0,ac.mG)(this,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){return[2,sS((t=zm(e)).localStore).then(function(e){return tb(t,e)})]})})}function sb(e,t,n,r){return(0,ac.mG)(this,void 0,void 0,function(){var i,o;return(0,ac.Jh)(this,function(s){switch(s.label){case 0:return[4,function(e,t){var n=zm(e),r=zm(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return r.jt(e,t).next(function(t){return t?n.Mn.pn(e,t):Ny.resolve(null)})})}((i=zm(e)).localStore,t)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,aT(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(QT(i,t,r||null),YT(i,t),function(e,t){zm(zm(e)._n).Gt(t)}(i.localStore,t)):Hm(),s.label=4;case 4:return[4,tb(i,o)];case 5:return s.sent(),[3,7];case 6:Bm("SyncEngine","Cannot apply mutation batch with id: "+t),s.label=7;case 7:return[2]}})})}function ab(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,c;return(0,ac.Jh)(this,function(u){switch(u.label){case 0:return pb(n=zm(e)),fb(n),!0!==t||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,cb(n,r.toArray())]);case 1:return i=u.sent(),n.$o=!0,[4,fT(n.remoteStore,!0)];case 2:for(u.sent(),o=0,s=i;o<s.length;o++)YS(n.remoteStore,s[o]);return[3,7];case 3:return!1!==t||!1===n.$o?[3,7]:(a=[],c=Promise.resolve(),n.Vo.forEach(function(e,t){n.sharedClientState.isLocalQueryTarget(t)?a.push(t):c=c.then(function(){return JT(n,t),rS(n.localStore,t,!0)}),QS(n.remoteStore,t)}),[4,c]);case 4:return u.sent(),[4,cb(n,a)];case 5:return u.sent(),function(e){var t=zm(e);t.Co.forEach(function(e,n){QS(t.remoteStore,n)}),t.No.ts(),t.Co=new Map,t.Do=new rv(yg.comparator)}(n),n.$o=!1,[4,fT(n.remoteStore,!1)];case 6:u.sent(),u.label=7;case 7:return[2]}})})}function cb(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a,c,u,l,h,d,p,f;return(0,ac.Jh)(this,function(m){switch(m.label){case 0:n=zm(e),r=[],i=[],o=0,s=t,m.label=1;case 1:return o<s.length?(c=void 0,(u=n.Vo.get(a=s[o]))&&0!==u.length?[4,nS(n.localStore,d_(u[0]))]:[3,7]):[3,13];case 2:c=m.sent(),l=0,h=u,m.label=3;case 3:return l<h.length?(d=n.Po.get(h[l]),[4,ib(n,d)]):[3,6];case 4:(p=m.sent()).snapshot&&i.push(p.snapshot),m.label=5;case 5:return l++,[3,3];case 6:return[3,11];case 7:return[4,oS(n.localStore,a)];case 8:return f=m.sent(),[4,nS(n.localStore,f)];case 9:return c=m.sent(),[4,FT(n,ub(f),a,!1)];case 10:m.sent(),m.label=11;case 11:r.push(c),m.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function ub(e){return i_(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function lb(e){var t=zm(e);return zm(zm(t.localStore).persistence).fn()}function hb(e,t,n,r){return(0,ac.mG)(this,void 0,void 0,function(){var i,o,s;return(0,ac.Jh)(this,function(a){switch(a.label){case 0:return(i=zm(e)).$o?(Bm("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(t))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,sS(i.localStore)];case 3:return o=a.sent(),s=vv.createSynthesizedRemoteEventForCurrentChange(t,"current"===n),[4,tb(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,rS(i.localStore,t,!0)];case 6:return a.sent(),JT(i,t,r),[3,8];case 7:Hm(),a.label=8;case 8:return[2]}})})}function db(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i,o,s,a,c,u,l,h;return(0,ac.Jh)(this,function(d){switch(d.label){case 0:if(!(r=pb(e)).$o)return[3,10];i=0,o=t,d.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Bm("SyncEngine","Adding an already active target "+s),[3,5]):[4,oS(r.localStore,s)]:[3,6];case 2:return a=d.sent(),[4,nS(r.localStore,a)];case 3:return c=d.sent(),[4,FT(r,ub(a),c.targetId,!1)];case 4:d.sent(),YS(r.remoteStore,c),d.label=5;case 5:return i++,[3,1];case 6:u=function(e){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return r.Vo.has(e)?[4,rS(r.localStore,e,!1).then(function(){QS(r.remoteStore,e),JT(r,e)}).catch(bE)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},l=0,h=n,d.label=7;case 7:return l<h.length?[5,u(h[l])]:[3,10];case 8:d.sent(),d.label=9;case 9:return l++,[3,7];case 10:return[2]}})})}function pb(e){var t=zm(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=GT.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=rb.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=HT.bind(null,t),t.vo._r=IT.bind(null,t.eventManager),t.vo.Mo=CT.bind(null,t.eventManager),t}function fb(e){var t=zm(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=WT.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=zT.bind(null,t),t}var mb=function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(e){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return this.R=VS(e.databaseInfo.databaseId),this.sharedClientState=this.Bo(e),this.persistence=this.qo(e),[4,this.persistence.start()];case 1:return t.sent(),this.gcScheduler=this.Uo(e),this.localStore=this.Qo(e),[2]}})})},e.prototype.Uo=function(e){return null},e.prototype.Qo=function(e){return QE(this.persistence,new KE,e.initialUser,this.R)},e.prototype.qo=function(e){return new _S(yS.bs,this.R)},e.prototype.Bo=function(e){return new NS},e.prototype.terminate=function(){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){switch(e.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return e.sent(),[4,this.persistence.shutdown()];case 2:return e.sent(),[2]}})})},e}(),gb=function(e){function t(t,n,r){var i=this;return(i=e.call(this)||this).Ko=t,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,ac.ZT)(t,e),t.prototype.initialize=function(t){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return[4,e.prototype.initialize.call(this,t)];case 1:return n.sent(),[4,aS(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,t)];case 3:return n.sent(),[4,fb(this.Ko.syncEngine)];case 4:return n.sent(),[4,aT(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},t.prototype.Qo=function(e){return QE(this.persistence,new KE,e.initialUser,this.R)},t.prototype.Uo=function(e){return new IE(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue)},t.prototype.qo=function(e){var t=qE(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?lE.withCacheSize(this.cacheSizeBytes):lE.DEFAULT;return new BE(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,MS(),US(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(e){return new NS},t}(mb),_b=function(e){function t(t,n){var r=this;return(r=e.call(this,t,n,!1)||this).Ko=t,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,ac.ZT)(t,e),t.prototype.initialize=function(t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r=this;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return[4,e.prototype.initialize.call(this,t)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof OS?(this.sharedClientState.syncEngine={ui:sb.bind(null,n),ai:hb.bind(null,n),hi:db.bind(null,n),fn:lb.bind(null,n),ci:ob.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(e){return(0,ac.mG)(r,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return[4,ab(this.Ko.syncEngine,e)];case 1:return t.sent(),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},t.prototype.Bo=function(e){var t=MS();if(!OS.yt(t))throw new Um(Mm.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=qE(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new OS(t,e.asyncQueue,n,e.clientId,e.initialUser)},t}(gb),vb=function(){function e(){}return e.prototype.initialize=function(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n=this;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return qT(n.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=nb.bind(null,this.syncEngine),[4,fT(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},e.prototype.createEventManager=function(e){return new bT},e.prototype.createDatastore=function(e){var t=VS(e.databaseInfo.databaseId),n=new xS(e.databaseInfo);return function(e,t,n){return new qS(e,t,n)}(e.credentials,n,t)},e.prototype.createRemoteStore=function(e){var t,n,r,i,o,s=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return qT(s.syncEngine,e,0)},o=DS.yt()?new DS:new kS,new WS(t,n,r,i,o)},e.prototype.createSyncEngine=function(e,t){return function(e,t,n,r,i,o,s){var a=new UT(e,t,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)},e.prototype.terminate=function(){return function(e){return(0,ac.mG)(this,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return t=zm(e),Bm("RemoteStore","RemoteStore shutting down."),t.Or.add(5),[4,KS(t)];case 1:return n.sent(),t.Lr.shutdown(),t.Br.set("Unknown"),[2]}})})}(this.remoteStore)},e}(),yb=function(){function e(e){this.observer=e,this.muted=!1}return e.prototype.next=function(e){this.observer.next&&this.jo(this.observer.next,e)},e.prototype.error=function(e){this.observer.error?this.jo(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(e,t){var n=this;this.muted||setTimeout(function(){n.muted||e(t)},0)},e}(),Eb=(function(){function e(e,t){var n=this;this.Go=e,this.R=t,this.metadata=new Oy,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(e){e&&e.io()?n.metadata.resolve(e.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==e?void 0:e.payload)))},function(e){return n.metadata.reject(e)})}e.prototype.close=function(){return this.Go.cancel()},e.prototype.getMetadata=function(){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){return[2,this.metadata.promise]})})},e.prototype.Lo=function(){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){switch(e.label){case 0:return[4,this.getMetadata()];case 1:return[2,(e.sent(),this.Ho())]}})})},e.prototype.Ho=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e,t,n,r;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(e=i.sent())?[2,null]:(t=this.zo.decode(e),n=Number(t),isNaN(n)&&this.Yo("length string ("+t+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new NT(JSON.parse(r),e.length+n)]}})})},e.prototype.Zo=function(){return this.buffer.findIndex(function(e){return e==="{".charCodeAt(0)})},e.prototype.Jo=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e,t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((e=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),t=this.buffer.slice(0,e),[2,(this.buffer=this.buffer.slice(e),t)])}})})},e.prototype.Xo=function(e){return(0,ac.mG)(this,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return this.buffer.length<e?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return t=this.zo.decode(this.buffer.slice(0,e)),[2,(this.buffer=this.buffer.slice(e),t)]}})})},e.prototype.Yo=function(e){throw this.Go.cancel(),new Error("Invalid bundle format: "+e)},e.prototype.tc=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e,t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(e=n.sent()).done||((t=new Uint8Array(this.buffer.length+e.value.length)).set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t),[2,e.done]}})})}}(),function(){function e(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(e){return(0,ac.mG)(this,void 0,void 0,function(){var t,n=this;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Um(Mm.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i,o,s,a;return(0,ac.Jh)(this,function(c){switch(c.label){case 0:return n=zm(e),r=Bv(n.R)+"/documents",i={documents:t.map(function(e){return Mv(n.R,e)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=c.sent(),s=new Map,o.forEach(function(e){var t=function(e,t){return"found"in t?function(e,t){Wm(!!t.found);var n=Uv(e,t.found.name),r=Pv(t.found.updateTime),i=new Lg({mapValue:{fields:t.found.fields}});return Mg.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Wm(!!t.missing),Wm(!!t.readTime);var n=Uv(e,t.missing),r=Pv(t.readTime);return Mg.newNoDocument(n,r)}(e,t):Hm()}(n.R,e);s.set(t.key.toString(),t)}),a=[],[2,(t.forEach(function(e){var t=s.get(e.toString());Wm(!!t),a.push(t)}),a)]}})})}(this.datastore,e)];case 1:return[2,((t=r.sent()).forEach(function(e){return n.recordVersion(e)}),t)]}})})},e.prototype.set=function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())},e.prototype.update=function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())},e.prototype.delete=function(e){this.write(new $_(e,this.precondition(e))),this.writtenDocs.add(e.toString())},e.prototype.commit=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e,t=this;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return e=this.readVersions,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(e,n){var r=yg.fromPath(n);t.mutations.push(new Z_(r,t.precondition(r)))}),[4,function(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return n=zm(e),r=Bv(n.R)+"/documents",i={writes:t.map(function(e){return Hv(n.R,e)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},e.prototype.recordVersion=function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Hm();t=Zm.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Um(Mm.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)},e.prototype.precondition=function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?U_.updateTime(t):U_.none()},e.prototype.preconditionForUpdate=function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Zm.min()))throw new Um(Mm.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return U_.updateTime(t)}return U_.exists(!0)},e.prototype.write=function(e){this.ensureCommitNotCalled(),this.mutations.push(e)},e.prototype.ensureCommitNotCalled=function(){},e}()),Sb=function(){function e(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new FS(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.nc()},e.prototype.nc=function(){var e=this;this.Zi.ji(function(){return(0,ac.mG)(e,void 0,void 0,function(){var e,t,n=this;return(0,ac.Jh)(this,function(r){return e=new Eb(this.datastore),(t=this.sc(e))&&t.then(function(t){n.asyncQueue.enqueueAndForget(function(){return e.commit().then(function(){n.deferred.resolve(t)}).catch(function(e){n.ic(e)})})}).catch(function(e){n.ic(e)}),[2]})})})},e.prototype.sc=function(e){try{var t=this.updateFunction(e);return!gg(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}},e.prototype.ic=function(e){var t=this;this.ec>0&&this.rc(e)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return t.nc(),Promise.resolve()})):this.deferred.reject(e)},e.prototype.rc=function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!tv(t)}return!1},e}(),Tb=function(){function e(e,t,n){var r=this;this.credentials=e,this.asyncQueue=t,this.databaseInfo=n,this.user=ES.UNAUTHENTICATED,this.clientId=Ym.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(t,function(e){return(0,ac.mG)(r,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return Bm("FirestoreClient","Received user=",e.uid),[4,this.credentialListener(e)];case 1:return t.sent(),this.user=e,[2]}})})})}return e.prototype.getConfiguration=function(){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},e.prototype.setCredentialChangeListener=function(e){this.credentialListener=e},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Um(Mm.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new Oy;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return(0,ac.mG)(e,void 0,void 0,function(){var e,n;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),t.resolve(),[3,6];case 5:return e=r.sent(),n=vT(e,"Failed to shutdown persistence"),t.reject(n),[3,6];case 6:return[2]}})})}),t.promise},e}();function bb(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r,i=this;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return e.asyncQueue.verifyOperationInProgress(),Bm("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return n=o.sent(),[4,t.initialize(n)];case 2:return o.sent(),r=n.initialUser,e.setCredentialChangeListener(function(e){return(0,ac.mG)(i,void 0,void 0,function(){return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return r.isEqual(e)?[3,2]:[4,JE(t.localStore,e)];case 1:n.sent(),r=e,n.label=2;case 2:return[2]}})})}),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=t,[2]}})})}function wb(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,Rb(e)];case 1:return n=i.sent(),Bm("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return r=i.sent(),[4,t.initialize(n,r)];case 3:return i.sent(),e.setCredentialChangeListener(function(e){return function(e,t){return(0,ac.mG)(this,void 0,void 0,function(){var n,r;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return(n=zm(e)).asyncQueue.verifyOperationInProgress(),Bm("RemoteStore","RemoteStore received new credentials"),r=eT(n),n.Or.add(3),[4,KS(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(t)];case 2:return i.sent(),n.Or.delete(3),[4,zS(n)];case 3:return i.sent(),[2]}})})}(t.remoteStore,e)}),e.onlineComponents=t,[2]}})})}function Rb(e){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(Bm("FirestoreClient","Using default OfflineComponentProvider"),[4,bb(e,new mb)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function Ib(e){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(Bm("FirestoreClient","Using default OnlineComponentProvider"),[4,wb(e,new vb)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function Cb(e){return Rb(e).then(function(e){return e.persistence})}function Ab(e){return Rb(e).then(function(e){return e.localStore})}function Ob(e){return Ib(e).then(function(e){return e.remoteStore})}function Nb(e){return Ib(e).then(function(e){return e.syncEngine})}function kb(e){return(0,ac.mG)(this,void 0,void 0,function(){var t,n;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return[4,Ib(e)];case 1:return t=r.sent(),[2,((n=t.eventManager).onListen=VT.bind(null,t.syncEngine),n.onUnlisten=BT.bind(null,t.syncEngine),n)]}})})}function Db(e,t,n){var r=this;void 0===n&&(n={});var i=new Oy;return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(r,void 0,void 0,function(){var r;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return r=function(e,t,n,r,i){var o=new yb({next:function(o){t.enqueueAndForget(function(){return RT(e,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Um(Mm.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Um(Mm.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(e){return i.reject(e)}}),s=new OT(o_(n.path),o,{includeMetadataChanges:!0,so:!0});return wT(e,s)},[4,kb(e)];case 1:return[2,r.apply(void 0,[o.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}function Pb(e,t,n){var r=this;void 0===n&&(n={});var i=new Oy;return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(r,void 0,void 0,function(){var r;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return r=function(e,t,n,r,i){var o=new yb({next:function(n){t.enqueueAndForget(function(){return RT(e,s)}),n.fromCache&&"server"===r.source?i.reject(new Um(Mm.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),s=new OT(n,o,{includeMetadataChanges:!0,so:!0});return wT(e,s)},[4,kb(e)];case 1:return[2,r.apply(void 0,[o.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}var Lb=function(e,t,n,r,i,o,s,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},xb=function(){function e(e,t){this.projectId=e,this.database=t||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e}(),Mb=new Map,Ub=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},Vb=function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(e,t){this.changeListener=t,e.enqueueRetryable(function(){return t(ES.UNAUTHENTICATED)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Fb=function(){function e(e){this.token=e,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable(function(){return t(n.token.user)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Bb=function(){function e(e){var t=this;this.currentUser=ES.UNAUTHENTICATED,this.oc=new Oy,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){t.cc++,t.currentUser=t.ac(),t.oc.resolve(),t.changeListener&&t.asyncQueue.enqueueRetryable(function(){return t.changeListener(t.currentUser)})};var n=function(e){Bm("FirebaseCredentialsProvider","Auth detected"),t.auth=e,t.auth.addAuthTokenListener(t.uc)};e.onInit(function(e){return n(e)}),setTimeout(function(){if(!t.auth){var r=e.getImmediate({optional:!0});r?n(r):(Bm("FirebaseCredentialsProvider","Auth not yet detected"),t.oc.resolve())}},0)}return e.prototype.getToken=function(){var e=this,t=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return e.cc!==t?(Bm("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(Wm("string"==typeof n.accessToken),new Ub(n.accessToken,e.currentUser)):null}):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(e,t){var n=this;this.asyncQueue=e,this.asyncQueue.enqueueRetryable(function(){return(0,ac.mG)(n,void 0,void 0,function(){return(0,ac.Jh)(this,function(e){switch(e.label){case 0:return[4,this.oc.promise];case 1:return e.sent(),[4,t(this.currentUser)];case 2:return e.sent(),this.changeListener=t,[2]}})})})},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},e.prototype.ac=function(){var e=this.auth&&this.auth.getUid();return Wm(null===e||"string"==typeof e),new ES(e)},e}(),jb=function(){function e(e,t,n){this.hc=e,this.lc=t,this.fc=n,this.type="FirstParty",this.user=ES.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var e={"X-Goog-AuthUser":this.lc},t=this.hc.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.fc&&(e["X-Goog-Iam-Authorization-Token"]=this.fc),e},enumerable:!1,configurable:!0}),e}(),Gb=function(){function e(e,t,n){this.hc=e,this.lc=t,this.fc=n}return e.prototype.getToken=function(){return Promise.resolve(new jb(this.hc,this.lc,this.fc))},e.prototype.setChangeListener=function(e,t){e.enqueueRetryable(function(){return t(ES.FIRST_PARTY)})},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e}();function qb(e,t,n){if(!n)throw new Um(Mm.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function Hb(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Um(Mm.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function Wb(e,t,n,r){if(!0===t&&!0===r)throw new Um(Mm.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function zb(e){if(!yg.isDocumentKey(e))throw new Um(Mm.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function Kb(e){if(yg.isDocumentKey(e))throw new Um(Mm.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function Yb(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&t.length>1)return t[1]}return null}(e);return t?"a custom "+t+" object":"an object"}return"function"==typeof e?"a function":Hm()}function Qb(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Um(Mm.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Yb(e);throw new Um(Mm.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+n)}return e}function Jb(e,t){if(t<=0)throw new Um(Mm.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}var Xb=function(){function e(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new Um(Mm.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Um(Mm.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Wb("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams},e}(),$b=function(){function e(e,t){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Xb({}),this._settingsFrozen=!1,e instanceof xb?(this._databaseId=e,this._credentials=new Vb):(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Um(Mm.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xb(e.options.projectId)}(e),this._credentials=new Bb(t))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new Um(Mm.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(e){if(this._settingsFrozen)throw new Um(Mm.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Xb(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new Vb;switch(e.type){case"gapi":var t=e.client;return Wm(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Gb(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Um(Mm.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return(e=Mb.get(this))&&(Bm("ComponentProvider","Removing Datastore"),Mb.delete(this),e.terminate()),Promise.resolve();var e},e}(),Zb=function(){function e(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new tw(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e}(),ew=function(){function e(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e}(),tw=function(e){function t(t,n,r){var i=this;return(i=e.call(this,t,n,o_(r))||this)._path=r,i.type="collection",i}return(0,ac.ZT)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._path.popLast();return e.isEmpty()?null:new Zb(this.firestore,null,new yg(e))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._path)},t}(ew);function nw(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=(0,wh.m9)(e),qb("collection","path",t),e instanceof $b)return Kb(n=ig.fromString.apply(ig,(0,ac.ev)([t],r))),new tw(e,null,n);if(!(e instanceof Zb||e instanceof tw))throw new Um(Mm.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Kb(n=ig.fromString.apply(ig,(0,ac.ev)([e.path],r)).child(ig.fromString(t))),new tw(e.firestore,null,n)}function rw(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=(0,wh.m9)(e),1===arguments.length&&(t=Ym.u()),qb("doc","path",t),e instanceof $b)return zb(n=ig.fromString.apply(ig,(0,ac.ev)([t],r))),new Zb(e,null,new yg(n));if(!(e instanceof Zb||e instanceof tw))throw new Um(Mm.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return zb(n=e._path.child(ig.fromString.apply(ig,(0,ac.ev)([t],r)))),new Zb(e.firestore,e instanceof tw?e.converter:null,new yg(n))}function iw(e,t){return e=(0,wh.m9)(e),t=(0,wh.m9)(t),(e instanceof Zb||e instanceof tw)&&(t instanceof Zb||t instanceof tw)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function ow(e,t){return e=(0,wh.m9)(e),t=(0,wh.m9)(t),e instanceof ew&&t instanceof ew&&e.firestore===t.firestore&&f_(e._query,t._query)&&e.converter===t.converter}var sw=function(){function e(){var e=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new FS(this,"async_queue_retry"),this.Tc=function(){var t=US();t&&Bm("AsyncQueue","Visibility state changed to "+t.visibilityState),e.Zi.Gi()};var t=US();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Tc)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(e){this.enqueue(e)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(e){this.Ic(),this.Ac(e)},e.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var e=US();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Tc)}},e.prototype.enqueue=function(e){return this.Ic(),this._c?new Promise(function(e){}):this.Ac(e)},e.prototype.enqueueRetryable=function(e){var t=this;this.enqueueAndForget(function(){return t.wc.push(e),t.Rc()})},e.prototype.Rc=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e,t=this;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!xy(e=n.sent()))throw e;return Bm("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return t.Rc()}),n.label=5;case 5:return[2]}})})},e.prototype.Ac=function(e){var t=this,n=this.dc.then(function(){return t.gc=!0,e().catch(function(e){throw t.yc=e,t.gc=!1,jm("INTERNAL UNHANDLED ERROR: ",function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(function(e){return t.gc=!1,e})});return this.dc=n,n},e.prototype.enqueueAfterDelay=function(e,t,n){var r=this;this.Ic(),this.Ec.indexOf(e)>-1&&(t=0);var i=_T.createAndSchedule(this,e,t,n,function(e){return r.bc(e)});return this.mc.push(i),i},e.prototype.Ic=function(){this.yc&&Hm()},e.prototype.verifyOperationInProgress=function(){},e.prototype.vc=function(){return(0,ac.mG)(this,void 0,void 0,function(){var e;return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return[4,e=this.dc];case 1:t.sent(),t.label=2;case 2:if(e!==this.dc)return[3,0];t.label=3;case 3:return[2]}})})},e.prototype.Pc=function(e){for(var t=0,n=this.mc;t<n.length;t++)if(n[t].timerId===e)return!0;return!1},e.prototype.Vc=function(e){var t=this;return this.vc().then(function(){t.mc.sort(function(e,t){return e.targetTimeMs-t.targetTimeMs});for(var n=0,r=t.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==e&&i.timerId===e)break}return t.vc()})},e.prototype.Sc=function(e){this.Ec.push(e)},e.prototype.bc=function(e){var t=this.mc.indexOf(e);this.mc.splice(t,1)},e}();function aw(e){return function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=e,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(e)}!function(){function e(){this._progressObserver={},this._taskCompletionResolver=new Oy,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}e.prototype.onProgress=function(e,t,n){this._progressObserver={next:e,error:t,complete:n}},e.prototype.catch=function(e){return this._taskCompletionResolver.promise.catch(e)},e.prototype.then=function(e,t){return this._taskCompletionResolver.promise.then(e,t)},e.prototype._completeWith=function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)},e.prototype._failWith=function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)},e.prototype._updateProgress=function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}();var cw=function(e){function t(t,n){var r=this;return(r=e.call(this,t,n)||this).type="firestore",r._queue=new sw,r._persistenceKey="name"in t?t.name:"[DEFAULT]",r}return(0,ac.ZT)(t,e),t.prototype._terminate=function(){return this._firestoreClient||lw(this),this._firestoreClient.terminate()},t}($b);function uw(e){return e._firestoreClient||lw(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function lw(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new Lb(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Tb(e._credentials,e._queue,r)}function hw(e,t,n){var r=this,i=new Oy;return e.asyncQueue.enqueue(function(){return(0,ac.mG)(r,void 0,void 0,function(){var r;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,bb(e,n)];case 1:return o.sent(),[4,wb(e,t)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(e){return"FirebaseError"===e.name?e.code===Mm.FAILED_PRECONDITION||e.code===Mm.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function dw(e){if(e._initialized||e._terminated)throw new Um(Mm.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var pw=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=0;n<e.length;++n)if(0===e[n].length)throw new Um(Mm.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new sg(e)}return e.prototype.isEqual=function(e){return this._internalPath.isEqual(e._internalPath)},e}(),fw=function(){function e(e){this._byteString=e}return e.fromBase64String=function(t){try{return new e(cg.fromBase64String(t))}catch(t){throw new Um(Mm.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}},e.fromUint8Array=function(t){return new e(cg.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(e){return this._byteString.isEqual(e._byteString)},e}(),mw=function(e){this._methodName=e},gw=function(){function e(e,t){if(!isFinite(e)||e<-90||e>90)throw new Um(Mm.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Um(Mm.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(e){return this._lat===e._lat&&this._long===e._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(e){return Qm(this._lat,e._lat)||Qm(this._long,e._long)},e}(),_w=/^__.*__$/,vw=function(){function e(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}return e.prototype.toMutation=function(e,t){return null!==this.fieldMask?new z_(e,this.data,this.fieldMask,t,this.fieldTransforms):new W_(e,this.data,t,this.fieldTransforms)},e}(),yw=function(){function e(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}return e.prototype.toMutation=function(e,t){return new z_(e,this.data,this.fieldMask,t,this.fieldTransforms)},e}();function Ew(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Hm()}}var Sw=function(){function e(e,t,n,r,i,o){this.settings=e,this.databaseId=t,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),e.prototype.Nc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.xc=function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Nc({path:n,Fc:!1});return r.kc(e),r},e.prototype.$c=function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},e.prototype.Oc=function(e){return this.Nc({path:void 0,Fc:!0})},e.prototype.Mc=function(e){return jw(e,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},e.prototype.contains=function(e){return void 0!==this.fieldMask.find(function(t){return e.isPrefixOf(t)})||void 0!==this.fieldTransforms.find(function(t){return e.isPrefixOf(t.field)})},e.prototype.Dc=function(){if(this.path)for(var e=0;e<this.path.length;e++)this.kc(this.path.get(e))},e.prototype.kc=function(e){if(0===e.length)throw this.Mc("Document fields must not be empty");if(Ew(this.Cc)&&_w.test(e))throw this.Mc('Document fields cannot begin and end with "__"')},e}(),Tw=function(){function e(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.R=n||VS(e)}return e.prototype.qc=function(e,t,n,r){return void 0===r&&(r=!1),new Sw({Cc:e,methodName:t,Bc:n,path:sg.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},e}();function bw(e){var t=e._freezeSettings(),n=VS(e._databaseId);return new Tw(e._databaseId,!!t.ignoreUndefinedProperties,n)}function ww(e,t,n,r,i,o){void 0===o&&(o={});var s=e.qc(o.merge||o.mergeFields?2:0,t,n,i);Uw("Data must be an object, but it was:",s,r);var a,c,u=xw(r,s);if(o.merge)a=new ag(s.fieldMask),c=s.fieldTransforms;else if(o.mergeFields){for(var l=[],h=0,d=o.mergeFields;h<d.length;h++){var p=Vw(t,d[h],n);if(!s.contains(p))throw new Um(Mm.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Gw(l,p)||l.push(p)}a=new ag(l),c=s.fieldTransforms.filter(function(e){return a.covers(e.field)})}else a=null,c=s.fieldTransforms;return new vw(new Lg(u),a,c)}var Rw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,ac.ZT)(t,e),t.prototype._toFieldTransform=function(e){if(2!==e.Cc)throw e.Mc(1===e.Cc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return e.fieldMask.push(e.path),null},t.prototype.isEqual=function(e){return e instanceof t},t}(mw);function Iw(e,t,n){return new Sw({Cc:3,Bc:t.settings.Bc,methodName:e._methodName,Fc:n},t.databaseId,t.R,t.ignoreUndefinedProperties)}var Cw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,ac.ZT)(t,e),t.prototype._toFieldTransform=function(e){return new x_(e.path,new C_)},t.prototype.isEqual=function(e){return e instanceof t},t}(mw),Aw=function(e){function t(t,n){var r=this;return(r=e.call(this,t)||this).Uc=n,r}return(0,ac.ZT)(t,e),t.prototype._toFieldTransform=function(e){var t=Iw(this,e,!0),n=this.Uc.map(function(e){return Lw(e,t)}),r=new A_(n);return new x_(e.path,r)},t.prototype.isEqual=function(e){return this===e},t}(mw),Ow=function(e){function t(t,n){var r=this;return(r=e.call(this,t)||this).Uc=n,r}return(0,ac.ZT)(t,e),t.prototype._toFieldTransform=function(e){var t=Iw(this,e,!0),n=this.Uc.map(function(e){return Lw(e,t)}),r=new N_(n);return new x_(e.path,r)},t.prototype.isEqual=function(e){return this===e},t}(mw),Nw=function(e){function t(t,n){var r=this;return(r=e.call(this,t)||this).Qc=n,r}return(0,ac.ZT)(t,e),t.prototype._toFieldTransform=function(e){var t=new D_(e.R,T_(e.R,this.Qc));return new x_(e.path,t)},t.prototype.isEqual=function(e){return this===e},t}(mw);function kw(e,t,n,r){var i=e.qc(1,t,n);Uw("Data must be an object, but it was:",i,r);var o=[],s=Lg.empty();tg(r,function(e,r){var a=Bw(t,e,n);r=(0,wh.m9)(r);var c=i.$c(a);if(r instanceof Rw)o.push(a);else{var u=Lw(r,c);null!=u&&(o.push(a),s.set(a,u))}});var a=new ag(o);return new yw(s,a,i.fieldTransforms)}function Dw(e,t,n,r,i,o){var s=e.qc(1,t,n),a=[Vw(t,r,n)],c=[i];if(o.length%2!=0)throw new Um(Mm.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<o.length;u+=2)a.push(Vw(t,o[u])),c.push(o[u+1]);for(var l=[],h=Lg.empty(),d=a.length-1;d>=0;--d)if(!Gw(l,a[d])){var p=a[d],f=c[d];f=(0,wh.m9)(f);var m=s.$c(p);if(f instanceof Rw)l.push(p);else{var g=Lw(f,m);null!=g&&(l.push(p),h.set(p,g))}}var _=new ag(l);return new yw(h,_,s.fieldTransforms)}function Pw(e,t,n,r){return void 0===r&&(r=!1),Lw(n,e.qc(r?4:3,t))}function Lw(e,t){if(Mw(e=(0,wh.m9)(e)))return Uw("Unsupported field value:",t,e),xw(e,t);if(e instanceof mw)return function(e,t){if(!Ew(t.Cc))throw t.Mc(e._methodName+"() can only be used with update() and set()");if(!t.path)throw t.Mc(e._methodName+"() is not currently supported inside arrays");var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.Cc)throw t.Mc("Nested arrays are not supported");return function(e,t){for(var n=[],r=0,i=0,o=e;i<o.length;i++){var s=Lw(o[i],t.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,wh.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return T_(t.R,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=$m.fromDate(e);return{timestampValue:Nv(t.R,n)}}if(e instanceof $m)return n=new $m(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)),{timestampValue:Nv(t.R,n)};if(e instanceof gw)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof fw)return{bytesValue:kv(t.R,e._byteString)};if(e instanceof Zb){var r=e.firestore._databaseId;if(!r.isEqual(n=t.databaseId))throw t.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Lv(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Mc("Unsupported field value: "+Yb(e))}(e,t)}function xw(e,t){var n={};return ng(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tg(e,function(e,r){var i=Lw(r,t.xc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function Mw(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof $m||e instanceof gw||e instanceof fw||e instanceof Zb||e instanceof mw)}function Uw(e,t,n){if(!Mw(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=Yb(n);throw t.Mc("an object"===r?e+" a custom object":e+" "+r)}}function Vw(e,t,n){if((t=(0,wh.m9)(t))instanceof pw)return t._internalPath;if("string"==typeof t)return Bw(e,t);throw jw("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var Fw=new RegExp("[~\\*/\\[\\]]");function Bw(e,t,n){if(t.search(Fw)>=0)throw jw("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,n);try{return(new(pw.bind.apply(pw,(0,ac.ev)([void 0],t.split(".")))))._internalPath}catch(Gh){throw jw("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,n)}}function jw(e,t,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+t+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var c="";return(o||s)&&(c+=" (found",o&&(c+=" in field "+r),s&&(c+=" in document "+i),c+=")"),new Um(Mm.INVALID_ARGUMENT,(a+=". ")+e+c)}function Gw(e,t){return e.some(function(e){return e.isEqual(t)})}var qw=function(){function e(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new Zb(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return null!==this._document},e.prototype.data=function(){if(this._document){if(this._converter){var e=new Hw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}},e.prototype.get=function(e){if(this._document){var t=this._document.data.field(Ww("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}},e}(),Hw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,ac.ZT)(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t}(qw);function Ww(e,t){return"string"==typeof t?Bw(e,t):t instanceof pw?t._internalPath:t._delegate._internalPath}var zw=function(){function e(e,t){this.hasPendingWrites=e,this.fromCache=t}return e.prototype.isEqual=function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache},e}(),Kw=function(e){function t(t,n,r,i,o,s){var a=this;return(a=e.call(this,t,n,r,i,s)||this)._firestore=t,a._firestoreImpl=t,a.metadata=o,a}return(0,ac.ZT)(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(e){if(void 0===e&&(e={}),this._document){if(this._converter){var t=new Yw(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}},t.prototype.get=function(e,t){if(void 0===t&&(t={}),this._document){var n=this._document.data.field(Ww("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}},t}(qw),Yw=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,ac.ZT)(t,e),t.prototype.data=function(t){return void 0===t&&(t={}),e.prototype.data.call(this,t)},t}(Kw),Qw=function(){function e(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new zw(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(e.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(e,t){var n=this;this._snapshot.docs.forEach(function(r){e.call(t,new Yw(n._firestore,n._userDataWriter,r.key,r,new zw(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},e.prototype.docChanges=function(e){void 0===e&&(e={});var t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Um(Mm.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map(function(t){return{type:"added",doc:new Yw(e._firestore,e._userDataWriter,t.doc.key,t.doc,new zw(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}})}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(function(e){return t||3!==e.type}).map(function(t){var n=new Yw(e._firestore,e._userDataWriter,t.doc.key,t.doc,new zw(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,o=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(o=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:Jw(t.type),doc:n,oldIndex:i,newIndex:o}})}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges},e}();function Jw(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Hm()}}function Xw(e,t){return e instanceof Kw&&t instanceof Kw?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Qw&&t instanceof Qw&&e._firestore===t._firestore&&ow(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function $w(e){if(a_(e)&&0===e.explicitOrderBy.length)throw new Um(Mm.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Zw=function(){};function eR(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=o._apply(e)}return e}var tR=function(e){function t(t,n,r){var i=this;return(i=e.call(this)||this).Kc=t,i.jc=n,i.Wc=r,i.type="where",i}return(0,ac.ZT)(t,e),t.prototype._apply=function(e){var t=bw(e.firestore),n=function(e,t,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Um(Mm.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){cR(s,o);for(var c=[],u=0,l=s;u<l.length;u++)c.push(aR(r,e,l[u]));a={arrayValue:{values:c}}}else a=aR(r,e,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||cR(s,o),a=Pw(n,"where",s,"in"===o||"not-in"===o);var h=Gg.create(i,o,a);return function(e,t){if(t.g()){var n=u_(e);if(null!==n&&!n.isEqual(t.field))throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+t.field.toString()+"'");var r=c_(e);null!==r&&uR(0,t.field,r)}var i=function(e,t){for(var n=0,r=e.filters;n<r.length;n++){var i=r[n];if(t.indexOf(i.op)>=0)return i.op}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw new Um(Mm.INVALID_ARGUMENT,i===t.op?"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter.":"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+i.toString()+"' filters.")}(e,h),h}(e._query,0,t,e.firestore._databaseId,this.Kc,this.jc,this.Wc);return new ew(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new r_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))},t}(Zw),nR=function(e){function t(t,n){var r=this;return(r=e.call(this)||this).Kc=t,r.Gc=n,r.type="orderBy",r}return(0,ac.ZT)(t,e),t.prototype._apply=function(e){var t=function(e,t,n){if(null!==e.startAt)throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Zg(t,n);return function(e,t){if(null===c_(e)){var n=u_(e);null!==n&&uR(0,n,t.field)}}(e,r),r}(e._query,this.Kc,this.Gc);return new ew(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new r_(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))},t}(Zw),rR=function(e){function t(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.zc=n,i.Hc=r,i}return(0,ac.ZT)(t,e),t.prototype._apply=function(e){return new ew(e.firestore,e.converter,p_(e._query,this.zc,this.Hc))},t}(Zw),iR=function(e){function t(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.Jc=n,i.Yc=r,i}return(0,ac.ZT)(t,e),t.prototype._apply=function(e){var t=sR(e,this.type,this.Jc,this.Yc);return new ew(e.firestore,e.converter,function(e,t){return new r_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))},t}(Zw),oR=function(e){function t(t,n,r){var i=this;return(i=e.call(this)||this).type=t,i.Jc=n,i.Yc=r,i}return(0,ac.ZT)(t,e),t.prototype._apply=function(e){var t=sR(e,this.type,this.Jc,this.Yc);return new ew(e.firestore,e.converter,function(e,t){return new r_(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))},t}(Zw);function sR(e,t,n,r){if(n[0]=(0,wh.m9)(n[0]),n[0]instanceof qw)return function(e,t,n,r,i){if(!r)throw new Um(Mm.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=h_(e);s<a.length;s++){var c=a[s];if(c.field.isKeyField())o.push(Cg(t,r.key));else{var u=r.data.field(c.field);if(pg(u))throw new Um(Mm.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){var l=c.field.canonicalString();throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+l+"' (used as the orderBy) does not exist.")}o.push(u)}}return new Xg(o,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=bw(e.firestore);return function(e,t,n,r,i,o){var s=e.explicitOrderBy;if(i.length>s.length)throw new Um(Mm.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],c=0;c<i.length;c++){var u=i[c];if(s[c].field.isKeyField()){if("string"!=typeof u)throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof u);if(!l_(e)&&-1!==u.indexOf("/"))throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+u+"' contains a slash.");var l=e.path.child(ig.fromString(u));if(!yg.isDocumentKey(l))throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+l+"' is not because it contains an odd number of segments.");var h=new yg(l);a.push(Cg(t,h))}else{var d=Pw(n,r,u);a.push(d)}}return new Xg(a,o)}(e._query,e.firestore._databaseId,i,t,n,r)}function aR(e,t,n){if("string"==typeof(n=(0,wh.m9)(n))){if(""===n)throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!l_(t)&&-1!==n.indexOf("/"))throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=t.path.child(ig.fromString(n));if(!yg.isDocumentKey(r))throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Cg(e,new yg(r))}if(n instanceof Zb)return Cg(e,n._key);throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Yb(n)+".")}function cR(e,t){if(!Array.isArray(e)||0===e.length)throw new Um(Mm.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new Um(Mm.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function uR(e,t,n){if(!n.isEqual(t))throw new Um(Mm.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var lR=function(){function e(){}return e.prototype.convertValue=function(e,t){switch(void 0===t&&(t="none"),Eg(e)){case 0:return null;case 1:return e.booleanValue;case 2:return hg(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(dg(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Hm()}},e.prototype.convertObject=function(e,t){var n=this,r={};return tg(e.fields,function(e,i){r[e]=n.convertValue(i,t)}),r},e.prototype.convertGeoPoint=function(e){return new gw(hg(e.latitude),hg(e.longitude))},e.prototype.convertArray=function(e,t){var n=this;return(e.values||[]).map(function(e){return n.convertValue(e,t)})},e.prototype.convertServerTimestamp=function(e,t){switch(t){case"previous":var n=fg(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(mg(e));default:return null}},e.prototype.convertTimestamp=function(e){var t=lg(e);return new $m(t.seconds,t.nanos)},e.prototype.convertDocumentKey=function(e,t){var n=ig.fromString(e);Wm(oy(n));var r=new xb(n.get(1),n.get(3)),i=new yg(n.popFirst(5));return r.isEqual(t)||jm("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+t.projectId+"/"+t.database+") instead."),i},e}();function hR(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var dR=function(e){function t(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return(0,ac.ZT)(t,e),t.prototype.convertBytes=function(e){return new fw(e)},t.prototype.convertReference=function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Zb(this.firestore,null,t)},t}(lR),pR=function(){function e(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=bw(e)}return e.prototype.set=function(e,t,n){this._verifyNotCommitted();var r=fR(e,this._firestore),i=hR(r.converter,t,n),o=ww(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,U_.none())),this},e.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=fR(e,this._firestore);return o="string"==typeof(t=(0,wh.m9)(t))||t instanceof pw?Dw(this._dataReader,"WriteBatch.update",s._key,t,n,r):kw(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,U_.exists(!0))),this},e.prototype.delete=function(e){this._verifyNotCommitted();var t=fR(e,this._firestore);return this._mutations=this._mutations.concat(new $_(t._key,U_.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new Um(Mm.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e}();function fR(e,t){if((e=(0,wh.m9)(e)).firestore!==t)throw new Um(Mm.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var mR=function(e){function t(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return(0,ac.ZT)(t,e),t.prototype.convertBytes=function(e){return new fw(e)},t.prototype.convertReference=function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Zb(this.firestore,null,t)},t}(lR);function gR(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=Qb(e,Zb);var o=Qb(e.firestore,cw),s=bw(o);return vR(o,[("string"==typeof(t=(0,wh.m9)(t))||t instanceof pw?Dw(s,"updateDoc",e._key,t,n,r):kw(s,"updateDoc",e._key,t)).toMutation(e._key,U_.exists(!0))])}function _R(e){for(var t,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];e=(0,wh.m9)(e);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||aw(i[a])||(s=i[a],a++);var c,u,l,h={includeMetadataChanges:s.includeMetadataChanges};if(aw(i[a])){var d=i[a];i[a]=null===(t=d.next)||void 0===t?void 0:t.bind(d),i[a+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),i[a+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(e instanceof Zb)u=Qb(e.firestore,cw),l=o_(e._key.path),c={next:function(t){i[a]&&i[a](yR(u,e,t))},error:i[a+1],complete:i[a+2]};else{var p=Qb(e,ew);u=Qb(p.firestore,cw),l=p._query;var f=new mR(u);c={next:function(e){i[a]&&i[a](new Qw(u,f,p,e))},error:i[a+1],complete:i[a+2]},$w(e._query)}return function(e,t,n,r){var i=this,o=new yb(r),s=new OT(t,o,n);return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(i,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return t=wT,[4,kb(e)];case 1:return[2,t.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(i,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return t=RT,[4,kb(e)];case 1:return[2,t.apply(void 0,[n.sent(),s])]}})})})}}(uw(u),l,h,c)}function vR(e,t){return function(e,t){var n=this,r=new Oy;return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(n,void 0,void 0,function(){var n;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return n=jT,[4,Nb(e)];case 1:return[2,n.apply(void 0,[i.sent(),t,r])]}})})}),r.promise}(uw(e),t)}function yR(e,t,n){var r=n.docs.get(t._key),i=new mR(e);return new Kw(e,i,t._key,r,new zw(n.hasPendingWrites,n.fromCache),t.converter)}var ER=function(e){function t(t,n){var r=this;return(r=e.call(this,t,n)||this)._firestore=t,r}return(0,ac.ZT)(t,e),t.prototype.get=function(t){var n=this,r=fR(t,this._firestore),i=new mR(this._firestore);return e.prototype.get.call(this,t).then(function(e){return new Kw(n._firestore,i,r._key,e._document,new zw(!1,!1),r.converter)})},t}(function(){function e(e,t){this._firestore=e,this._transaction=t,this._dataReader=bw(e)}return e.prototype.get=function(e){var t=this,n=fR(e,this._firestore),r=new dR(this._firestore);return this._transaction.lookup([n._key]).then(function(e){if(!e||1!==e.length)return Hm();var i=e[0];if(i.isFoundDocument())return new qw(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new qw(t._firestore,r,n._key,null,n.converter);throw Hm()})},e.prototype.set=function(e,t,n){var r=fR(e,this._firestore),i=hR(r.converter,t,n),o=ww(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},e.prototype.update=function(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=fR(e,this._firestore);return o="string"==typeof(t=(0,wh.m9)(t))||t instanceof pw?Dw(this._dataReader,"Transaction.update",s._key,t,n,r):kw(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this},e.prototype.delete=function(e){var t=fR(e,this._firestore);return this._transaction.delete(t._key),this},e}());function SR(){if("undefined"==typeof Uint8Array)throw new Um(Mm.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function TR(){if("undefined"==typeof atob)throw new Um(Mm.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var bR=function(){function e(e){this._delegate=e}return e.fromBase64String=function(t){return TR(),new e(fw.fromBase64String(t))},e.fromUint8Array=function(t){return SR(),new e(fw.fromUint8Array(t))},e.prototype.toBase64=function(){return TR(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return SR(),this._delegate.toUint8Array()},e.prototype.isEqual=function(e){return this._delegate.isEqual(e._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(),wR=function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(e,t){return function(e,t){dw(e=Qb(e,cw));var n=uw(e),r=e._freezeSettings(),i=new vb;return hw(n,i,new gb(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})},e.prototype.enableMultiTabIndexedDbPersistence=function(e){return function(e){dw(e=Qb(e,cw));var t=uw(e),n=e._freezeSettings(),r=new vb;return hw(t,r,new _b(r,n.cacheSizeBytes))}(e._delegate)},e.prototype.clearIndexedDbPersistence=function(e){return function(e){var t=this;if(e._initialized&&!e._terminated)throw new Um(Mm.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Oy;return e._queue.enqueueAndForgetEvenWhileRestricted(function(){return(0,ac.mG)(t,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(e){return(0,ac.mG)(this,void 0,void 0,function(){return(0,ac.Jh)(this,function(t){switch(t.label){case 0:return Dy.yt()?[4,Dy.delete(e+"main")]:[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(qE(e._databaseId,e._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}})})}),n.promise}(e._delegate)},e}(),RR=function(){function e(e,t,n){var r=this;this._delegate=t,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},e instanceof xb||(this.Zc=e)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Gm("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)},e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),function(e,t,n,r){void 0===r&&(r={});var i=(e=Qb(e,$b))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==t&&Gm("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},i),{host:t+":"+n,ssl:!1})),r.mockUserToken){var o=(0,wh.Sg)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Um(Mm.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");e._credentials=new Fb(new Ub(o,new ES(s)))}}(this._delegate,e,t,n)},e.prototype.enableNetwork=function(){return function(e){var t=this;return e.asyncQueue.enqueue(function(){return(0,ac.mG)(t,void 0,void 0,function(){var t,n;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return[4,Cb(e)];case 1:return t=r.sent(),[4,Ob(e)];case 2:return n=r.sent(),[2,(t.setNetworkEnabled(!0),function(e){var t=zm(e);return t.Or.delete(0),zS(t)}(n))]}})})})}(uw(Qb(this._delegate,cw)))},e.prototype.disableNetwork=function(){return function(e){var t=this;return e.asyncQueue.enqueue(function(){return(0,ac.mG)(t,void 0,void 0,function(){var t,n;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return[4,Cb(e)];case 1:return t=r.sent(),[4,Ob(e)];case 2:return n=r.sent(),[2,(t.setNetworkEnabled(!1),function(e){return(0,ac.mG)(this,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return(t=zm(e)).Or.add(0),[4,KS(t)];case 1:return n.sent(),t.Br.set("Offline"),[2]}})})}(n))]}})})})}(uw(Qb(this._delegate,cw)))},e.prototype.enablePersistence=function(e){var t=!1,n=!1;return e&&Wb("synchronizeTabs",t=!!e.synchronizeTabs,"experimentalForceOwningTab",n=!!e.experimentalForceOwningTab),t?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},e.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(e){var t=this,n=new Oy;return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(t,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(r){switch(r.label){case 0:return t=KT,[4,Nb(e)];case 1:return[2,t.apply(void 0,[r.sent(),n])]}})})}),n.promise}(uw(Qb(this._delegate,cw)))},e.prototype.onSnapshotsInSync=function(e){return function(e,t){return function(e,t){var n=this,r=new yb(t);return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(n,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return t=function(e,t){zm(e).Gr.add(t),t.next()},[4,kb(e)];case 1:return[2,t.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(n,void 0,void 0,function(){var t;return(0,ac.Jh)(this,function(n){switch(n.label){case 0:return t=function(e,t){zm(e).Gr.delete(t)},[4,kb(e)];case 1:return[2,t.apply(void 0,[n.sent(),r])]}})})})}}(uw(e=Qb(e,cw)),aw(t)?t:{next:t})}(this._delegate,e)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.Zc)throw new Um(Mm.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),e.prototype.collection=function(e){try{return new FR(this,nw(this._delegate,e))}catch(e){throw kR(e,"collection()","Firestore.collection()")}},e.prototype.doc=function(e){try{return new NR(this,rw(this._delegate,e))}catch(e){throw kR(e,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(e){try{return new MR(this,function(e,t){if(e=Qb(e,$b),qb("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Um(Mm.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ew(e,null,function(e){return new r_(ig.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw kR(e,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(e){var t=this;return function(e,t){return function(e,t){var n=this,r=new Oy;return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(n,void 0,void 0,function(){var n;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return[4,function(e){return Ib(e).then(function(e){return e.datastore})}(e)];case 1:return n=i.sent(),new Sb(e.asyncQueue,n,t,r).run(),[2]}})})}),r.promise}(uw(e),function(n){return t(new ER(e,n))})}(this._delegate,function(n){return e(new CR(t,n))})},e.prototype.batch=function(){var e=this;return uw(this._delegate),new AR(new pR(this._delegate,function(t){return vR(e._delegate,t)}))},e.prototype.loadBundle=function(e){throw new Um(Mm.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(e){throw new Um(Mm.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(),IR=function(e){function t(t){var n=this;return(n=e.call(this)||this).firestore=t,n}return(0,ac.ZT)(t,e),t.prototype.convertBytes=function(e){return new bR(new fw(e))},t.prototype.convertReference=function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return NR.tu(t,this.firestore,null)},t}(lR),CR=function(){function e(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new IR(e)}return e.prototype.get=function(e){var t=this,n=BR(e);return this._delegate.get(n).then(function(e){return new LR(t._firestore,new Kw(t._firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,n.converter))})},e.prototype.set=function(e,t,n){var r=BR(e);return n?(Hb("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this},e.prototype.update=function(e,t,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=BR(e);return 2===arguments.length?this._delegate.update(s,t):(r=this._delegate).update.apply(r,(0,ac.ev)([s,t,n],i)),this},e.prototype.delete=function(e){var t=BR(e);return this._delegate.delete(t),this},e}(),AR=function(){function e(e){this._delegate=e}return e.prototype.set=function(e,t,n){var r=BR(e);return n?(Hb("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this},e.prototype.update=function(e,t,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=BR(e);return 2===arguments.length?this._delegate.update(s,t):(r=this._delegate).update.apply(r,(0,ac.ev)([s,t,n],i)),this},e.prototype.delete=function(e){var t=BR(e);return this._delegate.delete(t),this},e.prototype.commit=function(){return this._delegate.commit()},e}(),OR=function(){function e(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}return e.prototype.fromFirestore=function(e,t){var n=new Yw(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new xR(this._firestore,n),null!=t?t:{})},e.prototype.toFirestore=function(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)},e.eu=function(t,n){var r=e.nu,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new IR(t),n),i.set(n,o)),o},e}();OR.nu=new WeakMap;var NR=function(){function e(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new IR(e)}return e.su=function(t,n,r){if(t.length%2!=0)throw new Um(Mm.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(n,new Zb(n._delegate,r,new yg(t)))},e.tu=function(t,n,r){return new e(n,new Zb(n._delegate,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new FR(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(e){try{return new FR(this.firestore,nw(this._delegate,e))}catch(e){throw kR(e,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(e){return(e=(0,wh.m9)(e))instanceof Zb&&iw(this._delegate,e)},e.prototype.set=function(e,t){t=Hb("DocumentReference.set",t);try{return function(e,t,n){e=Qb(e,Zb);var r=Qb(e.firestore,cw),i=hR(e.converter,t,n);return vR(r,[ww(bw(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,U_.none())])}(this._delegate,e,t)}catch(e){throw kR(e,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?gR(this._delegate,e):gR.apply(void 0,(0,ac.ev)([this._delegate,e,t],n))}catch(e){throw kR(e,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return vR(Qb((e=this._delegate).firestore,cw),[new $_(e._key,U_.none())]);var e},e.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=DR(t),i=PR(t,function(t){return new LR(e.firestore,new Kw(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))});return _R(this._delegate,r,i)},e.prototype.get=function(e){var t=this;return("cache"===(null==e?void 0:e.source)?function(e){e=Qb(e,Zb);var t=Qb(e.firestore,cw),n=uw(t),r=new mR(t);return function(e,t){var n=this,r=new Oy;return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(n,void 0,void 0,function(){var n;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return n=function(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i;return(0,ac.Jh)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(e,t){var n=zm(e);return n.persistence.runTransaction("read document","readonly",function(e){return n.Mn.mn(e,t)})}(e,t)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Um(Mm.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=vT(r,"Failed to get document '"+t+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Ab(e)];case 1:return[2,n.apply(void 0,[i.sent(),t,r])]}})})}),r.promise}(n,e._key).then(function(n){return new Kw(t,r,e._key,n,new zw(null!==n&&n.hasLocalMutations,!0),e.converter)})}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Qb(e,Zb);var t=Qb(e.firestore,cw);return Db(uw(t),e._key,{source:"server"}).then(function(n){return yR(t,e,n)})}(this._delegate):function(e){e=Qb(e,Zb);var t=Qb(e.firestore,cw);return Db(uw(t),e._key).then(function(n){return yR(t,e,n)})}(this._delegate)).then(function(e){return new LR(t.firestore,new Kw(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))})},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?OR.eu(this.firestore,t):null))},e}();function kR(e,t,n){return e.message=e.message.replace(t,n),e}function DR(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if("object"==typeof r&&!aw(r))return r}return{}}function PR(e,t){var n,r,i;return{next:function(e){i.next&&i.next(t(e))},error:null===(n=(i=aw(e[0])?e[0]:aw(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var LR=function(){function e(e,t){this._firestore=e,this._delegate=t}return Object.defineProperty(e.prototype,"ref",{get:function(){return new NR(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(e){return this._delegate.data(e)},e.prototype.get=function(e,t){return this._delegate.get(e,t)},e.prototype.isEqual=function(e){return Xw(this._delegate,e._delegate)},e}(),xR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,ac.ZT)(t,e),t.prototype.data=function(e){return this._delegate.data(e)},t}(LR),MR=function(){function e(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new IR(e)}return e.prototype.where=function(t,n,r){try{return new e(this.firestore,eR(this._delegate,function(e,t,n){var r=t,i=Ww("where",e);return new tR(i,r,n)}(t,n,r)))}catch(t){throw kR(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,eR(this._delegate,function(e,t){void 0===t&&(t="asc");var n=t,r=Ww("orderBy",e);return new nR(r,n)}(t,n)))}catch(t){throw kR(t,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,eR(this._delegate,function(e){return Jb("limit",e),new rR("limit",e,"F")}(t)))}catch(t){throw kR(t,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,eR(this._delegate,function(e){return Jb("limitToLast",e),new rR("limitToLast",e,"L")}(t)))}catch(t){throw kR(t,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,eR(this._delegate,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new iR("startAt",e,!0)}).apply(void 0,t)))}catch(t){throw kR(t,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,eR(this._delegate,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new iR("startAfter",e,!1)}).apply(void 0,t)))}catch(t){throw kR(t,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,eR(this._delegate,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new oR("endBefore",e,!0)}).apply(void 0,t)))}catch(t){throw kR(t,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,eR(this._delegate,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new oR("endAt",e,!1)}).apply(void 0,t)))}catch(t){throw kR(t,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(e){return ow(this._delegate,e._delegate)},e.prototype.get=function(e){var t=this;return("cache"===(null==e?void 0:e.source)?function(e){e=Qb(e,ew);var t=Qb(e.firestore,cw),n=uw(t),r=new mR(t);return function(e,t){var n=this,r=new Oy;return e.asyncQueue.enqueueAndForget(function(){return(0,ac.mG)(n,void 0,void 0,function(){var n;return(0,ac.Jh)(this,function(i){switch(i.label){case 0:return n=function(e,t,n){return(0,ac.mG)(this,void 0,void 0,function(){var r,i,o,s,a;return(0,ac.Jh)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,iS(e,t,!0)];case 1:return a=c.sent(),r=new LT(t,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=c.sent(),a=vT(s,"Failed to execute query '"+t+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Ab(e)];case 1:return[2,n.apply(void 0,[i.sent(),t,r])]}})})}),r.promise}(n,e._query).then(function(n){return new Qw(t,r,e,n)})}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=Qb(e,ew);var t=Qb(e.firestore,cw),n=uw(t),r=new mR(t);return Pb(n,e._query,{source:"server"}).then(function(n){return new Qw(t,r,e,n)})}(this._delegate):function(e){e=Qb(e,ew);var t=Qb(e.firestore,cw),n=uw(t),r=new mR(t);return $w(e._query),Pb(n,e._query).then(function(n){return new Qw(t,r,e,n)})}(this._delegate)).then(function(e){return new VR(t.firestore,new Qw(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))})},e.prototype.onSnapshot=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=DR(t),i=PR(t,function(t){return new VR(e.firestore,new Qw(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))});return _R(this._delegate,r,i)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?OR.eu(this.firestore,t):null))},e}(),UR=function(){function e(e,t){this._firestore=e,this._delegate=t}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new xR(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(),VR=function(){function e(e,t){this._firestore=e,this._delegate=t}return Object.defineProperty(e.prototype,"query",{get:function(){return new MR(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var e=this;return this._delegate.docs.map(function(t){return new xR(e._firestore,t)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(e){var t=this;return this._delegate.docChanges(e).map(function(e){return new UR(t._firestore,e)})},e.prototype.forEach=function(e,t){var n=this;this._delegate.forEach(function(r){e.call(t,new xR(n._firestore,r))})},e.prototype.isEqual=function(e){return Xw(this._delegate,e._delegate)},e}(),FR=function(e){function t(t,n){var r=this;return(r=e.call(this,t,n)||this).firestore=t,r._delegate=n,r}return(0,ac.ZT)(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._delegate.parent;return e?new NR(this.firestore,e):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(e){try{return new NR(this.firestore,void 0===e?rw(this._delegate):rw(this._delegate,e))}catch(e){throw kR(e,"doc()","CollectionReference.doc()")}},t.prototype.add=function(e){var t=this;return function(e,t){var n=Qb(e.firestore,cw),r=rw(e),i=hR(e.converter,t);return vR(n,[ww(bw(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,U_.exists(!1))]).then(function(){return r})}(this._delegate,e).then(function(e){return new NR(t.firestore,e)})},t.prototype.isEqual=function(e){return iw(this._delegate,e._delegate)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?OR.eu(this.firestore,e):null))},t}(MR);function BR(e){return Qb(e,Zb)}var jR,GR=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._delegate=new(pw.bind.apply(pw,(0,ac.ev)([void 0],e)))}return e.documentId=function(){return new e(sg.keyField().canonicalString())},e.prototype.isEqual=function(e){return(e=(0,wh.m9)(e))instanceof pw&&this._delegate._internalPath.isEqual(e._internalPath)},e}(),qR=function(){function e(e){this._delegate=e}return e.serverTimestamp=function(){var t=new Cw("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Rw("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Aw("arrayUnion",e)}).apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return new Ow("arrayRemove",e)}).apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(e){return new Nw("increment",e)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(e){return this._delegate.isEqual(e._delegate)},e}(),HR=n(5119),WR={Firestore:RR,GeoPoint:gw,Timestamp:$m,Blob:bR,Transaction:CR,WriteBatch:AR,DocumentReference:NR,DocumentSnapshot:LR,Query:MR,QueryDocumentSnapshot:xR,QuerySnapshot:VR,CollectionReference:FR,FieldPath:GR,FieldValue:qR,setLogLevel:function(e){Vm.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(e,t){e.INTERNAL.registerComponent(new HR.wA("firestore",function(e){return function(e,t){return new RR(e,new cw(e,t),new wR)}(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},WR)))})(jR=bh.Z),jR.registerVersion("@firebase/firestore","2.3.7");var zR=n(1906),KR=n(8489),YR=n(9291);class QR extends ui.xQ{constructor(e=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=e<1?1:e,this._windowTime=t<1?1:t,t===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(e){if(!this.isStopped){const t=this._events;t.push(e),t.length>this._bufferSize&&t.shift()}super.next(e)}nextTimeWindow(e){this.isStopped||(this._events.push(new JR(this._getNow(),e)),this._trimBufferThenGetEvents()),super.next(e)}_subscribe(e){const t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;let o;if(this.closed)throw new li.N;if(this.isStopped||this.hasError?o=ro.w.EMPTY:(this.observers.push(e),o=new YR.W(this,e)),r&&e.add(e=new Eh.ht(e,r)),t)for(let s=0;s<i&&!e.closed;s++)e.next(n[s]);else for(let s=0;s<i&&!e.closed;s++)e.next(n[s].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),o}_getNow(){return(this.scheduler||KR.c).now()}_trimBufferThenGetEvents(){const e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length;let o=0;for(;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&r.splice(0,o),r}}class JR{constructor(e,t){this.time=e,this.value=t}}function XR(e,t,n){let r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},e=>e.lift(function({bufferSize:e=Number.POSITIVE_INFINITY,windowTime:t=Number.POSITIVE_INFINITY,refCount:n,scheduler:r}){let i,o,s=0,a=!1,c=!1;return function(u){let l;s++,!i||a?(a=!1,i=new QR(e,t,r),l=i.subscribe(this),o=u.subscribe({next(e){i.next(e)},error(e){a=!0,i.error(e)},complete(){c=!0,o=void 0,i.complete()}}),c&&(o=void 0)):l=i.subscribe(this),this.add(()=>{s--,l.unsubscribe(),l=void 0,o&&!c&&n&&0===s&&(o.unsubscribe(),o=void 0,i=void 0)})}}(r))}function $R(e,t){return t?Oi(()=>e,t):Oi(()=>e)}var ZR=n(3482);const eI=new r.OlP("angularfire2.auth.use-emulator"),tI=new r.OlP("angularfire2.auth.settings"),nI=new r.OlP("angularfire2.auth.tenant-id"),rI=new r.OlP("angularfire2.auth.langugage-code"),iI=new r.OlP("angularfire2.auth.use-device-language"),oI=new r.OlP("angularfire.auth.persistence");let sI=(()=>{class e{constructor(e,t,r,i,o,s,a,c,u,l){const h=new Sh.HU(i),d=(0,Sh.ss)(h),p=new ui.xQ,f=(0,ke.of)(void 0).pipe((0,Eh.QV)(h.outsideAngular),Oi(()=>i.runOutsideAngular(()=>n.e(420).then(n.bind(n,7420)))),(0,Fe.U)(()=>(0,Sh.on)(e,i,t)),(0,Fe.U)(e=>i.runOutsideAngular(()=>{const t=o,n=s;return(0,Sh.sI)(`${e.name}.auth`,"AngularFireAuth",e,()=>{const r=i.runOutsideAngular(()=>e.auth());if(t&&r.useEmulator(`http://${t.join(":")}`),a&&(r.tenantId=a),r.languageCode=c,u&&r.useDeviceLanguage(),n)for(const[e,t]of Object.entries(n))r.settings[e]=t;return l&&r.setPersistence(l),r},[t,a,c,u,n,l])})),XR({bufferSize:1,refCount:!1}));if(K(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,ke.of)(null);else{f.pipe(eo()).subscribe();const e=f.pipe(Oi(e=>e.getRedirectResult().then(e=>e,()=>null)),d,XR({bufferSize:1,refCount:!1})),t=e=>new De.y(t=>({unsubscribe:i.runOutsideAngular(()=>e(t))})),n=f.pipe(Oi(e=>t(e.onAuthStateChanged.bind(e)))),r=f.pipe(Oi(e=>t(e.onIdTokenChanged.bind(e))));this.authState=e.pipe($R(n),(0,ZR.R)(h.outsideAngular),(0,Eh.QV)(h.insideAngular)),this.user=e.pipe($R(r),(0,ZR.R)(h.outsideAngular),(0,Eh.QV)(h.insideAngular)),this.idToken=this.user.pipe(Oi(e=>e?(0,ci.D)(e.getIdToken()):(0,ke.of)(null))),this.idTokenResult=this.user.pipe(Oi(e=>e?(0,ci.D)(e.getIdTokenResult()):(0,ke.of)(null))),this.credential=(0,zR.T)(e,p,this.authState.pipe(Me(e=>!e))).pipe((0,Fe.U)(e=>(null==e?void 0:e.user)?e:null),(0,ZR.R)(h.outsideAngular),(0,Eh.QV)(h.insideAngular))}return(0,Sh.pX)(this,f,i,{spy:{apply:(e,t,n)=>{(e.startsWith("signIn")||e.startsWith("createUser"))&&n.then(e=>p.next(e))}}})}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(Sh.Dh),r.LFG(Sh.xv,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(eI,8),r.LFG(tI,8),r.LFG(nI,8),r.LFG(rI,8),r.LFG(iI,8),r.LFG(oI,8))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(Sh.Dh),r.LFG(Sh.xv,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(eI,8),r.LFG(tI,8),r.LFG(nI,8),r.LFG(rI,8),r.LFG(iI,8),r.LFG(oI,8))},token:e,providedIn:"any"}),e})();function aI(e,t){return function(e,t=ph.z){return new De.y(n=>{let r;return null!=t?t.schedule(()=>{r=e.onSnapshot({includeMetadataChanges:!0},n)}):r=e.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(e,t)}function cI(e,t){return aI(e,t).pipe((0,Fe.U)(e=>({payload:e,type:"query"})))}function uI(e,t){return cI(e,t).pipe(Mi(void 0),fh(),(0,Fe.U)(([e,t])=>{const n=t.payload.docChanges(),r=n.map(e=>({type:e.type,payload:e}));return e&&JSON.stringify(e.payload.metadata)!==JSON.stringify(t.payload.metadata)&&t.payload.docs.forEach((t,i)=>{const o=n.find(e=>e.doc.ref.isEqual(t.ref)),s=null==e?void 0:e.payload.docs.find(e=>e.ref.isEqual(t.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(t.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(t.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:t}})}),r}))}function lI(e,t,n){return uI(e,n).pipe(Ui((e,n)=>function(e,t,n){return t.forEach(t=>{n.indexOf(t.type)>-1&&(e=function(e,t){switch(t.type){case"added":if(!e[t.newIndex]||!e[t.newIndex].doc.ref.isEqual(t.doc.ref))return hI(e,t.newIndex,0,t);break;case"modified":if(null==e[t.oldIndex]||e[t.oldIndex].doc.ref.isEqual(t.doc.ref)){if(t.oldIndex!==t.newIndex){const n=e.slice();return n.splice(t.oldIndex,1),n.splice(t.newIndex,0,t),n}return hI(e,t.newIndex,1,t)}break;case"removed":if(e[t.oldIndex]&&e[t.oldIndex].doc.ref.isEqual(t.doc.ref))return hI(e,t.oldIndex,1)}return e}(e,t))}),e}(e,n.map(e=>e.payload),t),[]),_h(),(0,Fe.U)(e=>e.map(e=>({type:e.type,payload:e}))))}function hI(e,t,n,...r){const i=e.slice();return i.splice(t,n,...r),i}function dI(e){return e&&0!==e.length||(e=["added","removed","modified"]),e}(0,Sh.GT)(sI,[{app:null,applyActionCode:null,checkActionCode:null,confirmPasswordReset:null,createUserWithEmailAndPassword:null,currentUser:null,fetchSignInMethodsForEmail:null,isSignInWithEmailLink:null,getRedirectResult:null,languageCode:null,settings:null,onAuthStateChanged:null,onIdTokenChanged:null,sendSignInLinkToEmail:null,sendPasswordResetEmail:null,setPersistence:null,signInAndRetrieveDataWithCredential:null,signInAnonymously:null,signInWithCredential:null,signInWithCustomToken:null,signInWithEmailAndPassword:null,signInWithPhoneNumber:null,signInWithEmailLink:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,tenantId:null,updateCurrentUser:null,useDeviceLanguage:null,useEmulator:null,verifyPasswordResetCode:null}]);class pI{constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=uI(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Fe.U)(t=>t.filter(t=>e.indexOf(t.type)>-1)))),t.pipe(Mi(void 0),fh(),Me(([e,t])=>t.length>0||!e),(0,Fe.U)(([e,t])=>t),this.afs.keepUnstableUntilFirst)}auditTrail(e){return this.stateChanges(e).pipe(Ui((e,t)=>[...e,...t],[]))}snapshotChanges(e){const t=dI(e);return lI(this.query,t,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(e={}){return cI(this.query,this.afs.schedulers.outsideAngular).pipe((0,Fe.U)(t=>t.payload.docs.map(t=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data())),this.afs.keepUnstableUntilFirst)}get(e){return(0,ci.D)(this.query.get(e)).pipe((0,Eh.QV)(this.afs.schedulers.insideAngular))}add(e){return this.ref.add(e)}doc(e){return new fI(this.ref.doc(e),this.afs)}}class fI{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const n=this.ref.collection(e),{ref:r,query:i}=EI(n,t);return new pI(r,i,this.afs)}snapshotChanges(){return aI(this.ref,this.afs.schedulers.outsideAngular).pipe(Mi(void 0),fh(),(0,Fe.U)(([e,t])=>t.exists?(null==e?void 0:e.exists)?{payload:t,type:"modified"}:{payload:t,type:"added"}:{payload:t,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Fe.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,ci.D)(this.ref.get(e)).pipe((0,Eh.QV)(this.afs.schedulers.insideAngular))}}class mI{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?uI(this.query,this.afs.schedulers.outsideAngular).pipe((0,Fe.U)(t=>t.filter(t=>e.indexOf(t.type)>-1)),Me(e=>e.length>0),this.afs.keepUnstableUntilFirst):uI(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(e){return this.stateChanges(e).pipe(Ui((e,t)=>[...e,...t],[]))}snapshotChanges(e){const t=dI(e);return lI(this.query,t,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(e={}){return cI(this.query,this.afs.schedulers.outsideAngular).pipe((0,Fe.U)(t=>t.payload.docs.map(t=>e.idField?Object.assign({[e.idField]:t.id},t.data()):t.data())),this.afs.keepUnstableUntilFirst)}get(e){return(0,ci.D)(this.query.get(e)).pipe((0,Eh.QV)(this.afs.schedulers.insideAngular))}}const gI=new r.OlP("angularfire2.enableFirestorePersistence"),_I=new r.OlP("angularfire2.firestore.persistenceSettings"),vI=new r.OlP("angularfire2.firestore.settings"),yI=new r.OlP("angularfire2.firestore.use-emulator");function EI(e,t=(e=>e)){return{query:t(e),ref:e}}let SI=(()=>{class e{constructor(e,t,n,r,i,o,s,a,c){this.schedulers=new Sh.HU(o),this.keepUnstableUntilFirst=(0,Sh.ss)(this.schedulers);const u=(0,Sh.on)(e,o,t);!Th.Z.auth&&c&&(0,Sh.yq)();const l=a;[this.firestore,this.persistenceEnabled$]=(0,Sh.sI)(`${u.name}.firestore`,"AngularFirestore",u,()=>{const e=o.runOutsideAngular(()=>u.firestore());if(r&&e.settings(r),l&&e.useEmulator(...l),n&&!K(i)){const t=()=>{try{return(0,ci.D)(e.enablePersistence(s||void 0).then(()=>!0,()=>!1))}catch(jR){return"undefined"!=typeof console&&console.warn(jR),(0,ke.of)(!1)}};return[e,o.runOutsideAngular(t)]}return[e,(0,ke.of)(!1)]},[r,l,n])}collection(e,t){let n;n="string"==typeof e?this.firestore.collection(e):e;const{ref:r,query:i}=EI(n,t),o=this.schedulers.ngZone.run(()=>r);return new pI(o,i,this)}collectionGroup(e,t){const n=t||(e=>e),r=this.firestore.collectionGroup(e);return new mI(n(r),this)}doc(e){let t;t="string"==typeof e?this.firestore.doc(e):e;const n=this.schedulers.ngZone.run(()=>t);return new fI(n,this)}createId(){return this.firestore.collection("_").doc().id}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(Sh.Dh),r.LFG(Sh.xv,8),r.LFG(gI,8),r.LFG(vI,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(_I,8),r.LFG(yI,8),r.LFG(eI,8))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(Sh.Dh),r.LFG(Sh.xv,8),r.LFG(gI,8),r.LFG(vI,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(_I,8),r.LFG(yI,8),r.LFG(eI,8))},token:e,providedIn:"any"}),e})();function TI(e){return null!=e&&"false"!=`${e}`}function bI(e,t=0){return function(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):t}function wI(e){return Array.isArray(e)?e:[e]}function RI(e){return null==e?"":"string"==typeof e?e:`${e}px`}function II(e){return e instanceof r.SBq?e.nativeElement:e}var CI=n(5024);function AI(e,t,n,r){return(0,CI.m)(n)&&(r=n,n=void 0),r?AI(e,t,n).pipe((0,Fe.U)(e=>(0,pi.k)(e)?r(...e):r(e))):new De.y(r=>{OI(e,t,function(e){r.next(arguments.length>1?Array.prototype.slice.call(arguments):e)},r,n)})}function OI(e,t,n,r,i){let o;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){const r=e;e.addEventListener(t,n,i),o=()=>r.removeEventListener(t,n,i)}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){const r=e;e.on(t,n),o=()=>r.off(t,n)}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e)){const r=e;e.addListener(t,n),o=()=>r.removeListener(t,n)}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(let o=0,s=e.length;o<s;o++)OI(e[o],t,n,r,i)}r.add(o)}n(8277),n(1098),n(2709);class NI{constructor(e){this.durationSelector=e}call(e,t){return t.subscribe(new kI(e,this.durationSelector))}}class kI extends Ai.Ds{constructor(e,t){super(e),this.durationSelector=t,this.hasValue=!1}_next(e){if(this.value=e,this.hasValue=!0,!this.throttled){let n;try{const{durationSelector:t}=this;n=t(e)}catch(t){return this.destination.error(t)}const r=(0,Ai.ft)(n,new Ai.IY(this));!r||r.closed?this.clearThrottle():this.add(this.throttled=r)}}clearThrottle(){const{value:e,hasValue:t,throttled:n}=this;n&&(this.remove(n),this.throttled=void 0,n.unsubscribe()),t&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}var DI=n(2293);function PI(e){const{index:t,period:n,subscriber:r}=e;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function LI(e,t=ph.P){return n=()=>function(e=0,t,n){let r=-1;return(0,DI.k)(t)?r=Number(t)<1?1:Number(t):(0,di.K)(t)&&(n=t),(0,di.K)(n)||(n=ph.P),new De.y(t=>{const i=(0,DI.k)(e)?e:+e-n.now();return n.schedule(PI,i,{index:0,period:r,subscriber:t})})}(e,t),function(e){return e.lift(new NI(n))};var n}function xI(e){return t=>t.lift(new MI(e))}class MI{constructor(e){this.notifier=e}call(e,t){const n=new UI(e),r=(0,Ai.ft)(this.notifier,new Ai.IY(n));return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n}}class UI extends Ai.Ds{constructor(e){super(e),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}let VI;try{VI="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(Iw){VI=!1}let FI,BI,jI=(()=>{class e{constructor(e){this._platformId=e,this.isBrowser=this._platformId?"browser"===this._platformId:"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!VI)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(r.Lbi))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(r.Lbi))},token:e,providedIn:"root"}),e})(),GI=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({}),e})();function qI(e){return function(){if(null==FI&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>FI=!0}))}finally{FI=FI||!1}return FI}()?e:!!e.capture}function HI(){if(null==BI){if("object"!=typeof document||!document||"function"!=typeof Element||!Element)return BI=!1,BI;if("scrollBehavior"in document.documentElement.style)BI=!0;else{const e=Element.prototype.scrollTo;BI=!!e&&!/\{\s*\[native code\]\s*\}/.test(e.toString())}}return BI}const WI=new r.OlP("cdk-dir-doc",{providedIn:"root",factory:function(){return(0,r.f3M)(s)}});let zI=(()=>{class e{constructor(e){if(this.value="ltr",this.change=new r.vpe,e){const t=e.documentElement?e.documentElement.dir:null,n=(e.body?e.body.dir:null)||t;this.value="ltr"===n||"rtl"===n?n:"ltr"}}ngOnDestroy(){this.change.complete()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(WI,8))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(WI,8))},token:e,providedIn:"root"}),e})(),KI=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({}),e})();class YI{constructor(e=!1,t,n=!0){this._multiple=e,this._emitChanges=n,this._selection=new Set,this._deselectedToEmit=[],this._selectedToEmit=[],this.changed=new ui.xQ,t&&t.length&&(e?t.forEach(e=>this._markSelected(e)):this._markSelected(t[0]),this._selectedToEmit.length=0)}get selected(){return this._selected||(this._selected=Array.from(this._selection.values())),this._selected}select(...e){this._verifyValueAssignment(e),e.forEach(e=>this._markSelected(e)),this._emitChangeEvent()}deselect(...e){this._verifyValueAssignment(e),e.forEach(e=>this._unmarkSelected(e)),this._emitChangeEvent()}toggle(e){this.isSelected(e)?this.deselect(e):this.select(e)}clear(){this._unmarkAll(),this._emitChangeEvent()}isSelected(e){return this._selection.has(e)}isEmpty(){return 0===this._selection.size}hasValue(){return!this.isEmpty()}sort(e){this._multiple&&this.selected&&this._selected.sort(e)}isMultipleSelection(){return this._multiple}_emitChangeEvent(){this._selected=null,(this._selectedToEmit.length||this._deselectedToEmit.length)&&(this.changed.next({source:this,added:this._selectedToEmit,removed:this._deselectedToEmit}),this._deselectedToEmit=[],this._selectedToEmit=[])}_markSelected(e){this.isSelected(e)||(this._multiple||this._unmarkAll(),this._selection.add(e),this._emitChanges&&this._selectedToEmit.push(e))}_unmarkSelected(e){this.isSelected(e)&&(this._selection.delete(e),this._emitChanges&&this._deselectedToEmit.push(e))}_unmarkAll(){this.isEmpty()||this._selection.forEach(e=>this._unmarkSelected(e))}_verifyValueAssignment(e){}}let QI=(()=>{class e{constructor(e,t,n){this._ngZone=e,this._platform=t,this._scrolled=new ui.xQ,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=n}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){const t=this.scrollContainers.get(e);t&&(t.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=20){return this._platform.isBrowser?new De.y(t=>{this._globalSubscription||this._addGlobalListener();const n=e>0?this._scrolled.pipe(LI(e)).subscribe(t):this._scrolled.subscribe(t);return this._scrolledCount++,()=>{n.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):(0,ke.of)()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,t)=>this.deregister(t)),this._scrolled.complete()}ancestorScrolled(e,t){const n=this.getAncestorScrollContainers(e);return this.scrolled(t).pipe(Me(e=>!e||n.indexOf(e)>-1))}getAncestorScrollContainers(e){const t=[];return this.scrollContainers.forEach((n,r)=>{this._scrollableContainsElement(r,e)&&t.push(r)}),t}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,t){let n=II(t),r=e.getElementRef().nativeElement;do{if(n==r)return!0}while(n=n.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>AI(this._getWindow().document,"scroll").subscribe(()=>this._scrolled.next()))}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(r.R0b),r.LFG(jI),r.LFG(s,8))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(r.R0b),r.LFG(jI),r.LFG(s,8))},token:e,providedIn:"root"}),e})(),JI=(()=>{class e{constructor(e,t,n){this._platform=e,this._change=new ui.xQ,this._changeListener=e=>{this._change.next(e)},this._document=n,t.runOutsideAngular(()=>{if(e.isBrowser){const e=this._getWindow();e.addEventListener("resize",this._changeListener),e.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._updateViewportSize())})}ngOnDestroy(){if(this._platform.isBrowser){const e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();const e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){const e=this.getViewportScrollPosition(),{width:t,height:n}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+n,right:e.left+t,height:n,width:t}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};const e=this._document,t=this._getWindow(),n=e.documentElement,r=n.getBoundingClientRect();return{top:-r.top||e.body.scrollTop||t.scrollY||n.scrollTop||0,left:-r.left||e.body.scrollLeft||t.scrollX||n.scrollLeft||0}}change(e=20){return e>0?this._change.pipe(LI(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){const e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(jI),r.LFG(r.R0b),r.LFG(s,8))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(jI),r.LFG(r.R0b),r.LFG(s,8))},token:e,providedIn:"root"}),e})(),XI=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({}),e})(),$I=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[KI,GI,XI],KI,XI]}),e})();class ZI{attach(e){return this._attachedHost=e,e.attach(this)}detach(){let e=this._attachedHost;null!=e&&(this._attachedHost=null,e.detach())}get isAttached(){return null!=this._attachedHost}setAttachedHost(e){this._attachedHost=e}}class eC extends ZI{constructor(e,t,n,r){super(),this.component=e,this.viewContainerRef=t,this.injector=n,this.componentFactoryResolver=r}}class tC extends ZI{constructor(e,t,n){super(),this.templateRef=e,this.viewContainerRef=t,this.context=n}get origin(){return this.templateRef.elementRef}attach(e,t=this.context){return this.context=t,super.attach(e)}detach(){return this.context=void 0,super.detach()}}class nC extends ZI{constructor(e){super(),this.element=e instanceof r.SBq?e.nativeElement:e}}class rC extends class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(e){return e instanceof eC?(this._attachedPortal=e,this.attachComponentPortal(e)):e instanceof tC?(this._attachedPortal=e,this.attachTemplatePortal(e)):this.attachDomPortal&&e instanceof nC?(this._attachedPortal=e,this.attachDomPortal(e)):void 0}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(e){this._disposeFn=e}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}}{constructor(e,t,n,r,i){super(),this.outletElement=e,this._componentFactoryResolver=t,this._appRef=n,this._defaultInjector=r,this.attachDomPortal=e=>{const t=e.element,n=this._document.createComment("dom-portal");t.parentNode.insertBefore(n,t),this.outletElement.appendChild(t),this._attachedPortal=e,super.setDisposeFn(()=>{n.parentNode&&n.parentNode.replaceChild(t,n)})},this._document=i}attachComponentPortal(e){const t=(e.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(e.component);let n;return e.viewContainerRef?(n=e.viewContainerRef.createComponent(t,e.viewContainerRef.length,e.injector||e.viewContainerRef.injector),this.setDisposeFn(()=>n.destroy())):(n=t.create(e.injector||this._defaultInjector),this._appRef.attachView(n.hostView),this.setDisposeFn(()=>{this._appRef.detachView(n.hostView),n.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(n)),this._attachedPortal=e,n}attachTemplatePortal(e){let t=e.viewContainerRef,n=t.createEmbeddedView(e.templateRef,e.context);return n.rootNodes.forEach(e=>this.outletElement.appendChild(e)),n.detectChanges(),this.setDisposeFn(()=>{let e=t.indexOf(n);-1!==e&&t.remove(e)}),this._attachedPortal=e,n}dispose(){super.dispose(),null!=this.outletElement.parentNode&&this.outletElement.parentNode.removeChild(this.outletElement)}_getComponentRootNode(e){return e.hostView.rootNodes[0]}}let iC=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({}),e})();class oC{constructor(e,t){this.predicate=e,this.inclusive=t}call(e,t){return t.subscribe(new sC(e,this.predicate,this.inclusive))}}class sC extends xe.L{constructor(e,t,n){super(e),this.predicate=t,this.inclusive=n,this.index=0}_next(e){const t=this.destination;let n;try{n=this.predicate(e,this.index++)}catch(r){return void t.error(r)}this.nextOrComplete(e,n)}nextOrComplete(e,t){const n=this.destination;Boolean(t)?n.next(e):(this.inclusive&&n.next(e),n.complete())}}function aC(e,...t){return t.length?t.some(t=>e[t]):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}const cC=HI();class uC{constructor(e,t){this._viewportRuler=e,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=t}attach(){}enable(){if(this._canBeEnabled()){const e=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=e.style.left||"",this._previousHTMLStyles.top=e.style.top||"",e.style.left=RI(-this._previousScrollPosition.left),e.style.top=RI(-this._previousScrollPosition.top),e.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){const e=this._document.documentElement,t=e.style,n=this._document.body.style,r=t.scrollBehavior||"",i=n.scrollBehavior||"";this._isEnabled=!1,t.left=this._previousHTMLStyles.left,t.top=this._previousHTMLStyles.top,e.classList.remove("cdk-global-scrollblock"),cC&&(t.scrollBehavior=n.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),cC&&(t.scrollBehavior=r,n.scrollBehavior=i)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;const e=this._document.body,t=this._viewportRuler.getViewportSize();return e.scrollHeight>t.height||e.scrollWidth>t.width}}class lC{constructor(e,t,n,r){this._scrollDispatcher=e,this._ngZone=t,this._viewportRuler=n,this._config=r,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(e){this._overlayRef=e}enable(){if(this._scrollSubscription)return;const e=this._scrollDispatcher.scrolled(0);this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=e.subscribe(()=>{const e=this._viewportRuler.getViewportScrollPosition().top;Math.abs(e-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=e.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}class hC{enable(){}disable(){}attach(){}}function dC(e,t){return t.some(t=>e.bottom<t.top||e.top>t.bottom||e.right<t.left||e.left>t.right)}function pC(e,t){return t.some(t=>e.top<t.top||e.bottom>t.bottom||e.left<t.left||e.right>t.right)}class fC{constructor(e,t,n,r){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=n,this._config=r,this._scrollSubscription=null}attach(e){this._overlayRef=e}enable(){this._scrollSubscription||(this._scrollSubscription=this._scrollDispatcher.scrolled(this._config?this._config.scrollThrottle:0).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){const e=this._overlayRef.overlayElement.getBoundingClientRect(),{width:t,height:n}=this._viewportRuler.getViewportSize();dC(e,[{width:t,height:n,bottom:n,right:t,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}}))}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}}let mC=(()=>{class e{constructor(e,t,n,r){this._scrollDispatcher=e,this._viewportRuler=t,this._ngZone=n,this.noop=()=>new hC,this.close=e=>new lC(this._scrollDispatcher,this._ngZone,this._viewportRuler,e),this.block=()=>new uC(this._viewportRuler,this._document),this.reposition=e=>new fC(this._scrollDispatcher,this._viewportRuler,this._ngZone,e),this._document=r}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(QI),r.LFG(JI),r.LFG(r.R0b),r.LFG(s))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(QI),r.LFG(JI),r.LFG(r.R0b),r.LFG(s))},token:e,providedIn:"root"}),e})();class gC{constructor(e){if(this.scrollStrategy=new hC,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,e){const t=Object.keys(e);for(const n of t)void 0!==e[n]&&(this[n]=e[n])}}}class _C{constructor(e,t,n,r,i){this.offsetX=n,this.offsetY=r,this.panelClass=i,this.originX=e.originX,this.originY=e.originY,this.overlayX=t.overlayX,this.overlayY=t.overlayY}}class vC{constructor(e,t){this.connectionPair=e,this.scrollableViewProperties=t}}let yC=(()=>{class e{constructor(e){this._attachedOverlays=[],this._document=e}ngOnDestroy(){this.detach()}add(e){this.remove(e),this._attachedOverlays.push(e)}remove(e){const t=this._attachedOverlays.indexOf(e);t>-1&&this._attachedOverlays.splice(t,1),0===this._attachedOverlays.length&&this.detach()}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(s))},token:e,providedIn:"root"}),e})(),EC=(()=>{class e extends yC{constructor(e){super(e),this._keydownListener=e=>{const t=this._attachedOverlays;for(let n=t.length-1;n>-1;n--)if(t[n]._keydownEvents.observers.length>0){t[n]._keydownEvents.next(e);break}}}add(e){super.add(e),this._isAttached||(this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(s))},token:e,providedIn:"root"}),e})(),SC=(()=>{class e extends yC{constructor(e,t){super(e),this._platform=t,this._cursorStyleIsSet=!1,this._clickListener=e=>{const t=e.composedPath?e.composedPath()[0]:e.target,n=this._attachedOverlays.slice();for(let r=n.length-1;r>-1;r--){const i=n[r];if(!(i._outsidePointerEvents.observers.length<1)&&i.hasAttached()){if(i.overlayElement.contains(t))break;i._outsidePointerEvents.next(e)}}}}add(e){if(super.add(e),!this._isAttached){const e=this._document.body;e.addEventListener("click",this._clickListener,!0),e.addEventListener("auxclick",this._clickListener,!0),e.addEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=e.style.cursor,e.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){const e=this._document.body;e.removeEventListener("click",this._clickListener,!0),e.removeEventListener("auxclick",this._clickListener,!0),e.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(e.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s),r.LFG(jI))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(s),r.LFG(jI))},token:e,providedIn:"root"}),e})();const TC="undefined"!=typeof __karma__&&!!__karma__||"undefined"!=typeof jasmine&&!!jasmine||"undefined"!=typeof jest&&!!jest||"undefined"!=typeof Mocha&&!!Mocha;let bC=(()=>{class e{constructor(e,t){this._platform=t,this._document=e}ngOnDestroy(){const e=this._containerElement;e&&e.parentNode&&e.parentNode.removeChild(e)}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){const e="cdk-overlay-container";if(this._platform.isBrowser||TC){const t=this._document.querySelectorAll(`.${e}[platform="server"], .${e}[platform="test"]`);for(let e=0;e<t.length;e++)t[e].parentNode.removeChild(t[e])}const t=this._document.createElement("div");t.classList.add(e),TC?t.setAttribute("platform","test"):this._platform.isBrowser||t.setAttribute("platform","server"),this._document.body.appendChild(t),this._containerElement=t}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(s),r.LFG(jI))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(s),r.LFG(jI))},token:e,providedIn:"root"}),e})();class wC{constructor(e,t,n,r,i,o,s,a,c){this._portalOutlet=e,this._host=t,this._pane=n,this._config=r,this._ngZone=i,this._keyboardDispatcher=o,this._document=s,this._location=a,this._outsideClickDispatcher=c,this._backdropElement=null,this._backdropClick=new ui.xQ,this._attachments=new ui.xQ,this._detachments=new ui.xQ,this._locationChanges=ro.w.EMPTY,this._backdropClickHandler=e=>this._backdropClick.next(e),this._keydownEvents=new ui.xQ,this._outsidePointerEvents=new ui.xQ,r.scrollStrategy&&(this._scrollStrategy=r.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=r.positionStrategy}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(e){let t=this._portalOutlet.attach(e);return!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host),this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),this._ngZone.onStable.pipe(Pi(1)).subscribe(()=>{this.hasAttached()&&this.updatePosition()}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),t}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();const e=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenStable(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),e}dispose(){const e=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this.detachBackdrop(),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host&&this._host.parentNode&&(this._host.parentNode.removeChild(this._host),this._host=null),this._previousHostParent=this._pane=null,e&&this._detachments.next(),this._detachments.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(e){e!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=e,this.hasAttached()&&(e.attach(this),this.updatePosition()))}updateSize(e){this._config=Object.assign(Object.assign({},this._config),e),this._updateElementSize()}setDirection(e){this._config=Object.assign(Object.assign({},this._config),{direction:e}),this._updateElementDirection()}addPanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!0)}removePanelClass(e){this._pane&&this._toggleClasses(this._pane,e,!1)}getDirection(){const e=this._config.direction;return e?"string"==typeof e?e:e.value:"ltr"}updateScrollStrategy(e){e!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=e,this.hasAttached()&&(e.attach(this),e.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;const e=this._pane.style;e.width=RI(this._config.width),e.height=RI(this._config.height),e.minWidth=RI(this._config.minWidth),e.minHeight=RI(this._config.minHeight),e.maxWidth=RI(this._config.maxWidth),e.maxHeight=RI(this._config.maxHeight)}_togglePointerEvents(e){this._pane.style.pointerEvents=e?"":"none"}_attachBackdrop(){const e="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),"undefined"!=typeof requestAnimationFrame?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(e)})}):this._backdropElement.classList.add(e)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let e,t=this._backdropElement;if(!t)return;let n=()=>{t&&(t.removeEventListener("click",this._backdropClickHandler),t.removeEventListener("transitionend",n),t.parentNode&&t.parentNode.removeChild(t)),this._backdropElement==t&&(this._backdropElement=null),this._config.backdropClass&&this._toggleClasses(t,this._config.backdropClass,!1),clearTimeout(e)};t.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{t.addEventListener("transitionend",n)}),t.style.pointerEvents="none",e=this._ngZone.runOutsideAngular(()=>setTimeout(n,500))}_toggleClasses(e,t,n){const r=e.classList;wI(t).forEach(e=>{e&&(n?r.add(e):r.remove(e))})}_detachContentWhenStable(){this._ngZone.runOutsideAngular(()=>{const e=this._ngZone.onStable.pipe(xI((0,zR.T)(this._attachments,this._detachments))).subscribe(()=>{this._pane&&this._host&&0!==this._pane.children.length||(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._previousHostParent.removeChild(this._host)),e.unsubscribe())})})}_disposeScrollStrategy(){const e=this._scrollStrategy;e&&(e.disable(),e.detach&&e.detach())}}const RC="cdk-overlay-connected-position-bounding-box",IC=/([A-Za-z%]+)$/;class CC{constructor(e,t,n,r,i){this._viewportRuler=t,this._document=n,this._platform=r,this._overlayContainer=i,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new ui.xQ,this._resizeSubscription=ro.w.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(e)}get positions(){return this._preferredPositions}attach(e){this._validatePositions(),e.hostElement.classList.add(RC),this._overlayRef=e,this._boundingBox=e.hostElement,this._pane=e.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition)return void this.reapplyLastPosition();this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect();const e=this._originRect,t=this._overlayRect,n=this._viewportRect,r=[];let i;for(let o of this._preferredPositions){let s=this._getOriginPoint(e,o),a=this._getOverlayPoint(s,t,o),c=this._getOverlayFit(a,t,n,o);if(c.isCompletelyWithinViewport)return this._isPushed=!1,void this._applyPosition(o,s);this._canFitWithFlexibleDimensions(c,a,n)?r.push({position:o,origin:s,overlayRect:t,boundingBoxRect:this._calculateBoundingBoxRect(s,o)}):(!i||i.overlayFit.visibleArea<c.visibleArea)&&(i={overlayFit:c,overlayPoint:a,originPoint:s,position:o,overlayRect:t})}if(r.length){let e=null,t=-1;for(const n of r){const r=n.boundingBoxRect.width*n.boundingBoxRect.height*(n.position.weight||1);r>t&&(t=r,e=n)}return this._isPushed=!1,void this._applyPosition(e.position,e.origin)}if(this._canPush)return this._isPushed=!0,void this._applyPosition(i.position,i.originPoint);this._applyPosition(i.position,i.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&AC(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(RC),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(!this._isDisposed&&(!this._platform||this._platform.isBrowser)){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect();const e=this._lastPosition||this._preferredPositions[0],t=this._getOriginPoint(this._originRect,e);this._applyPosition(e,t)}}withScrollableContainers(e){return this._scrollables=e,this}withPositions(e){return this._preferredPositions=e,-1===e.indexOf(this._lastPosition)&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(e){return this._viewportMargin=e,this}withFlexibleDimensions(e=!0){return this._hasFlexibleDimensions=e,this}withGrowAfterOpen(e=!0){return this._growAfterOpen=e,this}withPush(e=!0){return this._canPush=e,this}withLockedPosition(e=!0){return this._positionLocked=e,this}setOrigin(e){return this._origin=e,this}withDefaultOffsetX(e){return this._offsetX=e,this}withDefaultOffsetY(e){return this._offsetY=e,this}withTransformOriginOn(e){return this._transformOriginSelector=e,this}_getOriginPoint(e,t){let n,r;if("center"==t.originX)n=e.left+e.width/2;else{const r=this._isRtl()?e.right:e.left,i=this._isRtl()?e.left:e.right;n="start"==t.originX?r:i}return r="center"==t.originY?e.top+e.height/2:"top"==t.originY?e.top:e.bottom,{x:n,y:r}}_getOverlayPoint(e,t,n){let r,i;return r="center"==n.overlayX?-t.width/2:"start"===n.overlayX?this._isRtl()?-t.width:0:this._isRtl()?0:-t.width,i="center"==n.overlayY?-t.height/2:"top"==n.overlayY?0:-t.height,{x:e.x+r,y:e.y+i}}_getOverlayFit(e,t,n,r){const i=NC(t);let{x:o,y:s}=e,a=this._getOffset(r,"x"),c=this._getOffset(r,"y");a&&(o+=a),c&&(s+=c);let u=0-s,l=s+i.height-n.height,h=this._subtractOverflows(i.width,0-o,o+i.width-n.width),d=this._subtractOverflows(i.height,u,l),p=h*d;return{visibleArea:p,isCompletelyWithinViewport:i.width*i.height===p,fitsInViewportVertically:d===i.height,fitsInViewportHorizontally:h==i.width}}_canFitWithFlexibleDimensions(e,t,n){if(this._hasFlexibleDimensions){const r=n.bottom-t.y,i=n.right-t.x,o=OC(this._overlayRef.getConfig().minHeight),s=OC(this._overlayRef.getConfig().minWidth),a=e.fitsInViewportHorizontally||null!=s&&s<=i;return(e.fitsInViewportVertically||null!=o&&o<=r)&&a}return!1}_pushOverlayOnScreen(e,t,n){if(this._previousPushAmount&&this._positionLocked)return{x:e.x+this._previousPushAmount.x,y:e.y+this._previousPushAmount.y};const r=NC(t),i=this._viewportRect,o=Math.max(e.x+r.width-i.width,0),s=Math.max(e.y+r.height-i.height,0),a=Math.max(i.top-n.top-e.y,0),c=Math.max(i.left-n.left-e.x,0);let u=0,l=0;return u=r.width<=i.width?c||-o:e.x<this._viewportMargin?i.left-n.left-e.x:0,l=r.height<=i.height?a||-s:e.y<this._viewportMargin?i.top-n.top-e.y:0,this._previousPushAmount={x:u,y:l},{x:e.x+u,y:e.y+l}}_applyPosition(e,t){if(this._setTransformOrigin(e),this._setOverlayElementStyles(t,e),this._setBoundingBoxStyles(t,e),e.panelClass&&this._addPanelClasses(e.panelClass),this._lastPosition=e,this._positionChanges.observers.length){const t=this._getScrollVisibility(),n=new vC(e,t);this._positionChanges.next(n)}this._isInitialRender=!1}_setTransformOrigin(e){if(!this._transformOriginSelector)return;const t=this._boundingBox.querySelectorAll(this._transformOriginSelector);let n,r=e.overlayY;n="center"===e.overlayX?"center":this._isRtl()?"start"===e.overlayX?"right":"left":"start"===e.overlayX?"left":"right";for(let i=0;i<t.length;i++)t[i].style.transformOrigin=`${n} ${r}`}_calculateBoundingBoxRect(e,t){const n=this._viewportRect,r=this._isRtl();let i,o,s,a,c,u;if("top"===t.overlayY)o=e.y,i=n.height-o+this._viewportMargin;else if("bottom"===t.overlayY)s=n.height-e.y+2*this._viewportMargin,i=n.height-s+this._viewportMargin;else{const t=Math.min(n.bottom-e.y+n.top,e.y),r=this._lastBoundingBoxSize.height;i=2*t,o=e.y-t,i>r&&!this._isInitialRender&&!this._growAfterOpen&&(o=e.y-r/2)}if("end"===t.overlayX&&!r||"start"===t.overlayX&&r)u=n.width-e.x+this._viewportMargin,a=e.x-this._viewportMargin;else if("start"===t.overlayX&&!r||"end"===t.overlayX&&r)c=e.x,a=n.right-e.x;else{const t=Math.min(n.right-e.x+n.left,e.x),r=this._lastBoundingBoxSize.width;a=2*t,c=e.x-t,a>r&&!this._isInitialRender&&!this._growAfterOpen&&(c=e.x-r/2)}return{top:o,left:c,bottom:s,right:u,width:a,height:i}}_setBoundingBoxStyles(e,t){const n=this._calculateBoundingBoxRect(e,t);this._isInitialRender||this._growAfterOpen||(n.height=Math.min(n.height,this._lastBoundingBoxSize.height),n.width=Math.min(n.width,this._lastBoundingBoxSize.width));const r={};if(this._hasExactPosition())r.top=r.left="0",r.bottom=r.right=r.maxHeight=r.maxWidth="",r.width=r.height="100%";else{const e=this._overlayRef.getConfig().maxHeight,i=this._overlayRef.getConfig().maxWidth;r.height=RI(n.height),r.top=RI(n.top),r.bottom=RI(n.bottom),r.width=RI(n.width),r.left=RI(n.left),r.right=RI(n.right),r.alignItems="center"===t.overlayX?"center":"end"===t.overlayX?"flex-end":"flex-start",r.justifyContent="center"===t.overlayY?"center":"bottom"===t.overlayY?"flex-end":"flex-start",e&&(r.maxHeight=RI(e)),i&&(r.maxWidth=RI(i))}this._lastBoundingBoxSize=n,AC(this._boundingBox.style,r)}_resetBoundingBoxStyles(){AC(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){AC(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(e,t){const n={},r=this._hasExactPosition(),i=this._hasFlexibleDimensions,o=this._overlayRef.getConfig();if(r){const r=this._viewportRuler.getViewportScrollPosition();AC(n,this._getExactOverlayY(t,e,r)),AC(n,this._getExactOverlayX(t,e,r))}else n.position="static";let s="",a=this._getOffset(t,"x"),c=this._getOffset(t,"y");a&&(s+=`translateX(${a}px) `),c&&(s+=`translateY(${c}px)`),n.transform=s.trim(),o.maxHeight&&(r?n.maxHeight=RI(o.maxHeight):i&&(n.maxHeight="")),o.maxWidth&&(r?n.maxWidth=RI(o.maxWidth):i&&(n.maxWidth="")),AC(this._pane.style,n)}_getExactOverlayY(e,t,n){let r={top:"",bottom:""},i=this._getOverlayPoint(t,this._overlayRect,e);this._isPushed&&(i=this._pushOverlayOnScreen(i,this._overlayRect,n));let o=this._overlayContainer.getContainerElement().getBoundingClientRect().top;return i.y-=o,"bottom"===e.overlayY?r.bottom=this._document.documentElement.clientHeight-(i.y+this._overlayRect.height)+"px":r.top=RI(i.y),r}_getExactOverlayX(e,t,n){let r,i={left:"",right:""},o=this._getOverlayPoint(t,this._overlayRect,e);return this._isPushed&&(o=this._pushOverlayOnScreen(o,this._overlayRect,n)),r=this._isRtl()?"end"===e.overlayX?"left":"right":"end"===e.overlayX?"right":"left","right"===r?i.right=this._document.documentElement.clientWidth-(o.x+this._overlayRect.width)+"px":i.left=RI(o.x),i}_getScrollVisibility(){const e=this._getOriginRect(),t=this._pane.getBoundingClientRect(),n=this._scrollables.map(e=>e.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:pC(e,n),isOriginOutsideView:dC(e,n),isOverlayClipped:pC(t,n),isOverlayOutsideView:dC(t,n)}}_subtractOverflows(e,...t){return t.reduce((e,t)=>e-Math.max(t,0),e)}_getNarrowedViewportRect(){const e=this._document.documentElement.clientWidth,t=this._document.documentElement.clientHeight,n=this._viewportRuler.getViewportScrollPosition();return{top:n.top+this._viewportMargin,left:n.left+this._viewportMargin,right:n.left+e-this._viewportMargin,bottom:n.top+t-this._viewportMargin,width:e-2*this._viewportMargin,height:t-2*this._viewportMargin}}_isRtl(){return"rtl"===this._overlayRef.getDirection()}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(e,t){return"x"===t?null==e.offsetX?this._offsetX:e.offsetX:null==e.offsetY?this._offsetY:e.offsetY}_validatePositions(){}_addPanelClasses(e){this._pane&&wI(e).forEach(e=>{""!==e&&-1===this._appliedPanelClasses.indexOf(e)&&(this._appliedPanelClasses.push(e),this._pane.classList.add(e))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(e=>{this._pane.classList.remove(e)}),this._appliedPanelClasses=[])}_getOriginRect(){const e=this._origin;if(e instanceof r.SBq)return e.nativeElement.getBoundingClientRect();if(e instanceof Element)return e.getBoundingClientRect();const t=e.width||0,n=e.height||0;return{top:e.y,bottom:e.y+n,left:e.x,right:e.x+t,height:n,width:t}}}function AC(e,t){for(let n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function OC(e){if("number"!=typeof e&&null!=e){const[t,n]=e.split(IC);return n&&"px"!==n?null:parseFloat(t)}return e||null}function NC(e){return{top:Math.floor(e.top),right:Math.floor(e.right),bottom:Math.floor(e.bottom),left:Math.floor(e.left),width:Math.floor(e.width),height:Math.floor(e.height)}}class kC{constructor(e,t,n,r,i,o,s){this._preferredPositions=[],this._positionStrategy=new CC(n,r,i,o,s).withFlexibleDimensions(!1).withPush(!1).withViewportMargin(0),this.withFallbackPosition(e,t),this.onPositionChange=this._positionStrategy.positionChanges}get positions(){return this._preferredPositions}attach(e){this._overlayRef=e,this._positionStrategy.attach(e),this._direction&&(e.setDirection(this._direction),this._direction=null)}dispose(){this._positionStrategy.dispose()}detach(){this._positionStrategy.detach()}apply(){this._positionStrategy.apply()}recalculateLastPosition(){this._positionStrategy.reapplyLastPosition()}withScrollableContainers(e){this._positionStrategy.withScrollableContainers(e)}withFallbackPosition(e,t,n,r){const i=new _C(e,t,n,r);return this._preferredPositions.push(i),this._positionStrategy.withPositions(this._preferredPositions),this}withDirection(e){return this._overlayRef?this._overlayRef.setDirection(e):this._direction=e,this}withOffsetX(e){return this._positionStrategy.withDefaultOffsetX(e),this}withOffsetY(e){return this._positionStrategy.withDefaultOffsetY(e),this}withLockedPosition(e){return this._positionStrategy.withLockedPosition(e),this}withPositions(e){return this._preferredPositions=e.slice(),this._positionStrategy.withPositions(this._preferredPositions),this}setOrigin(e){return this._positionStrategy.setOrigin(e),this}}const DC="cdk-global-overlay-wrapper";class PC{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._leftOffset="",this._rightOffset="",this._alignItems="",this._justifyContent="",this._width="",this._height=""}attach(e){const t=e.getConfig();this._overlayRef=e,this._width&&!t.width&&e.updateSize({width:this._width}),this._height&&!t.height&&e.updateSize({height:this._height}),e.hostElement.classList.add(DC),this._isDisposed=!1}top(e=""){return this._bottomOffset="",this._topOffset=e,this._alignItems="flex-start",this}left(e=""){return this._rightOffset="",this._leftOffset=e,this._justifyContent="flex-start",this}bottom(e=""){return this._topOffset="",this._bottomOffset=e,this._alignItems="flex-end",this}right(e=""){return this._leftOffset="",this._rightOffset=e,this._justifyContent="flex-end",this}width(e=""){return this._overlayRef?this._overlayRef.updateSize({width:e}):this._width=e,this}height(e=""){return this._overlayRef?this._overlayRef.updateSize({height:e}):this._height=e,this}centerHorizontally(e=""){return this.left(e),this._justifyContent="center",this}centerVertically(e=""){return this.top(e),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement.style,n=this._overlayRef.getConfig(),{width:r,height:i,maxWidth:o,maxHeight:s}=n,a=!("100%"!==r&&"100vw"!==r||o&&"100%"!==o&&"100vw"!==o),c=!("100%"!==i&&"100vh"!==i||s&&"100%"!==s&&"100vh"!==s);e.position=this._cssPosition,e.marginLeft=a?"0":this._leftOffset,e.marginTop=c?"0":this._topOffset,e.marginBottom=this._bottomOffset,e.marginRight=this._rightOffset,a?t.justifyContent="flex-start":"center"===this._justifyContent?t.justifyContent="center":"rtl"===this._overlayRef.getConfig().direction?"flex-start"===this._justifyContent?t.justifyContent="flex-end":"flex-end"===this._justifyContent&&(t.justifyContent="flex-start"):t.justifyContent=this._justifyContent,t.alignItems=c?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;const e=this._overlayRef.overlayElement.style,t=this._overlayRef.hostElement,n=t.style;t.classList.remove(DC),n.justifyContent=n.alignItems=e.marginTop=e.marginBottom=e.marginLeft=e.marginRight=e.position="",this._overlayRef=null,this._isDisposed=!0}}let LC=(()=>{class e{constructor(e,t,n,r){this._viewportRuler=e,this._document=t,this._platform=n,this._overlayContainer=r}global(){return new PC}connectedTo(e,t,n){return new kC(t,n,e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}flexibleConnectedTo(e){return new CC(e,this._viewportRuler,this._document,this._platform,this._overlayContainer)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(JI),r.LFG(s),r.LFG(jI),r.LFG(bC))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(JI),r.LFG(s),r.LFG(jI),r.LFG(bC))},token:e,providedIn:"root"}),e})(),xC=0,MC=(()=>{class e{constructor(e,t,n,r,i,o,s,a,c,u,l){this.scrollStrategies=e,this._overlayContainer=t,this._componentFactoryResolver=n,this._positionBuilder=r,this._keyboardDispatcher=i,this._injector=o,this._ngZone=s,this._document=a,this._directionality=c,this._location=u,this._outsideClickDispatcher=l}create(e){const t=this._createHostElement(),n=this._createPaneElement(t),r=this._createPortalOutlet(n),i=new gC(e);return i.direction=i.direction||this._directionality.value,new wC(r,t,n,i,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher)}position(){return this._positionBuilder}_createPaneElement(e){const t=this._document.createElement("div");return t.id="cdk-overlay-"+xC++,t.classList.add("cdk-overlay-pane"),e.appendChild(t),t}_createHostElement(){const e=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(e),e}_createPortalOutlet(e){return this._appRef||(this._appRef=this._injector.get(r.z2F)),new rC(e,this._componentFactoryResolver,this._appRef,this._injector,this._document)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(mC),r.LFG(bC),r.LFG(r._Vd),r.LFG(LC),r.LFG(EC),r.LFG(r.zs3),r.LFG(r.R0b),r.LFG(s),r.LFG(zI),r.LFG(S),r.LFG(SC))},e.\u0275prov=r.Yz7({token:e,factory:e.\u0275fac}),e})();const UC=[{originX:"start",originY:"bottom",overlayX:"start",overlayY:"top"},{originX:"start",originY:"top",overlayX:"start",overlayY:"bottom"},{originX:"end",originY:"top",overlayX:"end",overlayY:"bottom"},{originX:"end",originY:"bottom",overlayX:"end",overlayY:"top"}],VC=new r.OlP("cdk-connected-overlay-scroll-strategy");let FC=(()=>{class e{constructor(e){this.elementRef=e}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq))},e.\u0275dir=r.lG2({type:e,selectors:[["","cdk-overlay-origin",""],["","overlay-origin",""],["","cdkOverlayOrigin",""]],exportAs:["cdkOverlayOrigin"]}),e})(),BC=(()=>{class e{constructor(e,t,n,i,o){this._overlay=e,this._dir=o,this._hasBackdrop=!1,this._lockPosition=!1,this._growAfterOpen=!1,this._flexibleDimensions=!1,this._push=!1,this._backdropSubscription=ro.w.EMPTY,this._attachSubscription=ro.w.EMPTY,this._detachSubscription=ro.w.EMPTY,this._positionSubscription=ro.w.EMPTY,this.viewportMargin=0,this.open=!1,this.disableClose=!1,this.backdropClick=new r.vpe,this.positionChange=new r.vpe,this.attach=new r.vpe,this.detach=new r.vpe,this.overlayKeydown=new r.vpe,this.overlayOutsideClick=new r.vpe,this._templatePortal=new tC(t,n),this._scrollStrategyFactory=i,this.scrollStrategy=this._scrollStrategyFactory()}get offsetX(){return this._offsetX}set offsetX(e){this._offsetX=e,this._position&&this._updatePositionStrategy(this._position)}get offsetY(){return this._offsetY}set offsetY(e){this._offsetY=e,this._position&&this._updatePositionStrategy(this._position)}get hasBackdrop(){return this._hasBackdrop}set hasBackdrop(e){this._hasBackdrop=TI(e)}get lockPosition(){return this._lockPosition}set lockPosition(e){this._lockPosition=TI(e)}get flexibleDimensions(){return this._flexibleDimensions}set flexibleDimensions(e){this._flexibleDimensions=TI(e)}get growAfterOpen(){return this._growAfterOpen}set growAfterOpen(e){this._growAfterOpen=TI(e)}get push(){return this._push}set push(e){this._push=TI(e)}get overlayRef(){return this._overlayRef}get dir(){return this._dir?this._dir.value:"ltr"}ngOnDestroy(){this._attachSubscription.unsubscribe(),this._detachSubscription.unsubscribe(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this._overlayRef&&this._overlayRef.dispose()}ngOnChanges(e){this._position&&(this._updatePositionStrategy(this._position),this._overlayRef.updateSize({width:this.width,minWidth:this.minWidth,height:this.height,minHeight:this.minHeight}),e.origin&&this.open&&this._position.apply()),e.open&&(this.open?this._attachOverlay():this._detachOverlay())}_createOverlay(){this.positions&&this.positions.length||(this.positions=UC);const e=this._overlayRef=this._overlay.create(this._buildConfig());this._attachSubscription=e.attachments().subscribe(()=>this.attach.emit()),this._detachSubscription=e.detachments().subscribe(()=>this.detach.emit()),e.keydownEvents().subscribe(e=>{this.overlayKeydown.next(e),27!==e.keyCode||this.disableClose||aC(e)||(e.preventDefault(),this._detachOverlay())}),this._overlayRef.outsidePointerEvents().subscribe(e=>{this.overlayOutsideClick.next(e)})}_buildConfig(){const e=this._position=this.positionStrategy||this._createPositionStrategy(),t=new gC({direction:this._dir,positionStrategy:e,scrollStrategy:this.scrollStrategy,hasBackdrop:this.hasBackdrop});return(this.width||0===this.width)&&(t.width=this.width),(this.height||0===this.height)&&(t.height=this.height),(this.minWidth||0===this.minWidth)&&(t.minWidth=this.minWidth),(this.minHeight||0===this.minHeight)&&(t.minHeight=this.minHeight),this.backdropClass&&(t.backdropClass=this.backdropClass),this.panelClass&&(t.panelClass=this.panelClass),t}_updatePositionStrategy(e){const t=this.positions.map(e=>({originX:e.originX,originY:e.originY,overlayX:e.overlayX,overlayY:e.overlayY,offsetX:e.offsetX||this.offsetX,offsetY:e.offsetY||this.offsetY,panelClass:e.panelClass||void 0}));return e.setOrigin(this.origin.elementRef).withPositions(t).withFlexibleDimensions(this.flexibleDimensions).withPush(this.push).withGrowAfterOpen(this.growAfterOpen).withViewportMargin(this.viewportMargin).withLockedPosition(this.lockPosition).withTransformOriginOn(this.transformOriginSelector)}_createPositionStrategy(){const e=this._overlay.position().flexibleConnectedTo(this.origin.elementRef);return this._updatePositionStrategy(e),e}_attachOverlay(){this._overlayRef?this._overlayRef.getConfig().hasBackdrop=this.hasBackdrop:this._createOverlay(),this._overlayRef.hasAttached()||this._overlayRef.attach(this._templatePortal),this.hasBackdrop?this._backdropSubscription=this._overlayRef.backdropClick().subscribe(e=>{this.backdropClick.emit(e)}):this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe(),this.positionChange.observers.length>0&&(this._positionSubscription=this._position.positionChanges.pipe(function(e,t=!1){return n=>n.lift(new oC(e,t))}(()=>this.positionChange.observers.length>0)).subscribe(e=>{this.positionChange.emit(e),0===this.positionChange.observers.length&&this._positionSubscription.unsubscribe()}))}_detachOverlay(){this._overlayRef&&this._overlayRef.detach(),this._backdropSubscription.unsubscribe(),this._positionSubscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(MC),r.Y36(r.Rgc),r.Y36(r.s_b),r.Y36(VC),r.Y36(zI,8))},e.\u0275dir=r.lG2({type:e,selectors:[["","cdk-connected-overlay",""],["","connected-overlay",""],["","cdkConnectedOverlay",""]],inputs:{viewportMargin:["cdkConnectedOverlayViewportMargin","viewportMargin"],open:["cdkConnectedOverlayOpen","open"],disableClose:["cdkConnectedOverlayDisableClose","disableClose"],scrollStrategy:["cdkConnectedOverlayScrollStrategy","scrollStrategy"],offsetX:["cdkConnectedOverlayOffsetX","offsetX"],offsetY:["cdkConnectedOverlayOffsetY","offsetY"],hasBackdrop:["cdkConnectedOverlayHasBackdrop","hasBackdrop"],lockPosition:["cdkConnectedOverlayLockPosition","lockPosition"],flexibleDimensions:["cdkConnectedOverlayFlexibleDimensions","flexibleDimensions"],growAfterOpen:["cdkConnectedOverlayGrowAfterOpen","growAfterOpen"],push:["cdkConnectedOverlayPush","push"],positions:["cdkConnectedOverlayPositions","positions"],origin:["cdkConnectedOverlayOrigin","origin"],positionStrategy:["cdkConnectedOverlayPositionStrategy","positionStrategy"],width:["cdkConnectedOverlayWidth","width"],height:["cdkConnectedOverlayHeight","height"],minWidth:["cdkConnectedOverlayMinWidth","minWidth"],minHeight:["cdkConnectedOverlayMinHeight","minHeight"],backdropClass:["cdkConnectedOverlayBackdropClass","backdropClass"],panelClass:["cdkConnectedOverlayPanelClass","panelClass"],transformOriginSelector:["cdkConnectedOverlayTransformOriginOn","transformOriginSelector"]},outputs:{backdropClick:"backdropClick",positionChange:"positionChange",attach:"attach",detach:"detach",overlayKeydown:"overlayKeydown",overlayOutsideClick:"overlayOutsideClick"},exportAs:["cdkConnectedOverlay"],features:[r.TTD]}),e})();const jC={provide:VC,deps:[MC],useFactory:function(e){return()=>e.scrollStrategies.reposition()}};let GC=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:[MC,jC],imports:[[KI,iC,$I],$I]}),e})();class qC{constructor(e,t){this.dueTime=e,this.scheduler=t}call(e,t){return t.subscribe(new HC(e,this.dueTime,this.scheduler))}}class HC extends xe.L{constructor(e,t,n){super(e),this.dueTime=t,this.scheduler=n,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(WC,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:e}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}}clearDebounce(){const e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)}}function WC(e){e.debouncedNext()}let zC=(()=>{class e{create(e){return"undefined"==typeof MutationObserver?null:new MutationObserver(e)}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Yz7({factory:function(){return new e},token:e,providedIn:"root"}),e})(),KC=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:[zC]}),e})();class YC extends class{constructor(e){this._items=e,this._activeItemIndex=-1,this._activeItem=null,this._wrap=!1,this._letterKeyStream=new ui.xQ,this._typeaheadSubscription=ro.w.EMPTY,this._vertical=!0,this._allowedModifierKeys=[],this._homeAndEnd=!1,this._skipPredicateFn=e=>e.disabled,this._pressedLetters=[],this.tabOut=new ui.xQ,this.change=new ui.xQ,e instanceof r.n_E&&e.changes.subscribe(e=>{if(this._activeItem){const t=e.toArray().indexOf(this._activeItem);t>-1&&t!==this._activeItemIndex&&(this._activeItemIndex=t)}})}skipPredicate(e){return this._skipPredicateFn=e,this}withWrap(e=!0){return this._wrap=e,this}withVerticalOrientation(e=!0){return this._vertical=e,this}withHorizontalOrientation(e){return this._horizontal=e,this}withAllowedModifierKeys(e){return this._allowedModifierKeys=e,this}withTypeAhead(e=200){return this._typeaheadSubscription.unsubscribe(),this._typeaheadSubscription=this._letterKeyStream.pipe((0,to.b)(e=>this._pressedLetters.push(e)),function(e,t=ph.P){return n=>n.lift(new qC(e,t))}(e),Me(()=>this._pressedLetters.length>0),(0,Fe.U)(()=>this._pressedLetters.join(""))).subscribe(e=>{const t=this._getItemsArray();for(let n=1;n<t.length+1;n++){const r=(this._activeItemIndex+n)%t.length,i=t[r];if(!this._skipPredicateFn(i)&&0===i.getLabel().toUpperCase().trim().indexOf(e)){this.setActiveItem(r);break}}this._pressedLetters=[]}),this}withHomeAndEnd(e=!0){return this._homeAndEnd=e,this}setActiveItem(e){const t=this._activeItem;this.updateActiveItem(e),this._activeItem!==t&&this.change.next(this._activeItemIndex)}onKeydown(e){const t=e.keyCode,n=["altKey","ctrlKey","metaKey","shiftKey"].every(t=>!e[t]||this._allowedModifierKeys.indexOf(t)>-1);switch(t){case 9:return void this.tabOut.next();case 40:if(this._vertical&&n){this.setNextItemActive();break}return;case 38:if(this._vertical&&n){this.setPreviousItemActive();break}return;case 39:if(this._horizontal&&n){"rtl"===this._horizontal?this.setPreviousItemActive():this.setNextItemActive();break}return;case 37:if(this._horizontal&&n){"rtl"===this._horizontal?this.setNextItemActive():this.setPreviousItemActive();break}return;case 36:if(this._homeAndEnd&&n){this.setFirstItemActive();break}return;case 35:if(this._homeAndEnd&&n){this.setLastItemActive();break}return;default:return void((n||aC(e,"shiftKey"))&&(e.key&&1===e.key.length?this._letterKeyStream.next(e.key.toLocaleUpperCase()):(t>=65&&t<=90||t>=48&&t<=57)&&this._letterKeyStream.next(String.fromCharCode(t))))}this._pressedLetters=[],e.preventDefault()}get activeItemIndex(){return this._activeItemIndex}get activeItem(){return this._activeItem}isTyping(){return this._pressedLetters.length>0}setFirstItemActive(){this._setActiveItemByIndex(0,1)}setLastItemActive(){this._setActiveItemByIndex(this._items.length-1,-1)}setNextItemActive(){this._activeItemIndex<0?this.setFirstItemActive():this._setActiveItemByDelta(1)}setPreviousItemActive(){this._activeItemIndex<0&&this._wrap?this.setLastItemActive():this._setActiveItemByDelta(-1)}updateActiveItem(e){const t=this._getItemsArray(),n="number"==typeof e?e:t.indexOf(e),r=t[n];this._activeItem=null==r?null:r,this._activeItemIndex=n}_setActiveItemByDelta(e){this._wrap?this._setActiveInWrapMode(e):this._setActiveInDefaultMode(e)}_setActiveInWrapMode(e){const t=this._getItemsArray();for(let n=1;n<=t.length;n++){const r=(this._activeItemIndex+e*n+t.length)%t.length;if(!this._skipPredicateFn(t[r]))return void this.setActiveItem(r)}}_setActiveInDefaultMode(e){this._setActiveItemByIndex(this._activeItemIndex+e,e)}_setActiveItemByIndex(e,t){const n=this._getItemsArray();if(n[e]){for(;this._skipPredicateFn(n[e]);)if(!n[e+=t])return;this.setActiveItem(e)}}_getItemsArray(){return this._items instanceof r.n_E?this._items.toArray():this._items}}{setActiveItem(e){this.activeItem&&this.activeItem.setInactiveStyles(),super.setActiveItem(e),this.activeItem&&this.activeItem.setActiveStyles()}}"undefined"!=typeof Element&&Element;const QC=new r.OlP("liveAnnouncerElement",{providedIn:"root",factory:function(){return null}}),JC=new r.OlP("LIVE_ANNOUNCER_DEFAULT_OPTIONS");let XC=(()=>{class e{constructor(e,t,n,r){this._ngZone=t,this._defaultOptions=r,this._document=n,this._liveElement=e||this._createLiveElement()}announce(e,...t){const n=this._defaultOptions;let r,i;return 1===t.length&&"number"==typeof t[0]?i=t[0]:[r,i]=t,this.clear(),clearTimeout(this._previousTimeout),r||(r=n&&n.politeness?n.politeness:"polite"),null==i&&n&&(i=n.duration),this._liveElement.setAttribute("aria-live",r),this._ngZone.runOutsideAngular(()=>new Promise(t=>{clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=e,t(),"number"==typeof i&&(this._previousTimeout=setTimeout(()=>this.clear(),i))},100)}))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement&&this._liveElement.parentNode&&(this._liveElement.parentNode.removeChild(this._liveElement),this._liveElement=null)}_createLiveElement(){const e="cdk-live-announcer-element",t=this._document.getElementsByClassName(e),n=this._document.createElement("div");for(let r=0;r<t.length;r++)t[r].parentNode.removeChild(t[r]);return n.classList.add(e),n.classList.add("cdk-visually-hidden"),n.setAttribute("aria-atomic","true"),n.setAttribute("aria-live","polite"),this._document.body.appendChild(n),n}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(QC,8),r.LFG(r.R0b),r.LFG(s),r.LFG(JC,8))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(QC,8),r.LFG(r.R0b),r.LFG(s),r.LFG(JC,8))},token:e,providedIn:"root"}),e})();const $C="cdk-high-contrast-black-on-white",ZC="cdk-high-contrast-white-on-black",eA="cdk-high-contrast-active";let tA=(()=>{class e{constructor(e,t){this._platform=e,this._document=t}getHighContrastMode(){if(!this._platform.isBrowser)return 0;const e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);const t=this._document.defaultView||window,n=t&&t.getComputedStyle?t.getComputedStyle(e):null,r=(n&&n.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(e),r){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){const e=this._document.body.classList;e.remove(eA),e.remove($C),e.remove(ZC),this._hasCheckedHighContrastMode=!0;const t=this.getHighContrastMode();1===t?(e.add(eA),e.add($C)):2===t&&(e.add(eA),e.add(ZC))}}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(jI),r.LFG(s))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(jI),r.LFG(s))},token:e,providedIn:"root"}),e})();const nA=new r.GfV("12.0.5");function rA(e,t){if(1&e&&r._UZ(0,"mat-pseudo-checkbox",4),2&e){const e=r.oxw();r.Q6J("state",e.selected?"checked":"unchecked")("disabled",e.disabled)}}function iA(e,t){if(1&e&&(r.TgZ(0,"span",5),r._uU(1),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.hij("(",e.group.label,")")}}const oA=["*"],sA=new r.GfV("12.0.5"),aA=new r.OlP("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}});let cA,uA=(()=>{class e{constructor(e,t,n){this._hasDoneGlobalChecks=!1,this._document=n,e._applyBodyHighContrastModeCssClasses(),this._sanityChecks=t,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}_getWindow(){const e=this._document.defaultView||window;return"object"==typeof e&&e?e:null}_checksAreEnabled(){return(0,r.X6Q)()&&!this._isTestEnv()}_isTestEnv(){const e=this._getWindow();return e&&(e.__karma__||e.jasmine)}_checkDoctypeIsDefined(){this._checksAreEnabled()&&(!0===this._sanityChecks||this._sanityChecks.doctype)&&!this._document.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}_checkThemeIsPresent(){if(!this._checksAreEnabled()||!1===this._sanityChecks||!this._sanityChecks.theme||!this._document.body||"function"!=typeof getComputedStyle)return;const e=this._document.createElement("div");e.classList.add("mat-theme-loaded-marker"),this._document.body.appendChild(e);const t=getComputedStyle(e);t&&"none"!==t.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),this._document.body.removeChild(e)}_checkCdkVersionMatch(){this._checksAreEnabled()&&(!0===this._sanityChecks||this._sanityChecks.version)&&sA.full!==nA.full&&console.warn("The Angular Material version ("+sA.full+") does not match the Angular CDK version ("+nA.full+").\nPlease ensure the versions of these two packages exactly match.")}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(tA),r.LFG(aA,8),r.LFG(s))},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[KI],KI]}),e})();function lA(e){return class extends e{constructor(...e){super(...e),this._disabled=!1}get disabled(){return this._disabled}set disabled(e){this._disabled=TI(e)}}}function hA(e){return class extends e{constructor(...e){super(...e),this._disableRipple=!1}get disableRipple(){return this._disableRipple}set disableRipple(e){this._disableRipple=TI(e)}}}function dA(e,t=0){return class extends e{constructor(...e){super(...e),this._tabIndex=t,this.defaultTabIndex=t}get tabIndex(){return this.disabled?-1:this._tabIndex}set tabIndex(e){this._tabIndex=null!=e?bI(e):this.defaultTabIndex}}}function pA(e){return class extends e{constructor(...e){super(...e),this.errorState=!1,this.stateChanges=new ui.xQ}updateErrorState(){const e=this.errorState,t=(this.errorStateMatcher||this._defaultErrorStateMatcher).isErrorState(this.ngControl?this.ngControl.control:null,this._parentFormGroup||this._parentForm);t!==e&&(this.errorState=t,this.stateChanges.next())}}}try{cA="undefined"!=typeof Intl}catch(Iw){cA=!1}let fA=(()=>{class e{isErrorState(e,t){return!!(e&&e.invalid&&(e.touched||t&&t.submitted))}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=r.Yz7({factory:function(){return new e},token:e,providedIn:"root"}),e})();class mA{constructor(e,t,n){this._renderer=e,this.element=t,this.config=n,this.state=3}fadeOut(){this._renderer.fadeOutRipple(this)}}const gA={enterDuration:450,exitDuration:400},_A=qI({passive:!0}),vA=["mousedown","touchstart"],yA=["mouseup","mouseleave","touchend","touchcancel"];class EA{constructor(e,t,n,r){this._target=e,this._ngZone=t,this._isPointerDown=!1,this._activeRipples=new Set,this._pointerUpEventsRegistered=!1,r.isBrowser&&(this._containerElement=II(n))}fadeInRipple(e,t,n={}){const r=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),i=Object.assign(Object.assign({},gA),n.animation);n.centered&&(e=r.left+r.width/2,t=r.top+r.height/2);const o=n.radius||function(e,t,n){const r=Math.max(Math.abs(e-n.left),Math.abs(e-n.right)),i=Math.max(Math.abs(t-n.top),Math.abs(t-n.bottom));return Math.sqrt(r*r+i*i)}(e,t,r),s=e-r.left,a=t-r.top,c=i.enterDuration,u=document.createElement("div");u.classList.add("mat-ripple-element"),u.style.left=s-o+"px",u.style.top=a-o+"px",u.style.height=2*o+"px",u.style.width=2*o+"px",null!=n.color&&(u.style.backgroundColor=n.color),u.style.transitionDuration=`${c}ms`,this._containerElement.appendChild(u),window.getComputedStyle(u).getPropertyValue("opacity"),u.style.transform="scale(1)";const l=new mA(this,u,n);return l.state=0,this._activeRipples.add(l),n.persistent||(this._mostRecentTransientRipple=l),this._runTimeoutOutsideZone(()=>{const e=l===this._mostRecentTransientRipple;l.state=1,n.persistent||e&&this._isPointerDown||l.fadeOut()},c),l}fadeOutRipple(e){const t=this._activeRipples.delete(e);if(e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),!t)return;const n=e.element,r=Object.assign(Object.assign({},gA),e.config.animation);n.style.transitionDuration=`${r.exitDuration}ms`,n.style.opacity="0",e.state=2,this._runTimeoutOutsideZone(()=>{e.state=3,n.parentNode.removeChild(n)},r.exitDuration)}fadeOutAll(){this._activeRipples.forEach(e=>e.fadeOut())}fadeOutAllNonPersistent(){this._activeRipples.forEach(e=>{e.config.persistent||e.fadeOut()})}setupTriggerEvents(e){const t=II(e);t&&t!==this._triggerElement&&(this._removeTriggerEvents(),this._triggerElement=t,this._registerEvents(vA))}handleEvent(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(yA),this._pointerUpEventsRegistered=!0)}_onMousedown(e){const t=function(e){return 0===e.buttons}(e),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;this._target.rippleDisabled||t||n||(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}_onTouchStart(e){if(!this._target.rippleDisabled&&!function(e){const t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0];return!(!t||-1!==t.identifier||null!=t.radiusX&&1!==t.radiusX||null!=t.radiusY&&1!==t.radiusY)}(e)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;const t=e.changedTouches;for(let e=0;e<t.length;e++)this.fadeInRipple(t[e].clientX,t[e].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._activeRipples.forEach(e=>{!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()}))}_runTimeoutOutsideZone(e,t=0){this._ngZone.runOutsideAngular(()=>setTimeout(e,t))}_registerEvents(e){this._ngZone.runOutsideAngular(()=>{e.forEach(e=>{this._triggerElement.addEventListener(e,this,_A)})})}_removeTriggerEvents(){this._triggerElement&&(vA.forEach(e=>{this._triggerElement.removeEventListener(e,this,_A)}),this._pointerUpEventsRegistered&&yA.forEach(e=>{this._triggerElement.removeEventListener(e,this,_A)}))}}const SA=new r.OlP("mat-ripple-global-options");let TA=(()=>{class e{constructor(e,t,n,r,i){this._elementRef=e,this._animationMode=i,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=r||{},this._rippleRenderer=new EA(this,t,e,n)}get disabled(){return this._disabled}set disabled(e){e&&this.fadeOutAllNonPersistent(),this._disabled=e,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign(Object.assign(Object.assign({},this._globalOptions.animation),"NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(e,t=0,n){return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,t,Object.assign(Object.assign({},this.rippleConfig),n)):this._rippleRenderer.fadeInRipple(0,0,Object.assign(Object.assign({},this.rippleConfig),e))}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq),r.Y36(r.R0b),r.Y36(jI),r.Y36(SA,8),r.Y36(ri,8))},e.\u0275dir=r.lG2({type:e,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(e,t){2&e&&r.ekj("mat-ripple-unbounded",t.unbounded)},inputs:{radius:["matRippleRadius","radius"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"],color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],animation:["matRippleAnimation","animation"]},exportAs:["matRipple"]}),e})(),bA=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[uA,GI],uA]}),e})(),wA=(()=>{class e{constructor(e){this._animationMode=e,this.state="unchecked",this.disabled=!1}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(ri,8))},e.\u0275cmp=r.Xpm({type:e,selectors:[["mat-pseudo-checkbox"]],hostAttrs:[1,"mat-pseudo-checkbox"],hostVars:8,hostBindings:function(e,t){2&e&&r.ekj("mat-pseudo-checkbox-indeterminate","indeterminate"===t.state)("mat-pseudo-checkbox-checked","checked"===t.state)("mat-pseudo-checkbox-disabled",t.disabled)("_mat-animation-noopable","NoopAnimations"===t._animationMode)},inputs:{state:"state",disabled:"disabled"},decls:0,vars:0,template:function(e,t){},styles:['.mat-pseudo-checkbox{width:16px;height:16px;border:2px solid;border-radius:2px;cursor:pointer;display:inline-block;vertical-align:middle;box-sizing:border-box;position:relative;flex-shrink:0;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1),background-color 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox::after{position:absolute;opacity:0;content:"";border-bottom:2px solid currentColor;transition:opacity 90ms cubic-bezier(0, 0, 0.2, 0.1)}.mat-pseudo-checkbox.mat-pseudo-checkbox-checked,.mat-pseudo-checkbox.mat-pseudo-checkbox-indeterminate{border-color:transparent}._mat-animation-noopable.mat-pseudo-checkbox{transition:none;animation:none}._mat-animation-noopable.mat-pseudo-checkbox::after{transition:none}.mat-pseudo-checkbox-disabled{cursor:default}.mat-pseudo-checkbox-indeterminate::after{top:5px;left:1px;width:10px;opacity:1;border-radius:2px}.mat-pseudo-checkbox-checked::after{top:2.4px;left:1px;width:8px;height:3px;border-left:2px solid currentColor;transform:rotate(-45deg);opacity:1;box-sizing:content-box}\n'],encapsulation:2,changeDetection:0}),e})(),RA=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[uA]]}),e})();const IA=new r.OlP("MAT_OPTION_PARENT_COMPONENT");class CA{}const AA=lA(CA);let OA=0,NA=(()=>{class e extends AA{constructor(e){var t;super(),this._labelId="mat-optgroup-label-"+OA++,this._inert=null!==(t=null==e?void 0:e.inertGroups)&&void 0!==t&&t}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(IA,8))},e.\u0275dir=r.lG2({type:e,inputs:{label:"label"},features:[r.qOj]}),e})();const kA=new r.OlP("MatOptgroup");let DA=0;class PA{constructor(e,t=!1){this.source=e,this.isUserInput=t}}let LA=(()=>{class e{constructor(e,t,n,i){this._element=e,this._changeDetectorRef=t,this._parent=n,this.group=i,this._selected=!1,this._active=!1,this._disabled=!1,this._mostRecentViewValue="",this.id="mat-option-"+DA++,this.onSelectionChange=new r.vpe,this._stateChanges=new ui.xQ}get multiple(){return this._parent&&this._parent.multiple}get selected(){return this._selected}get disabled(){return this.group&&this.group.disabled||this._disabled}set disabled(e){this._disabled=TI(e)}get disableRipple(){return this._parent&&this._parent.disableRipple}get active(){return this._active}get viewValue(){return(this._getHostElement().textContent||"").trim()}select(){this._selected||(this._selected=!0,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}deselect(){this._selected&&(this._selected=!1,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent())}focus(e,t){const n=this._getHostElement();"function"==typeof n.focus&&n.focus(t)}setActiveStyles(){this._active||(this._active=!0,this._changeDetectorRef.markForCheck())}setInactiveStyles(){this._active&&(this._active=!1,this._changeDetectorRef.markForCheck())}getLabel(){return this.viewValue}_handleKeydown(e){13!==e.keyCode&&32!==e.keyCode||aC(e)||(this._selectViaInteraction(),e.preventDefault())}_selectViaInteraction(){this.disabled||(this._selected=!this.multiple||!this._selected,this._changeDetectorRef.markForCheck(),this._emitSelectionChangeEvent(!0))}_getAriaSelected(){return this.selected||!this.multiple&&null}_getTabIndex(){return this.disabled?"-1":"0"}_getHostElement(){return this._element.nativeElement}ngAfterViewChecked(){if(this._selected){const e=this.viewValue;e!==this._mostRecentViewValue&&(this._mostRecentViewValue=e,this._stateChanges.next())}}ngOnDestroy(){this._stateChanges.complete()}_emitSelectionChangeEvent(e=!1){this.onSelectionChange.emit(new PA(this,e))}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq),r.Y36(r.sBO),r.Y36(void 0),r.Y36(NA))},e.\u0275dir=r.lG2({type:e,inputs:{id:"id",disabled:"disabled",value:"value"},outputs:{onSelectionChange:"onSelectionChange"}}),e})(),xA=(()=>{class e extends LA{constructor(e,t,n,r){super(e,t,n,r)}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(r.SBq),r.Y36(r.sBO),r.Y36(IA,8),r.Y36(kA,8))},e.\u0275cmp=r.Xpm({type:e,selectors:[["mat-option"]],hostAttrs:["role","option",1,"mat-option","mat-focus-indicator"],hostVars:12,hostBindings:function(e,t){1&e&&r.NdJ("click",function(){return t._selectViaInteraction()})("keydown",function(e){return t._handleKeydown(e)}),2&e&&(r.Ikx("id",t.id),r.uIk("tabindex",t._getTabIndex())("aria-selected",t._getAriaSelected())("aria-disabled",t.disabled.toString()),r.ekj("mat-selected",t.selected)("mat-option-multiple",t.multiple)("mat-active",t.active)("mat-option-disabled",t.disabled))},exportAs:["matOption"],features:[r.qOj],ngContentSelectors:oA,decls:5,vars:4,consts:[["class","mat-option-pseudo-checkbox",3,"state","disabled",4,"ngIf"],[1,"mat-option-text"],["class","cdk-visually-hidden",4,"ngIf"],["mat-ripple","",1,"mat-option-ripple",3,"matRippleTrigger","matRippleDisabled"],[1,"mat-option-pseudo-checkbox",3,"state","disabled"],[1,"cdk-visually-hidden"]],template:function(e,t){1&e&&(r.F$t(),r.YNc(0,rA,1,2,"mat-pseudo-checkbox",0),r.TgZ(1,"span",1),r.Hsn(2),r.qZA(),r.YNc(3,iA,2,1,"span",2),r._UZ(4,"div",3)),2&e&&(r.Q6J("ngIf",t.multiple),r.xp6(3),r.Q6J("ngIf",t.group&&t.group._inert),r.xp6(1),r.Q6J("matRippleTrigger",t._getHostElement())("matRippleDisabled",t.disabled||t.disableRipple))},directives:[P,TA,wA],styles:[".mat-option{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:block;line-height:48px;height:48px;padding:0 16px;text-align:left;text-decoration:none;max-width:100%;position:relative;cursor:pointer;outline:none;display:flex;flex-direction:row;max-width:100%;box-sizing:border-box;align-items:center;-webkit-tap-highlight-color:transparent}.mat-option[disabled]{cursor:default}[dir=rtl] .mat-option{text-align:right}.mat-option .mat-icon{margin-right:16px;vertical-align:middle}.mat-option .mat-icon svg{vertical-align:top}[dir=rtl] .mat-option .mat-icon{margin-left:16px;margin-right:0}.mat-option[aria-disabled=true]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.mat-optgroup .mat-option:not(.mat-option-multiple){padding-left:32px}[dir=rtl] .mat-optgroup .mat-option:not(.mat-option-multiple){padding-left:16px;padding-right:32px}.cdk-high-contrast-active .mat-option{margin:0 1px}.cdk-high-contrast-active .mat-option.mat-active{border:solid 1px currentColor;margin:0}.cdk-high-contrast-active .mat-option[aria-disabled=true]{opacity:.5}.mat-option-text{display:inline-block;flex-grow:1;overflow:hidden;text-overflow:ellipsis}.mat-option .mat-option-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-option-pseudo-checkbox{margin-right:8px}[dir=rtl] .mat-option-pseudo-checkbox{margin-left:8px;margin-right:0}\n"],encapsulation:2,changeDetection:0}),e})();function MA(e,t,n){if(n.length){let r=t.toArray(),i=n.toArray(),o=0;for(let t=0;t<e+1;t++)r[t].group&&r[t].group===i[o]&&o++;return o}return 0}let UA=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[bA,z,uA,RA]]}),e})(),VA=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275dir=r.lG2({type:e}),e})();const FA=new r.OlP("MatFormField");let BA=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[z,uA,KC],uA]}),e})();const jA=["trigger"],GA=["panel"];function qA(e,t){if(1&e&&(r.TgZ(0,"span",8),r._uU(1),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Oqu(e.placeholder)}}function HA(e,t){if(1&e&&(r.TgZ(0,"span",12),r._uU(1),r.qZA()),2&e){const e=r.oxw(2);r.xp6(1),r.Oqu(e.triggerValue)}}function WA(e,t){1&e&&r.Hsn(0,0,["*ngSwitchCase","true"])}function zA(e,t){if(1&e&&(r.TgZ(0,"span",9),r.YNc(1,HA,2,1,"span",10),r.YNc(2,WA,1,0,"ng-content",11),r.qZA()),2&e){const e=r.oxw();r.Q6J("ngSwitch",!!e.customTrigger),r.xp6(2),r.Q6J("ngSwitchCase",!0)}}function KA(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div",13),r.TgZ(1,"div",14,15),r.NdJ("@transformPanel.done",function(t){return r.CHM(e),r.oxw()._panelDoneAnimatingStream.next(t.toState)})("keydown",function(t){return r.CHM(e),r.oxw()._handleKeydown(t)}),r.Hsn(3,1),r.qZA(),r.qZA()}if(2&e){const e=r.oxw();r.Q6J("@transformPanelWrap",void 0),r.xp6(1),r.Gre("mat-select-panel ",e._getPanelTheme(),""),r.Udp("transform-origin",e._transformOrigin)("font-size",e._triggerFontSize,"px"),r.Q6J("ngClass",e.panelClass)("@transformPanel",e.multiple?"showing-multiple":"showing"),r.uIk("id",e.id+"-panel")("aria-multiselectable",e.multiple)("aria-label",e.ariaLabel||null)("aria-labelledby",e._getPanelAriaLabelledby())}}const YA=[[["mat-select-trigger"]],"*"],QA=["mat-select-trigger","*"],JA={transformPanelWrap:Et("transformPanelWrap",[Rt("* => void",Ct("@transformPanel",[It()],{optional:!0}))]),transformPanel:Et("transformPanel",[wt("void",bt({transform:"scaleY(0.8)",minWidth:"100%",opacity:0})),wt("showing",bt({opacity:1,minWidth:"calc(100% + 32px)",transform:"scaleY(1)"})),wt("showing-multiple",bt({opacity:1,minWidth:"calc(100% + 64px)",transform:"scaleY(1)"})),Rt("void => *",St("120ms cubic-bezier(0, 0, 0.2, 1)")),Rt("* => void",St("100ms 25ms linear",bt({opacity:0})))])};let XA=0;const $A=256,ZA=new r.OlP("mat-select-scroll-strategy"),eO=new r.OlP("MAT_SELECT_CONFIG"),tO={provide:ZA,deps:[MC],useFactory:function(e){return()=>e.scrollStrategies.reposition()}};class nO{constructor(e,t){this.source=e,this.value=t}}class rO{constructor(e,t,n,r,i){this._elementRef=e,this._defaultErrorStateMatcher=t,this._parentForm=n,this._parentFormGroup=r,this.ngControl=i}}const iO=hA(dA(lA(pA(rO)))),oO=new r.OlP("MatSelectTrigger");let sO=(()=>{class e extends iO{constructor(e,t,n,i,o,s,a,c,u,l,h,d,p,f){var m,g,_;super(o,i,a,c,l),this._viewportRuler=e,this._changeDetectorRef=t,this._ngZone=n,this._dir=s,this._parentFormField=u,this.ngControl=l,this._liveAnnouncer=p,this._defaultOptions=f,this._panelOpen=!1,this._compareWith=(e,t)=>e===t,this._uid="mat-select-"+XA++,this._triggerAriaLabelledBy=null,this._destroy=new ui.xQ,this._onChange=()=>{},this._onTouched=()=>{},this._valueId="mat-select-value-"+XA++,this._panelDoneAnimatingStream=new ui.xQ,this._overlayPanelClass=(null===(m=this._defaultOptions)||void 0===m?void 0:m.overlayPanelClass)||"",this._focused=!1,this.controlType="mat-select",this._required=!1,this._multiple=!1,this._disableOptionCentering=null!==(_=null===(g=this._defaultOptions)||void 0===g?void 0:g.disableOptionCentering)&&void 0!==_&&_,this.ariaLabel="",this.optionSelectionChanges=Ii(()=>{const e=this.options;return e?e.changes.pipe(Mi(e),Oi(()=>(0,zR.T)(...e.map(e=>e.onSelectionChange)))):this._ngZone.onStable.pipe(Pi(1),Oi(()=>this.optionSelectionChanges))}),this.openedChange=new r.vpe,this._openedStream=this.openedChange.pipe(Me(e=>e),(0,Fe.U)(()=>{})),this._closedStream=this.openedChange.pipe(Me(e=>!e),(0,Fe.U)(()=>{})),this.selectionChange=new r.vpe,this.valueChange=new r.vpe,this.ngControl&&(this.ngControl.valueAccessor=this),null!=(null==f?void 0:f.typeaheadDebounceInterval)&&(this._typeaheadDebounceInterval=f.typeaheadDebounceInterval),this._scrollStrategyFactory=d,this._scrollStrategy=this._scrollStrategyFactory(),this.tabIndex=parseInt(h)||0,this.id=this.id}get focused(){return this._focused||this._panelOpen}get placeholder(){return this._placeholder}set placeholder(e){this._placeholder=e,this.stateChanges.next()}get required(){return this._required}set required(e){this._required=TI(e),this.stateChanges.next()}get multiple(){return this._multiple}set multiple(e){this._multiple=TI(e)}get disableOptionCentering(){return this._disableOptionCentering}set disableOptionCentering(e){this._disableOptionCentering=TI(e)}get compareWith(){return this._compareWith}set compareWith(e){this._compareWith=e,this._selectionModel&&this._initializeSelection()}get value(){return this._value}set value(e){(e!==this._value||this._multiple&&Array.isArray(e))&&(this.options&&this._setSelectionByValue(e),this._value=e)}get typeaheadDebounceInterval(){return this._typeaheadDebounceInterval}set typeaheadDebounceInterval(e){this._typeaheadDebounceInterval=bI(e)}get id(){return this._id}set id(e){this._id=e||this._uid,this.stateChanges.next()}ngOnInit(){this._selectionModel=new YI(this.multiple),this.stateChanges.next(),this._panelDoneAnimatingStream.pipe(_h(),xI(this._destroy)).subscribe(()=>this._panelDoneAnimating(this.panelOpen))}ngAfterContentInit(){this._initKeyManager(),this._selectionModel.changed.pipe(xI(this._destroy)).subscribe(e=>{e.added.forEach(e=>e.select()),e.removed.forEach(e=>e.deselect())}),this.options.changes.pipe(Mi(null),xI(this._destroy)).subscribe(()=>{this._resetOptions(),this._initializeSelection()})}ngDoCheck(){const e=this._getTriggerAriaLabelledby();if(e!==this._triggerAriaLabelledBy){const t=this._elementRef.nativeElement;this._triggerAriaLabelledBy=e,e?t.setAttribute("aria-labelledby",e):t.removeAttribute("aria-labelledby")}this.ngControl&&this.updateErrorState()}ngOnChanges(e){e.disabled&&this.stateChanges.next(),e.typeaheadDebounceInterval&&this._keyManager&&this._keyManager.withTypeAhead(this._typeaheadDebounceInterval)}ngOnDestroy(){this._destroy.next(),this._destroy.complete(),this.stateChanges.complete()}toggle(){this.panelOpen?this.close():this.open()}open(){this._canOpen()&&(this._panelOpen=!0,this._keyManager.withHorizontalOrientation(null),this._highlightCorrectOption(),this._changeDetectorRef.markForCheck())}close(){this._panelOpen&&(this._panelOpen=!1,this._keyManager.withHorizontalOrientation(this._isRtl()?"rtl":"ltr"),this._changeDetectorRef.markForCheck(),this._onTouched())}writeValue(e){this.value=e}registerOnChange(e){this._onChange=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e,this._changeDetectorRef.markForCheck(),this.stateChanges.next()}get panelOpen(){return this._panelOpen}get selected(){return this.multiple?this._selectionModel.selected:this._selectionModel.selected[0]}get triggerValue(){if(this.empty)return"";if(this._multiple){const e=this._selectionModel.selected.map(e=>e.viewValue);return this._isRtl()&&e.reverse(),e.join(", ")}return this._selectionModel.selected[0].viewValue}_isRtl(){return!!this._dir&&"rtl"===this._dir.value}_handleKeydown(e){this.disabled||(this.panelOpen?this._handleOpenKeydown(e):this._handleClosedKeydown(e))}_handleClosedKeydown(e){const t=e.keyCode,n=40===t||38===t||37===t||39===t,r=13===t||32===t,i=this._keyManager;if(!i.isTyping()&&r&&!aC(e)||(this.multiple||e.altKey)&&n)e.preventDefault(),this.open();else if(!this.multiple){const t=this.selected;i.onKeydown(e);const n=this.selected;n&&t!==n&&this._liveAnnouncer.announce(n.viewValue,1e4)}}_handleOpenKeydown(e){const t=this._keyManager,n=e.keyCode,r=40===n||38===n,i=t.isTyping();if(r&&e.altKey)e.preventDefault(),this.close();else if(i||13!==n&&32!==n||!t.activeItem||aC(e))if(!i&&this._multiple&&65===n&&e.ctrlKey){e.preventDefault();const t=this.options.some(e=>!e.disabled&&!e.selected);this.options.forEach(e=>{e.disabled||(t?e.select():e.deselect())})}else{const n=t.activeItemIndex;t.onKeydown(e),this._multiple&&r&&e.shiftKey&&t.activeItem&&t.activeItemIndex!==n&&t.activeItem._selectViaInteraction()}else e.preventDefault(),t.activeItem._selectViaInteraction()}_onFocus(){this.disabled||(this._focused=!0,this.stateChanges.next())}_onBlur(){this._focused=!1,this.disabled||this.panelOpen||(this._onTouched(),this._changeDetectorRef.markForCheck(),this.stateChanges.next())}_onAttached(){this._overlayDir.positionChange.pipe(Pi(1)).subscribe(()=>{this._changeDetectorRef.detectChanges(),this._positioningSettled()})}_getPanelTheme(){return this._parentFormField?`mat-${this._parentFormField.color}`:""}get empty(){return!this._selectionModel||this._selectionModel.isEmpty()}_initializeSelection(){Promise.resolve().then(()=>{this._setSelectionByValue(this.ngControl?this.ngControl.value:this._value),this.stateChanges.next()})}_setSelectionByValue(e){if(this._selectionModel.selected.forEach(e=>e.setInactiveStyles()),this._selectionModel.clear(),this.multiple&&e)Array.isArray(e),e.forEach(e=>this._selectValue(e)),this._sortValues();else{const t=this._selectValue(e);t?this._keyManager.updateActiveItem(t):this.panelOpen||this._keyManager.updateActiveItem(-1)}this._changeDetectorRef.markForCheck()}_selectValue(e){const t=this.options.find(t=>{if(this._selectionModel.isSelected(t))return!1;try{return null!=t.value&&this._compareWith(t.value,e)}catch(n){return!1}});return t&&this._selectionModel.select(t),t}_initKeyManager(){this._keyManager=new YC(this.options).withTypeAhead(this._typeaheadDebounceInterval).withVerticalOrientation().withHorizontalOrientation(this._isRtl()?"rtl":"ltr").withHomeAndEnd().withAllowedModifierKeys(["shiftKey"]),this._keyManager.tabOut.pipe(xI(this._destroy)).subscribe(()=>{this.panelOpen&&(!this.multiple&&this._keyManager.activeItem&&this._keyManager.activeItem._selectViaInteraction(),this.focus(),this.close())}),this._keyManager.change.pipe(xI(this._destroy)).subscribe(()=>{this._panelOpen&&this.panel?this._scrollOptionIntoView(this._keyManager.activeItemIndex||0):this._panelOpen||this.multiple||!this._keyManager.activeItem||this._keyManager.activeItem._selectViaInteraction()})}_resetOptions(){const e=(0,zR.T)(this.options.changes,this._destroy);this.optionSelectionChanges.pipe(xI(e)).subscribe(e=>{this._onSelect(e.source,e.isUserInput),e.isUserInput&&!this.multiple&&this._panelOpen&&(this.close(),this.focus())}),(0,zR.T)(...this.options.map(e=>e._stateChanges)).pipe(xI(e)).subscribe(()=>{this._changeDetectorRef.markForCheck(),this.stateChanges.next()})}_onSelect(e,t){const n=this._selectionModel.isSelected(e);null!=e.value||this._multiple?(n!==e.selected&&(e.selected?this._selectionModel.select(e):this._selectionModel.deselect(e)),t&&this._keyManager.setActiveItem(e),this.multiple&&(this._sortValues(),t&&this.focus())):(e.deselect(),this._selectionModel.clear(),null!=this.value&&this._propagateChanges(e.value)),n!==this._selectionModel.isSelected(e)&&this._propagateChanges(),this.stateChanges.next()}_sortValues(){if(this.multiple){const e=this.options.toArray();this._selectionModel.sort((t,n)=>this.sortComparator?this.sortComparator(t,n,e):e.indexOf(t)-e.indexOf(n)),this.stateChanges.next()}}_propagateChanges(e){let t=null;t=this.multiple?this.selected.map(e=>e.value):this.selected?this.selected.value:e,this._value=t,this.valueChange.emit(t),this._onChange(t),this.selectionChange.emit(this._getChangeEvent(t)),this._changeDetectorRef.markForCheck()}_highlightCorrectOption(){this._keyManager&&(this.empty?this._keyManager.setFirstItemActive():this._keyManager.setActiveItem(this._selectionModel.selected[0]))}_canOpen(){var e;return!this._panelOpen&&!this.disabled&&(null===(e=this.options)||void 0===e?void 0:e.length)>0}focus(e){this._elementRef.nativeElement.focus(e)}_getPanelAriaLabelledby(){var e;if(this.ariaLabel)return null;const t=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();return this.ariaLabelledby?(t?t+" ":"")+this.ariaLabelledby:t}_getAriaActiveDescendant(){return this.panelOpen&&this._keyManager&&this._keyManager.activeItem?this._keyManager.activeItem.id:null}_getTriggerAriaLabelledby(){var e;if(this.ariaLabel)return null;const t=null===(e=this._parentFormField)||void 0===e?void 0:e.getLabelId();let n=(t?t+" ":"")+this._valueId;return this.ariaLabelledby&&(n+=" "+this.ariaLabelledby),n}_panelDoneAnimating(e){this.openedChange.emit(e)}setDescribedByIds(e){this._ariaDescribedby=e.join(" ")}onContainerClick(){this.focus(),this.open()}get shouldLabelFloat(){return this._panelOpen||!this.empty||this._focused&&!!this._placeholder}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(JI),r.Y36(r.sBO),r.Y36(r.R0b),r.Y36(fA),r.Y36(r.SBq),r.Y36(zI,8),r.Y36(rh,8),r.Y36(ah,8),r.Y36(FA,8),r.Y36(kl,10),r.$8M("tabindex"),r.Y36(ZA),r.Y36(XC),r.Y36(eO,8))},e.\u0275dir=r.lG2({type:e,viewQuery:function(e,t){if(1&e&&(r.Gf(jA,5),r.Gf(GA,5),r.Gf(BC,5)),2&e){let e;r.iGM(e=r.CRH())&&(t.trigger=e.first),r.iGM(e=r.CRH())&&(t.panel=e.first),r.iGM(e=r.CRH())&&(t._overlayDir=e.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],id:"id",placeholder:"placeholder",required:"required",multiple:"multiple",disableOptionCentering:"disableOptionCentering",compareWith:"compareWith",value:"value",typeaheadDebounceInterval:"typeaheadDebounceInterval",panelClass:"panelClass",ariaLabelledby:["aria-labelledby","ariaLabelledby"],errorStateMatcher:"errorStateMatcher",sortComparator:"sortComparator"},outputs:{openedChange:"openedChange",_openedStream:"opened",_closedStream:"closed",selectionChange:"selectionChange",valueChange:"valueChange"},features:[r.qOj,r.TTD]}),e})(),aO=(()=>{class e extends sO{constructor(){super(...arguments),this._scrollTop=0,this._triggerFontSize=0,this._transformOrigin="top",this._offsetY=0,this._positions=[{originX:"start",originY:"top",overlayX:"start",overlayY:"top"},{originX:"start",originY:"bottom",overlayX:"start",overlayY:"bottom"}]}_calculateOverlayScroll(e,t,n){const r=this._getItemHeight();return Math.min(Math.max(0,r*e-t+r/2),n)}ngOnInit(){super.ngOnInit(),this._viewportRuler.change().pipe(xI(this._destroy)).subscribe(()=>{this.panelOpen&&(this._triggerRect=this.trigger.nativeElement.getBoundingClientRect(),this._changeDetectorRef.markForCheck())})}open(){super._canOpen()&&(super.open(),this._triggerRect=this.trigger.nativeElement.getBoundingClientRect(),this._triggerFontSize=parseInt(getComputedStyle(this.trigger.nativeElement).fontSize||"0"),this._calculateOverlayPosition(),this._ngZone.onStable.pipe(Pi(1)).subscribe(()=>{this._triggerFontSize&&this._overlayDir.overlayRef&&this._overlayDir.overlayRef.overlayElement&&(this._overlayDir.overlayRef.overlayElement.style.fontSize=`${this._triggerFontSize}px`)}))}_scrollOptionIntoView(e){const t=MA(e,this.options,this.optionGroups),n=this._getItemHeight();var r,i,o;this.panel.nativeElement.scrollTop=(i=n,(r=(e+t)*n)<(o=this.panel.nativeElement.scrollTop)?r:r+i>o+256?Math.max(0,r-256+i):o)}_positioningSettled(){this._calculateOverlayOffsetX(),this.panel.nativeElement.scrollTop=this._scrollTop}_panelDoneAnimating(e){this.panelOpen?this._scrollTop=0:(this._overlayDir.offsetX=0,this._changeDetectorRef.markForCheck()),super._panelDoneAnimating(e)}_getChangeEvent(e){return new nO(this,e)}_calculateOverlayOffsetX(){const e=this._overlayDir.overlayRef.overlayElement.getBoundingClientRect(),t=this._viewportRuler.getViewportSize(),n=this._isRtl(),r=this.multiple?56:32;let i;if(this.multiple)i=40;else if(this.disableOptionCentering)i=16;else{let e=this._selectionModel.selected[0]||this.options.first;i=e&&e.group?32:16}n||(i*=-1);const o=0-(e.left+i-(n?r:0)),s=e.right+i-t.width+(n?0:r);o>0?i+=o+8:s>0&&(i-=s+8),this._overlayDir.offsetX=Math.round(i),this._overlayDir.overlayRef.updatePosition()}_calculateOverlayOffsetY(e,t,n){const r=this._getItemHeight(),i=(r-this._triggerRect.height)/2,o=Math.floor($A/r);let s;return this.disableOptionCentering?0:(s=0===this._scrollTop?e*r:this._scrollTop===n?(e-(this._getItemCount()-o))*r+(r-(this._getItemCount()*r-$A)%r):t-r/2,Math.round(-1*s-i))}_checkOverlayWithinViewport(e){const t=this._getItemHeight(),n=this._viewportRuler.getViewportSize(),r=this._triggerRect.top-8,i=n.height-this._triggerRect.bottom-8,o=Math.abs(this._offsetY),s=Math.min(this._getItemCount()*t,$A)-o-this._triggerRect.height;s>i?this._adjustPanelUp(s,i):o>r?this._adjustPanelDown(o,r,e):this._transformOrigin=this._getOriginBasedOnOption()}_adjustPanelUp(e,t){const n=Math.round(e-t);this._scrollTop-=n,this._offsetY-=n,this._transformOrigin=this._getOriginBasedOnOption(),this._scrollTop<=0&&(this._scrollTop=0,this._offsetY=0,this._transformOrigin="50% bottom 0px")}_adjustPanelDown(e,t,n){const r=Math.round(e-t);if(this._scrollTop+=r,this._offsetY+=r,this._transformOrigin=this._getOriginBasedOnOption(),this._scrollTop>=n)return this._scrollTop=n,this._offsetY=0,void(this._transformOrigin="50% top 0px")}_calculateOverlayPosition(){const e=this._getItemHeight(),t=this._getItemCount(),n=Math.min(t*e,$A),r=t*e-n;let i;i=this.empty?0:Math.max(this.options.toArray().indexOf(this._selectionModel.selected[0]),0),i+=MA(i,this.options,this.optionGroups);const o=n/2;this._scrollTop=this._calculateOverlayScroll(i,o,r),this._offsetY=this._calculateOverlayOffsetY(i,o,r),this._checkOverlayWithinViewport(r)}_getOriginBasedOnOption(){const e=this._getItemHeight(),t=(e-this._triggerRect.height)/2;return`50% ${Math.abs(this._offsetY)-t+e/2}px 0px`}_getItemHeight(){return 3*this._triggerFontSize}_getItemCount(){return this.options.length+this.optionGroups.length}}return e.\u0275fac=function(){let t;return function(n){return(t||(t=r.n5z(e)))(n||e)}}(),e.\u0275cmp=r.Xpm({type:e,selectors:[["mat-select"]],contentQueries:function(e,t,n){if(1&e&&(r.Suo(n,oO,5),r.Suo(n,xA,5),r.Suo(n,kA,5)),2&e){let e;r.iGM(e=r.CRH())&&(t.customTrigger=e.first),r.iGM(e=r.CRH())&&(t.options=e),r.iGM(e=r.CRH())&&(t.optionGroups=e)}},hostAttrs:["role","combobox","aria-autocomplete","none","aria-haspopup","true",1,"mat-select"],hostVars:20,hostBindings:function(e,t){1&e&&r.NdJ("keydown",function(e){return t._handleKeydown(e)})("focus",function(){return t._onFocus()})("blur",function(){return t._onBlur()}),2&e&&(r.uIk("id",t.id)("tabindex",t.tabIndex)("aria-controls",t.panelOpen?t.id+"-panel":null)("aria-expanded",t.panelOpen)("aria-label",t.ariaLabel||null)("aria-required",t.required.toString())("aria-disabled",t.disabled.toString())("aria-invalid",t.errorState)("aria-describedby",t._ariaDescribedby||null)("aria-activedescendant",t._getAriaActiveDescendant()),r.ekj("mat-select-disabled",t.disabled)("mat-select-invalid",t.errorState)("mat-select-required",t.required)("mat-select-empty",t.empty)("mat-select-multiple",t.multiple))},inputs:{disabled:"disabled",disableRipple:"disableRipple",tabIndex:"tabIndex"},exportAs:["matSelect"],features:[r._Bn([{provide:VA,useExisting:e},{provide:IA,useExisting:e}]),r.qOj],ngContentSelectors:QA,decls:9,vars:12,consts:[["cdk-overlay-origin","",1,"mat-select-trigger",3,"click"],["origin","cdkOverlayOrigin","trigger",""],[1,"mat-select-value",3,"ngSwitch"],["class","mat-select-placeholder mat-select-min-line",4,"ngSwitchCase"],["class","mat-select-value-text",3,"ngSwitch",4,"ngSwitchCase"],[1,"mat-select-arrow-wrapper"],[1,"mat-select-arrow"],["cdk-connected-overlay","","cdkConnectedOverlayLockPosition","","cdkConnectedOverlayHasBackdrop","","cdkConnectedOverlayBackdropClass","cdk-overlay-transparent-backdrop",3,"cdkConnectedOverlayPanelClass","cdkConnectedOverlayScrollStrategy","cdkConnectedOverlayOrigin","cdkConnectedOverlayOpen","cdkConnectedOverlayPositions","cdkConnectedOverlayMinWidth","cdkConnectedOverlayOffsetY","backdropClick","attach","detach"],[1,"mat-select-placeholder","mat-select-min-line"],[1,"mat-select-value-text",3,"ngSwitch"],["class","mat-select-min-line",4,"ngSwitchDefault"],[4,"ngSwitchCase"],[1,"mat-select-min-line"],[1,"mat-select-panel-wrap"],["role","listbox","tabindex","-1",3,"ngClass","keydown"],["panel",""]],template:function(e,t){if(1&e&&(r.F$t(YA),r.TgZ(0,"div",0,1),r.NdJ("click",function(){return t.toggle()}),r.TgZ(3,"div",2),r.YNc(4,qA,2,1,"span",3),r.YNc(5,zA,3,2,"span",4),r.qZA(),r.TgZ(6,"div",5),r._UZ(7,"div",6),r.qZA(),r.qZA(),r.YNc(8,KA,4,14,"ng-template",7),r.NdJ("backdropClick",function(){return t.close()})("attach",function(){return t._onAttached()})("detach",function(){return t.close()})),2&e){const e=r.MAs(1);r.uIk("aria-owns",t.panelOpen?t.id+"-panel":null),r.xp6(3),r.Q6J("ngSwitch",t.empty),r.uIk("id",t._valueId),r.xp6(1),r.Q6J("ngSwitchCase",!0),r.xp6(1),r.Q6J("ngSwitchCase",!1),r.xp6(3),r.Q6J("cdkConnectedOverlayPanelClass",t._overlayPanelClass)("cdkConnectedOverlayScrollStrategy",t._scrollStrategy)("cdkConnectedOverlayOrigin",e)("cdkConnectedOverlayOpen",t.panelOpen)("cdkConnectedOverlayPositions",t._positions)("cdkConnectedOverlayMinWidth",null==t._triggerRect?null:t._triggerRect.width)("cdkConnectedOverlayOffsetY",t._offsetY)}},directives:[FC,U,V,BC,F,O],styles:['.mat-select{display:inline-block;width:100%;outline:none}.mat-select-trigger{display:inline-table;cursor:pointer;position:relative;box-sizing:border-box}.mat-select-disabled .mat-select-trigger{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.mat-select-value{display:table-cell;max-width:0;width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.mat-select-value-text{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.mat-select-arrow-wrapper{display:table-cell;vertical-align:middle}.mat-form-field-appearance-fill .mat-select-arrow-wrapper{transform:translateY(-50%)}.mat-form-field-appearance-outline .mat-select-arrow-wrapper{transform:translateY(-25%)}.mat-form-field-appearance-standard.mat-form-field-has-label .mat-select:not(.mat-select-empty) .mat-select-arrow-wrapper{transform:translateY(-50%)}.mat-form-field-appearance-standard .mat-select.mat-select-empty .mat-select-arrow-wrapper{transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}._mat-animation-noopable.mat-form-field-appearance-standard .mat-select.mat-select-empty .mat-select-arrow-wrapper{transition:none}.mat-select-arrow{width:0;height:0;border-left:5px solid transparent;border-right:5px solid transparent;border-top:5px solid;margin:0 4px}.mat-select-panel-wrap{flex-basis:100%}.mat-select-panel{min-width:112px;max-width:280px;overflow:auto;-webkit-overflow-scrolling:touch;padding-top:0;padding-bottom:0;max-height:256px;min-width:100%;border-radius:4px;outline:0}.cdk-high-contrast-active .mat-select-panel{outline:solid 1px}.mat-select-panel .mat-optgroup-label,.mat-select-panel .mat-option{font-size:inherit;line-height:3em;height:3em}.mat-form-field-type-mat-select:not(.mat-form-field-disabled) .mat-form-field-flex{cursor:pointer}.mat-form-field-type-mat-select .mat-form-field-label{width:calc(100% - 18px)}.mat-select-placeholder{transition:color 400ms 133.3333333333ms cubic-bezier(0.25, 0.8, 0.25, 1)}._mat-animation-noopable .mat-select-placeholder{transition:none}.mat-form-field-hide-placeholder .mat-select-placeholder{color:transparent;-webkit-text-fill-color:transparent;transition:none;display:block}.mat-select-min-line:empty::before{content:" ";white-space:pre;width:1px}\n'],encapsulation:2,data:{animation:[JA.transformPanelWrap,JA.transformPanel]},changeDetection:0}),e})(),cO=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:[tO],imports:[[z,GC,UA,uA],XI,BA,UA,uA]}),e})();function uO(e,t){if(1&e&&(r.TgZ(0,"mat-option",5),r._uU(1),r.qZA()),2&e){const e=t.$implicit;r.Q6J("value",e),r.xp6(1),r.hij(" Casa - ",e.houseNumber," ")}}function lO(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"h5",3),r._uU(2,"Llamar a residente"),r.qZA(),r.TgZ(3,"mat-select",4),r.NdJ("valueChange",function(t){return r.CHM(e),r.oxw().selected=t}),r.TgZ(4,"mat-option",5),r._uU(5," Residencias "),r.qZA(),r.YNc(6,uO,2,2,"mat-option",6),r.qZA(),r.TgZ(7,"div",7),r.TgZ(8,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callResident()}),r._uU(9,"Llamar"),r.qZA(),r.qZA(),r.TgZ(10,"div",7),r.TgZ(11,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callManager()}),r._uU(12,"Administrador"),r.qZA(),r.qZA(),r.TgZ(13,"div",7),r.TgZ(14,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callSupervisor()}),r._uU(15,"Supervisor"),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=r.oxw();r.xp6(3),r.Q6J("value",e.selected),r.xp6(1),r.Q6J("value",null),r.xp6(2),r.Q6J("ngForOf",e.houses)}}function hO(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"h5",3),r._uU(2,"Llamar a"),r.qZA(),r.TgZ(3,"div",7),r.TgZ(4,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callGuard()}),r._uU(5,"Caseta"),r.qZA(),r.qZA(),r.TgZ(6,"div",7),r.TgZ(7,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callSupervisor()}),r._uU(8,"Supervisor"),r.qZA(),r.qZA(),r.TgZ(9,"div",7),r.TgZ(10,"button",9),r.NdJ("click",function(){return r.CHM(e),r.oxw().callCenter()}),r._uU(11,"Centro de monitoreo"),r.qZA(),r.qZA(),r.qZA()}}function dO(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"h5",3),r._uU(2,"Llamar a"),r.qZA(),r.TgZ(3,"div",7),r.TgZ(4,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callGuard()}),r._uU(5,"Caseta"),r.qZA(),r.qZA(),r.TgZ(6,"div",7),r.TgZ(7,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callSupervisor()}),r._uU(8,"Supervisor"),r.qZA(),r.qZA(),r.TgZ(9,"div",7),r.TgZ(10,"button",9),r.NdJ("click",function(){return r.CHM(e),r.oxw().callCenter()}),r._uU(11,"Centro de monitoreo"),r.qZA(),r.qZA(),r.qZA()}}function pO(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"h5",3),r._uU(2,"Llamar a centro de monitoreo"),r.qZA(),r.TgZ(3,"div",7),r.TgZ(4,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callCenter()}),r._uU(5,"Llamar"),r.qZA(),r.qZA(),r.qZA()}}function fO(e,t){if(1&e&&(r.TgZ(0,"mat-option",5),r._uU(1),r.qZA()),2&e){const e=t.$implicit;r.Q6J("value",e),r.xp6(1),r.AsE(" ",e.name," ",e.lastName," ")}}function mO(e,t){if(1&e){const e=r.EpF();r.TgZ(0,"div"),r.TgZ(1,"h5",3),r._uU(2,"Llamar a supervisor"),r.qZA(),r.TgZ(3,"mat-select",10),r.NdJ("valueChange",function(t){return r.CHM(e),r.oxw().selected=t}),r.TgZ(4,"mat-option",5),r._uU(5," Supervisores "),r.qZA(),r.YNc(6,fO,2,3,"mat-option",6),r.qZA(),r.TgZ(7,"div",7),r.TgZ(8,"button",8),r.NdJ("click",function(){return r.CHM(e),r.oxw().callSupervisor()}),r._uU(9,"Llamar"),r.qZA(),r.qZA(),r.qZA()}if(2&e){const e=r.oxw();r.xp6(3),r.Q6J("value",e.selected),r.xp6(1),r.Q6J("value",null),r.xp6(2),r.Q6J("ngForOf",e.supervisors)}}const gO=[{path:"",redirectTo:"preview",pathMatch:"full"},{path:"preview",component:(()=>{class e{constructor(e,t,n,r,i){this.formBuilder=e,this.router=t,this.tokeService=n,this.firestore=r,this.activatedRoute=i,this.channel="",this.condominium="",this.userType="",this.showSettings=!1,this.joinLoading=!1,this.newLoading=!1,this.subscriptions=[],this.houses=[],this.residents=[],this.supervisors=[],this.managerNum=""}ngOnInit(){var e=this;return rc(function*(){oc([e.activatedRoute.queryParams.pipe(Pi(1))]).pipe(Pi(1)).subscribe(([t])=>{e.condominium=t.condominium,e.userType=t.userType,console.log(t.condominium)});let t=[],n=[],r=[];e.condominium&&"guard"==e.userType?(yield e.firestore.collection("condominium").doc(`${e.condominium}`).collection("resident").valueChanges().subscribe(e=>e.map(e=>{t.push(e),n.push({houseNumber:e.houseNumber,resident:e.residentNum})})),e.houses=n,e.residents=t,yield e.firestore.collection("condominium").doc(`${e.condominium}`).collection("supervisor").valueChanges().subscribe(t=>{e.supervisor=t[0]}),yield e.firestore.collection("condominium").doc(`${e.condominium}`).valueChanges().subscribe(t=>{let n=t;e.firestore.collection("user",e=>e.where("managerNum","==",n.managerNum)).valueChanges().subscribe(t=>{e.manager=t[0]})})):e.condominium&&"resident"==e.userType?(yield e.firestore.collection("condominium").doc(`${e.condominium}`).collection("guard",e=>e.where("place","==","Caseta")).valueChanges().subscribe(t=>{e.firestore.collection("user",e=>e.where("guardNum","==",t[0].guardNum)).valueChanges().subscribe(t=>{e.guard=t[0]})}),yield e.firestore.collection("condominium").doc(`${e.condominium}`).collection("supervisor").valueChanges().subscribe(t=>{e.supervisor=t[0]})):e.condominium&&"admin"==e.userType?(yield e.firestore.collection("condominium").doc(`${e.condominium}`).collection("guard",e=>e.where("place","==","Caseta")).valueChanges().subscribe(t=>{e.guard=t[0]}),yield e.firestore.collection("condominium").doc(`${e.condominium}`).collection("supervisor").valueChanges().subscribe(t=>{e.supervisor=t[0]})):e.condominium||"center"!=e.userType||(yield e.firestore.collection("user",e=>e.where("userType","==","supervisor")).valueChanges().subscribe(e=>e.map(e=>{r.push(e)})),e.supervisors=r),e.connectionInfoForm=e.formBuilder.group({channel:"",link:""})})()}ngOnDestroy(){for(const e of this.subscriptions)e.unsubscribe()}onShowSettings(){this.showSettings=!0}onCloseSettings(){this.showSettings=!1}sendNotification(e,t,n){return rc(function*(){console.log("Token: =>> ",e.expoToken),console.log("Link: =>> ",t);const r={to:e.expoToken,sound:"default",title:"Fereg SR",body:"Tienes una llamada entrante.",priority:"high",data:{link:t,channel:n}};yield fetch("https://exp.host/--/api/v2/push/send",{method:"POST",headers:{Accept:"application/json","Accept-encoding":"gzip, deflate","Content-Type":"application/json"},mode:"no-cors",body:JSON.stringify(r)}).then(e=>{}).catch(e=>{alert(e)})})()}callResident(){var e=this;return rc(function*(){yield e.firestore.collection("user",t=>t.where("residentNum","==",e.selected.resident)).valueChanges().subscribe(t=>t.map(t=>{let n=t,r=e.selected.houseNumber,i="";r&&(i=e.tokeService.getLink(r.toString()),e.sendNotification(n,i,r)),e.router.navigate(["/meeting"],{queryParams:{channel:r,link:i}})}))})()}callCenter(){var e=this;return rc(function*(){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<=10;r++)t+=n.charAt(Math.floor(Math.random()*n.length));yield e.firestore.collection("user",e=>e.where("email","==","cmonitoreo@feregsp.com")).valueChanges().subscribe(n=>n.map(n=>{let r=n,i=t,o="";i&&(o=e.tokeService.getLink(i.toString()),e.sendNotification(r,o,i)),e.router.navigate(["/meeting"],{queryParams:{channel:i,link:o}})}))})()}callSupervisor(){var e=this;return rc(function*(){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<=10;r++)t+=n.charAt(Math.floor(Math.random()*n.length));if("center"===e.userType){let n=t,r="";n&&(r=e.tokeService.getLink(n.toString()),e.sendNotification(e.selected,r,n)),e.router.navigate(["/meeting"],{queryParams:{channel:n,link:r}})}else yield e.firestore.collection("user",t=>t.where("email","==",e.supervisor.email)).valueChanges().subscribe(n=>n.map(n=>{let r=n;console.log(r.email);let i=t,o="";i&&(o=e.tokeService.getLink(i.toString()),e.sendNotification(r,o,i)),e.router.navigate(["/meeting"],{queryParams:{channel:i,link:o}})}))})()}callManager(){var e=this;return rc(function*(){console.log(e.manager);for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<=10;r++)t+=n.charAt(Math.floor(Math.random()*n.length));let i=t,o="";i&&(o=e.tokeService.getLink(i.toString()),e.sendNotification(e.manager,o,i)),e.router.navigate(["/meeting"],{queryParams:{channel:i,link:o}})})()}callGuard(){var e=this;return rc(function*(){console.log("Guard Num",e.guard.guardNum);for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<=10;r++)t+=n.charAt(Math.floor(Math.random()*n.length));yield e.firestore.collection("user",t=>t.where("guardNum","==",e.guard.guardNum)).valueChanges().subscribe(n=>n.map(n=>{let r=n,i=t,o="";i&&(o=e.tokeService.getLink(i.toString()),e.sendNotification(r,o,i)),e.router.navigate(["/meeting"],{queryParams:{channel:i,link:o}})}))})()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(dh),r.Y36(Ma),r.Y36(kc),r.Y36(SI),r.Y36(fs))},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-meeting-preview"]],decls:7,vars:5,consts:[[1,"page"],[1,"meeting-info"],[4,"ngIf"],[1,"title"],["placeholder","Residencias","formControlName","label",3,"value","valueChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"button-container"],["type","submit",1,"btn",3,"click"],["type","submit",1,"btnCenter",3,"click"],["placeholder","Supervisores","formControlName","label",3,"value","valueChange"]],template:function(e,t){1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"div",1),r.YNc(2,lO,16,3,"div",2),r.YNc(3,hO,12,0,"div",2),r.YNc(4,dO,12,0,"div",2),r.YNc(5,pO,6,0,"div",2),r.YNc(6,mO,10,3,"div",2),r.qZA(),r.qZA()),2&e&&(r.xp6(2),r.Q6J("ngIf","guard"===t.userType),r.xp6(1),r.Q6J("ngIf","resident"===t.userType),r.xp6(1),r.Q6J("ngIf","admin"===t.userType),r.xp6(1),r.Q6J("ngIf","supervisor"===t.userType),r.xp6(1),r.Q6J("ngIf","center"===t.userType))},directives:[P,aO,Dl,uh,xA,k],styles:[".page[_ngcontent-%COMP%]{text-align:center;background-color:#282828;max-height:100%;max-width:100%}  *{margin:0;padding:0}.form[_ngcontent-%COMP%], .meeting-info[_ngcontent-%COMP%]{padding-top:16px}.meeting-info[_ngcontent-%COMP%]{align-items:center}.title[_ngcontent-%COMP%]{color:#bd8234;font-size:20pt}.mat-select[_ngcontent-%COMP%], .title[_ngcontent-%COMP%]{font-family:galanogrotesque}.mat-select[_ngcontent-%COMP%]{background:#e5e5e5;width:40%;height:25px}.button-container[_ngcontent-%COMP%]{width:100%;height:10%;display:flex;flex-direction:row;justify-content:center;margin-top:16px}.btn[_ngcontent-%COMP%]{height:25px}.btn[_ngcontent-%COMP%], .btnCenter[_ngcontent-%COMP%]{border-radius:1rem;width:30%;background-color:#fb5b5a;color:#f4ce6e;border:none;font-family:galanogrotesque}.btnCenter[_ngcontent-%COMP%]{height:35px}"]}),e})()},{path:"meeting",component:ll}];let _O=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[z,Ka.forRoot(gO,{useHash:!0})],Ka]}),e})(),vO=(()=>{class e{constructor(){this.title="fereg-call"}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=r.Xpm({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(e,t){1&e&&r._UZ(0,"router-outlet")},directives:[Ua],styles:[""]}),e})();const yO={apiKey:"AIzaSyB3iG1C4TOTda1Cp5o4x4Df4wgjlnw5EHA",authDomain:"fereg-sr.firebaseapp.com",projectId:"fereg-sr",storageBucket:"fereg-sr.appspot.com",messagingSenderId:"1073184985324",appId:"1:1073184985324:web:23d213e6ebdd43829ad5c9"},EO=new r.OlP("angularfire2.messaging.vapid-key"),SO=new r.OlP("angularfire2.messaging.service-worker-registeration"),TO=parseInt(Th.Z.SDK_VERSION,10)<8;let bO=(()=>{class e{constructor(e,t,r,i,o,s){const a=new Sh.HU(i),c=s,u=(0,ke.of)(void 0).pipe((0,ZR.R)(a.outsideAngular),(0,Eh.QV)(a.insideAngular),Oi(()=>K(r)?Ri.E:n.e(995).then(n.bind(n,8995))),(0,Fe.U)(()=>(0,Sh.on)(e,i,t)),Oi(e=>(0,Sh.sI)(`${e.name}.messaging`,"AngularFireMessaging",e,()=>(0,ac.mG)(this,void 0,void 0,function*(){const t=e.messaging();return TO&&(o&&t.usePublicVapidKey(o),c&&t.useServiceWorker(yield c)),t}),[o,c])),XR({bufferSize:1,refCount:!1}));this.requestPermission=u.pipe((0,ZR.R)(a.outsideAngular),(0,Eh.QV)(a.insideAngular),Oi(e=>Th.Z.messaging.isSupported()?e.requestPermission():(0,Ec._)("Not supported."))),this.getToken=u.pipe((0,ZR.R)(a.outsideAngular),(0,Eh.QV)(a.insideAngular),Oi(e=>(0,ac.mG)(this,void 0,void 0,function*(){if(Th.Z.messaging.isSupported()&&"granted"===Notification.permission){if(TO)return yield e.getToken();{const t=c?yield c:null;return yield e.getToken({vapidKey:o,serviceWorkerRegistration:t})}}return null})));const l=new De.y(e=>{navigator.permissions.query({name:"notifications"}).then(t=>{t.onchange=()=>e.next()})}),h=u.pipe((0,ZR.R)(a.outsideAngular),(0,Eh.QV)(a.insideAngular),$R(l),$R(this.getToken));return this.tokenChanges=u.pipe((0,ZR.R)(a.outsideAngular),(0,Eh.QV)(a.insideAngular),Oi(()=>Th.Z.messaging.isSupported()?wi(this.getToken,h):Ri.E)),this.messages=u.pipe((0,ZR.R)(a.outsideAngular),(0,Eh.QV)(a.insideAngular),Oi(e=>Th.Z.messaging.isSupported()?new De.y(t=>e.onMessage(e=>t.next(e),e=>t.error(e),()=>t.complete())):Ri.E)),this.requestToken=(0,ke.of)(void 0).pipe((0,ZR.R)(a.outsideAngular),(0,Eh.QV)(a.insideAngular),Oi(()=>this.requestPermission),Bi(()=>(0,ke.of)(null)),(0,Pe.zg)(()=>this.tokenChanges)),this.deleteToken=e=>u.pipe((0,ZR.R)(a.outsideAngular),(0,Eh.QV)(a.insideAngular),Oi(t=>t.deleteToken(e||void 0)),Ji(!1)),(0,Sh.pX)(this,u,i)}}return e.\u0275fac=function(t){return new(t||e)(r.LFG(Sh.Dh),r.LFG(Sh.xv,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(EO,8),r.LFG(SO,8))},e.\u0275prov=r.Yz7({factory:function(){return new e(r.LFG(Sh.Dh),r.LFG(Sh.xv,8),r.LFG(r.Lbi),r.LFG(r.R0b),r.LFG(EO,8),r.LFG(SO,8))},token:e,providedIn:"any"}),e})();(0,Sh.GT)(bO,[{deleteToken:null,getToken:null,onMessage:null,onBackgroundMessage:null,onTokenRefresh:null,requestPermission:null,setBackgroundMessageHandler:null,useServiceWorker:null,usePublicVapidKey:null}]);let wO=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({providers:[bO]}),e})(),RO=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[bA,uA],uA]}),e})(),IO=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e,bootstrap:[vO]}),e.\u0275inj=r.cJS({providers:[W],imports:[[Ne,_O,hh,il,_t,_c.forRoot({AppID:"668a99d1131d4707a6222ffd0813b879",Video:{codec:"h264",mode:"rtc",role:"host"}}),Sh.hO.initializeApp(yO),wO,cO,ai,BA,RO]]}),e})();(0,r.G48)(),Ae().bootstrapModule(IO).catch(e=>console.error(e))},1052:e=>{function t(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(u){return void n(u)}a.done?t(c):Promise.resolve(c).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise(function(i,o){var s=e.apply(n,r);function a(e){t(s,i,o,a,c,"next",e)}function c(e){t(s,i,o,a,c,"throw",e)}a(void 0)})}},e.exports.default=e.exports,e.exports.__esModule=!0},4762:(e,t,n)=>{"use strict";n.d(t,{ZT:()=>i,pi:()=>o,mG:()=>s,Jh:()=>a,XA:()=>c,CR:()=>u,ev:()=>l});var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})}function a(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(a){o=[6,a],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function c(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function l(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||t)}}},e=>{"use strict";e(e.s=8848)}]);