{"ast":null,"code":"import _asyncToGenerator from \"/Users/homero/fereg-call/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { forkJoin } from 'rxjs';\nimport { take } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../shared/services/token.service\";\nimport * as i4 from \"@angular/fire/firestore\";\nimport * as i5 from \"@angular/common\";\n\nfunction MeetingPreviewComponent_option_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 9);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(item_r1);\n  }\n}\n\nexport class MeetingPreviewComponent {\n  constructor(formBuilder, router, tokeService, firestore, activatedRoute) {\n    this.formBuilder = formBuilder;\n    this.router = router;\n    this.tokeService = tokeService;\n    this.firestore = firestore;\n    this.activatedRoute = activatedRoute;\n    this.channel = '';\n    this.condominium = '';\n    this.showSettings = false;\n    this.joinLoading = false;\n    this.newLoading = false;\n    this.subscriptions = [];\n    this.houses = [];\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n\n      forkJoin([_this.activatedRoute.queryParams.pipe(take(1))]).pipe(take(1)).subscribe(([params]) => {\n        _this.condominium = params.condominium;\n      });\n      let residentsArray = [];\n      yield _this.firestore.collection(\"condominium\").doc(`${_this.condominium}`).collection('resident').valueChanges().subscribe(items => items.map(item => {\n        residentsArray.push('Casa ' + item.houseNumber);\n      }));\n      _this.houses = residentsArray;\n      _this.connectionInfoForm = _this.formBuilder.group({\n        channel: '',\n        link: ''\n      });\n      const channelChangeSubs = (_a = _this.connectionInfoForm.get('channel')) === null || _a === void 0 ? void 0 : _a.valueChanges.subscribe(value => {\n        var _a, _b, _c, _d;\n\n        if (value === '') {\n          (_b = (_a = _this.connectionInfoForm) === null || _a === void 0 ? void 0 : _a.get('link')) === null || _b === void 0 ? void 0 : _b.enable({\n            emitEvent: false\n          });\n        } else {\n          (_d = (_c = _this.connectionInfoForm) === null || _c === void 0 ? void 0 : _c.get('link')) === null || _d === void 0 ? void 0 : _d.disable({\n            emitEvent: false\n          });\n        }\n      });\n\n      _this.subscriptions.push(channelChangeSubs);\n\n      const linkChangeSubs = (_b = _this.connectionInfoForm.get('link')) === null || _b === void 0 ? void 0 : _b.valueChanges.subscribe(value => {\n        var _a, _b, _c, _d;\n\n        if (value === '') {\n          (_b = (_a = _this.connectionInfoForm) === null || _a === void 0 ? void 0 : _a.get('channel')) === null || _b === void 0 ? void 0 : _b.enable({\n            emitEvent: false\n          });\n        } else {\n          (_d = (_c = _this.connectionInfoForm) === null || _c === void 0 ? void 0 : _c.get('channel')) === null || _d === void 0 ? void 0 : _d.disable({\n            emitEvent: false\n          });\n        }\n      });\n\n      _this.subscriptions.push(linkChangeSubs);\n    })();\n  }\n\n  selectHouse(event) {\n    this.channel = event.target.value;\n  }\n\n  ngOnDestroy() {\n    for (const subs of this.subscriptions) {\n      subs.unsubscribe();\n    }\n  }\n\n  onShowSettings() {\n    this.showSettings = true;\n  }\n\n  onCloseSettings() {\n    this.showSettings = false;\n  }\n\n  onJoinMeeting() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      console.log('calling');\n      let channel = _this2.channel;\n      let link = ''; // const { channel, link } = this.connectionInfoForm?.value;\n\n      if (_this2.channel) {\n        const message = {\n          to: 'ExponentPushToken[6CVGlsCRjGituFlhH7tCiv]',\n          sound: 'default',\n          title: 'Fereg SR',\n          body: 'Tienes una llamada entrante.',\n          data: {\n            someData: 'goes here'\n          }\n        };\n        yield fetch('https://exp.host/--/api/v2/push/send', {\n          method: 'POST',\n          headers: {\n            Accept: 'application/json',\n            'Accept-encoding': 'gzip, deflate',\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(message)\n        });\n\n        const joinLink = _this2.tokeService.getLink(_this2.channel);\n\n        link = joinLink;\n        alert(`You can Invite other people using the link: ${joinLink}`);\n      }\n\n      _this2.router.navigate(['/meeting'], {\n        queryParams: {\n          channel,\n          link\n        }\n      });\n    })();\n  }\n\n}\n\nMeetingPreviewComponent.ɵfac = function MeetingPreviewComponent_Factory(t) {\n  return new (t || MeetingPreviewComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.TokenService), i0.ɵɵdirectiveInject(i4.AngularFirestore), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n};\n\nMeetingPreviewComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: MeetingPreviewComponent,\n  selectors: [[\"app-meeting-preview\"]],\n  decls: 12,\n  vars: 4,\n  consts: [[1, \"page\"], [1, \"meeting-info\"], [1, \"title\"], [1, \"form\", 3, \"formGroup\", \"ngSubmit\"], [\"aria-label\", \"ngSelected demo\", 3, \"change\"], [3, \"ngValue\", \"disabled\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"button-container\"], [\"type\", \"submit\", 1, \"btn\"], [3, \"value\"]],\n  template: function MeetingPreviewComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵelementStart(1, \"div\", 1);\n      i0.ɵɵelementStart(2, \"h5\", 2);\n      i0.ɵɵtext(3, \"Selecciona la casa a llamar\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(4, \"form\", 3);\n      i0.ɵɵlistener(\"ngSubmit\", function MeetingPreviewComponent_Template_form_ngSubmit_4_listener() {\n        return ctx.onJoinMeeting();\n      });\n      i0.ɵɵelementStart(5, \"select\", 4);\n      i0.ɵɵlistener(\"change\", function MeetingPreviewComponent_Template_select_change_5_listener($event) {\n        return ctx.selectHouse($event);\n      });\n      i0.ɵɵelementStart(6, \"option\", 5);\n      i0.ɵɵtext(7, \"Residencias\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(8, MeetingPreviewComponent_option_8_Template, 2, 2, \"option\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(9, \"div\", 7);\n      i0.ɵɵelementStart(10, \"button\", 8);\n      i0.ɵɵtext(11, \"Llamar\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(4);\n      i0.ɵɵproperty(\"formGroup\", ctx.connectionInfoForm);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngValue\", null)(\"disabled\", true);\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.houses);\n    }\n  },\n  directives: [i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i5.NgForOf],\n  styles: [\".page[_ngcontent-%COMP%] {\\n  text-align: center;\\n  background-color: #282828;\\n}\\n\\n  * {\\n  margin: 0;\\n  padding: 0;\\n}\\n\\n.form[_ngcontent-%COMP%] {\\n  padding-top: 16px;\\n}\\n\\n.meeting-info[_ngcontent-%COMP%] {\\n  align-items: center;\\n  padding-top: 16px;\\n}\\n\\n.title[_ngcontent-%COMP%] {\\n  color: #bd8234;\\n  font-size: 20pt;\\n}\\n\\n.button-container[_ngcontent-%COMP%] {\\n  width: 100%;\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: center;\\n  margin-top: 16px;\\n}\\n\\n.btn[_ngcontent-%COMP%] {\\n  border-radius: 1rem;\\n  width: 30%;\\n  height: 20px;\\n  background-color: #fb5b5a;\\n  color: #f4ce6e;\\n  border: none;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lZXRpbmctcHJldmlldy5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLGtCQUFBO0VBQ0EseUJBQUE7QUFDSjs7QUFDQTtFQUNJLFNBQUE7RUFDQSxVQUFBO0FBRUo7O0FBQ0E7RUFDSSxpQkFBQTtBQUVKOztBQUNBO0VBQ0ksbUJBQUE7RUFDQSxpQkFBQTtBQUVKOztBQUNBO0VBQ0ksY0FBQTtFQUNBLGVBQUE7QUFFSjs7QUFDQTtFQUNJLFdBQUE7RUFDQSxhQUFBO0VBQ0EsbUJBQUE7RUFDQSx1QkFBQTtFQUNBLGdCQUFBO0FBRUo7O0FBQ0E7RUFDSSxtQkFBQTtFQUNBLFVBQUE7RUFDQSxZQUFBO0VBQ0EseUJBQUE7RUFDQSxjQUFBO0VBQ0EsWUFBQTtBQUVKIiwiZmlsZSI6Im1lZXRpbmctcHJldmlldy5jb21wb25lbnQuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIi5wYWdlIHtcbiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogIzI4MjgyODtcbn1cbjo6bmctZGVlcCAqIHtcbiAgICBtYXJnaW46IDA7XG4gICAgcGFkZGluZzogMDtcbn1cblxuLmZvcm0ge1xuICAgIHBhZGRpbmctdG9wOiAxNnB4O1xufVxuXG4ubWVldGluZy1pbmZvIHtcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgIHBhZGRpbmctdG9wOiAxNnB4O1xufVxuXG4udGl0bGUge1xuICAgIGNvbG9yOiAjYmQ4MjM0O1xuICAgIGZvbnQtc2l6ZTogMjBwdDtcbn1cblxuLmJ1dHRvbi1jb250YWluZXIge1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICBtYXJnaW4tdG9wOiAxNnB4O1xufVxuXG4uYnRuIHtcbiAgICBib3JkZXItcmFkaXVzOiAxcmVtO1xuICAgIHdpZHRoOiAzMCU7XG4gICAgaGVpZ2h0OiAyMHB4O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNmYjViNWE7XG4gICAgY29sb3I6ICNmNGNlNmU7XG4gICAgYm9yZGVyOiBub25lO1xufVxuICAgIFxuIl19 */\"]\n});","map":{"version":3,"sources":["/Users/homero/fereg-call/src/app/pages/meeting-preview/meeting-preview.component.ts","/Users/homero/fereg-call/src/app/pages/meeting-preview/meeting-preview.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { forkJoin, Subscription } from 'rxjs';\nimport { TokenService } from '../../shared/services/token.service';\nimport { AngularFirestore, AngularFirestoreDocument } from '@angular/fire/firestore';\nimport { take } from 'rxjs/operators';\n\n@Component({\n  selector: 'app-meeting-preview',\n  templateUrl: './meeting-preview.component.html',\n  styleUrls: ['./meeting-preview.component.scss']\n})\nexport class MeetingPreviewComponent implements OnInit, OnDestroy {\n  channel = '';\n  condominium = '';\n  showSettings = false;\n  joinLoading = false;\n  newLoading = false;\n  connectionInfoForm!: FormGroup;\n  subscriptions: Subscription[] = [];\n  houses: any[] = [];\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private router: Router,\n    private tokeService: TokenService,\n    private firestore: AngularFirestore,\n    private activatedRoute: ActivatedRoute,\n  ) { }\n\n  async ngOnInit(): Promise<void> {\n    forkJoin([\n      this.activatedRoute.queryParams.pipe(take(1)),\n    ])\n      .pipe(\n        take(1),\n      ).subscribe(([params]) => {\n        this.condominium = params.condominium;\n      });\n    let residentsArray: any[] = [];\n    \n    await this.firestore.collection(\"condominium\").doc(`${this.condominium}`).collection('resident')\n      .valueChanges()\n      .subscribe((items) => items.map(item => {\n        residentsArray.push('Casa ' + item.houseNumber)\n      }));\n\n    this.houses = residentsArray;    \n\n    this.connectionInfoForm = this.formBuilder.group({\n      channel: '',\n      link: '',\n    });\n\n    const channelChangeSubs = this.connectionInfoForm.get('channel')?.valueChanges.subscribe(value => {\n      if (value === '') {\n        this.connectionInfoForm?.get('link')?.enable({ emitEvent: false });\n      }\n      else {\n        this.connectionInfoForm?.get('link')?.disable({ emitEvent: false });\n      }\n    });\n\n    this.subscriptions.push(channelChangeSubs as Subscription);\n\n    const linkChangeSubs = this.connectionInfoForm.get('link')?.valueChanges.subscribe(value => {\n      if (value === '') {\n        this.connectionInfoForm?.get('channel')?.enable({ emitEvent: false });\n      }\n      else {\n        this.connectionInfoForm?.get('channel')?.disable({ emitEvent: false });\n      }\n    });\n    this.subscriptions.push(linkChangeSubs as Subscription);\n  }\n\n  selectHouse(event: any) {\n    this.channel = event.target.value;\n }\n\n  ngOnDestroy(): void {\n    for (const subs of this.subscriptions) {\n      subs.unsubscribe();\n    }\n  }\n\n  onShowSettings(): void {\n    this.showSettings = true;\n  }\n\n  onCloseSettings(): void {\n    this.showSettings = false;\n  }\n\n  async onJoinMeeting(): Promise<void> {\n    console.log('calling')\n    let channel = this.channel;\n    let link = '';\n    // const { channel, link } = this.connectionInfoForm?.value;\n    if (this.channel) {\n      const message = {\n        to: 'ExponentPushToken[6CVGlsCRjGituFlhH7tCiv]',\n        sound: 'default',\n        title: 'Fereg SR',\n        body: 'Tienes una llamada entrante.',\n        data: { someData: 'goes here' },\n      };\n    \n      await fetch('https://exp.host/--/api/v2/push/send', {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Accept-encoding': 'gzip, deflate',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(message),\n      });\n      const joinLink = this.tokeService.getLink(this.channel);\n      link = joinLink;\n      alert(`You can Invite other people using the link: ${joinLink}`);\n    }\n    this.router.navigate(['/meeting'], { queryParams: { channel, link } });\n  }\n}\n","<div class=\"page\">\n  <div class=\"meeting-info\">\n    <h5 class=\"title\">Selecciona la casa a llamar</h5>\n    <form class=\"form\" [formGroup]=\"connectionInfoForm\" (ngSubmit)=\"onJoinMeeting()\">\n      <select aria-label=\"ngSelected demo\" (change)=\"selectHouse($event)\">\n        <option [ngValue]=\"null\" [disabled]=\"true\" >Residencias</option>\n        <option [value]=\"item\" *ngFor=\"let item of houses\">{{item}}</option>\n      </select>\n      <div class=\"button-container\">\n        <button type=\"submit\" class=\"btn\">Llamar</button>\n      </div>\n    </form>\n  </div> \n</div>"],"sourceRoot":""},"metadata":{},"sourceType":"module"}