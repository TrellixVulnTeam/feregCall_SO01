{"ast":null,"code":"import _asyncToGenerator from \"/Users/homero/fereg-call/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { forkJoin } from 'rxjs';\nimport { take } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"../../shared/services/token.service\";\nimport * as i4 from \"@angular/fire/firestore\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/select\";\nimport * as i7 from \"@angular/material/core\";\n\nfunction MeetingPreviewComponent_div_2_mat_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"mat-option\", 5);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const item_r5 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", item_r5);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" Casa - \", item_r5.houseNumber, \" \");\n  }\n}\n\nfunction MeetingPreviewComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"h5\", 3);\n    i0.ɵɵtext(2, \"Llamar a residente\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"mat-select\", 4);\n    i0.ɵɵlistener(\"valueChange\", function MeetingPreviewComponent_div_2_Template_mat_select_valueChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.selected = $event;\n    });\n    i0.ɵɵelementStart(4, \"mat-option\", 5);\n    i0.ɵɵtext(5, \" Residencias \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, MeetingPreviewComponent_div_2_mat_option_6_Template, 2, 2, \"mat-option\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 7);\n    i0.ɵɵelementStart(8, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function MeetingPreviewComponent_div_2_Template_button_click_8_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.onJoinMeeting();\n    });\n    i0.ɵɵtext(9, \"Llamar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"div\", 7);\n    i0.ɵɵelementStart(11, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function MeetingPreviewComponent_div_2_Template_button_click_11_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.callSupervisor();\n    });\n    i0.ɵɵtext(12, \"Llamar a supervisor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"value\", ctx_r0.selected);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"value\", null);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.houses);\n  }\n}\n\nfunction MeetingPreviewComponent_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"h5\", 3);\n    i0.ɵɵtext(2, \"Llamar a caseta\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 7);\n    i0.ɵɵelementStart(4, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function MeetingPreviewComponent_div_3_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r11);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return ctx_r10.callGuard();\n    });\n    i0.ɵɵtext(5, \"Llamar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction MeetingPreviewComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"h5\", 3);\n    i0.ɵɵtext(2, \"Llamar a Supervisor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 7);\n    i0.ɵɵelementStart(4, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function MeetingPreviewComponent_div_4_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return ctx_r12.callSupervisor();\n    });\n    i0.ɵɵtext(5, \"Llamar a supervisor\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction MeetingPreviewComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"h5\", 3);\n    i0.ɵɵtext(2, \"Llamar a centro de monitoreo\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 7);\n    i0.ɵɵelementStart(4, \"button\", 8);\n    i0.ɵɵlistener(\"click\", function MeetingPreviewComponent_div_5_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r14 = i0.ɵɵnextContext();\n      return ctx_r14.callCenter();\n    });\n    i0.ɵɵtext(5, \"Llamar a centro\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport class MeetingPreviewComponent {\n  constructor(formBuilder, router, tokeService, firestore, activatedRoute) {\n    this.formBuilder = formBuilder;\n    this.router = router;\n    this.tokeService = tokeService;\n    this.firestore = firestore;\n    this.activatedRoute = activatedRoute;\n    this.channel = '';\n    this.condominium = '';\n    this.userType = '';\n    this.showSettings = false;\n    this.joinLoading = false;\n    this.newLoading = false;\n    this.subscriptions = [];\n    this.houses = [];\n    this.residents = [];\n  }\n\n  ngOnInit() {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      var _a, _b;\n\n      forkJoin([_this.activatedRoute.queryParams.pipe(take(1))]).pipe(take(1)).subscribe(([params]) => {\n        _this.condominium = params.condominium;\n        _this.userType = params.userType;\n        console.log(params.condominium);\n      });\n      let residentsArray = [];\n      let housesArray = [];\n      let supervisorsArray = [];\n\n      if (_this.userType == 'guard') {\n        yield _this.firestore.collection(\"condominium\").doc(`${_this.condominium}`).collection('resident').valueChanges().subscribe(items => items.map(item => {\n          residentsArray.push(item);\n          housesArray.push({\n            houseNumber: item.houseNumber,\n            resident: item.residentNum\n          });\n        }));\n        _this.houses = housesArray;\n        _this.residents = residentsArray;\n        yield _this.firestore.collection(\"condominium\").doc(`${_this.condominium}`).collection('supervisor', ref => ref.where('userType', '==', 'supervisor')).valueChanges().subscribe(supervisor => {\n          _this.supervisor = supervisor[0];\n        });\n      } else if (_this.userType == 'resident') {\n        yield _this.firestore.collection(\"condominium\").doc(`${_this.condominium}`).collection('guard', ref => ref.where('place', '==', 'Caseta')).valueChanges().subscribe(guard => {\n          _this.guard = guard[0];\n        });\n      } else if (_this.userType == 'guard') {\n        yield _this.firestore.collection(\"condominium\").doc(`${_this.condominium}`).collection('supervisor', ref => ref.where('userType', '==', 'supervisor')).valueChanges().subscribe(supervisor => {\n          _this.supervisor = supervisor[0];\n        });\n      } // ToDo: add function to each user type\n\n\n      _this.connectionInfoForm = _this.formBuilder.group({\n        channel: '',\n        link: ''\n      });\n      const channelChangeSubs = (_a = _this.connectionInfoForm.get('channel')) === null || _a === void 0 ? void 0 : _a.valueChanges.subscribe(value => {\n        var _a, _b, _c, _d;\n\n        if (value === '') {\n          (_b = (_a = _this.connectionInfoForm) === null || _a === void 0 ? void 0 : _a.get('link')) === null || _b === void 0 ? void 0 : _b.enable({\n            emitEvent: false\n          });\n        } else {\n          (_d = (_c = _this.connectionInfoForm) === null || _c === void 0 ? void 0 : _c.get('link')) === null || _d === void 0 ? void 0 : _d.disable({\n            emitEvent: false\n          });\n        }\n      });\n\n      _this.subscriptions.push(channelChangeSubs);\n\n      const linkChangeSubs = (_b = _this.connectionInfoForm.get('link')) === null || _b === void 0 ? void 0 : _b.valueChanges.subscribe(value => {\n        var _a, _b, _c, _d;\n\n        if (value === '') {\n          (_b = (_a = _this.connectionInfoForm) === null || _a === void 0 ? void 0 : _a.get('channel')) === null || _b === void 0 ? void 0 : _b.enable({\n            emitEvent: false\n          });\n        } else {\n          (_d = (_c = _this.connectionInfoForm) === null || _c === void 0 ? void 0 : _c.get('channel')) === null || _d === void 0 ? void 0 : _d.disable({\n            emitEvent: false\n          });\n        }\n      });\n\n      _this.subscriptions.push(linkChangeSubs);\n    })();\n  }\n\n  ngOnDestroy() {\n    for (const subs of this.subscriptions) {\n      subs.unsubscribe();\n    }\n  }\n\n  onShowSettings() {\n    this.showSettings = true;\n  }\n\n  onCloseSettings() {\n    this.showSettings = false;\n  }\n\n  sendNotification(resident, link, channel) {\n    return _asyncToGenerator(function* () {\n      console.log('Token: =>> ', resident.expoToken);\n      console.log('Link: =>> ', link);\n      const message = {\n        to: resident.expoToken,\n        sound: 'default',\n        title: 'Fereg SR',\n        body: 'Tienes una llamada entrante.',\n        priority: 'high',\n        data: {\n          link: link,\n          channel: channel\n        }\n      };\n      yield fetch('https://exp.host/--/api/v2/push/send', {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Accept-encoding': 'gzip, deflate',\n          'Content-Type': 'application/json'\n        },\n        mode: 'no-cors',\n        body: JSON.stringify(message)\n      });\n    })();\n  }\n\n  onJoinMeeting() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.firestore.collection(\"user\", ref => ref.where('residentNum', '==', _this2.selected.resident)).valueChanges().subscribe(data => data.map(res => {\n        let resident = res;\n        let channel = _this2.selected.houseNumber;\n        let link = ''; // const { channel, link } = this.connectionInfoForm?.value;\n\n        if (channel) {\n          const joinLink = _this2.tokeService.getLink(channel.toString());\n\n          link = joinLink;\n\n          _this2.sendNotification(resident, link, channel); // alert(`You can Invite other people using the link: ${joinLink}`);\n\n        }\n\n        _this2.router.navigate(['/meeting'], {\n          queryParams: {\n            channel,\n            link\n          }\n        });\n      }));\n    })();\n  }\n\n  callCenter() {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this3.firestore.collection(\"user\", ref => ref.where('residentNum', '==', _this3.selected.resident)).valueChanges().subscribe(data => data.map(res => {\n        let resident = res;\n        let channel = _this3.selected.houseNumber;\n        let link = ''; // const { channel, link } = this.connectionInfoForm?.value;\n\n        if (channel) {\n          const joinLink = _this3.tokeService.getLink(channel.toString());\n\n          link = joinLink;\n\n          _this3.sendNotification(resident, link, channel); // alert(`You can Invite other people using the link: ${joinLink}`);\n\n        }\n\n        _this3.router.navigate(['/meeting'], {\n          queryParams: {\n            channel,\n            link\n          }\n        });\n      }));\n    })();\n  }\n\n  callSupervisor() {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      console.log(_this4.supervisor);\n      var channelId = \"\";\n      var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n      for (var i = 0; i <= 10; i++) {\n        channelId += possible.charAt(Math.floor(Math.random() * possible.length));\n      }\n\n      yield _this4.firestore.collection(\"user\", ref => ref.where('email', '==', _this4.supervisor.email)).valueChanges().subscribe(data => data.map(res => {\n        let supervisor = res;\n        let channel = channelId;\n        let link = ''; // const { channel, link } = this.connectionInfoForm?.value;\n\n        if (channel) {\n          const joinLink = _this4.tokeService.getLink(channel.toString());\n\n          link = joinLink;\n\n          _this4.sendNotification(supervisor, link, channel); // alert(`You can Invite other people using the link: ${joinLink}`);\n\n        }\n\n        _this4.router.navigate(['/meeting'], {\n          queryParams: {\n            channel,\n            link\n          }\n        });\n      }));\n    })();\n  }\n\n  callGuard() {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      var channelId = \"\";\n      var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n\n      for (var i = 0; i <= 10; i++) {\n        channelId += possible.charAt(Math.floor(Math.random() * possible.length));\n      }\n\n      yield _this5.firestore.collection(\"user\", ref => ref.where('guardNum', '==', _this5.guard.guardNum)).valueChanges().subscribe(data => data.map(res => {\n        let guardPlace = res;\n        let channel = channelId;\n        let link = ''; // const { channel, link } = this.connectionInfoForm?.value;\n\n        if (channel) {\n          const joinLink = _this5.tokeService.getLink(channel.toString());\n\n          link = joinLink;\n\n          _this5.sendNotification(guardPlace, link, channel); // alert(`You can Invite other people using the link: ${joinLink}`);\n\n        }\n\n        _this5.router.navigate(['/meeting'], {\n          queryParams: {\n            channel,\n            link\n          }\n        });\n      }));\n    })();\n  }\n\n}\n\nMeetingPreviewComponent.ɵfac = function MeetingPreviewComponent_Factory(t) {\n  return new (t || MeetingPreviewComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.TokenService), i0.ɵɵdirectiveInject(i4.AngularFirestore), i0.ɵɵdirectiveInject(i2.ActivatedRoute));\n};\n\nMeetingPreviewComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: MeetingPreviewComponent,\n  selectors: [[\"app-meeting-preview\"]],\n  decls: 6,\n  vars: 4,\n  consts: [[1, \"page\"], [1, \"meeting-info\"], [4, \"ngIf\"], [1, \"title\"], [\"placeholder\", \"Residencias\", \"formControlName\", \"label\", 3, \"value\", \"valueChange\"], [3, \"value\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"button-container\"], [\"type\", \"submit\", 1, \"btn\", 3, \"click\"]],\n  template: function MeetingPreviewComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵelementStart(1, \"div\", 1);\n      i0.ɵɵtemplate(2, MeetingPreviewComponent_div_2_Template, 13, 3, \"div\", 2);\n      i0.ɵɵtemplate(3, MeetingPreviewComponent_div_3_Template, 6, 0, \"div\", 2);\n      i0.ɵɵtemplate(4, MeetingPreviewComponent_div_4_Template, 6, 0, \"div\", 2);\n      i0.ɵɵtemplate(5, MeetingPreviewComponent_div_5_Template, 6, 0, \"div\", 2);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngIf\", ctx.userType === \"guard\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.userType === \"resident\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.userType === \"admin\");\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.userType === \"supervisor\");\n    }\n  },\n  directives: [i5.NgIf, i6.MatSelect, i1.NgControlStatus, i1.FormControlName, i7.MatOption, i5.NgForOf],\n  styles: [\".page[_ngcontent-%COMP%] {\\n  text-align: center;\\n  background-color: #282828;\\n  max-height: 100%;\\n  max-width: 100%;\\n}\\n\\n  * {\\n  margin: 0;\\n  padding: 0;\\n}\\n\\n.form[_ngcontent-%COMP%] {\\n  padding-top: 16px;\\n}\\n\\n.meeting-info[_ngcontent-%COMP%] {\\n  align-items: center;\\n  padding-top: 16px;\\n}\\n\\n.title[_ngcontent-%COMP%] {\\n  color: #bd8234;\\n  font-size: 20pt;\\n  font-family: \\\"galanogrotesque\\\";\\n}\\n\\n.mat-select[_ngcontent-%COMP%] {\\n  background: #e5e5e5;\\n  width: 40%;\\n  font-family: \\\"galanogrotesque\\\";\\n  height: 25px;\\n}\\n\\n.button-container[_ngcontent-%COMP%] {\\n  width: 100%;\\n  height: 10%;\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: center;\\n  margin-top: 16px;\\n}\\n\\n.btn[_ngcontent-%COMP%] {\\n  border-radius: 1rem;\\n  width: 30%;\\n  height: 25px;\\n  background-color: #fb5b5a;\\n  color: #f4ce6e;\\n  border: none;\\n  font-family: \\\"galanogrotesque\\\";\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lZXRpbmctcHJldmlldy5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNJLGtCQUFBO0VBQ0EseUJBQUE7RUFDQSxnQkFBQTtFQUNBLGVBQUE7QUFDSjs7QUFFQTtFQUNJLFNBQUE7RUFDQSxVQUFBO0FBQ0o7O0FBRUE7RUFDSSxpQkFBQTtBQUNKOztBQUVBO0VBQ0ksbUJBQUE7RUFDQSxpQkFBQTtBQUNKOztBQUVBO0VBQ0ksY0FBQTtFQUNBLGVBQUE7RUFDQSw4QkFBQTtBQUNKOztBQUVBO0VBQ0ksbUJBQUE7RUFDQSxVQUFBO0VBQ0EsOEJBQUE7RUFDQSxZQUFBO0FBQ0o7O0FBRUE7RUFDSSxXQUFBO0VBQ0EsV0FBQTtFQUNBLGFBQUE7RUFDQSxtQkFBQTtFQUNBLHVCQUFBO0VBQ0EsZ0JBQUE7QUFDSjs7QUFFQTtFQUNJLG1CQUFBO0VBQ0EsVUFBQTtFQUNBLFlBQUE7RUFDQSx5QkFBQTtFQUNBLGNBQUE7RUFDQSxZQUFBO0VBQ0EsOEJBQUE7QUFDSiIsImZpbGUiOiJtZWV0aW5nLXByZXZpZXcuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIucGFnZSB7XG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIGJhY2tncm91bmQtY29sb3I6ICMyODI4Mjg7XG4gICAgbWF4LWhlaWdodDogMTAwJTtcbiAgICBtYXgtd2lkdGg6IDEwMCU7XG59XG5cbjo6bmctZGVlcCAqIHtcbiAgICBtYXJnaW46IDA7XG4gICAgcGFkZGluZzogMDtcbn1cblxuLmZvcm0ge1xuICAgIHBhZGRpbmctdG9wOiAxNnB4O1xufVxuXG4ubWVldGluZy1pbmZvIHtcbiAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgIHBhZGRpbmctdG9wOiAxNnB4O1xufVxuXG4udGl0bGUge1xuICAgIGNvbG9yOiAjYmQ4MjM0O1xuICAgIGZvbnQtc2l6ZTogMjBwdDtcbiAgICBmb250LWZhbWlseTogJ2dhbGFub2dyb3Rlc3F1ZSc7XG59XG5cbi5tYXQtc2VsZWN0IHtcbiAgICBiYWNrZ3JvdW5kOiAjZTVlNWU1O1xuICAgIHdpZHRoOiA0MCU7XG4gICAgZm9udC1mYW1pbHk6ICdnYWxhbm9ncm90ZXNxdWUnO1xuICAgIGhlaWdodDogMjVweCxcbn1cblxuLmJ1dHRvbi1jb250YWluZXIge1xuICAgIHdpZHRoOiAxMDAlO1xuICAgIGhlaWdodDogMTAlO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcbiAgICBtYXJnaW4tdG9wOiAxNnB4O1xufVxuXG4uYnRuIHtcbiAgICBib3JkZXItcmFkaXVzOiAxcmVtO1xuICAgIHdpZHRoOiAzMCU7XG4gICAgaGVpZ2h0OiAyNXB4O1xuICAgIGJhY2tncm91bmQtY29sb3I6ICNmYjViNWE7XG4gICAgY29sb3I6ICNmNGNlNmU7XG4gICAgYm9yZGVyOiBub25lO1xuICAgIGZvbnQtZmFtaWx5OiAnZ2FsYW5vZ3JvdGVzcXVlJztcbn0iXX0= */\"]\n});","map":{"version":3,"sources":["/Users/homero/fereg-call/src/app/pages/meeting-preview/meeting-preview.component.ts","/Users/homero/fereg-call/src/app/pages/meeting-preview/meeting-preview.component.html"],"names":[],"mappings":";AAGA,SAAS,QAAT,QAAmD,MAAnD;AAGA,SAAS,IAAT,QAAqB,gBAArB;;;;;;;;;;;;ACIQ,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,YAAA,EAAA,CAAA;AACE,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA;AACF,IAAA,EAAA,CAAA,YAAA;;;;;AAFwC,IAAA,EAAA,CAAA,UAAA,CAAA,OAAA,EAAA,OAAA;AACtC,IAAA,EAAA,CAAA,SAAA,CAAA,CAAA;AAAA,IAAA,EAAA,CAAA,kBAAA,CAAA,UAAA,EAAA,OAAA,CAAA,WAAA,EAAA,GAAA;;;;;;;;AARN,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,IAAA,EAAA,CAAA;AAAkB,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,oBAAA;AAAkB,IAAA,EAAA,CAAA,YAAA;AACpC,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,YAAA,EAAA,CAAA;AAAsC,IAAA,EAAA,CAAA,UAAA,CAAA,aAAA,EAAA,SAAA,wEAAA,CAAA,MAAA,EAAA;AAAA,MAAA,EAAA,CAAA,aAAA,CAAA,GAAA;AAAA,YAAA,MAAA,GAAA,EAAA,CAAA,aAAA,EAAA;AAAA,aAAA,MAAA,CAAA,QAAA,GAAA,MAAA;AAAA,KAAA;AAEpC,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,YAAA,EAAA,CAAA;AACE,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,eAAA;AACF,IAAA,EAAA,CAAA,YAAA;AACA,IAAA,EAAA,CAAA,UAAA,CAAA,CAAA,EAAA,mDAAA,EAAA,CAAA,EAAA,CAAA,EAAA,YAAA,EAAA,CAAA;AAGF,IAAA,EAAA,CAAA,YAAA;AACA,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,QAAA,EAAA,CAAA;AAAkC,IAAA,EAAA,CAAA,UAAA,CAAA,OAAA,EAAA,SAAA,8DAAA,GAAA;AAAA,MAAA,EAAA,CAAA,aAAA,CAAA,GAAA;AAAA,YAAA,MAAA,GAAA,EAAA,CAAA,aAAA,EAAA;AAAA,aAAA,MAAA,CAAA,aAAA,EAAA;AAAA,KAAA;AAA0B,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,QAAA;AAAM,IAAA,EAAA,CAAA,YAAA;AACpE,IAAA,EAAA,CAAA,YAAA;AACA,IAAA,EAAA,CAAA,cAAA,CAAA,EAAA,EAAA,KAAA,EAAA,CAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,EAAA,EAAA,QAAA,EAAA,CAAA;AAAkC,IAAA,EAAA,CAAA,UAAA,CAAA,OAAA,EAAA,SAAA,+DAAA,GAAA;AAAA,MAAA,EAAA,CAAA,aAAA,CAAA,GAAA;AAAA,YAAA,MAAA,GAAA,EAAA,CAAA,aAAA,EAAA;AAAA,aAAA,MAAA,CAAA,cAAA,EAAA;AAAA,KAAA;AAA2B,IAAA,EAAA,CAAA,MAAA,CAAA,EAAA,EAAA,qBAAA;AAAmB,IAAA,EAAA,CAAA,YAAA;AAClF,IAAA,EAAA,CAAA,YAAA;AACF,IAAA,EAAA,CAAA,YAAA;;;;;AAfwC,IAAA,EAAA,CAAA,SAAA,CAAA,CAAA;AAAA,IAAA,EAAA,CAAA,UAAA,CAAA,OAAA,EAAA,MAAA,CAAA,QAAA;AAExB,IAAA,EAAA,CAAA,SAAA,CAAA,CAAA;AAAA,IAAA,EAAA,CAAA,UAAA,CAAA,OAAA,EAAA,IAAA;AAGiB,IAAA,EAAA,CAAA,SAAA,CAAA,CAAA;AAAA,IAAA,EAAA,CAAA,UAAA,CAAA,SAAA,EAAA,MAAA,CAAA,MAAA;;;;;;;;AAYjC,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,IAAA,EAAA,CAAA;AAAkB,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,iBAAA;AAAe,IAAA,EAAA,CAAA,YAAA;AACjC,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,QAAA,EAAA,CAAA;AAAkC,IAAA,EAAA,CAAA,UAAA,CAAA,OAAA,EAAA,SAAA,8DAAA,GAAA;AAAA,MAAA,EAAA,CAAA,aAAA,CAAA,IAAA;AAAA,YAAA,OAAA,GAAA,EAAA,CAAA,aAAA,EAAA;AAAA,aAAA,OAAA,CAAA,SAAA,EAAA;AAAA,KAAA;AAAsB,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,QAAA;AAAM,IAAA,EAAA,CAAA,YAAA;AAChE,IAAA,EAAA,CAAA,YAAA;AACF,IAAA,EAAA,CAAA,YAAA;;;;;;;;AAEA,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,IAAA,EAAA,CAAA;AAAkB,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,qBAAA;AAAmB,IAAA,EAAA,CAAA,YAAA;AACrC,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,QAAA,EAAA,CAAA;AAAkC,IAAA,EAAA,CAAA,UAAA,CAAA,OAAA,EAAA,SAAA,8DAAA,GAAA;AAAA,MAAA,EAAA,CAAA,aAAA,CAAA,IAAA;AAAA,YAAA,OAAA,GAAA,EAAA,CAAA,aAAA,EAAA;AAAA,aAAA,OAAA,CAAA,cAAA,EAAA;AAAA,KAAA;AAA2B,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,qBAAA;AAAmB,IAAA,EAAA,CAAA,YAAA;AAClF,IAAA,EAAA,CAAA,YAAA;AACF,IAAA,EAAA,CAAA,YAAA;;;;;;;;AAEA,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,IAAA,EAAA,CAAA;AAAkB,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,8BAAA;AAA4B,IAAA,EAAA,CAAA,YAAA;AAC9C,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AACE,IAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,QAAA,EAAA,CAAA;AAAkC,IAAA,EAAA,CAAA,UAAA,CAAA,OAAA,EAAA,SAAA,8DAAA,GAAA;AAAA,MAAA,EAAA,CAAA,aAAA,CAAA,IAAA;AAAA,YAAA,OAAA,GAAA,EAAA,CAAA,aAAA,EAAA;AAAA,aAAA,OAAA,CAAA,UAAA,EAAA;AAAA,KAAA;AAAuB,IAAA,EAAA,CAAA,MAAA,CAAA,CAAA,EAAA,iBAAA;AAAe,IAAA,EAAA,CAAA,YAAA;AAC1E,IAAA,EAAA,CAAA,YAAA;AACF,IAAA,EAAA,CAAA,YAAA;;;;ADzBJ,OAAM,MAAO,uBAAP,CAA8B;AAgBlC,EAAA,WAAA,CACU,WADV,EAEU,MAFV,EAGU,WAHV,EAIU,SAJV,EAKU,cALV,EAKwC;AAJ9B,SAAA,WAAA,GAAA,WAAA;AACA,SAAA,MAAA,GAAA,MAAA;AACA,SAAA,WAAA,GAAA,WAAA;AACA,SAAA,SAAA,GAAA,SAAA;AACA,SAAA,cAAA,GAAA,cAAA;AApBV,SAAA,OAAA,GAAU,EAAV;AACA,SAAA,WAAA,GAAc,EAAd;AACA,SAAA,QAAA,GAAW,EAAX;AACA,SAAA,YAAA,GAAe,KAAf;AACA,SAAA,WAAA,GAAc,KAAd;AACA,SAAA,UAAA,GAAa,KAAb;AAEA,SAAA,aAAA,GAAgC,EAAhC;AACA,SAAA,MAAA,GAAgB,EAAhB;AACA,SAAA,SAAA,GAAmB,EAAnB;AAYK;;AAEC,EAAA,QAAQ,GAAA;AAAA;;AAAA;;;AACZ,MAAA,QAAQ,CAAC,CACP,KAAI,CAAC,cAAL,CAAoB,WAApB,CAAgC,IAAhC,CAAqC,IAAI,CAAC,CAAD,CAAzC,CADO,CAAD,CAAR,CAGG,IAHH,CAII,IAAI,CAAC,CAAD,CAJR,EAKI,SALJ,CAKc,CAAC,CAAC,MAAD,CAAD,KAAa;AACvB,QAAA,KAAI,CAAC,WAAL,GAAmB,MAAM,CAAC,WAA1B;AACA,QAAA,KAAI,CAAC,QAAL,GAAgB,MAAM,CAAC,QAAvB;AACA,QAAA,OAAO,CAAC,GAAR,CAAY,MAAM,CAAC,WAAnB;AACD,OATH;AAUA,UAAI,cAAc,GAAU,EAA5B;AACA,UAAI,WAAW,GAAU,EAAzB;AACA,UAAI,gBAAgB,GAAU,EAA9B;;AAEA,UAAG,KAAI,CAAC,QAAL,IAAiB,OAApB,EAA6B;AAC3B,cAAM,KAAI,CAAC,SAAL,CAAe,UAAf,CAA0B,aAA1B,EAAyC,GAAzC,CAA6C,GAAG,KAAI,CAAC,WAAW,EAAhE,EAAoE,UAApE,CAA+E,UAA/E,EACL,YADK,GAEL,SAFK,CAEM,KAAD,IAAW,KAAK,CAAC,GAAN,CAAU,IAAI,IAAG;AACrC,UAAA,cAAc,CAAC,IAAf,CAAoB,IAApB;AACA,UAAA,WAAW,CAAC,IAAZ,CAAiB;AAAC,YAAA,WAAW,EAAE,IAAI,CAAC,WAAnB;AAAgC,YAAA,QAAQ,EAAE,IAAI,CAAC;AAA/C,WAAjB;AACD,SAHqB,CAFhB,CAAN;AAOA,QAAA,KAAI,CAAC,MAAL,GAAc,WAAd;AACA,QAAA,KAAI,CAAC,SAAL,GAAiB,cAAjB;AAEA,cAAM,KAAI,CAAC,SAAL,CAAe,UAAf,CAA0B,aAA1B,EAAyC,GAAzC,CAA6C,GAAG,KAAI,CAAC,WAAW,EAAhE,EAAoE,UAApE,CAA+E,YAA/E,EAA6F,GAAG,IAAI,GAAG,CAAC,KAAJ,CAAU,UAAV,EAAsB,IAAtB,EAA4B,YAA5B,CAApG,EACL,YADK,GAEL,SAFK,CAEM,UAAD,IAAe;AACxB,UAAA,KAAI,CAAC,UAAL,GAAkB,UAAU,CAAC,CAAD,CAA5B;AACD,SAJK,CAAN;AAKD,OAhBD,MAiBK,IAAG,KAAI,CAAC,QAAL,IAAiB,UAApB,EAAgC;AAEnC,cAAM,KAAI,CAAC,SAAL,CAAe,UAAf,CAA0B,aAA1B,EAAyC,GAAzC,CAA6C,GAAG,KAAI,CAAC,WAAW,EAAhE,EAAoE,UAApE,CAA+E,OAA/E,EAAwF,GAAG,IAAI,GAAG,CAAC,KAAJ,CAAU,OAAV,EAAmB,IAAnB,EAAyB,QAAzB,CAA/F,EACL,YADK,GAEL,SAFK,CAEM,KAAD,IAAU;AACnB,UAAA,KAAI,CAAC,KAAL,GAAa,KAAK,CAAC,CAAD,CAAlB;AACD,SAJK,CAAN;AAKD,OAPI,MAQA,IAAG,KAAI,CAAC,QAAL,IAAiB,OAApB,EAA6B;AAChC,cAAM,KAAI,CAAC,SAAL,CAAe,UAAf,CAA0B,aAA1B,EAAyC,GAAzC,CAA6C,GAAG,KAAI,CAAC,WAAW,EAAhE,EAAoE,UAApE,CAA+E,YAA/E,EAA6F,GAAG,IAAI,GAAG,CAAC,KAAJ,CAAU,UAAV,EAAsB,IAAtB,EAA4B,YAA5B,CAApG,EACL,YADK,GAEL,SAFK,CAEM,UAAD,IAAe;AACxB,UAAA,KAAI,CAAC,UAAL,GAAkB,UAAU,CAAC,CAAD,CAA5B;AACD,SAJK,CAAN;AAKD,OA9CW,CA+CX;;;AAGD,MAAA,KAAI,CAAC,kBAAL,GAA0B,KAAI,CAAC,WAAL,CAAiB,KAAjB,CAAuB;AAC/C,QAAA,OAAO,EAAE,EADsC;AAE/C,QAAA,IAAI,EAAE;AAFyC,OAAvB,CAA1B;AAKA,YAAM,iBAAiB,GAAG,CAAA,EAAA,GAAA,KAAI,CAAC,kBAAL,CAAwB,GAAxB,CAA4B,SAA5B,CAAA,MAAsC,IAAtC,IAAsC,EAAA,KAAA,KAAA,CAAtC,GAAsC,KAAA,CAAtC,GAAsC,EAAA,CAAE,YAAF,CAAe,SAAf,CAAyB,KAAK,IAAG;;;AAC/F,YAAI,KAAK,KAAK,EAAd,EAAkB;AAChB,WAAA,EAAA,GAAA,CAAA,EAAA,GAAA,KAAI,CAAC,kBAAL,MAAuB,IAAvB,IAAuB,EAAA,KAAA,KAAA,CAAvB,GAAuB,KAAA,CAAvB,GAAuB,EAAA,CAAE,GAAF,CAAM,MAAN,CAAvB,MAAoC,IAApC,IAAoC,EAAA,KAAA,KAAA,CAApC,GAAoC,KAAA,CAApC,GAAoC,EAAA,CAAE,MAAF,CAAS;AAAE,YAAA,SAAS,EAAE;AAAb,WAAT,CAApC;AACD,SAFD,MAGK;AACH,WAAA,EAAA,GAAA,CAAA,EAAA,GAAA,KAAI,CAAC,kBAAL,MAAuB,IAAvB,IAAuB,EAAA,KAAA,KAAA,CAAvB,GAAuB,KAAA,CAAvB,GAAuB,EAAA,CAAE,GAAF,CAAM,MAAN,CAAvB,MAAoC,IAApC,IAAoC,EAAA,KAAA,KAAA,CAApC,GAAoC,KAAA,CAApC,GAAoC,EAAA,CAAE,OAAF,CAAU;AAAE,YAAA,SAAS,EAAE;AAAb,WAAV,CAApC;AACD;AACF,OAP+D,CAAhE;;AASA,MAAA,KAAI,CAAC,aAAL,CAAmB,IAAnB,CAAwB,iBAAxB;;AAEA,YAAM,cAAc,GAAG,CAAA,EAAA,GAAA,KAAI,CAAC,kBAAL,CAAwB,GAAxB,CAA4B,MAA5B,CAAA,MAAmC,IAAnC,IAAmC,EAAA,KAAA,KAAA,CAAnC,GAAmC,KAAA,CAAnC,GAAmC,EAAA,CAAE,YAAF,CAAe,SAAf,CAAyB,KAAK,IAAG;;;AACzF,YAAI,KAAK,KAAK,EAAd,EAAkB;AAChB,WAAA,EAAA,GAAA,CAAA,EAAA,GAAA,KAAI,CAAC,kBAAL,MAAuB,IAAvB,IAAuB,EAAA,KAAA,KAAA,CAAvB,GAAuB,KAAA,CAAvB,GAAuB,EAAA,CAAE,GAAF,CAAM,SAAN,CAAvB,MAAuC,IAAvC,IAAuC,EAAA,KAAA,KAAA,CAAvC,GAAuC,KAAA,CAAvC,GAAuC,EAAA,CAAE,MAAF,CAAS;AAAE,YAAA,SAAS,EAAE;AAAb,WAAT,CAAvC;AACD,SAFD,MAGK;AACH,WAAA,EAAA,GAAA,CAAA,EAAA,GAAA,KAAI,CAAC,kBAAL,MAAuB,IAAvB,IAAuB,EAAA,KAAA,KAAA,CAAvB,GAAuB,KAAA,CAAvB,GAAuB,EAAA,CAAE,GAAF,CAAM,SAAN,CAAvB,MAAuC,IAAvC,IAAuC,EAAA,KAAA,KAAA,CAAvC,GAAuC,KAAA,CAAvC,GAAuC,EAAA,CAAE,OAAF,CAAU;AAAE,YAAA,SAAS,EAAE;AAAb,WAAV,CAAvC;AACD;AACF,OAPyD,CAA1D;;AAQA,MAAA,KAAI,CAAC,aAAL,CAAmB,IAAnB,CAAwB,cAAxB;AA1EY;AA2Eb;;AAED,EAAA,WAAW,GAAA;AACT,SAAK,MAAM,IAAX,IAAmB,KAAK,aAAxB,EAAuC;AACrC,MAAA,IAAI,CAAC,WAAL;AACD;AACF;;AAED,EAAA,cAAc,GAAA;AACZ,SAAK,YAAL,GAAoB,IAApB;AACD;;AAED,EAAA,eAAe,GAAA;AACb,SAAK,YAAL,GAAoB,KAApB;AACD;;AAEK,EAAA,gBAAgB,CAAC,QAAD,EAAgB,IAAhB,EAA2B,OAA3B,EAAuC;AAAA;AAC3D,MAAA,OAAO,CAAC,GAAR,CAAY,aAAZ,EAA0B,QAAQ,CAAC,SAAnC;AACA,MAAA,OAAO,CAAC,GAAR,CAAY,YAAZ,EAA0B,IAA1B;AACA,YAAM,OAAO,GAAG;AACd,QAAA,EAAE,EAAE,QAAQ,CAAC,SADC;AAEd,QAAA,KAAK,EAAE,SAFO;AAGd,QAAA,KAAK,EAAE,UAHO;AAId,QAAA,IAAI,EAAE,8BAJQ;AAKd,QAAA,QAAQ,EAAE,MALI;AAMd,QAAA,IAAI,EAAE;AACJ,UAAA,IAAI,EAAE,IADF;AAEJ,UAAA,OAAO,EAAE;AAFL;AANQ,OAAhB;AAWA,YAAM,KAAK,CAAC,sCAAD,EAAyC;AAClD,QAAA,MAAM,EAAE,MAD0C;AAElD,QAAA,OAAO,EAAE;AACP,UAAA,MAAM,EAAE,kBADD;AAEP,6BAAmB,eAFZ;AAGP,0BAAgB;AAHT,SAFyC;AAOlD,QAAA,IAAI,EAAE,SAP4C;AAQlD,QAAA,IAAI,EAAE,IAAI,CAAC,SAAL,CAAe,OAAf;AAR4C,OAAzC,CAAX;AAd2D;AAwB5D;;AAEK,EAAA,aAAa,GAAA;AAAA;;AAAA;AACjB,YAAM,MAAI,CAAC,SAAL,CAAe,UAAf,CAA0B,MAA1B,EAAkC,GAAG,IAAI,GAAG,CAAC,KAAJ,CAAU,aAAV,EAAyB,IAAzB,EAA+B,MAAI,CAAC,QAAL,CAAc,QAA7C,CAAzC,EACH,YADG,GAEH,SAFG,CAEQ,IAAD,IAAU,IAAI,CAAC,GAAL,CAAU,GAAD,IAAQ;AACpC,YAAI,QAAQ,GAAG,GAAf;AACA,YAAI,OAAO,GAAG,MAAI,CAAC,QAAL,CAAc,WAA5B;AACA,YAAI,IAAI,GAAG,EAAX,CAHoC,CAIpC;;AACA,YAAI,OAAJ,EAAa;AACX,gBAAM,QAAQ,GAAG,MAAI,CAAC,WAAL,CAAiB,OAAjB,CAAyB,OAAO,CAAC,QAAR,EAAzB,CAAjB;;AACA,UAAA,IAAI,GAAG,QAAP;;AACA,UAAA,MAAI,CAAC,gBAAL,CAAsB,QAAtB,EAAgC,IAAhC,EAAsC,OAAtC,EAHW,CAIX;;AACD;;AACD,QAAA,MAAI,CAAC,MAAL,CAAY,QAAZ,CAAqB,CAAC,UAAD,CAArB,EAAmC;AAAE,UAAA,WAAW,EAAE;AAAE,YAAA,OAAF;AAAW,YAAA;AAAX;AAAf,SAAnC;AACD,OAZoB,CAFjB,CAAN;AADiB;AAgBlB;;AAEK,EAAA,UAAU,GAAA;AAAA;;AAAA;AACd,YAAM,MAAI,CAAC,SAAL,CAAe,UAAf,CAA0B,MAA1B,EAAkC,GAAG,IAAI,GAAG,CAAC,KAAJ,CAAU,aAAV,EAAyB,IAAzB,EAA+B,MAAI,CAAC,QAAL,CAAc,QAA7C,CAAzC,EACH,YADG,GAEH,SAFG,CAEQ,IAAD,IAAU,IAAI,CAAC,GAAL,CAAU,GAAD,IAAQ;AACpC,YAAI,QAAQ,GAAG,GAAf;AACA,YAAI,OAAO,GAAG,MAAI,CAAC,QAAL,CAAc,WAA5B;AACA,YAAI,IAAI,GAAG,EAAX,CAHoC,CAIpC;;AACA,YAAI,OAAJ,EAAa;AACX,gBAAM,QAAQ,GAAG,MAAI,CAAC,WAAL,CAAiB,OAAjB,CAAyB,OAAO,CAAC,QAAR,EAAzB,CAAjB;;AACA,UAAA,IAAI,GAAG,QAAP;;AACA,UAAA,MAAI,CAAC,gBAAL,CAAsB,QAAtB,EAAgC,IAAhC,EAAsC,OAAtC,EAHW,CAIX;;AACD;;AACD,QAAA,MAAI,CAAC,MAAL,CAAY,QAAZ,CAAqB,CAAC,UAAD,CAArB,EAAmC;AAAE,UAAA,WAAW,EAAE;AAAE,YAAA,OAAF;AAAW,YAAA;AAAX;AAAf,SAAnC;AACD,OAZoB,CAFjB,CAAN;AADc;AAgBf;;AAEK,EAAA,cAAc,GAAA;AAAA;;AAAA;AAClB,MAAA,OAAO,CAAC,GAAR,CAAY,MAAI,CAAC,UAAjB;AAEA,UAAI,SAAS,GAAG,EAAhB;AACA,UAAI,QAAQ,GAAG,gEAAf;;AACA,WAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,IAAI,EAArB,EAAyB,CAAC,EAA1B,EAA8B;AAC5B,QAAA,SAAS,IAAI,QAAQ,CAAC,MAAT,CAAgB,IAAI,CAAC,KAAL,CAAW,IAAI,CAAC,MAAL,KAAgB,QAAQ,CAAC,MAApC,CAAhB,CAAb;AACD;;AAED,YAAM,MAAI,CAAC,SAAL,CAAe,UAAf,CAA0B,MAA1B,EAAkC,GAAG,IAAI,GAAG,CAAC,KAAJ,CAAU,OAAV,EAAmB,IAAnB,EAAyB,MAAI,CAAC,UAAL,CAAgB,KAAzC,CAAzC,EACH,YADG,GAEH,SAFG,CAEQ,IAAD,IAAU,IAAI,CAAC,GAAL,CAAU,GAAD,IAAQ;AACpC,YAAI,UAAU,GAAG,GAAjB;AACA,YAAI,OAAO,GAAG,SAAd;AACA,YAAI,IAAI,GAAG,EAAX,CAHoC,CAIpC;;AACA,YAAI,OAAJ,EAAa;AACX,gBAAM,QAAQ,GAAG,MAAI,CAAC,WAAL,CAAiB,OAAjB,CAAyB,OAAO,CAAC,QAAR,EAAzB,CAAjB;;AACA,UAAA,IAAI,GAAG,QAAP;;AACA,UAAA,MAAI,CAAC,gBAAL,CAAsB,UAAtB,EAAkC,IAAlC,EAAwC,OAAxC,EAHW,CAIX;;AACD;;AACD,QAAA,MAAI,CAAC,MAAL,CAAY,QAAZ,CAAqB,CAAC,UAAD,CAArB,EAAmC;AAAE,UAAA,WAAW,EAAE;AAAE,YAAA,OAAF;AAAW,YAAA;AAAX;AAAf,SAAnC;AACD,OAZoB,CAFjB,CAAN;AATkB;AAwBnB;;AAEK,EAAA,SAAS,GAAA;AAAA;;AAAA;AACb,UAAI,SAAS,GAAG,EAAhB;AACA,UAAI,QAAQ,GAAG,gEAAf;;AACA,WAAK,IAAI,CAAC,GAAG,CAAb,EAAgB,CAAC,IAAI,EAArB,EAAyB,CAAC,EAA1B,EAA8B;AAC5B,QAAA,SAAS,IAAI,QAAQ,CAAC,MAAT,CAAgB,IAAI,CAAC,KAAL,CAAW,IAAI,CAAC,MAAL,KAAgB,QAAQ,CAAC,MAApC,CAAhB,CAAb;AACD;;AACD,YAAM,MAAI,CAAC,SAAL,CAAe,UAAf,CAA0B,MAA1B,EAAkC,GAAG,IAAI,GAAG,CAAC,KAAJ,CAAU,UAAV,EAAsB,IAAtB,EAA4B,MAAI,CAAC,KAAL,CAAW,QAAvC,CAAzC,EACH,YADG,GAEH,SAFG,CAEQ,IAAD,IAAU,IAAI,CAAC,GAAL,CAAU,GAAD,IAAQ;AACpC,YAAI,UAAU,GAAG,GAAjB;AACA,YAAI,OAAO,GAAG,SAAd;AACA,YAAI,IAAI,GAAG,EAAX,CAHoC,CAIpC;;AACA,YAAI,OAAJ,EAAa;AACX,gBAAM,QAAQ,GAAG,MAAI,CAAC,WAAL,CAAiB,OAAjB,CAAyB,OAAO,CAAC,QAAR,EAAzB,CAAjB;;AACA,UAAA,IAAI,GAAG,QAAP;;AACA,UAAA,MAAI,CAAC,gBAAL,CAAsB,UAAtB,EAAkC,IAAlC,EAAwC,OAAxC,EAHW,CAIX;;AACD;;AACD,QAAA,MAAI,CAAC,MAAL,CAAY,QAAZ,CAAqB,CAAC,UAAD,CAArB,EAAmC;AAAE,UAAA,WAAW,EAAE;AAAE,YAAA,OAAF;AAAW,YAAA;AAAX;AAAf,SAAnC;AACD,OAZoB,CAFjB,CAAN;AANa;AAqBd;;AAhOiC;;;mBAAvB,uB,EAAuB,EAAA,CAAA,iBAAA,CAAA,EAAA,CAAA,WAAA,C,EAAA,EAAA,CAAA,iBAAA,CAAA,EAAA,CAAA,MAAA,C,EAAA,EAAA,CAAA,iBAAA,CAAA,EAAA,CAAA,YAAA,C,EAAA,EAAA,CAAA,iBAAA,CAAA,EAAA,CAAA,gBAAA,C,EAAA,EAAA,CAAA,iBAAA,CAAA,EAAA,CAAA,cAAA,C;AAAA,C;;;QAAvB,uB;AAAuB,EAAA,SAAA,EAAA,CAAA,CAAA,qBAAA,CAAA,C;AAAA,EAAA,KAAA,EAAA,C;AAAA,EAAA,IAAA,EAAA,C;AAAA,EAAA,MAAA,EAAA,CAAA,CAAA,CAAA,EAAA,MAAA,CAAA,EAAA,CAAA,CAAA,EAAA,cAAA,CAAA,EAAA,CAAA,CAAA,EAAA,MAAA,CAAA,EAAA,CAAA,CAAA,EAAA,OAAA,CAAA,EAAA,CAAA,aAAA,EAAA,aAAA,EAAA,iBAAA,EAAA,OAAA,EAAA,CAAA,EAAA,OAAA,EAAA,aAAA,CAAA,EAAA,CAAA,CAAA,EAAA,OAAA,CAAA,EAAA,CAAA,CAAA,EAAA,OAAA,EAAA,CAAA,EAAA,OAAA,EAAA,SAAA,CAAA,EAAA,CAAA,CAAA,EAAA,kBAAA,CAAA,EAAA,CAAA,MAAA,EAAA,QAAA,EAAA,CAAA,EAAA,KAAA,EAAA,CAAA,EAAA,OAAA,CAAA,C;AAAA,EAAA,QAAA,EAAA,SAAA,gCAAA,CAAA,EAAA,EAAA,GAAA,EAAA;AAAA,QAAA,EAAA,GAAA,CAAA,EAAA;AChBpC,MAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AACE,MAAA,EAAA,CAAA,cAAA,CAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AAEE,MAAA,EAAA,CAAA,UAAA,CAAA,CAAA,EAAA,sCAAA,EAAA,EAAA,EAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AAmBA,MAAA,EAAA,CAAA,UAAA,CAAA,CAAA,EAAA,sCAAA,EAAA,CAAA,EAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AAOA,MAAA,EAAA,CAAA,UAAA,CAAA,CAAA,EAAA,sCAAA,EAAA,CAAA,EAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AAOA,MAAA,EAAA,CAAA,UAAA,CAAA,CAAA,EAAA,sCAAA,EAAA,CAAA,EAAA,CAAA,EAAA,KAAA,EAAA,CAAA;AAMF,MAAA,EAAA,CAAA,YAAA;AACF,MAAA,EAAA,CAAA,YAAA;;;;AAxCU,MAAA,EAAA,CAAA,SAAA,CAAA,CAAA;AAAA,MAAA,EAAA,CAAA,UAAA,CAAA,MAAA,EAAA,GAAA,CAAA,QAAA,KAAA,OAAA;AAmBA,MAAA,EAAA,CAAA,SAAA,CAAA,CAAA;AAAA,MAAA,EAAA,CAAA,UAAA,CAAA,MAAA,EAAA,GAAA,CAAA,QAAA,KAAA,UAAA;AAOA,MAAA,EAAA,CAAA,SAAA,CAAA,CAAA;AAAA,MAAA,EAAA,CAAA,UAAA,CAAA,MAAA,EAAA,GAAA,CAAA,QAAA,KAAA,OAAA;AAOA,MAAA,EAAA,CAAA,SAAA,CAAA,CAAA;AAAA,MAAA,EAAA,CAAA,UAAA,CAAA,MAAA,EAAA,GAAA,CAAA,QAAA,KAAA,YAAA","sourcesContent":["import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { FormBuilder, FormGroup } from '@angular/forms';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { forkJoin, Observable, Subscription } from 'rxjs';\nimport { TokenService } from '../../shared/services/token.service';\nimport { AngularFirestore, AngularFirestoreDocument } from '@angular/fire/firestore';\nimport { take } from 'rxjs/operators';\nimport { Resident } from 'src/app/shared/models/resident';\nimport { GuardPlace } from 'src/app/shared/models/guardPlace';\nimport { Supervisor } from 'src/app/shared/models/supervisor';\n\n@Component({\n  selector: 'app-meeting-preview',\n  templateUrl: './meeting-preview.component.html',\n  styleUrls: ['./meeting-preview.component.scss']\n})\nexport class MeetingPreviewComponent implements OnInit, OnDestroy {\n  channel = '';\n  condominium = '';\n  userType = '';\n  showSettings = false;\n  joinLoading = false;\n  newLoading = false;\n  connectionInfoForm!: FormGroup;\n  subscriptions: Subscription[] = [];\n  houses: any[] = [];\n  residents: any[] = [];\n  supervisor: any;\n  selected: any;\n  resident: any;\n  guard: any;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private router: Router,\n    private tokeService: TokenService,\n    private firestore: AngularFirestore,\n    private activatedRoute: ActivatedRoute,\n  ) { }\n\n  async ngOnInit(): Promise<void> {\n    forkJoin([\n      this.activatedRoute.queryParams.pipe(take(1)),\n    ])\n      .pipe(\n        take(1),\n      ).subscribe(([params]) => {\n        this.condominium = params.condominium;\n        this.userType = params.userType;\n        console.log(params.condominium)\n      });\n    let residentsArray: any[] = [];\n    let housesArray: any[] = [];\n    let supervisorsArray: any[] = [];\n    \n    if(this.userType == 'guard') {\n      await this.firestore.collection(\"condominium\").doc(`${this.condominium}`).collection('resident')\n      .valueChanges()\n      .subscribe((items) => items.map(item => {\n        residentsArray.push(item);\n        housesArray.push({houseNumber: item.houseNumber, resident: item.residentNum});\n      }));\n    \n      this.houses = housesArray;   \n      this.residents = residentsArray; \n\n      await this.firestore.collection(\"condominium\").doc(`${this.condominium}`).collection('supervisor', ref => ref.where('userType', '==', 'supervisor'))\n      .valueChanges()\n      .subscribe((supervisor) => {\n        this.supervisor = supervisor[0];\n      });\n    }\n    else if(this.userType == 'resident') {\n      \n      await this.firestore.collection(\"condominium\").doc(`${this.condominium}`).collection('guard', ref => ref.where('place', '==', 'Caseta'))\n      .valueChanges()\n      .subscribe((guard) => {\n        this.guard = guard[0];\n      });\n    }\n    else if(this.userType == 'guard') {\n      await this.firestore.collection(\"condominium\").doc(`${this.condominium}`).collection('supervisor', ref => ref.where('userType', '==', 'supervisor'))\n      .valueChanges()\n      .subscribe((supervisor) => {\n        this.supervisor = supervisor[0];\n      });\n    }\n     // ToDo: add function to each user type\n    \n\n    this.connectionInfoForm = this.formBuilder.group({\n      channel: '',\n      link: '',\n    });\n\n    const channelChangeSubs = this.connectionInfoForm.get('channel')?.valueChanges.subscribe(value => {\n      if (value === '') {\n        this.connectionInfoForm?.get('link')?.enable({ emitEvent: false });\n      }\n      else {\n        this.connectionInfoForm?.get('link')?.disable({ emitEvent: false });\n      }\n    });\n\n    this.subscriptions.push(channelChangeSubs as Subscription);\n\n    const linkChangeSubs = this.connectionInfoForm.get('link')?.valueChanges.subscribe(value => {\n      if (value === '') {\n        this.connectionInfoForm?.get('channel')?.enable({ emitEvent: false });\n      }\n      else {\n        this.connectionInfoForm?.get('channel')?.disable({ emitEvent: false });\n      }\n    });\n    this.subscriptions.push(linkChangeSubs as Subscription);\n  }\n\n  ngOnDestroy(): void {\n    for (const subs of this.subscriptions) {\n      subs.unsubscribe();\n    }\n  }\n\n  onShowSettings(): void {\n    this.showSettings = true;\n  }\n\n  onCloseSettings(): void {\n    this.showSettings = false;\n  }\n\n  async sendNotification(resident: any, link: any, channel: any): Promise<void> {\n    console.log('Token: =>> ',resident.expoToken);\n    console.log('Link: =>> ', link)\n    const message = {\n      to: resident.expoToken,\n      sound: 'default',\n      title: 'Fereg SR',\n      body: 'Tienes una llamada entrante.',\n      priority: 'high',\n      data: { \n        link: link,\n        channel: channel\n      },\n    };\n    await fetch('https://exp.host/--/api/v2/push/send', {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Accept-encoding': 'gzip, deflate',\n        'Content-Type': 'application/json',\n      },\n      mode: 'no-cors',\n      body: JSON.stringify(message),\n    });\n  }\n\n  async onJoinMeeting(): Promise<void> {\n    await this.firestore.collection(\"user\", ref => ref.where('residentNum', '==', this.selected.resident))\n      .valueChanges()\n      .subscribe((data) => data.map((res) => {\n        let resident = res as Resident\n        let channel = this.selected.houseNumber;\n        let link = '';\n        // const { channel, link } = this.connectionInfoForm?.value;\n        if (channel) {\n          const joinLink = this.tokeService.getLink(channel.toString());\n          link = joinLink;\n          this.sendNotification(resident, link, channel);\n          // alert(`You can Invite other people using the link: ${joinLink}`);\n        }\n        this.router.navigate(['/meeting'], { queryParams: { channel, link } });\n      }));    \n  }\n\n  async callCenter(): Promise<void> {\n    await this.firestore.collection(\"user\", ref => ref.where('residentNum', '==', this.selected.resident))\n      .valueChanges()\n      .subscribe((data) => data.map((res) => {\n        let resident = res as Resident\n        let channel = this.selected.houseNumber;\n        let link = '';\n        // const { channel, link } = this.connectionInfoForm?.value;\n        if (channel) {\n          const joinLink = this.tokeService.getLink(channel.toString());\n          link = joinLink;\n          this.sendNotification(resident, link, channel);\n          // alert(`You can Invite other people using the link: ${joinLink}`);\n        }\n        this.router.navigate(['/meeting'], { queryParams: { channel, link } });\n      }));    \n  }\n\n  async callSupervisor(): Promise<void> {\n    console.log(this.supervisor)\n\n    var channelId = \"\";\n    var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    for (var i = 0; i <= 10; i++) {\n      channelId += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    await this.firestore.collection(\"user\", ref => ref.where('email', '==', this.supervisor.email))\n      .valueChanges()\n      .subscribe((data) => data.map((res) => {\n        let supervisor = res as Supervisor\n        let channel = channelId;\n        let link = '';\n        // const { channel, link } = this.connectionInfoForm?.value;\n        if (channel) {\n          const joinLink = this.tokeService.getLink(channel.toString());\n          link = joinLink;\n          this.sendNotification(supervisor, link, channel);\n          // alert(`You can Invite other people using the link: ${joinLink}`);\n        }\n        this.router.navigate(['/meeting'], { queryParams: { channel, link } });\n      }));    \n  }\n\n  async callGuard(): Promise<void> {\n    var channelId = \"\";\n    var possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    for (var i = 0; i <= 10; i++) {\n      channelId += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n    await this.firestore.collection(\"user\", ref => ref.where('guardNum', '==', this.guard.guardNum))\n      .valueChanges()\n      .subscribe((data) => data.map((res) => {\n        let guardPlace = res as GuardPlace\n        let channel = channelId;\n        let link = '';\n        // const { channel, link } = this.connectionInfoForm?.value;\n        if (channel) {\n          const joinLink = this.tokeService.getLink(channel.toString());\n          link = joinLink;\n          this.sendNotification(guardPlace, link, channel);\n          // alert(`You can Invite other people using the link: ${joinLink}`);\n        }\n        this.router.navigate(['/meeting'], { queryParams: { channel, link } });\n      })); \n  }\n\n  \n}\n","<div class=\"page\">\n  <div class=\"meeting-info\">\n    <!-- Guard -->\n    <div *ngIf=\"userType === 'guard'\">\n      <h5 class=\"title\">Llamar a residente</h5>\n      <mat-select placeholder=\"Residencias\" [(value)]=\"selected\"\n                  formControlName=\"label\">\n        <mat-option [value]=\"null\">\n          Residencias\n        </mat-option>\n        <mat-option *ngFor=\"let item of houses\" [value]=\"item\">\n          Casa - {{item.houseNumber}}\n        </mat-option>\n      </mat-select>\n      <div class=\"button-container\">\n        <button class=\"btn\" type=\"submit\" (click)=\"onJoinMeeting()\">Llamar</button>\n      </div>\n      <div class=\"button-container\">\n        <button class=\"btn\" type=\"submit\" (click)=\"callSupervisor()\">Llamar a supervisor</button>\n      </div>\n    </div>\n    <!-- Resident -->\n    <div *ngIf=\"userType === 'resident'\">\n      <h5 class=\"title\">Llamar a caseta</h5>\n      <div class=\"button-container\">\n        <button class=\"btn\" type=\"submit\" (click)=\"callGuard()\">Llamar</button>\n      </div>\n    </div>\n    <!-- Admin -->\n    <div *ngIf=\"userType === 'admin'\">\n      <h5 class=\"title\">Llamar a Supervisor</h5>\n      <div class=\"button-container\">\n        <button class=\"btn\" type=\"submit\" (click)=\"callSupervisor()\">Llamar a supervisor</button>\n      </div>\n    </div>\n    <!-- Supervisor -->\n    <div *ngIf=\"userType === 'supervisor'\">\n      <h5 class=\"title\">Llamar a centro de monitoreo</h5>\n      <div class=\"button-container\">\n        <button class=\"btn\" type=\"submit\" (click)=\"callCenter()\">Llamar a centro</button>\n      </div>\n    </div>\n  </div> \n</div>"],"sourceRoot":""},"metadata":{},"sourceType":"module"}